var _y=Object.create;var _o=Object.defineProperty;var Wy=Object.getOwnPropertyDescriptor;var zy=Object.getOwnPropertyNames;var Ay=Object.getPrototypeOf,Py=Object.prototype.hasOwnProperty;var Le=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),jn=(t,e)=>{for(var r in e)_o(t,r,{get:e[r],enumerable:!0})},Hy=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of zy(e))!Py.call(t,a)&&a!==r&&_o(t,a,{get:()=>e[a],enumerable:!(n=Wy(e,a))||n.enumerable});return t};var Kn=(t,e,r)=>(r=t!=null?_y(Ay(t)):{},Hy(e||!t||!t.__esModule?_o(r,"default",{value:t,enumerable:!0}):r,t));var ki=Le((cW,Fl)=>{"use strict";Fl.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,a,i;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!t(e[a],r[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[a]))return!1;for(a=n;a--!==0;){var s=i[a];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r}});var tc=Le((fW,bl)=>{"use strict";var kl=Object.prototype.toString;bl.exports=function(e){var r=kl.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&kl.call(e.callee)==="[object Function]"),n}});var Pl=Le((uW,Al)=>{"use strict";var zl;Object.keys||(Da=Object.prototype.hasOwnProperty,rc=Object.prototype.toString,Ul=tc(),nc=Object.prototype.propertyIsEnumerable,Nl=!nc.call({toString:null},"toString"),Bl=nc.call(function(){},"prototype"),La=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],bi=function(t){var e=t.constructor;return e&&e.prototype===t},Gl={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},_l=(function(){if(typeof window>"u")return!1;for(var t in window)try{if(!Gl["$"+t]&&Da.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{bi(window[t])}catch{return!0}}catch{return!0}return!1})(),Wl=function(t){if(typeof window>"u"||!_l)return bi(t);try{return bi(t)}catch{return!1}},zl=function(e){var r=e!==null&&typeof e=="object",n=rc.call(e)==="[object Function]",a=Ul(e),i=r&&rc.call(e)==="[object String]",s=[];if(!r&&!n&&!a)throw new TypeError("Object.keys called on a non-object");var o=Bl&&n;if(i&&e.length>0&&!Da.call(e,0))for(var c=0;c<e.length;++c)s.push(String(c));if(a&&e.length>0)for(var f=0;f<e.length;++f)s.push(String(f));else for(var l in e)!(o&&l==="prototype")&&Da.call(e,l)&&s.push(String(l));if(Nl)for(var u=Wl(e),g=0;g<La.length;++g)!(u&&La[g]==="constructor")&&Da.call(e,La[g])&&s.push(La[g]);return s});var Da,rc,Ul,nc,Nl,Bl,La,bi,Gl,_l,Wl;Al.exports=zl});var Kl=Le((lW,jl)=>{"use strict";var HC=Array.prototype.slice,IC=tc(),Hl=Object.keys,Ui=Hl?function(e){return Hl(e)}:Pl(),Il=Object.keys;Ui.shim=function(){if(Object.keys){var e=(function(){var r=Object.keys(arguments);return r&&r.length===arguments.length})(1,2);e||(Object.keys=function(n){return IC(n)?Il(HC.call(n)):Il(n)})}else Object.keys=Ui;return Object.keys||Ui};jl.exports=Ui});var ac=Le((gW,$l)=>{"use strict";var Ni=Object.defineProperty||!1;if(Ni)try{Ni({},"a",{value:1})}catch{Ni=!1}$l.exports=Ni});var Yl=Le((pW,Xl)=>{"use strict";Xl.exports=SyntaxError});var Zl=Le((hW,ql)=>{"use strict";ql.exports=TypeError});var Jl=Le((dW,Ql)=>{"use strict";Ql.exports=Object.getOwnPropertyDescriptor});var tg=Le((vW,eg)=>{"use strict";var Bi=Jl();if(Bi)try{Bi([],"length")}catch{Bi=null}eg.exports=Bi});var ig=Le((mW,ag)=>{"use strict";var rg=ac(),jC=Yl(),$n=Zl(),ng=tg();ag.exports=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new $n("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new $n("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $n("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $n("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $n("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $n("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,c=!!ng&&ng(e,r);if(rg)rg(e,r,{configurable:s===null&&c?c.configurable:!s,enumerable:a===null&&c?c.enumerable:!a,value:n,writable:i===null&&c?c.writable:!i});else if(o||!a&&!i&&!s)e[r]=n;else throw new jC("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var cg=Le((xW,og)=>{"use strict";var ic=ac(),sg=function(){return!!ic};sg.hasArrayLengthDefineBug=function(){if(!ic)return null;try{return ic([],"length",{value:1}).length!==1}catch{return!0}};og.exports=sg});var sc=Le((yW,gg)=>{"use strict";var KC=Kl(),$C=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",XC=Object.prototype.toString,YC=Array.prototype.concat,fg=ig(),qC=function(t){return typeof t=="function"&&XC.call(t)==="[object Function]"},ug=cg()(),ZC=function(t,e,r,n){if(e in t){if(n===!0){if(t[e]===r)return}else if(!qC(n)||!n())return}ug?fg(t,e,r,!0):fg(t,e,r)},lg=function(t,e){var r=arguments.length>2?arguments[2]:{},n=KC(e);$C&&(n=YC.call(n,Object.getOwnPropertySymbols(e)));for(var a=0;a<n.length;a+=1)ZC(t,n[a],e[n[a]],r[n[a]])};lg.supportsDescriptors=!!ug;gg.exports=lg});var oc=Le((TW,Gi)=>{"use strict";typeof self<"u"?Gi.exports=self:typeof window<"u"?Gi.exports=window:Gi.exports=Function("return this")()});var cc=Le((SW,pg)=>{"use strict";var QC=oc();pg.exports=function(){return typeof global!="object"||!global||global.Math!==Math||global.Array!==Array?QC:global}});var dg=Le((CW,hg)=>{"use strict";var JC=sc(),e2=cc();hg.exports=function(){var e=e2();if(JC.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||!r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e}});var yg=Le((wW,xg)=>{"use strict";var t2=sc(),r2=oc(),vg=cc(),n2=dg(),a2=vg(),mg=function(){return a2};t2(mg,{getPolyfill:vg,implementation:r2,shim:n2});xg.exports=mg});var tp=Le((ep,mc)=>{(function(t,e,r){function n(o){var c=this,f=s();c.next=function(){var l=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=l-(c.c=l|0)},c.c=1,c.s0=f(" "),c.s1=f(" "),c.s2=f(" "),c.s0-=f(o),c.s0<0&&(c.s0+=1),c.s1-=f(o),c.s1<0&&(c.s1+=1),c.s2-=f(o),c.s2<0&&(c.s2+=1),f=null}function a(o,c){return c.c=o.c,c.s0=o.s0,c.s1=o.s1,c.s2=o.s2,c}function i(o,c){var f=new n(o),l=c&&c.state,u=f.next;return u.int32=function(){return f.next()*4294967296|0},u.double=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.quick=u,l&&(typeof l=="object"&&a(l,f),u.state=function(){return a(f,{})}),u}function s(){var o=4022871197,c=function(f){f=String(f);for(var l=0;l<f.length;l++){o+=f.charCodeAt(l);var u=.02519603282416938*o;o=u>>>0,u-=o,u*=o,o=u>>>0,u-=o,o+=u*4294967296}return(o>>>0)*23283064365386963e-26};return c}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.alea=i})(ep,typeof mc=="object"&&mc,typeof define=="function"&&define)});var np=Le((rp,xc)=>{(function(t,e,r){function n(s){var o=this,c="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var l=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^l^l>>>8},s===(s|0)?o.x=s:c+=s;for(var f=0;f<c.length+64;f++)o.x^=c.charCodeAt(f)|0,o.next()}function a(s,o){return o.x=s.x,o.y=s.y,o.z=s.z,o.w=s.w,o}function i(s,o){var c=new n(s),f=o&&o.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var u=c.next()>>>11,g=(c.next()>>>0)/4294967296,p=(u+g)/(1<<21);while(p===0);return p},l.int32=c.next,l.quick=l,f&&(typeof f=="object"&&a(f,c),l.state=function(){return a(c,{})}),l}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.xor128=i})(rp,typeof xc=="object"&&xc,typeof define=="function"&&define)});var ip=Le((ap,yc)=>{(function(t,e,r){function n(s){var o=this,c="";o.next=function(){var l=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(l^l<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,s===(s|0)?o.x=s:c+=s;for(var f=0;f<c.length+64;f++)o.x^=c.charCodeAt(f)|0,f==c.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function a(s,o){return o.x=s.x,o.y=s.y,o.z=s.z,o.w=s.w,o.v=s.v,o.d=s.d,o}function i(s,o){var c=new n(s),f=o&&o.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var u=c.next()>>>11,g=(c.next()>>>0)/4294967296,p=(u+g)/(1<<21);while(p===0);return p},l.int32=c.next,l.quick=l,f&&(typeof f=="object"&&a(f,c),l.state=function(){return a(c,{})}),l}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.xorwow=i})(ap,typeof yc=="object"&&yc,typeof define=="function"&&define)});var op=Le((sp,Tc)=>{(function(t,e,r){function n(s){var o=this;o.next=function(){var f=o.x,l=o.i,u,g,p;return u=f[l],u^=u>>>7,g=u^u<<24,u=f[l+1&7],g^=u^u>>>10,u=f[l+3&7],g^=u^u>>>3,u=f[l+4&7],g^=u^u<<7,u=f[l+7&7],u=u^u<<13,g^=u^u<<9,f[l]=g,o.i=l+1&7,g};function c(f,l){var u,g,p=[];if(l===(l|0))g=p[0]=l;else for(l=""+l,u=0;u<l.length;++u)p[u&7]=p[u&7]<<15^l.charCodeAt(u)+p[u+1&7]<<13;for(;p.length<8;)p.push(0);for(u=0;u<8&&p[u]===0;++u);for(u==8?g=p[7]=-1:g=p[u],f.x=p,f.i=0,u=256;u>0;--u)f.next()}c(o,s)}function a(s,o){return o.x=s.x.slice(),o.i=s.i,o}function i(s,o){s==null&&(s=+new Date);var c=new n(s),f=o&&o.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var u=c.next()>>>11,g=(c.next()>>>0)/4294967296,p=(u+g)/(1<<21);while(p===0);return p},l.int32=c.next,l.quick=l,f&&(f.x&&a(f,c),l.state=function(){return a(c,{})}),l}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.xorshift7=i})(sp,typeof Tc=="object"&&Tc,typeof define=="function"&&define)});var fp=Le((cp,Sc)=>{(function(t,e,r){function n(s){var o=this;o.next=function(){var f=o.w,l=o.X,u=o.i,g,p;return o.w=f=f+1640531527|0,p=l[u+34&127],g=l[u=u+1&127],p^=p<<13,g^=g<<17,p^=p>>>15,g^=g>>>12,p=l[u]=p^g,o.i=u,p+(f^f>>>16)|0};function c(f,l){var u,g,p,d,h,v=[],x=128;for(l===(l|0)?(g=l,l=null):(l=l+"\0",g=0,x=Math.max(x,l.length)),p=0,d=-32;d<x;++d)l&&(g^=l.charCodeAt((d+32)%l.length)),d===0&&(h=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,d>=0&&(h=h+1640531527|0,u=v[d&127]^=g+h,p=u==0?p+1:0);for(p>=128&&(v[(l&&l.length||0)&127]=-1),p=127,d=512;d>0;--d)g=v[p+34&127],u=v[p=p+1&127],g^=g<<13,u^=u<<17,g^=g>>>15,u^=u>>>12,v[p]=g^u;f.w=h,f.X=v,f.i=p}c(o,s)}function a(s,o){return o.i=s.i,o.w=s.w,o.X=s.X.slice(),o}function i(s,o){s==null&&(s=+new Date);var c=new n(s),f=o&&o.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var u=c.next()>>>11,g=(c.next()>>>0)/4294967296,p=(u+g)/(1<<21);while(p===0);return p},l.int32=c.next,l.quick=l,f&&(f.X&&a(f,c),l.state=function(){return a(c,{})}),l}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.xor4096=i})(cp,typeof Sc=="object"&&Sc,typeof define=="function"&&define)});var lp=Le((up,Cc)=>{(function(t,e,r){function n(s){var o=this,c="";o.next=function(){var l=o.b,u=o.c,g=o.d,p=o.a;return l=l<<25^l>>>7^u,u=u-g|0,g=g<<24^g>>>8^p,p=p-l|0,o.b=l=l<<20^l>>>12^u,o.c=u=u-g|0,o.d=g<<16^u>>>16^p,o.a=p-l|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,s===Math.floor(s)?(o.a=s/4294967296|0,o.b=s|0):c+=s;for(var f=0;f<c.length+20;f++)o.b^=c.charCodeAt(f)|0,o.next()}function a(s,o){return o.a=s.a,o.b=s.b,o.c=s.c,o.d=s.d,o}function i(s,o){var c=new n(s),f=o&&o.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var u=c.next()>>>11,g=(c.next()>>>0)/4294967296,p=(u+g)/(1<<21);while(p===0);return p},l.int32=c.next,l.quick=l,f&&(typeof f=="object"&&a(f,c),l.state=function(){return a(c,{})}),l}e&&e.exports?e.exports=i:r&&r.amd?r(function(){return i}):this.tychei=i})(up,typeof Cc=="object"&&Cc,typeof define=="function"&&define)});var gp=Le(()=>{});var hp=Le((pp,Ki)=>{(function(t,e,r){var n=256,a=6,i=52,s="random",o=r.pow(n,a),c=r.pow(2,i),f=c*2,l=n-1,u;function g(m,y,S){var C=[];y=y==!0?{entropy:!0}:y||{};var E=v(h(y.entropy?[m,T(e)]:m??x(),3),C),O=new p(C),U=function(){for(var k=O.g(a),V=o,b=0;k<c;)k=(k+b)*n,V*=n,b=O.g(1);for(;k>=f;)k/=2,V/=2,b>>>=1;return(k+b)/V};return U.int32=function(){return O.g(4)|0},U.quick=function(){return O.g(4)/4294967296},U.double=U,v(T(O.S),e),(y.pass||S||function(k,V,b,R){return R&&(R.S&&d(R,O),k.state=function(){return d(O,{})}),b?(r[s]=k,V):k})(U,E,"global"in y?y.global:this==r,y.state)}function p(m){var y,S=m.length,C=this,E=0,O=C.i=C.j=0,U=C.S=[];for(S||(m=[S++]);E<n;)U[E]=E++;for(E=0;E<n;E++)U[E]=U[O=l&O+m[E%S]+(y=U[E])],U[O]=y;(C.g=function(k){for(var V,b=0,R=C.i,M=C.j,N=C.S;k--;)V=N[R=l&R+1],b=b*n+N[l&(N[R]=N[M=l&M+V])+(N[M]=V)];return C.i=R,C.j=M,b})(n)}function d(m,y){return y.i=m.i,y.j=m.j,y.S=m.S.slice(),y}function h(m,y){var S=[],C=typeof m,E;if(y&&C=="object")for(E in m)try{S.push(h(m[E],y-1))}catch{}return S.length?S:C=="string"?m:m+"\0"}function v(m,y){for(var S=m+"",C,E=0;E<S.length;)y[l&E]=l&(C^=y[l&E]*19)+S.charCodeAt(E++);return T(y)}function x(){try{var m;return u&&(m=u.randomBytes)?m=m(n):(m=new Uint8Array(n),(t.crypto||t.msCrypto).getRandomValues(m)),T(m)}catch{var y=t.navigator,S=y&&y.plugins;return[+new Date,t,S,t.screen,T(e)]}}function T(m){return String.fromCharCode.apply(0,m)}if(v(r.random(),e),typeof Ki=="object"&&Ki.exports){Ki.exports=g;try{u=gp()}catch{}}else typeof define=="function"&&define.amd?define(function(){return g}):r["seed"+s]=g})(typeof self<"u"?self:pp,[],Math)});var vp=Le((XW,dp)=>{var U2=tp(),N2=np(),B2=ip(),G2=op(),_2=fp(),W2=lp(),ln=hp();ln.alea=U2;ln.xor128=N2;ln.xorwow=B2;ln.xorshift7=G2;ln.xor4096=_2;ln.tychei=W2;dp.exports=ln});var b1=Le((F1,k1)=>{(function(t){if(typeof F1=="object")k1.exports=t();else if(typeof define=="function"&&define.amd)define(t);else{var e;try{e=window}catch{e=self}e.SparkMD5=t()}})(function(t){"use strict";var e=function(x,T){return x+T&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(x,T,m,y,S,C){return T=e(e(T,x),e(y,C)),e(T<<S|T>>>32-S,m)}function a(x,T){var m=x[0],y=x[1],S=x[2],C=x[3];m+=(y&S|~y&C)+T[0]-680876936|0,m=(m<<7|m>>>25)+y|0,C+=(m&y|~m&S)+T[1]-389564586|0,C=(C<<12|C>>>20)+m|0,S+=(C&m|~C&y)+T[2]+606105819|0,S=(S<<17|S>>>15)+C|0,y+=(S&C|~S&m)+T[3]-1044525330|0,y=(y<<22|y>>>10)+S|0,m+=(y&S|~y&C)+T[4]-176418897|0,m=(m<<7|m>>>25)+y|0,C+=(m&y|~m&S)+T[5]+1200080426|0,C=(C<<12|C>>>20)+m|0,S+=(C&m|~C&y)+T[6]-1473231341|0,S=(S<<17|S>>>15)+C|0,y+=(S&C|~S&m)+T[7]-45705983|0,y=(y<<22|y>>>10)+S|0,m+=(y&S|~y&C)+T[8]+1770035416|0,m=(m<<7|m>>>25)+y|0,C+=(m&y|~m&S)+T[9]-1958414417|0,C=(C<<12|C>>>20)+m|0,S+=(C&m|~C&y)+T[10]-42063|0,S=(S<<17|S>>>15)+C|0,y+=(S&C|~S&m)+T[11]-1990404162|0,y=(y<<22|y>>>10)+S|0,m+=(y&S|~y&C)+T[12]+1804603682|0,m=(m<<7|m>>>25)+y|0,C+=(m&y|~m&S)+T[13]-40341101|0,C=(C<<12|C>>>20)+m|0,S+=(C&m|~C&y)+T[14]-1502002290|0,S=(S<<17|S>>>15)+C|0,y+=(S&C|~S&m)+T[15]+1236535329|0,y=(y<<22|y>>>10)+S|0,m+=(y&C|S&~C)+T[1]-165796510|0,m=(m<<5|m>>>27)+y|0,C+=(m&S|y&~S)+T[6]-1069501632|0,C=(C<<9|C>>>23)+m|0,S+=(C&y|m&~y)+T[11]+643717713|0,S=(S<<14|S>>>18)+C|0,y+=(S&m|C&~m)+T[0]-373897302|0,y=(y<<20|y>>>12)+S|0,m+=(y&C|S&~C)+T[5]-701558691|0,m=(m<<5|m>>>27)+y|0,C+=(m&S|y&~S)+T[10]+38016083|0,C=(C<<9|C>>>23)+m|0,S+=(C&y|m&~y)+T[15]-660478335|0,S=(S<<14|S>>>18)+C|0,y+=(S&m|C&~m)+T[4]-405537848|0,y=(y<<20|y>>>12)+S|0,m+=(y&C|S&~C)+T[9]+568446438|0,m=(m<<5|m>>>27)+y|0,C+=(m&S|y&~S)+T[14]-1019803690|0,C=(C<<9|C>>>23)+m|0,S+=(C&y|m&~y)+T[3]-187363961|0,S=(S<<14|S>>>18)+C|0,y+=(S&m|C&~m)+T[8]+1163531501|0,y=(y<<20|y>>>12)+S|0,m+=(y&C|S&~C)+T[13]-1444681467|0,m=(m<<5|m>>>27)+y|0,C+=(m&S|y&~S)+T[2]-51403784|0,C=(C<<9|C>>>23)+m|0,S+=(C&y|m&~y)+T[7]+1735328473|0,S=(S<<14|S>>>18)+C|0,y+=(S&m|C&~m)+T[12]-1926607734|0,y=(y<<20|y>>>12)+S|0,m+=(y^S^C)+T[5]-378558|0,m=(m<<4|m>>>28)+y|0,C+=(m^y^S)+T[8]-2022574463|0,C=(C<<11|C>>>21)+m|0,S+=(C^m^y)+T[11]+1839030562|0,S=(S<<16|S>>>16)+C|0,y+=(S^C^m)+T[14]-35309556|0,y=(y<<23|y>>>9)+S|0,m+=(y^S^C)+T[1]-1530992060|0,m=(m<<4|m>>>28)+y|0,C+=(m^y^S)+T[4]+1272893353|0,C=(C<<11|C>>>21)+m|0,S+=(C^m^y)+T[7]-155497632|0,S=(S<<16|S>>>16)+C|0,y+=(S^C^m)+T[10]-1094730640|0,y=(y<<23|y>>>9)+S|0,m+=(y^S^C)+T[13]+681279174|0,m=(m<<4|m>>>28)+y|0,C+=(m^y^S)+T[0]-358537222|0,C=(C<<11|C>>>21)+m|0,S+=(C^m^y)+T[3]-722521979|0,S=(S<<16|S>>>16)+C|0,y+=(S^C^m)+T[6]+76029189|0,y=(y<<23|y>>>9)+S|0,m+=(y^S^C)+T[9]-640364487|0,m=(m<<4|m>>>28)+y|0,C+=(m^y^S)+T[12]-421815835|0,C=(C<<11|C>>>21)+m|0,S+=(C^m^y)+T[15]+530742520|0,S=(S<<16|S>>>16)+C|0,y+=(S^C^m)+T[2]-995338651|0,y=(y<<23|y>>>9)+S|0,m+=(S^(y|~C))+T[0]-198630844|0,m=(m<<6|m>>>26)+y|0,C+=(y^(m|~S))+T[7]+1126891415|0,C=(C<<10|C>>>22)+m|0,S+=(m^(C|~y))+T[14]-1416354905|0,S=(S<<15|S>>>17)+C|0,y+=(C^(S|~m))+T[5]-57434055|0,y=(y<<21|y>>>11)+S|0,m+=(S^(y|~C))+T[12]+1700485571|0,m=(m<<6|m>>>26)+y|0,C+=(y^(m|~S))+T[3]-1894986606|0,C=(C<<10|C>>>22)+m|0,S+=(m^(C|~y))+T[10]-1051523|0,S=(S<<15|S>>>17)+C|0,y+=(C^(S|~m))+T[1]-2054922799|0,y=(y<<21|y>>>11)+S|0,m+=(S^(y|~C))+T[8]+1873313359|0,m=(m<<6|m>>>26)+y|0,C+=(y^(m|~S))+T[15]-30611744|0,C=(C<<10|C>>>22)+m|0,S+=(m^(C|~y))+T[6]-1560198380|0,S=(S<<15|S>>>17)+C|0,y+=(C^(S|~m))+T[13]+1309151649|0,y=(y<<21|y>>>11)+S|0,m+=(S^(y|~C))+T[4]-145523070|0,m=(m<<6|m>>>26)+y|0,C+=(y^(m|~S))+T[11]-1120210379|0,C=(C<<10|C>>>22)+m|0,S+=(m^(C|~y))+T[2]+718787259|0,S=(S<<15|S>>>17)+C|0,y+=(C^(S|~m))+T[9]-343485551|0,y=(y<<21|y>>>11)+S|0,x[0]=m+x[0]|0,x[1]=y+x[1]|0,x[2]=S+x[2]|0,x[3]=C+x[3]|0}function i(x){var T=[],m;for(m=0;m<64;m+=4)T[m>>2]=x.charCodeAt(m)+(x.charCodeAt(m+1)<<8)+(x.charCodeAt(m+2)<<16)+(x.charCodeAt(m+3)<<24);return T}function s(x){var T=[],m;for(m=0;m<64;m+=4)T[m>>2]=x[m]+(x[m+1]<<8)+(x[m+2]<<16)+(x[m+3]<<24);return T}function o(x){var T=x.length,m=[1732584193,-271733879,-1732584194,271733878],y,S,C,E,O,U;for(y=64;y<=T;y+=64)a(m,i(x.substring(y-64,y)));for(x=x.substring(y-64),S=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;y<S;y+=1)C[y>>2]|=x.charCodeAt(y)<<(y%4<<3);if(C[y>>2]|=128<<(y%4<<3),y>55)for(a(m,C),y=0;y<16;y+=1)C[y]=0;return E=T*8,E=E.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(E[2],16),U=parseInt(E[1],16)||0,C[14]=O,C[15]=U,a(m,C),m}function c(x){var T=x.length,m=[1732584193,-271733879,-1732584194,271733878],y,S,C,E,O,U;for(y=64;y<=T;y+=64)a(m,s(x.subarray(y-64,y)));for(x=y-64<T?x.subarray(y-64):new Uint8Array(0),S=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;y<S;y+=1)C[y>>2]|=x[y]<<(y%4<<3);if(C[y>>2]|=128<<(y%4<<3),y>55)for(a(m,C),y=0;y<16;y+=1)C[y]=0;return E=T*8,E=E.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(E[2],16),U=parseInt(E[1],16)||0,C[14]=O,C[15]=U,a(m,C),m}function f(x){var T="",m;for(m=0;m<4;m+=1)T+=r[x>>m*8+4&15]+r[x>>m*8&15];return T}function l(x){var T;for(T=0;T<x.length;T+=1)x[T]=f(x[T]);return x.join("")}l(o("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(x,T){var m=(x&65535)+(T&65535),y=(x>>16)+(T>>16)+(m>>16);return y<<16|m&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function x(T,m){return T=T|0||0,T<0?Math.max(T+m,0):Math.min(T,m)}ArrayBuffer.prototype.slice=function(T,m){var y=this.byteLength,S=x(T,y),C=y,E,O,U,k;return m!==t&&(C=x(m,y)),S>C?new ArrayBuffer(0):(E=C-S,O=new ArrayBuffer(E),U=new Uint8Array(O),k=new Uint8Array(this,S,E),U.set(k),O)}})();function u(x){return/[\u0080-\uFFFF]/.test(x)&&(x=unescape(encodeURIComponent(x))),x}function g(x,T){var m=x.length,y=new ArrayBuffer(m),S=new Uint8Array(y),C;for(C=0;C<m;C+=1)S[C]=x.charCodeAt(C);return T?S:y}function p(x){return String.fromCharCode.apply(null,new Uint8Array(x))}function d(x,T,m){var y=new Uint8Array(x.byteLength+T.byteLength);return y.set(new Uint8Array(x)),y.set(new Uint8Array(T),x.byteLength),m?y:y.buffer}function h(x){var T=[],m=x.length,y;for(y=0;y<m-1;y+=2)T.push(parseInt(x.substr(y,2),16));return String.fromCharCode.apply(String,T)}function v(){this.reset()}return v.prototype.append=function(x){return this.appendBinary(u(x)),this},v.prototype.appendBinary=function(x){this._buff+=x,this._length+=x.length;var T=this._buff.length,m;for(m=64;m<=T;m+=64)a(this._hash,i(this._buff.substring(m-64,m)));return this._buff=this._buff.substring(m-64),this},v.prototype.end=function(x){var T=this._buff,m=T.length,y,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C;for(y=0;y<m;y+=1)S[y>>2]|=T.charCodeAt(y)<<(y%4<<3);return this._finish(S,m),C=l(this._hash),x&&(C=h(C)),this.reset(),C},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(x){return this._buff=x.buff,this._length=x.length,this._hash=x.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(x,T){var m=T,y,S,C;if(x[m>>2]|=128<<(m%4<<3),m>55)for(a(this._hash,x),m=0;m<16;m+=1)x[m]=0;y=this._length*8,y=y.toString(16).match(/(.*?)(.{0,8})$/),S=parseInt(y[2],16),C=parseInt(y[1],16)||0,x[14]=S,x[15]=C,a(this._hash,x)},v.hash=function(x,T){return v.hashBinary(u(x),T)},v.hashBinary=function(x,T){var m=o(x),y=l(m);return T?h(y):y},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(x){var T=d(this._buff.buffer,x,!0),m=T.length,y;for(this._length+=x.byteLength,y=64;y<=m;y+=64)a(this._hash,s(T.subarray(y-64,y)));return this._buff=y-64<m?new Uint8Array(T.buffer.slice(y-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(x){var T=this._buff,m=T.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S,C;for(S=0;S<m;S+=1)y[S>>2]|=T[S]<<(S%4<<3);return this._finish(y,m),C=l(this._hash),x&&(C=h(C)),this.reset(),C},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var x=v.prototype.getState.call(this);return x.buff=p(x.buff),x},v.ArrayBuffer.prototype.setState=function(x){return x.buff=g(x.buff,!0),v.prototype.setState.call(this,x)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(x,T){var m=c(new Uint8Array(x)),y=l(m);return T?h(y):y},v})});var Tu=Le(()=>{});var pr={};jn(pr,{ARRAY_TYPE:()=>Ve,EPSILON:()=>ue,RANDOM:()=>Et,equals:()=>$y,setMatrixArrayType:()=>Iy,toRadian:()=>Ky});var ue=1e-6,Ve=typeof Float32Array<"u"?Float32Array:Array,Et=Math.random;function Iy(t){Ve=t}var jy=Math.PI/180;function Ky(t){return t*jy}function $y(t,e){return Math.abs(t-e)<=ue*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ee={};jn(ee,{add:()=>vT,adjoint:()=>rT,clone:()=>Yy,copy:()=>qy,create:()=>Wo,determinant:()=>nT,equals:()=>TT,exactEquals:()=>yT,frob:()=>dT,fromMat2d:()=>uT,fromMat4:()=>Xy,fromQuat:()=>lT,fromRotation:()=>cT,fromScaling:()=>fT,fromTranslation:()=>oT,fromValues:()=>Zy,identity:()=>Jy,invert:()=>tT,mul:()=>ST,multiply:()=>el,multiplyScalar:()=>mT,multiplyScalarAndAdd:()=>xT,normalFromMat4:()=>gT,projection:()=>pT,rotate:()=>iT,scale:()=>sT,set:()=>Qy,str:()=>hT,sub:()=>CT,subtract:()=>tl,translate:()=>aT,transpose:()=>eT});function Wo(){var t=new Ve(9);return Ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Xy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Yy(t){var e=new Ve(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Zy(t,e,r,n,a,i,s,o,c){var f=new Ve(9);return f[0]=t,f[1]=e,f[2]=r,f[3]=n,f[4]=a,f[5]=i,f[6]=s,f[7]=o,f[8]=c,f}function Qy(t,e,r,n,a,i,s,o,c,f){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=s,t[6]=o,t[7]=c,t[8]=f,t}function Jy(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function eT(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function tT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],f=e[7],l=e[8],u=l*s-o*f,g=-l*i+o*c,p=f*i-s*c,d=r*u+n*g+a*p;return d?(d=1/d,t[0]=u*d,t[1]=(-l*n+a*f)*d,t[2]=(o*n-a*s)*d,t[3]=g*d,t[4]=(l*r-a*c)*d,t[5]=(-o*r+a*i)*d,t[6]=p*d,t[7]=(-f*r+n*c)*d,t[8]=(s*r-n*i)*d,t):null}function rT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],f=e[7],l=e[8];return t[0]=s*l-o*f,t[1]=a*f-n*l,t[2]=n*o-a*s,t[3]=o*c-i*l,t[4]=r*l-a*c,t[5]=a*i-r*o,t[6]=i*f-s*c,t[7]=n*c-r*f,t[8]=r*s-n*i,t}function nT(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],s=t[5],o=t[6],c=t[7],f=t[8];return e*(f*i-s*c)+r*(-f*a+s*o)+n*(c*a-i*o)}function el(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],f=e[6],l=e[7],u=e[8],g=r[0],p=r[1],d=r[2],h=r[3],v=r[4],x=r[5],T=r[6],m=r[7],y=r[8];return t[0]=g*n+p*s+d*f,t[1]=g*a+p*o+d*l,t[2]=g*i+p*c+d*u,t[3]=h*n+v*s+x*f,t[4]=h*a+v*o+x*l,t[5]=h*i+v*c+x*u,t[6]=T*n+m*s+y*f,t[7]=T*a+m*o+y*l,t[8]=T*i+m*c+y*u,t}function aT(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],f=e[6],l=e[7],u=e[8],g=r[0],p=r[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=s,t[4]=o,t[5]=c,t[6]=g*n+p*s+f,t[7]=g*a+p*o+l,t[8]=g*i+p*c+u,t}function iT(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],f=e[6],l=e[7],u=e[8],g=Math.sin(r),p=Math.cos(r);return t[0]=p*n+g*s,t[1]=p*a+g*o,t[2]=p*i+g*c,t[3]=p*s-g*n,t[4]=p*o-g*a,t[5]=p*c-g*i,t[6]=f,t[7]=l,t[8]=u,t}function sT(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function oT(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function cT(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fT(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function lT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=r+r,o=n+n,c=a+a,f=r*s,l=n*s,u=n*o,g=a*s,p=a*o,d=a*c,h=i*s,v=i*o,x=i*c;return t[0]=1-u-d,t[3]=l-x,t[6]=g+v,t[1]=l+x,t[4]=1-f-d,t[7]=p-h,t[2]=g-v,t[5]=p+h,t[8]=1-f-u,t}function gT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],f=e[7],l=e[8],u=e[9],g=e[10],p=e[11],d=e[12],h=e[13],v=e[14],x=e[15],T=r*o-n*s,m=r*c-a*s,y=r*f-i*s,S=n*c-a*o,C=n*f-i*o,E=a*f-i*c,O=l*h-u*d,U=l*v-g*d,k=l*x-p*d,V=u*v-g*h,b=u*x-p*h,R=g*x-p*v,M=T*R-m*b+y*V+S*k-C*U+E*O;return M?(M=1/M,t[0]=(o*R-c*b+f*V)*M,t[1]=(c*k-s*R-f*U)*M,t[2]=(s*b-o*k+f*O)*M,t[3]=(a*b-n*R-i*V)*M,t[4]=(r*R-a*k+i*U)*M,t[5]=(n*k-r*b-i*O)*M,t[6]=(h*E-v*C+x*S)*M,t[7]=(v*y-d*E-x*m)*M,t[8]=(d*C-h*y+x*T)*M,t):null}function pT(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function hT(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function dT(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function vT(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function tl(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function mT(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function xT(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function yT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function TT(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],f=t[7],l=t[8],u=e[0],g=e[1],p=e[2],d=e[3],h=e[4],v=e[5],x=e[6],T=e[7],m=e[8];return Math.abs(r-u)<=ue*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-g)<=ue*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-p)<=ue*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-d)<=ue*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-h)<=ue*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-v)<=ue*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(c-x)<=ue*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(f-T)<=ue*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(l-m)<=ue*Math.max(1,Math.abs(l),Math.abs(m))}var ST=el,CT=tl;var D={};jn(D,{add:()=>sS,adjoint:()=>VT,clone:()=>OT,copy:()=>ET,create:()=>wT,determinant:()=>FT,equals:()=>uS,exactEquals:()=>fS,frob:()=>iS,fromQuat:()=>YT,fromQuat2:()=>IT,fromRotation:()=>zT,fromRotationTranslation:()=>al,fromRotationTranslationScale:()=>$T,fromRotationTranslationScaleOrigin:()=>XT,fromScaling:()=>WT,fromTranslation:()=>_T,fromValues:()=>MT,fromXRotation:()=>AT,fromYRotation:()=>PT,fromZRotation:()=>HT,frustum:()=>qT,getRotation:()=>KT,getScaling:()=>il,getTranslation:()=>jT,identity:()=>rl,invert:()=>LT,lookAt:()=>rS,mul:()=>lS,multiply:()=>nl,multiplyScalar:()=>oS,multiplyScalarAndAdd:()=>cS,ortho:()=>eS,orthoNO:()=>ol,orthoZO:()=>tS,perspective:()=>ZT,perspectiveFromFieldOfView:()=>JT,perspectiveNO:()=>sl,perspectiveZO:()=>QT,rotate:()=>UT,rotateX:()=>NT,rotateY:()=>BT,rotateZ:()=>GT,scale:()=>bT,set:()=>RT,str:()=>aS,sub:()=>gS,subtract:()=>cl,targetTo:()=>nS,translate:()=>kT,transpose:()=>DT});function wT(){var t=new Ve(16);return Ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function OT(t){var e=new Ve(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ET(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function MT(t,e,r,n,a,i,s,o,c,f,l,u,g,p,d,h){var v=new Ve(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=a,v[5]=i,v[6]=s,v[7]=o,v[8]=c,v[9]=f,v[10]=l,v[11]=u,v[12]=g,v[13]=p,v[14]=d,v[15]=h,v}function RT(t,e,r,n,a,i,s,o,c,f,l,u,g,p,d,h,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=s,t[6]=o,t[7]=c,t[8]=f,t[9]=l,t[10]=u,t[11]=g,t[12]=p,t[13]=d,t[14]=h,t[15]=v,t}function rl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function DT(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],i=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=a,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function LT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],f=e[7],l=e[8],u=e[9],g=e[10],p=e[11],d=e[12],h=e[13],v=e[14],x=e[15],T=r*o-n*s,m=r*c-a*s,y=r*f-i*s,S=n*c-a*o,C=n*f-i*o,E=a*f-i*c,O=l*h-u*d,U=l*v-g*d,k=l*x-p*d,V=u*v-g*h,b=u*x-p*h,R=g*x-p*v,M=T*R-m*b+y*V+S*k-C*U+E*O;return M?(M=1/M,t[0]=(o*R-c*b+f*V)*M,t[1]=(a*b-n*R-i*V)*M,t[2]=(h*E-v*C+x*S)*M,t[3]=(g*C-u*E-p*S)*M,t[4]=(c*k-s*R-f*U)*M,t[5]=(r*R-a*k+i*U)*M,t[6]=(v*y-d*E-x*m)*M,t[7]=(l*E-g*y+p*m)*M,t[8]=(s*b-o*k+f*O)*M,t[9]=(n*k-r*b-i*O)*M,t[10]=(d*C-h*y+x*T)*M,t[11]=(u*y-l*C-p*T)*M,t[12]=(o*U-s*V-c*O)*M,t[13]=(r*V-n*U+a*O)*M,t[14]=(h*m-d*S-v*T)*M,t[15]=(l*S-u*m+g*T)*M,t):null}function VT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],f=e[7],l=e[8],u=e[9],g=e[10],p=e[11],d=e[12],h=e[13],v=e[14],x=e[15];return t[0]=o*(g*x-p*v)-u*(c*x-f*v)+h*(c*p-f*g),t[1]=-(n*(g*x-p*v)-u*(a*x-i*v)+h*(a*p-i*g)),t[2]=n*(c*x-f*v)-o*(a*x-i*v)+h*(a*f-i*c),t[3]=-(n*(c*p-f*g)-o*(a*p-i*g)+u*(a*f-i*c)),t[4]=-(s*(g*x-p*v)-l*(c*x-f*v)+d*(c*p-f*g)),t[5]=r*(g*x-p*v)-l*(a*x-i*v)+d*(a*p-i*g),t[6]=-(r*(c*x-f*v)-s*(a*x-i*v)+d*(a*f-i*c)),t[7]=r*(c*p-f*g)-s*(a*p-i*g)+l*(a*f-i*c),t[8]=s*(u*x-p*h)-l*(o*x-f*h)+d*(o*p-f*u),t[9]=-(r*(u*x-p*h)-l*(n*x-i*h)+d*(n*p-i*u)),t[10]=r*(o*x-f*h)-s*(n*x-i*h)+d*(n*f-i*o),t[11]=-(r*(o*p-f*u)-s*(n*p-i*u)+l*(n*f-i*o)),t[12]=-(s*(u*v-g*h)-l*(o*v-c*h)+d*(o*g-c*u)),t[13]=r*(u*v-g*h)-l*(n*v-a*h)+d*(n*g-a*u),t[14]=-(r*(o*v-c*h)-s*(n*v-a*h)+d*(n*c-a*o)),t[15]=r*(o*g-c*u)-s*(n*g-a*u)+l*(n*c-a*o),t}function FT(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],s=t[5],o=t[6],c=t[7],f=t[8],l=t[9],u=t[10],g=t[11],p=t[12],d=t[13],h=t[14],v=t[15],x=e*s-r*i,T=e*o-n*i,m=e*c-a*i,y=r*o-n*s,S=r*c-a*s,C=n*c-a*o,E=f*d-l*p,O=f*h-u*p,U=f*v-g*p,k=l*h-u*d,V=l*v-g*d,b=u*v-g*h;return x*b-T*V+m*k+y*U-S*O+C*E}function nl(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],f=e[6],l=e[7],u=e[8],g=e[9],p=e[10],d=e[11],h=e[12],v=e[13],x=e[14],T=e[15],m=r[0],y=r[1],S=r[2],C=r[3];return t[0]=m*n+y*o+S*u+C*h,t[1]=m*a+y*c+S*g+C*v,t[2]=m*i+y*f+S*p+C*x,t[3]=m*s+y*l+S*d+C*T,m=r[4],y=r[5],S=r[6],C=r[7],t[4]=m*n+y*o+S*u+C*h,t[5]=m*a+y*c+S*g+C*v,t[6]=m*i+y*f+S*p+C*x,t[7]=m*s+y*l+S*d+C*T,m=r[8],y=r[9],S=r[10],C=r[11],t[8]=m*n+y*o+S*u+C*h,t[9]=m*a+y*c+S*g+C*v,t[10]=m*i+y*f+S*p+C*x,t[11]=m*s+y*l+S*d+C*T,m=r[12],y=r[13],S=r[14],C=r[15],t[12]=m*n+y*o+S*u+C*h,t[13]=m*a+y*c+S*g+C*v,t[14]=m*i+y*f+S*p+C*x,t[15]=m*s+y*l+S*d+C*T,t}function kT(t,e,r){var n=r[0],a=r[1],i=r[2],s,o,c,f,l,u,g,p,d,h,v,x;return e===t?(t[12]=e[0]*n+e[4]*a+e[8]*i+e[12],t[13]=e[1]*n+e[5]*a+e[9]*i+e[13],t[14]=e[2]*n+e[6]*a+e[10]*i+e[14],t[15]=e[3]*n+e[7]*a+e[11]*i+e[15]):(s=e[0],o=e[1],c=e[2],f=e[3],l=e[4],u=e[5],g=e[6],p=e[7],d=e[8],h=e[9],v=e[10],x=e[11],t[0]=s,t[1]=o,t[2]=c,t[3]=f,t[4]=l,t[5]=u,t[6]=g,t[7]=p,t[8]=d,t[9]=h,t[10]=v,t[11]=x,t[12]=s*n+l*a+d*i+e[12],t[13]=o*n+u*a+h*i+e[13],t[14]=c*n+g*a+v*i+e[14],t[15]=f*n+p*a+x*i+e[15]),t}function bT(t,e,r){var n=r[0],a=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function UT(t,e,r,n){var a=n[0],i=n[1],s=n[2],o=Math.hypot(a,i,s),c,f,l,u,g,p,d,h,v,x,T,m,y,S,C,E,O,U,k,V,b,R,M,N;return o<ue?null:(o=1/o,a*=o,i*=o,s*=o,c=Math.sin(r),f=Math.cos(r),l=1-f,u=e[0],g=e[1],p=e[2],d=e[3],h=e[4],v=e[5],x=e[6],T=e[7],m=e[8],y=e[9],S=e[10],C=e[11],E=a*a*l+f,O=i*a*l+s*c,U=s*a*l-i*c,k=a*i*l-s*c,V=i*i*l+f,b=s*i*l+a*c,R=a*s*l+i*c,M=i*s*l-a*c,N=s*s*l+f,t[0]=u*E+h*O+m*U,t[1]=g*E+v*O+y*U,t[2]=p*E+x*O+S*U,t[3]=d*E+T*O+C*U,t[4]=u*k+h*V+m*b,t[5]=g*k+v*V+y*b,t[6]=p*k+x*V+S*b,t[7]=d*k+T*V+C*b,t[8]=u*R+h*M+m*N,t[9]=g*R+v*M+y*N,t[10]=p*R+x*M+S*N,t[11]=d*R+T*M+C*N,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function NT(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[4],s=e[5],o=e[6],c=e[7],f=e[8],l=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+f*n,t[5]=s*a+l*n,t[6]=o*a+u*n,t[7]=c*a+g*n,t[8]=f*a-i*n,t[9]=l*a-s*n,t[10]=u*a-o*n,t[11]=g*a-c*n,t}function BT(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],s=e[1],o=e[2],c=e[3],f=e[8],l=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-f*n,t[1]=s*a-l*n,t[2]=o*a-u*n,t[3]=c*a-g*n,t[8]=i*n+f*a,t[9]=s*n+l*a,t[10]=o*n+u*a,t[11]=c*n+g*a,t}function GT(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],s=e[1],o=e[2],c=e[3],f=e[4],l=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+f*n,t[1]=s*a+l*n,t[2]=o*a+u*n,t[3]=c*a+g*n,t[4]=f*a-i*n,t[5]=l*a-s*n,t[6]=u*a-o*n,t[7]=g*a-c*n,t}function _T(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function WT(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zT(t,e,r){var n=r[0],a=r[1],i=r[2],s=Math.hypot(n,a,i),o,c,f;return s<ue?null:(s=1/s,n*=s,a*=s,i*=s,o=Math.sin(e),c=Math.cos(e),f=1-c,t[0]=n*n*f+c,t[1]=a*n*f+i*o,t[2]=i*n*f-a*o,t[3]=0,t[4]=n*a*f-i*o,t[5]=a*a*f+c,t[6]=i*a*f+n*o,t[7]=0,t[8]=n*i*f+a*o,t[9]=a*i*f-n*o,t[10]=i*i*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function AT(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function PT(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function HT(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function al(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=n+n,c=a+a,f=i+i,l=n*o,u=n*c,g=n*f,p=a*c,d=a*f,h=i*f,v=s*o,x=s*c,T=s*f;return t[0]=1-(p+h),t[1]=u+T,t[2]=g-x,t[3]=0,t[4]=u-T,t[5]=1-(l+h),t[6]=d+v,t[7]=0,t[8]=g+x,t[9]=d-v,t[10]=1-(l+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function IT(t,e){var r=new Ve(3),n=-e[0],a=-e[1],i=-e[2],s=e[3],o=e[4],c=e[5],f=e[6],l=e[7],u=n*n+a*a+i*i+s*s;return u>0?(r[0]=(o*s+l*n+c*i-f*a)*2/u,r[1]=(c*s+l*a+f*n-o*i)*2/u,r[2]=(f*s+l*i+o*a-c*n)*2/u):(r[0]=(o*s+l*n+c*i-f*a)*2,r[1]=(c*s+l*a+f*n-o*i)*2,r[2]=(f*s+l*i+o*a-c*n)*2),al(t,e,r),t}function jT(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function il(t,e){var r=e[0],n=e[1],a=e[2],i=e[4],s=e[5],o=e[6],c=e[8],f=e[9],l=e[10];return t[0]=Math.hypot(r,n,a),t[1]=Math.hypot(i,s,o),t[2]=Math.hypot(c,f,l),t}function KT(t,e){var r=new Ve(3);il(r,e);var n=1/r[0],a=1/r[1],i=1/r[2],s=e[0]*n,o=e[1]*a,c=e[2]*i,f=e[4]*n,l=e[5]*a,u=e[6]*i,g=e[8]*n,p=e[9]*a,d=e[10]*i,h=s+l+d,v=0;return h>0?(v=Math.sqrt(h+1)*2,t[3]=.25*v,t[0]=(u-p)/v,t[1]=(g-c)/v,t[2]=(o-f)/v):s>l&&s>d?(v=Math.sqrt(1+s-l-d)*2,t[3]=(u-p)/v,t[0]=.25*v,t[1]=(o+f)/v,t[2]=(g+c)/v):l>d?(v=Math.sqrt(1+l-s-d)*2,t[3]=(g-c)/v,t[0]=(o+f)/v,t[1]=.25*v,t[2]=(u+p)/v):(v=Math.sqrt(1+d-s-l)*2,t[3]=(o-f)/v,t[0]=(g+c)/v,t[1]=(u+p)/v,t[2]=.25*v),t}function $T(t,e,r,n){var a=e[0],i=e[1],s=e[2],o=e[3],c=a+a,f=i+i,l=s+s,u=a*c,g=a*f,p=a*l,d=i*f,h=i*l,v=s*l,x=o*c,T=o*f,m=o*l,y=n[0],S=n[1],C=n[2];return t[0]=(1-(d+v))*y,t[1]=(g+m)*y,t[2]=(p-T)*y,t[3]=0,t[4]=(g-m)*S,t[5]=(1-(u+v))*S,t[6]=(h+x)*S,t[7]=0,t[8]=(p+T)*C,t[9]=(h-x)*C,t[10]=(1-(u+d))*C,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function XT(t,e,r,n,a){var i=e[0],s=e[1],o=e[2],c=e[3],f=i+i,l=s+s,u=o+o,g=i*f,p=i*l,d=i*u,h=s*l,v=s*u,x=o*u,T=c*f,m=c*l,y=c*u,S=n[0],C=n[1],E=n[2],O=a[0],U=a[1],k=a[2],V=(1-(h+x))*S,b=(p+y)*S,R=(d-m)*S,M=(p-y)*C,N=(1-(g+x))*C,L=(v+T)*C,B=(d+m)*E,G=(v-T)*E,F=(1-(g+h))*E;return t[0]=V,t[1]=b,t[2]=R,t[3]=0,t[4]=M,t[5]=N,t[6]=L,t[7]=0,t[8]=B,t[9]=G,t[10]=F,t[11]=0,t[12]=r[0]+O-(V*O+M*U+B*k),t[13]=r[1]+U-(b*O+N*U+G*k),t[14]=r[2]+k-(R*O+L*U+F*k),t[15]=1,t}function YT(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=r+r,o=n+n,c=a+a,f=r*s,l=n*s,u=n*o,g=a*s,p=a*o,d=a*c,h=i*s,v=i*o,x=i*c;return t[0]=1-u-d,t[1]=l+x,t[2]=g-v,t[3]=0,t[4]=l-x,t[5]=1-f-d,t[6]=p+h,t[7]=0,t[8]=g+v,t[9]=p-h,t[10]=1-f-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qT(t,e,r,n,a,i,s){var o=1/(r-e),c=1/(a-n),f=1/(i-s);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(a+n)*c,t[10]=(s+i)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i*2*f,t[15]=0,t}function sl(t,e,r,n,a){var i=1/Math.tan(e/2),s;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(s=1/(n-a),t[10]=(a+n)*s,t[14]=2*a*n*s):(t[10]=-1,t[14]=-2*n),t}var ZT=sl;function QT(t,e,r,n,a){var i=1/Math.tan(e/2),s;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(s=1/(n-a),t[10]=a*s,t[14]=a*n*s):(t[10]=-1,t[14]=-n),t}function JT(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+o),f=2/(a+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=-((s-o)*c*.5),t[9]=(a-i)*f*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function ol(t,e,r,n,a,i,s){var o=1/(e-r),c=1/(n-a),f=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*c,t[14]=(s+i)*f,t[15]=1,t}var eS=ol;function tS(t,e,r,n,a,i,s){var o=1/(e-r),c=1/(n-a),f=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=f,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*c,t[14]=i*f,t[15]=1,t}function rS(t,e,r,n){var a,i,s,o,c,f,l,u,g,p,d=e[0],h=e[1],v=e[2],x=n[0],T=n[1],m=n[2],y=r[0],S=r[1],C=r[2];return Math.abs(d-y)<ue&&Math.abs(h-S)<ue&&Math.abs(v-C)<ue?rl(t):(l=d-y,u=h-S,g=v-C,p=1/Math.hypot(l,u,g),l*=p,u*=p,g*=p,a=T*g-m*u,i=m*l-x*g,s=x*u-T*l,p=Math.hypot(a,i,s),p?(p=1/p,a*=p,i*=p,s*=p):(a=0,i=0,s=0),o=u*s-g*i,c=g*a-l*s,f=l*i-u*a,p=Math.hypot(o,c,f),p?(p=1/p,o*=p,c*=p,f*=p):(o=0,c=0,f=0),t[0]=a,t[1]=o,t[2]=l,t[3]=0,t[4]=i,t[5]=c,t[6]=u,t[7]=0,t[8]=s,t[9]=f,t[10]=g,t[11]=0,t[12]=-(a*d+i*h+s*v),t[13]=-(o*d+c*h+f*v),t[14]=-(l*d+u*h+g*v),t[15]=1,t)}function nS(t,e,r,n){var a=e[0],i=e[1],s=e[2],o=n[0],c=n[1],f=n[2],l=a-r[0],u=i-r[1],g=s-r[2],p=l*l+u*u+g*g;p>0&&(p=1/Math.sqrt(p),l*=p,u*=p,g*=p);var d=c*g-f*u,h=f*l-o*g,v=o*u-c*l;return p=d*d+h*h+v*v,p>0&&(p=1/Math.sqrt(p),d*=p,h*=p,v*=p),t[0]=d,t[1]=h,t[2]=v,t[3]=0,t[4]=u*v-g*h,t[5]=g*d-l*v,t[6]=l*h-u*d,t[7]=0,t[8]=l,t[9]=u,t[10]=g,t[11]=0,t[12]=a,t[13]=i,t[14]=s,t[15]=1,t}function aS(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function iS(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function sS(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function cl(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function oS(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function cS(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function fS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function uS(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],f=t[7],l=t[8],u=t[9],g=t[10],p=t[11],d=t[12],h=t[13],v=t[14],x=t[15],T=e[0],m=e[1],y=e[2],S=e[3],C=e[4],E=e[5],O=e[6],U=e[7],k=e[8],V=e[9],b=e[10],R=e[11],M=e[12],N=e[13],L=e[14],B=e[15];return Math.abs(r-T)<=ue*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-m)<=ue*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=ue*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(i-S)<=ue*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-C)<=ue*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(o-E)<=ue*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(c-O)<=ue*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(f-U)<=ue*Math.max(1,Math.abs(f),Math.abs(U))&&Math.abs(l-k)<=ue*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(u-V)<=ue*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(g-b)<=ue*Math.max(1,Math.abs(g),Math.abs(b))&&Math.abs(p-R)<=ue*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-M)<=ue*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(h-N)<=ue*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(v-L)<=ue*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(x-B)<=ue*Math.max(1,Math.abs(x),Math.abs(B))}var lS=nl,gS=cl;var ze={};jn(ze,{add:()=>bC,calculateW:()=>CC,clone:()=>LC,conjugate:()=>MC,copy:()=>FC,create:()=>Jo,dot:()=>Dl,equals:()=>WC,exactEquals:()=>_C,exp:()=>Ol,fromEuler:()=>RC,fromMat3:()=>Ml,fromValues:()=>VC,getAngle:()=>xC,getAxisAngle:()=>mC,identity:()=>vC,invert:()=>EC,len:()=>BC,length:()=>Ll,lerp:()=>NC,ln:()=>El,mul:()=>UC,multiply:()=>wl,normalize:()=>ec,pow:()=>wC,random:()=>OC,rotateX:()=>yC,rotateY:()=>TC,rotateZ:()=>SC,rotationTo:()=>zC,scale:()=>Rl,set:()=>kC,setAxes:()=>PC,setAxisAngle:()=>Cl,slerp:()=>Fi,sqlerp:()=>AC,sqrLen:()=>GC,squaredLength:()=>Vl,str:()=>DC});var P={};jn(P,{add:()=>vS,angle:()=>BS,bezier:()=>DS,ceil:()=>mS,clone:()=>pS,copy:()=>hS,create:()=>Mi,cross:()=>Ra,dist:()=>IS,distance:()=>pl,div:()=>HS,divide:()=>gl,dot:()=>Di,equals:()=>zS,exactEquals:()=>WS,floor:()=>xS,forEach:()=>$S,fromValues:()=>Ri,hermite:()=>RS,inverse:()=>ES,len:()=>Ao,length:()=>fl,lerp:()=>MS,max:()=>TS,min:()=>yS,mul:()=>PS,multiply:()=>ll,negate:()=>OS,normalize:()=>zo,random:()=>LS,rotateX:()=>bS,rotateY:()=>US,rotateZ:()=>NS,round:()=>SS,scale:()=>CS,scaleAndAdd:()=>wS,set:()=>dS,sqrDist:()=>jS,sqrLen:()=>KS,squaredDistance:()=>hl,squaredLength:()=>dl,str:()=>_S,sub:()=>AS,subtract:()=>ul,transformMat3:()=>FS,transformMat4:()=>VS,transformQuat:()=>kS,zero:()=>GS});function Mi(){var t=new Ve(3);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pS(t){var e=new Ve(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function fl(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Ri(t,e,r){var n=new Ve(3);return n[0]=t,n[1]=e,n[2]=r,n}function hS(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function dS(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function vS(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ul(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ll(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function gl(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function mS(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function xS(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function yS(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function TS(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function SS(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function CS(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function wS(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function pl(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.hypot(r,n,a)}function hl(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a}function dl(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function OS(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ES(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function zo(t,e){var r=e[0],n=e[1],a=e[2],i=r*r+n*n+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Di(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ra(t,e,r){var n=e[0],a=e[1],i=e[2],s=r[0],o=r[1],c=r[2];return t[0]=a*c-i*o,t[1]=i*s-n*c,t[2]=n*o-a*s,t}function MS(t,e,r,n){var a=e[0],i=e[1],s=e[2];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=s+n*(r[2]-s),t}function RS(t,e,r,n,a,i){var s=i*i,o=s*(2*i-3)+1,c=s*(i-2)+i,f=s*(i-1),l=s*(3-2*i);return t[0]=e[0]*o+r[0]*c+n[0]*f+a[0]*l,t[1]=e[1]*o+r[1]*c+n[1]*f+a[1]*l,t[2]=e[2]*o+r[2]*c+n[2]*f+a[2]*l,t}function DS(t,e,r,n,a,i){var s=1-i,o=s*s,c=i*i,f=o*s,l=3*i*o,u=3*c*s,g=c*i;return t[0]=e[0]*f+r[0]*l+n[0]*u+a[0]*g,t[1]=e[1]*f+r[1]*l+n[1]*u+a[1]*g,t[2]=e[2]*f+r[2]*l+n[2]*u+a[2]*g,t}function LS(t,e){e=e||1;var r=Et()*2*Math.PI,n=Et()*2-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t}function VS(t,e,r){var n=e[0],a=e[1],i=e[2],s=r[3]*n+r[7]*a+r[11]*i+r[15];return s=s||1,t[0]=(r[0]*n+r[4]*a+r[8]*i+r[12])/s,t[1]=(r[1]*n+r[5]*a+r[9]*i+r[13])/s,t[2]=(r[2]*n+r[6]*a+r[10]*i+r[14])/s,t}function FS(t,e,r){var n=e[0],a=e[1],i=e[2];return t[0]=n*r[0]+a*r[3]+i*r[6],t[1]=n*r[1]+a*r[4]+i*r[7],t[2]=n*r[2]+a*r[5]+i*r[8],t}function kS(t,e,r){var n=r[0],a=r[1],i=r[2],s=r[3],o=e[0],c=e[1],f=e[2],l=a*f-i*c,u=i*o-n*f,g=n*c-a*o,p=a*g-i*u,d=i*l-n*g,h=n*u-a*l,v=s*2;return l*=v,u*=v,g*=v,p*=2,d*=2,h*=2,t[0]=o+l+p,t[1]=c+u+d,t[2]=f+g+h,t}function bS(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0],i[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),i[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function US(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),i[1]=a[1],i[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function NS(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),i[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),i[2]=a[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function BS(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],s=e[1],o=e[2],c=Math.sqrt(r*r+n*n+a*a),f=Math.sqrt(i*i+s*s+o*o),l=c*f,u=l&&Di(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function GS(t){return t[0]=0,t[1]=0,t[2]=0,t}function _S(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function WS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function zS(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],s=e[1],o=e[2];return Math.abs(r-i)<=ue*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=ue*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=ue*Math.max(1,Math.abs(a),Math.abs(o))}var AS=ul,PS=ll,HS=gl,IS=pl,jS=hl,Ao=fl,KS=dl,$S=(function(){var t=Mi();return function(e,r,n,a,i,s){var o,c;for(r||(r=3),n||(n=0),a?c=Math.min(a*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();var lt={};jn(lt,{add:()=>Ko,ceil:()=>XS,clone:()=>Po,copy:()=>Io,create:()=>vl,cross:()=>rC,dist:()=>lC,distance:()=>Tl,div:()=>uC,divide:()=>yl,dot:()=>Yo,equals:()=>Qo,exactEquals:()=>Zo,floor:()=>YS,forEach:()=>dC,fromValues:()=>Ho,inverse:()=>tC,len:()=>pC,length:()=>Li,lerp:()=>qo,max:()=>ZS,min:()=>qS,mul:()=>fC,multiply:()=>xl,negate:()=>eC,normalize:()=>Xo,random:()=>nC,round:()=>QS,scale:()=>$o,scaleAndAdd:()=>JS,set:()=>jo,sqrDist:()=>gC,sqrLen:()=>hC,squaredDistance:()=>Sl,squaredLength:()=>Vi,str:()=>oC,sub:()=>cC,subtract:()=>ml,transformMat4:()=>aC,transformQuat:()=>iC,zero:()=>sC});function vl(){var t=new Ve(4);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Po(t){var e=new Ve(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ho(t,e,r,n){var a=new Ve(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function Io(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function jo(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t}function Ko(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ml(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function xl(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function yl(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function XS(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function YS(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function qS(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function ZS(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function QS(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function $o(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function JS(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Tl(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,n,a,i)}function Sl(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+a*a+i*i}function Li(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.hypot(e,r,n,a)}function Vi(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a}function eC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function tC(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Xo(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=r*r+n*n+a*a+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=n*s,t[2]=a*s,t[3]=i*s,t}function Yo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function rC(t,e,r,n){var a=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],f=r[2]*n[3]-r[3]*n[2],l=e[0],u=e[1],g=e[2],p=e[3];return t[0]=u*f-g*c+p*o,t[1]=-(l*f)+g*s-p*i,t[2]=l*c-u*s+p*a,t[3]=-(l*o)+u*i-g*a,t}function qo(t,e,r,n){var a=e[0],i=e[1],s=e[2],o=e[3];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=s+n*(r[2]-s),t[3]=o+n*(r[3]-o),t}function nC(t,e){e=e||1;var r,n,a,i,s,o;do r=Et()*2-1,n=Et()*2-1,s=r*r+n*n;while(s>=1);do a=Et()*2-1,i=Et()*2-1,o=a*a+i*i;while(o>=1);var c=Math.sqrt((1-s)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*a*c,t[3]=e*i*c,t}function aC(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*s,t[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*s,t[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*s,t[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*s,t}function iC(t,e,r){var n=e[0],a=e[1],i=e[2],s=r[0],o=r[1],c=r[2],f=r[3],l=f*n+o*i-c*a,u=f*a+c*n-s*i,g=f*i+s*a-o*n,p=-s*n-o*a-c*i;return t[0]=l*f+p*-s+u*-c-g*-o,t[1]=u*f+p*-o+g*-s-l*-c,t[2]=g*f+p*-c+l*-o-u*-s,t[3]=e[3],t}function sC(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function oC(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Zo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Qo(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],s=e[0],o=e[1],c=e[2],f=e[3];return Math.abs(r-s)<=ue*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=ue*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-c)<=ue*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-f)<=ue*Math.max(1,Math.abs(i),Math.abs(f))}var cC=ml,fC=xl,uC=yl,lC=Tl,gC=Sl,pC=Li,hC=Vi,dC=(function(){var t=vl();return function(e,r,n,a,i,s){var o,c;for(r||(r=4),n||(n=0),a?c=Math.min(a*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function Jo(){var t=new Ve(4);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vC(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Cl(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function mC(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>ue?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function xC(t,e){var r=Dl(t,e);return Math.acos(2*r*r-1)}function wl(t,e,r){var n=e[0],a=e[1],i=e[2],s=e[3],o=r[0],c=r[1],f=r[2],l=r[3];return t[0]=n*l+s*o+a*f-i*c,t[1]=a*l+s*c+i*o-n*f,t[2]=i*l+s*f+n*c-a*o,t[3]=s*l-n*o-a*c-i*f,t}function yC(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],s=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=a*c+i*o,t[2]=i*c-a*o,t[3]=s*c-n*o,t}function TC(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],s=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=a*c+s*o,t[2]=i*c+n*o,t[3]=s*c-a*o,t}function SC(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],s=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=a*c-n*o,t[2]=i*c+s*o,t[3]=s*c-i*o,t}function CC(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t}function Ol(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=Math.sqrt(r*r+n*n+a*a),o=Math.exp(i),c=s>0?o*Math.sin(s)/s:0;return t[0]=r*c,t[1]=n*c,t[2]=a*c,t[3]=o*Math.cos(s),t}function El(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=Math.sqrt(r*r+n*n+a*a),o=s>0?Math.atan2(s,i)/s:0;return t[0]=r*o,t[1]=n*o,t[2]=a*o,t[3]=.5*Math.log(r*r+n*n+a*a+i*i),t}function wC(t,e,r){return El(t,e),Rl(t,t,r),Ol(t,t),t}function Fi(t,e,r,n){var a=e[0],i=e[1],s=e[2],o=e[3],c=r[0],f=r[1],l=r[2],u=r[3],g,p,d,h,v;return p=a*c+i*f+s*l+o*u,p<0&&(p=-p,c=-c,f=-f,l=-l,u=-u),1-p>ue?(g=Math.acos(p),d=Math.sin(g),h=Math.sin((1-n)*g)/d,v=Math.sin(n*g)/d):(h=1-n,v=n),t[0]=h*a+v*c,t[1]=h*i+v*f,t[2]=h*s+v*l,t[3]=h*o+v*u,t}function OC(t){var e=Et(),r=Et(),n=Et(),a=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*r),t[1]=a*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function EC(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],s=r*r+n*n+a*a+i*i,o=s?1/s:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-a*o,t[3]=i*o,t}function MC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ml(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var i=(a+1)%3,s=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[i*3+i]-e[s*3+s]+1),t[a]=.5*n,n=.5/n,t[3]=(e[i*3+s]-e[s*3+i])*n,t[i]=(e[i*3+a]+e[a*3+i])*n,t[s]=(e[s*3+a]+e[a*3+s])*n}return t}function RC(t,e,r,n){var a=.5*Math.PI/180;e*=a,r*=a,n*=a;var i=Math.sin(e),s=Math.cos(e),o=Math.sin(r),c=Math.cos(r),f=Math.sin(n),l=Math.cos(n);return t[0]=i*c*l-s*o*f,t[1]=s*o*l+i*c*f,t[2]=s*c*f-i*o*l,t[3]=s*c*l+i*o*f,t}function DC(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var LC=Po,VC=Ho,FC=Io,kC=jo,bC=Ko,UC=wl,Rl=$o,Dl=Yo,NC=qo,Ll=Li,BC=Ll,Vl=Vi,GC=Vl,ec=Xo,_C=Zo,WC=Qo,zC=(function(){var t=Mi(),e=Ri(1,0,0),r=Ri(0,1,0);return function(n,a,i){var s=Di(a,i);return s<-.999999?(Ra(t,e,a),Ao(t)<1e-6&&Ra(t,r,a),zo(t,t),Cl(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ra(t,a,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,ec(n,n))}})(),AC=(function(){var t=Jo(),e=Jo();return function(r,n,a,i,s,o){return Fi(t,n,s,o),Fi(e,a,i,o),Fi(r,t,e,2*o*(1-o)),r}})(),PC=(function(){var t=Wo();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],ec(e,Ml(e,t))}})();var Rg=Kn(ki(),1);var Tg=Kn(yg(),1),Nt=(0,Tg.default)(),Sg={vtkObject:()=>null};function ft(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Nt.console&&Nt.console.error&&Nt.console.error("Invalid VTK object"),null;let e=Sg[t.vtkClass];if(!e)return Nt.console&&Nt.console.error&&Nt.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;let r={...t};Object.keys(r).forEach(a=>{r[a]&&typeof r[a]=="object"&&r[a].vtkClass&&(r[a]=ft(r[a]))});let n=e(r);return n&&n.modified&&n.modified(),n}function i2(t,e){Sg[t]=e}ft.register=i2;var Xn=class extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}};var fc=0,Dg=t=>{throw new Error(`Named parameter '${t}' is missing`)},Lg=Symbol("void");function s2(){return fc}var Vg={};function fn(){}var o2=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];o2.forEach(t=>{Vg[t]=fn});Nt.console=console.hasOwnProperty("log")?console:Vg;var Fr={debug:fn,error:Nt.console.error||fn,info:Nt.console.info||fn,log:Nt.console.log||fn,warn:Nt.console.warn||fn};function Fg(t,e){Fr[t]&&(Fr[t]=e||fn)}function kg(){Fr.log(...arguments)}function bg(){Fr.info(...arguments)}function Wi(){Fr.debug(...arguments)}function le(){Fr.error(...arguments)}function Ai(){Fr.warn(...arguments)}var Cg={};function Ug(t){Cg[t]||(Fr.error(t),Cg[t]=!0)}var et=Object.create(null);et.Float32Array=Float32Array;et.Float64Array=Float64Array;et.Uint8Array=Uint8Array;et.Int8Array=Int8Array;et.Uint16Array=Uint16Array;et.Int16Array=Int16Array;et.Uint32Array=Uint32Array;et.Int32Array=Int32Array;et.Uint8ClampedArray=Uint8ClampedArray;try{et.BigInt64Array=BigInt64Array,et.BigUint64Array=BigUint64Array}catch{}function hr(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(et[t]||Float64Array)(...r)}function Yn(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(et[t]||Float64Array).from(...r)}function Pi(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Pe(t){return Pi(t[0]==="_"?t.slice(1):t)}function Ng(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Bg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,n=["TB","GB","MB","KB"],a=Number(t),i="B";for(;a>r;)a/=r,i=n.pop();return`${a.toFixed(e)} ${i}`}function Gg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",r=[],n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function _g(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function c2(t){return Object.values(et).some(e=>t instanceof e)}function f2(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function u2(t,e){return Object.keys(t).find(r=>t[r]===e)}function Wg(t){return t&&t.isA?t.getState():t}function uc(t){setTimeout(t,0)}function zg(t,e){let r=performance.now();t.finally(()=>{let n=performance.now()-r;e(n)})}function ae(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};_g(e);let r=[];if(Number.isInteger(e.mtime)||(e.mtime=++fc),!("classHierarchy"in e))e.classHierarchy=new Xn("vtkObject");else if(!(e.classHierarchy instanceof Xn)){let i=new Xn;for(let s=0;s<e.classHierarchy.length;s++)i.push(e.classHierarchy[s]);e.classHierarchy=i}function n(i){r[i]=null}function a(i){function s(){n(i)}return Object.freeze({unsubscribe:s})}return t.isDeleted=()=>!!e.deleted,t.modified=i=>{if(e.deleted){le("instance deleted - cannot call any method");return}i&&i<t.getMTime()||(e.mtime=++fc,r.forEach(s=>s&&s(t)))},t.onModified=i=>{if(e.deleted)return le("instance deleted - cannot call any method"),null;let s=r.length;return r.push(i),a(s)},t.getMTime=()=>e.mtime,t.isA=i=>{let s=e.classHierarchy.length;for(;s--;)if(e.classHierarchy[s]===i)return!0;return!1},t.getClassName=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-i]},t.set=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(i).forEach(f=>{let l=o?null:t[`set${Pi(f)}`];l&&Array.isArray(i[f])&&l.length>1?c=l(...i[f])||c:l?c=l(i[f])||c:(["mtime"].indexOf(f)===-1&&!s&&Ai(`Warning: Set value to model directly ${f}, ${i[f]}`),c=e[f]!==i[f]||c,e[f]=i[f])}),c},t.get=function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];if(!s.length)return e;let c={};return s.forEach(f=>{c[f]=e[f]}),c},t.getReferenceByName=i=>e[i],t.delete=()=>{Object.keys(e).forEach(i=>delete e[i]),r.forEach((i,s)=>n(s)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;let i={...e,vtkClass:t.getClassName()};Object.keys(i).forEach(o=>{i[o]===null||i[o]===void 0||o[0]==="_"?delete i[o]:i[o].isA?i[o]=i[o].getState():Array.isArray(i[o])?i[o]=i[o].map(Wg):c2(i[o])&&(i[o]=Array.from(i[o]))});let s={};return Object.keys(i).sort().forEach(o=>{s[o]=i[o]}),s.mtime&&delete s.mtime,s},t.shallowCopy=function(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${i.getClassName()} into ${t.getClassName()}`);let o=i.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(l=>{let u=c.indexOf(l);u===-1?s&&Wi(`add ${l} in shallowCopy`):c.splice(u,1),e[l]=o[l]}),c.length&&s&&Wi(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}var l2={object(t,e,r){return function(){return{...e[r.name]}}}};function Me(t,e,r){r.forEach(n=>{if(typeof n=="object"){let a=l2[n.type];a?t[`get${Pe(n.name)}`]=a(t,e,n):t[`get${Pe(n.name)}`]=()=>e[n.name]}else t[`get${Pe(n)}`]=()=>e[n]})}var Ag={enum(t,e,r){let n=`_on${Pe(r.name)}Changed`;return a=>{if(typeof a=="string"){if(r.enum[a]!==void 0)return e[r.name]!==r.enum[a]?(e[r.name]=r.enum[a],t.modified(),!0):!1;throw le(`Set Enum with invalid argument ${r}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[r.name]!==a){if(Object.keys(r.enum).map(i=>r.enum[i]).indexOf(a)!==-1){let i=e[r.name];return e[r.name]=a,e[n]?.(t,e,a,i),t.modified(),!0}throw le(`Set Enum outside numeric range ${r}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw le(`Set Enum with invalid argument (String/Number) ${r}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){r.params?.length===1&&Ai('Setter of type "object" with a single "param" field is not supported');let n=`_on${Pe(r.name)}Changed`;return function(){for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];let o;if(i.length>1&&r.params?.length?o=r.params.reduce((c,f,l)=>Object.assign(c,{[f]:i[l]}),{}):o=i[0],!(0,Rg.default)(e[r.name],o)){let c=e[r.name];return e[r.name]=o,e[n]?.(t,e,o,c),t.modified(),!0}return!1}}};function wg(t){if(typeof t=="object"){let e=Ag[t.type];if(e)return(r,n)=>e(r,n,t);throw le(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){let a=`_on${Pe(t)}Changed`;return function(s){if(n.deleted)return le("instance deleted - cannot call any method"),!1;if(n[t]!==s){let o=n[t.name];return n[t]=s,n[a]?.(r,n,s,o),r.modified(),!0}return!1}}}function un(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${Pe(n.name)}`]=wg(n)(t,e):t[`set${Pe(n)}`]=wg(n)(t,e)})}function ge(t,e,r){Me(t,e,r),un(t,e,r)}function dr(t,e,r){r.forEach(n=>{t[`get${Pe(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${Pe(n)}ByReference`]=()=>e[n]})}function lc(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(i=>{if(e[i]&&n&&e[i].length!==n)throw new RangeError(`Invalid initial number of values for array (${i})`);let s=`_on${Pe(i)}Changed`;t[`set${Pe(i)}`]=function(){if(e.deleted)return le("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),f=0;f<o;f++)c[f]=arguments[f];let l=c,u,g=!1;if(l.length===1&&(l[0]==null||l[0].length>=0)&&(l=l[0],g=!0),l==null)u=e[i]!==l;else{if(n&&l.length!==n)if(l.length<n&&a!==void 0)for(l=Array.from(l),g=!1;l.length<n;)l.push(a);else throw new RangeError(`Invalid number of values for array setter (${i})`);u=e[i]==null||e[i].length!==l.length;for(let p=0;!u&&p<l.length;++p)u=e[i][p]!==l[p];u&&g&&(l=Array.from(l))}if(u){let p=e[i.name];e[i]=l,e[s]?.(t,e,l,p),t.modified()}return u},t[`set${Pe(i)}From`]=o=>{let c=e[i];o.forEach((f,l)=>{c[l]=f})}})}function Hi(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;dr(t,e,r),lc(t,e,r,n,a)}function kr(t,e,r){for(let n=0;n<r.length;n++){let a=r[n];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function Ii(t,e,r,n){e.inputData?e.inputData=e.inputData.map(ft):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(ft):e.inputConnection=[],e.output?e.output=e.output.map(ft):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(ft):e.inputArrayToProcess=[],e.numberOfInputs=r;function a(p){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){le("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){le(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[d]!==p||e.inputConnection[d])&&(e.inputData[d]=p,e.inputConnection[d]=null,t.modified&&t.modified())}function i(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function s(p){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){le("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){let h=`algorithm ${t.getClassName()} only has `;h+=`${e.numberOfInputs}`,h+=" input ports. To add more input ports, use addInputConnection()",le(h);return}e.inputData[d]=null,e.inputConnection[d]=p}function o(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function c(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function f(p){if(e.deleted){le("instance deleted - cannot call any method");return}s(p,c())}function l(p){if(e.deleted){le("instance deleted - cannot call any method");return}a(p,c())}function u(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(le("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{let p=t.getMTime(),d=1/0,h=n;for(;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;let v=e.output[h].getMTime();if(v<p)return!0;v<d&&(d=v)}for(h=e.numberOfInputs;h--;)if(e.inputConnection[h]?.filter.shouldUpdate()||t.getInputData(h)?.getMTime()>d)return!0;return!1};function g(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=()=>u(p);return d.filter=t,d}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=s,t.addInputData=l,t.addInputConnection=f,t.getInputData=i,t.getInputConnection=o}n&&(t.getOutputData=u,t.getOutputPort=g),t.update=()=>{let p=[];if(e.numberOfInputs){let d=0;for(;d<e.numberOfInputs;)p[d]=t.getInputData(d),d++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=p=>{let d=e.inputArrayToProcess[p],h=e.inputData[p];return d&&h?h[`get${d.fieldAssociation}`]().getArray(d.arrayName):null},t.setInputArrayToProcess=function(p,d,h){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:d,fieldAssociation:h,attributeType:v}}}var gc=Symbol("Event abort");function Pg(t,e,r){let n=[],a=t.delete,i=1;function s(f){for(let l=0;l<n.length;++l){let[u]=n[l];if(u===f){n.splice(l,1);return}}}function o(f){function l(){s(f)}return Object.freeze({unsubscribe:l})}function c(){if(e.deleted){le("instance deleted - cannot call any method");return}let f=n.slice();for(let l=0;l<f.length;++l){let[,u,g]=f[l];if(u){if(g<0)setTimeout(()=>u.apply(t,arguments),1-g);else if(u.apply(t,arguments)===gc)break}}}t[`invoke${Pe(r)}`]=c,t[`on${Pe(r)}`]=function(f){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!f.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return le("instance deleted - cannot call any method"),null;let u=i++;return n.push([u,f,l]),n.sort((g,p)=>p[2]-g[2]),o(u)},t.delete=()=>{a(),n.forEach(f=>{let[l]=f;return s(l)})}}function $(t,e){let r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={},i={};return t(i,a,n),Object.freeze(i)};return e&&ft.register(e,r),r}function br(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e.filter(s=>!!s).map(s=>s(...a))}}function pc(t){return t&&t.isA&&t.isA("vtkObject")}function zi(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(pc(t)){if(n.indexOf(t)>=0)return r;n.push(t);let a=e(t);a!==void 0&&r.push(a);let i=t.get();Object.keys(i).forEach(s=>{let o=i[s];Array.isArray(o)?o.forEach(c=>{zi(c,e,r,n)}):zi(o,e,r,n)})}return r}function Hg(t,e,r){var n=this;let a,i=function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];let f=n,l=()=>{a=null,r||t.apply(f,o)},u=r&&!a;clearTimeout(a),a=setTimeout(l,e),u&&t.apply(f,o)};return i.cancel=()=>clearTimeout(a),i}function Ig(t,e){let r=!1,n=null;function a(){r=!1,n!==null&&(i(...n),n=null)}function i(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];if(r){n=o;return}r=!0,t(...o),setTimeout(a,e)}return i}function hc(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,a)=>{e.keystore[n]=a},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}var g2=1,_i="__root__";function jg(t,e){hc(t,e);let r=t.delete;e.proxyId=`${g2++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Me(t,e,["proxyId","proxyGroup","proxyName"]),ge(t,e,["proxyManager"]);let n={},a={};function i(f,l){a[l]||(a[l]=[]);let u=a[l];for(let g=0;g<f.length;g++)u.push(f[g].name),n[f[g].name]=f[g],f[g].children&&f[g].children.length&&i(f[g].children,f[g].name)}i(e.ui,_i),t.updateUI=f=>{e.ui=JSON.parse(JSON.stringify(f||[])),Object.keys(n).forEach(l=>delete n[l]),Object.keys(a).forEach(l=>delete a[l]),i(e.ui,_i),t.modified()};function s(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_i;return a[f]}t.updateProxyProperty=(f,l)=>{let u=n[f];u?Object.assign(u,l):n[f]={...l}},t.activate=()=>{if(e.proxyManager){let f=`setActive${Pe(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[f]&&e.proxyManager[f](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(f,l)=>{l in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[l]=[]),e.propertyLinkSubscribers[l].push(f)},t.gcPropertyLinks=f=>{let l=e.propertyLinkSubscribers[f]||[];for(;l.length;)l.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(f){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[f])return e.propertyLinkMap[f];let u=null,g=[],p=0,d=!1;function h(y){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(d)return null;let C=[],E=null;for(p=g.length;p--;){let U=g[p];U.instance===y?E=U:C.push(U)}if(!E)return null;let O=E.instance[`get${Pe(E.propertyName)}`]();if(!f2(O,u)||S){for(u=O,d=!0;C.length;){let U=C.pop();U.instance.set({[U.propertyName]:u})}d=!1}return e.propertyLinkMap[f].persistent&&(e.propertyLinkMap[f].value=O),O}function v(y,S){let C=[];for(p=g.length;p--;){let E=g[p];E.instance===y&&(E.propertyName===S||S===void 0)&&(E.subscription.unsubscribe(),C.push(p))}for(;C.length;)g.splice(C.pop(),1)}function x(y,S){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,E=y.onModified(h),O=g[0];return g.push({instance:y,propertyName:S,subscription:E}),C&&(e.propertyLinkMap[f].persistent&&e.propertyLinkMap[f].value!==void 0?y.set({[S]:e.propertyLinkMap[f].value}):O&&h(O.instance,!0)),{unsubscribe:()=>v(y,S)}}function T(){for(;g.length;)g.pop().subscription.unsubscribe()}let m={bind:x,unbind:v,unsubscribe:T,persistent:l};return e.propertyLinkMap[f]=m,m};function o(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_i,l=[],u=e.proxyId,g=s(f)||[];for(let p=0;p<g.length;p++){let d=g[p],h=t[`get${Pe(d)}`],v=h?h():void 0,x={id:u,name:d,value:v},T=o(d);T.length&&(x.children=T),l.push(x)}return l}t.listPropertyNames=()=>o().map(f=>f.name),t.getPropertyByName=f=>o().find(l=>l.name===f),t.getPropertyDomainByName=f=>(n[f]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{let f=Object.keys(e.propertyLinkMap),l=f.length;for(;l--;)e.propertyLinkMap[f[l]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function c(){if(e.links)for(let f=0;f<e.links.length;f++){let{link:l,property:u,persistent:g,updateOnBind:p,type:d}=e.links[f];if(d==="application"){let h=e.proxyManager.getPropertyLink(l,g);t.registerPropertyLinkForGC(h,"application"),h.bind(t,u,p)}}}uc(c)}function Kg(t,e,r){let n=t.delete,a=[],i=Object.keys(r),s=i.length;for(;s--;){let o=i[s],{modelKey:c,property:f,modified:l=!0}=r[o],u=Pe(f),g=Pe(o);t[`get${g}`]=e[c][`get${u}`],t[`set${g}`]=e[c][`set${u}`],l&&a.push(e[c].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();n()}}function $g(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){let c=Object.keys(o),f=c.length;for(;f--;){let l=c[f];e[l].set(o[l])}}let i=Object.keys(n),s=i.length;for(;s--;){let o=i[s];e[o]=n[o];let c=r[o];t[`set${Pe(o)}`]=f=>{if(f!==e[o]){e[o]=f;let l=c[f];a(l),t.modified()}}}i.length&&Me(t,e,i)}var Og=10,Eg=40,Mg=800;function Xg(t){let e=0,r=0,n=0,a=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*Og,a=r*Og,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||a)&&t.deltaMode&&(t.deltaMode===1?(n*=Eg,a*=Eg):(n*=Mg,a*=Mg)),n&&!e&&(e=n<1?-1:1),a&&!r&&(r=a<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:a||n}}var w={algo:Ii,capitalize:Pi,chain:br,debounce:Hg,enumToString:u2,event:Pg,EVENT_ABORT:gc,formatBytesToProperUnit:Bg,formatNumbersWithThousandSeparator:Gg,get:Me,getArray:dr,getCurrentGlobalMTime:s2,getStateArrayMapFunc:Wg,isVtkObject:pc,keystore:hc,measurePromiseExecution:zg,moveToProtected:kr,newInstance:$,newTypedArray:hr,newTypedArrayFrom:Yn,normalizeWheel:Xg,obj:ae,proxy:jg,proxyPropertyMapping:Kg,proxyPropertyState:$g,safeArrays:_g,set:un,setArray:lc,setGet:ge,setGetArray:Hi,setImmediate:uc,setLoggerFunction:Fg,throttle:Ig,traverseInstanceTree:zi,TYPED_ARRAYS:et,uncapitalize:Ng,VOID:Lg,vtkDebugMacro:Wi,vtkErrorMacro:le,vtkInfoMacro:bg,vtkLogMacro:kg,vtkOnceErrorMacro:Ug,vtkWarningMacro:Ai,objectSetterMap:Ag,requiredParam:Dg},De=Object.freeze({__proto__:null,requiredParam:Dg,VOID:Lg,setLoggerFunction:Fg,vtkLogMacro:kg,vtkInfoMacro:bg,vtkDebugMacro:Wi,vtkErrorMacro:le,vtkWarningMacro:Ai,vtkOnceErrorMacro:Ug,TYPED_ARRAYS:et,newTypedArray:hr,newTypedArrayFrom:Yn,capitalize:Pi,_capitalize:Pe,uncapitalize:Ng,formatBytesToProperUnit:Bg,formatNumbersWithThousandSeparator:Gg,setImmediateVTK:uc,measurePromiseExecution:zg,obj:ae,get:Me,set:un,setGet:ge,getArray:dr,setArray:lc,setGetArray:Hi,moveToProtected:kr,algo:Ii,EVENT_ABORT:gc,event:Pg,newInstance:$,chain:br,isVtkObject:pc,traverseInstanceTree:zi,debounce:Hg,throttle:Ig,keystore:hc,proxy:jg,proxyPropertyMapping:Kg,proxyPropertyState:$g,normalizeWheel:Xg,default:w});var{vtkErrorMacro:p2}=w,h2=["Build","Render"];function d2(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{let a=n.getTraverseOperation(),i=t[a];if(i){i(n);return}t.apply(n,!0);for(let s=0;s<e.children.length;s++)e.children[s].traverse(n);t.apply(n,!1)},t.apply=(n,a)=>{let i=t[n.getOperation()];i&&i(a,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let a=0;a<e.children.length;++a){let s=e.children[a].getViewNodeFor(n);if(s)return s}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;let a=e._parent.getLastAncestorOfType(n);return a||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;let a=e._renderableChildMap.get(n);if(a!==void 0)return a.setVisited(!0),a;let i=t.createViewNode(n);if(i)return i.setParent(t),i.setVisited(!0),e._renderableChildMap.set(n,i),e.children.push(i),i},t.addMissingNodes=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!n||!n.length))for(let i=0;i<n.length;++i){let s=n[i],o=t.addMissingNode(s);if(a&&o!==void 0&&e.children[i]!==o){for(let c=i+1;c<e.children.length;++c)if(e.children[c]===o){e.children.splice(c,1),e.children.splice(i,0,o);break}}}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let a=0;a<n.length;++a){let i=n[a];if(e.children.indexOf(i)===-1){i.setParent(t),e.children.push(i);let o=i.getRenderable();o&&e._renderableChildMap.set(o,i)}i.setVisited(!0)}},t.removeNode=n=>{let a=e.children.findIndex(s=>s===n);if(a<0)return!1;let i=n.getRenderable();return i&&e._renderableChildMap.delete(i),n.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let a=0;a<e.children.length;++a){let i=e.children[a];if(i.getVisited())e.children[n++]=i,i.setVisited(!1);else{let o=i.getRenderable();o&&e._renderableChildMap.delete(o),i.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return p2("Cannot create view nodes without my own factory"),null;let a=e.myFactory.createNode(n);return a&&a.setRenderable(n),a};let r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}var v2={renderable:null,myFactory:null,children:[],visited:!1};function Yg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,v2,r),w.obj(t,e),w.event(t,e,"event"),e._renderableChildMap=new Map,w.get(t,e,["visited"]),w.setGet(t,e,["_parent","renderable","myFactory"]),w.getArray(t,e,["children"]),w.moveToProtected(t,e,["parent"]),d2(t,e)}var m2=w.newInstance(Yg,"vtkViewNode"),Q={newInstance:m2,extend:Yg,PASS_TYPES:h2};function x2(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,a=r.getClassName(n++),i=!1,s=Object.keys(e.overrides);for(;a&&!i;)s.indexOf(a)!==-1?i=!0:a=r.getClassName(n++);if(!i)return null;let o=e.overrides[a]();return o.setMyFactory(t),o}}var y2={};function qg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y2,r),w.obj(t,e),x2(t,e)}var T2=w.newInstance(qg,"vtkViewNodeFactory"),ji={newInstance:T2,extend:qg};var Zg=Object.create(null);function Te(t,e){Zg[t]=e}function S2(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}var C2={};function Qg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,C2,r),e.overrides=Zg,ji.extend(t,e,r),S2(t,e)}var w2=w.newInstance(Qg,"vtkOpenGLViewNodeFactory"),Jg={newInstance:w2,extend:Qg};function O2(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){let n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){D.copy(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),ee.fromMat4(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),ee.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),D.transpose(e.keyMatrices.wcvc,e.keyMatrices.wcvc);let n=e._openGLRenderer.getAspectRatio();D.copy(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),D.transpose(e.keyMatrices.vcpc,e.keyMatrices.vcpc),D.multiply(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}var E2={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function M2(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,E2,r),Q.extend(t,e,r),e.keyMatrixTime={},ae(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},ge(t,e,["context","keyMatrixTime"]),O2(t,e)}var R2=$(M2);Te("vtkCamera",R2);var{vtkDebugMacro:D2}=De;function L2(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0,n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(D2("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0,a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),n|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));let i=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.colorMask(!0,!0,!0,!0),n&&a.clear(n),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{let r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{let r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],i=r[1]-n[1],s=e._parent.normalizedDisplayToDisplay(a,i),o=Math.round(s[0]),c=Math.round(s[1]),f=r[2]-n[0],l=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(f,l),g=Math.round(u[0])-o,p=Math.round(u[1])-c;return g<0&&(g=0),p<0&&(p=0),{usize:g,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let r=0,n=e.context;if(!e.renderable.getTransparent()){let i=e.renderable.getBackgroundByReference();n.clearColor(i[0],i[1],i[2],i[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);let a=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var V2={context:null,_openGLRenderWindow:null,selector:null};function F2(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V2,r),Q.extend(t,e,r),Me(t,e,["shaderCache"]),ge(t,e,["selector"]),kr(t,e,["openGLRenderWindow"]),L2(t,e)}var k2=$(F2,"vtkOpenGLRenderer");Te("vtkRenderer",k2);var dc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ce={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},b2=ce.FLOAT,vc={DefaultDataType:b2,DataTypeByteSize:dc,VtkDataTypes:ce};var yp=Kn(vp(),1);var qn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mp=[1,0,0,0,1,0,0,0,1],$i=1e-6,Xi=1e-12;var{vtkErrorMacro:Tp,vtkWarningMacro:gn}=w,Sp=0,xp=20;function ka(t){return()=>Tp(`vtkMath::${t} - NOT IMPLEMENTED`)}function Fa(t,e,r,n){let a;for(let i=0;i<e;i++)a=t[r*e+i],t[r*e+i]=t[n*e+i],t[n*e+i]=a}function Va(t,e,r,n){let a;for(let i=0;i<e;i++)a=t[i*e+r],t[i*e+r]=t[i*e+n],t[i*e+n]=a}function be(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}var z2=()=>Math.PI;function A2(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function Fe(t){return t/180*Math.PI}function mr(t){return t*180/Math.PI}var{round:Qn,floor:ba,ceil:P2,min:H2,max:I2}=Math;function j2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0;for(let a=e,i=t.length;a<i;a+=r)t[a]<n&&(n=t[a]);return n}function K2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0;for(let a=e,i=t.length;a<i;a+=r)n<t[a]&&(n=t[a]);return n}function $2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,a=-1/0;for(let i=e,s=t.length;i<s;i+=r)t[i]<n&&(n=t[i]),a<t[i]&&(a=t[i]);return[n,a]}var X2=ka("ceilLog2"),Y2=ka("factorial");function pt(t){let e=1;for(;e<t;)e*=2;return e}function Jn(t){return t===pt(t)}function q2(t,e){let r=1;for(let n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function Z2(t,e){if(t<e)return 0;let r=be(e);for(let n=0;n<e;++n)r[n]=n;return r}function Q2(t,e,r){let n=0;for(let a=e-1;a>=0;--a)if(r[a]<t-e+a){let i=r[a]+1;for(;a<e;)r[a++]=i++;n=1;break}return n}function J2(t){(0,yp.default)(`${t}`,{global:!0}),Sp=t}function ew(){return Sp}function tw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+r*Math.random()}var rw=ka("gaussian");function xr(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Be(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Cp(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function wp(t,e){return t[0]*=e,t[1]*=e,t}function Zi(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function nw(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function te(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function aw(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function $e(t,e,r){let n=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=a,r[2]=i,r}function gt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function tt(t){let e=gt(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function Op(t){let e=gt(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function iw(t,e,r,n){let a=t[0]*t[0],i=t[1]*t[1],s=t[2]*t[2],o=Math.sqrt(a+i+s),c,f,l;a>i&&a>s?(c=0,f=1,l=2):i>s?(c=1,f=2,l=0):(c=2,f=0,l=1);let u=t[c]/o,g=t[f]/o,p=t[l]/o,d=Math.sqrt(u*u+p*p);if(n!==0){let h=Math.sin(n),v=Math.cos(n);e&&(e[c]=(p*v-u*g*h)/d,e[f]=h*d,e[l]=(-(u*v)-g*p*h)/d),r&&(r[c]=(-(p*h)-u*g*v)/d,r[f]=v*d,r[l]=(u*h-g*p*v)/d)}else e&&(e[c]=p/d,e[f]=0,e[l]=-u/d),r&&(r[c]=-u*g/d,r[f]=d,r[l]=-g*p/d)}function sw(t,e,r){let n=te(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;let a=te(t,e)/n;for(let i=0;i<3;i++)r[i]=e[i];return Cp(r,a),!0}function wc(t,e){return t[0]*e[0]+t[1]*e[1]}function ow(t,e,r){let n=wc(e,e);if(n===0)return r[0]=0,r[1]=0,!1;let a=wc(t,e)/n;for(let i=0;i<2;i++)r[i]=e[i];return wp(r,a),!0}function Ze(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function cw(t,e){let r=[0,0,0];return $e(t,e,r),Math.atan2(gt(r),te(t,e))}function fw(t,e,r){let n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(n**2)/(2*e))}function uw(t,e,r){let n=Math.abs(t-r);return Math.exp(-(n**2)/(2*e))}function lw(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function Ep(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Rc(t){let e=Ep(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Ge(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function gw(t,e){let r,n,a,i=[0,0,0];for(let s=0;s<3;s++)a=Math.abs(t[s*3]),(n=Math.abs(t[s*3+1]))>a&&(a=n),(n=Math.abs(t[s*3+2]))>a&&(a=n),i[s]=1/a;a=i[0]*Math.abs(t[0]),r=0,(n=i[1]*Math.abs(t[3]))>=a&&(a=n,r=1),(n=i[2]*Math.abs(t[6]))>=a&&(r=2),r!==0&&(Fa(t,3,r,0),i[r]=i[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],a=i[1]*Math.abs(t[4]),r=1,(n=i[2]*Math.abs(t[7]))>=a&&(r=2,Fa(t,3,1,2),i[2]=i[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function pw(t,e,r){let n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function hw(t,e,r){let n=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],f=t[6],l=t[7],u=t[8],g=+Ge(o,l,c,u),p=-Ge(s,f,c,u),d=+Ge(s,f,o,l),h=-Ge(a,l,i,u),v=+Ge(n,f,i,u),x=-Ge(n,f,a,l),T=+Ge(a,o,i,c),m=-Ge(n,s,i,c),y=+Ge(n,s,a,o),S=n*g+a*p+i*d,C=g*e[0]+h*e[1]+T*e[2],E=p*e[0]+v*e[1]+m*e[2],O=d*e[0]+x*e[1]+y*e[2];r[0]=C/S,r[1]=E/S,r[2]=O/S}function dw(t,e,r){let n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],i=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=a,r[2]=i}function Oc(t,e,r){let n=[...t],a=[...e];for(let i=0;i<3;i++)r[i]=n[0]*a[i]+n[1]*a[i+3]+n[2]*a[i+6],r[i+3]=n[3]*a[i]+n[4]*a[i+3]+n[5]*a[i+6],r[i+6]=n[6]*a[i]+n[7]*a[i+3]+n[8]*a[i+6]}function vw(t,e,r,n,a,i,s){n!==a&&Tp("Number of columns of A must match number of rows of B.");let o=[...t],c=[...e];for(let f=0;f<r;f++)for(let l=0;l<i;l++){s[f*i+l]=0;for(let u=0;u<n;u++)s[f*i+l]+=o[f*n+u]*c[l+i*u]}}function Zn(t,e){let r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function mw(t,e){let r=t[0],n=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],f=t[7],l=t[8],u=+Ge(s,f,o,l),g=-Ge(i,c,o,l),p=+Ge(i,c,s,f),d=-Ge(n,f,a,l),h=+Ge(r,c,a,l),v=-Ge(r,c,n,f),x=+Ge(n,s,a,o),T=-Ge(r,i,a,o),m=+Ge(r,i,n,s),y=r*u+n*g+a*p;y===0&&gn("Matrix has 0 determinant"),e[0]=u/y,e[3]=g/y,e[6]=p/y,e[1]=d/y,e[4]=h/y,e[7]=v/y,e[2]=x/y,e[5]=T/y,e[8]=m/y}function Qi(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function Ua(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$i;if(t.length!==e.length)return!1;function n(a,i){return Math.abs(a-e[i])<=r}return t.every(n)}var Ur=Ua;function Mp(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function Rp(t,e){for(let r=0;r<t;r++){for(let n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function xw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$i;return Ur(t,qn,e)}function yw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$i;return Ur(t,mp,e)}function Dp(t,e){let r=t[0]*t[0],n=t[0]*t[1],a=t[0]*t[2],i=t[0]*t[3],s=t[1]*t[1],o=t[2]*t[2],c=t[3]*t[3],f=t[1]*t[2],l=t[1]*t[3],u=t[2]*t[3],g=s+o+c,p=1/(r+g),d=(r-g)*p;p*=2,e[0]=s*p+d,e[3]=(f+i)*p,e[6]=(l-a)*p,e[1]=(f-i)*p,e[4]=o*p+d,e[7]=(u+n)*p,e[2]=(l+a)*p,e[5]=(u-n)*p,e[8]=c*p+d}function qi(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;let r=`${t}`.split("e"),n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function Ji(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=qi(t[0],r),e[1]=qi(t[1],r),e[2]=qi(t[2],r),e}function Na(t,e,r,n){let a,i,s,o,c,f,l,u,g,p,d,h,v,x,T,m,y=be(e),S=be(e),C=(O,U,k)=>{x=O[U],v=O[k],O[U]=x-h*(v+x*p),O[k]=v+h*(x-v*p)};for(Rp(e,n),c=0;c<e;c++)y[c]=r[c]=t[c+c*e],S[c]=0;for(a=0;a<xp;a++){for(d=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)d+=Math.abs(t[c*e+o]);if(d===0)break;for(a<3?l=.2*d/(e*e):l=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)if(x=100*Math.abs(t[c*e+o]),a>3&&Math.abs(r[c])+x===Math.abs(r[c])&&Math.abs(r[o])+x===Math.abs(r[o]))t[c*e+o]=0;else if(Math.abs(t[c*e+o])>l){for(v=r[o]-r[c],Math.abs(v)+x===Math.abs(v)?g=t[c*e+o]/v:(u=.5*v/t[c*e+o],g=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(g=-g)),T=1/Math.sqrt(1+g*g),h=g*T,p=h/(1+T),v=g*t[c*e+o],S[c]-=v,S[o]+=v,r[c]-=v,r[o]+=v,t[c*e+o]=0,i=0;i<=c-1;i++)C(t,i*e+c,i*e+o);for(i=c+1;i<=o-1;i++)C(t,c*e+i,i*e+o);for(i=o+1;i<e;i++)C(t,c*e+i,o*e+i);for(i=0;i<e;i++)C(n,i*e+c,i*e+o)}for(c=0;c<e;c++)y[c]+=S[c],r[c]=y[c],S[c]=0}if(a>=xp)return gn("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(i=0;i<e-1;i++){for(s=i,m=r[s],a=i+1;a<e;a++)(r[a]>=m||Math.abs(r[a]-m)<Xi)&&(s=a,m=r[s]);s!==i&&(r[s]=r[i],r[i]=m,Va(n,e,i,s))}let E=(e>>1)+(e&1);for(f=0,a=0;a<e*e;a++)n[a]>=0&&f++;if(f<E)for(a=0;a<e;a++)n[a*e+i]*=-1;return 1}function Lp(t,e){let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];let n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],i=[...r];Na(i,4,a,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function Tw(t,e,r){let n=t[0]*e[0],a=t[0]*e[1],i=t[0]*e[2],s=t[0]*e[3],o=t[1]*e[0],c=t[1]*e[1],f=t[1]*e[2],l=t[1]*e[3],u=t[2]*e[0],g=t[2]*e[1],p=t[2]*e[2],d=t[2]*e[3],h=t[3]*e[0],v=t[3]*e[1],x=t[3]*e[2],T=t[3]*e[3];r[0]=n-c-p-T,r[1]=a+o+d-x,r[2]=i-l+u+v,r[3]=s+f-g+h}function Vp(t,e){for(let g=0;g<9;g++)e[g]=t[g];let r=be(3),n=be(3),a;for(let g=0;g<3;g++){let p=Math.abs(e[g*3]),d=Math.abs(e[g*3+1]),h=Math.abs(e[g*3+2]);a=d>p?d:p,a=h>a?h:a,r[g]=1,a!==0&&(r[g]/=a)}let i=Math.abs(e[0])*r[0],s=Math.abs(e[3])*r[1],o=Math.abs(e[6])*r[2];n[0]=0,a=i,s>=a&&(a=s,n[0]=1),o>=a&&(n[0]=2),n[0]!==0&&(Va(e,3,n[0],0),r[n[0]]=r[0]);let c=Math.abs(e[4])*r[1],f=Math.abs(e[7])*r[2];n[1]=1,a=c,f>=a&&(n[1]=2,Va(e,3,1,2)),n[2]=2;let l=0;if(Qi(e)<0){l=1;for(let g=0;g<9;g++)e[g]=-e[g]}let u=be(4);if(Lp(e,u),Dp(u,e),l)for(let g=0;g<9;g++)e[g]=-e[g];n[1]!==1&&Va(e,3,n[1],1),n[0]!==0&&Va(e,3,n[0],0)}function Fp(t,e,r){let n,a,i,s,o,c,f=[...t];if(Na(f,3,e,r),e[0]===e[1]&&e[0]===e[2]){Mp(r);return}for(Zn(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(c=Math.abs(r[n*3]),s=0,a=1;a<3;a++)c<(o=Math.abs(r[n*3+a]))&&(c=o,s=a);s!==n&&(o=e[s],e[s]=e[n],e[n]=o,Fa(r,3,n,s)),r[s*3+s]<0&&(r[s*3]=-r[s*3],r[s*3+1]=-r[s*3+1],r[s*3+2]=-r[s*3+2]),a=(s+1)%3,i=(s+2)%3,r[a*3]=0,r[a*3+1]=0,r[a*3+2]=0,r[a*3+a]=1;let l=$e([r[s*3],r[s*3+1],r[s*3+2]],[r[a*3],r[a*3+1],r[a*3+2]],[]);tt(l);let u=$e(l,[r[s*3],r[s*3+1],r[s*3+2]],[]);for(let g=0;g<3;g++)r[i*3+g]=l[g],r[a*3+g]=u[g];Zn(r,r);return}for(c=Math.abs(r[0]),s=0,n=1;n<3;n++)c<(o=Math.abs(r[n*3]))&&(c=o,s=n);if(s!==0){let l=e[s];e[s]=e[0],e[0]=l,Fa(r,3,s,0)}if(Math.abs(r[4])<Math.abs(r[7])){let l=e[2];e[2]=e[1],e[1]=l,Fa(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);Qi(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),Zn(r,r)}function Sw(t,e,r,n){let a,i=[...t],s=Qi(i);if(s<0)for(a=0;a<9;a++)i[a]=-i[a];Vp(i,e),Zn(i,i),Oc(i,e,n),Fp(n,r,n),Oc(e,n,e),Zn(n,n),s<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function Dc(t,e,r){let n,a,i,s,o=0,c,f,l,u=be(r);for(n=0;n<r;n++){for(s=0,a=0;a<r;a++)(l=Math.abs(t[n*r+a]))>s&&(s=l);if(s===0)return gn("Unable to factor linear system"),0;u[n]=1/s}for(a=0;a<r;a++){for(n=0;n<a;n++){for(c=t[n*r+a],i=0;i<n;i++)c-=t[n*r+i]*t[i*r+a];t[n*r+a]=c}for(s=0,n=a;n<r;n++){for(c=t[n*r+a],i=0;i<a;i++)c-=t[n*r+i]*t[i*r+a];t[n*r+a]=c,(f=u[n]*Math.abs(c))>=s&&(s=f,o=n)}if(a!==o){for(i=0;i<r;i++)f=t[o*r+i],t[o*r+i]=t[a*r+i],t[a*r+i]=f;u[o]=u[a]}if(e[a]=o,Math.abs(t[a*r+a])<=Xi)return gn("Unable to factor linear system"),0;if(a!==r-1)for(f=1/t[a*r+a],n=a+1;n<r;n++)t[n*r+a]*=f}return 1}function Lc(t,e,r,n){let a,i,s,o,c;for(s=-1,a=0;a<n;a++){if(o=e[a],c=r[o],r[o]=r[a],s>=0)for(i=s;i<=a-1;i++)c-=t[a*n+i]*r[i];else c!==0&&(s=a);r[a]=c}for(a=n-1;a>=0;a--){for(c=r[a],i=a+1;i<n;i++)c-=t[a*n+i]*r[i];r[a]=c/t[a*n+a]}}function Vc(t,e,r){if(r===2){let a=be(2),i=Ge(t[0],t[1],t[2],t[3]);return i===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/i,a[1]=(-(t[2]*e[0])+t[0]*e[1])/i,e[0]=a[0],e[1]=a[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);let n=be(r);return Dc(t,n,r)===0?0:(Lc(t,n,e,r),1)}function es(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,i=n||be(r),s=a||be(r);if(Dc(t,i,r)===0)return null;for(let o=0;o<r;o++){for(let c=0;c<r;c++)s[c]=0;s[o]=1,Lc(t,i,s,r);for(let c=0;c<r;c++)e[c*r+o]=s[c]}return e}function Cw(t,e){let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let a=0;a<e;a++)for(let i=a;i<e;i++)Math.abs(t[a*e+i])>n&&(n=Math.abs(t[a*e+i]));for(let a=0;a<e;a++)Math.abs(t[a*e+a])<r&&(r=Math.abs(t[a*e+a]));return r===0?Number.MAX_VALUE:n/r}function ww(t,e,r){return Na(t,3,e,r)}function Ec(t,e,r,n){if(t<r)return gn("Insufficient number of samples. Underdetermined."),0;let a,i,s,o=be(r*r),c=be(r),f=be(r*r);for(s=0;s<t;s++)for(a=0;a<r;a++)for(i=a;i<r;i++)o[a*r+i]+=e[s*r+a]*e[s*r+i];for(a=0;a<r;a++)for(i=0;i<a;i++)o[a*r+i]=o[i*r+a];for(Na(o,r,c,f),a=0;a<r;a++)n[a]=f[a*r+r-1];return 1}function Ow(t,e,r,n,a,i){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<a)return gn("Insufficient number of samples. Underdetermined."),0;let o=be(a),c=1,f,l=0,u,g,p,d=0;if(s){for(g=0;g<a;g++)o[g]=1;for(u=0;u<t;u++)for(g=0;g<a;g++)Math.abs(n[u*a+g])>Xi&&(c=0,o[g]=0);if(c&&a===1)return gn("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Ec(t,e,r,i);if(c)d=1;else for(g=0;g<a;g++)o[g]&&(d=1)}d&&(f=be(r),l=Ec(t,e,r,f));let h=be(r*r),v=be(r*r),x=be(r*a);for(p=0;p<t;p++)for(u=0;u<r;u++){for(g=u;g<r;g++)h[u*r+g]+=e[p*r+u]*e[p*r+g];for(g=0;g<a;g++)x[u*a+g]+=e[p*r+u]*n[p*a+g]}for(u=0;u<r;u++)for(g=0;g<u;g++)h[u*r+g]=h[g*r+u];let T=es(h,v,r);if(T)for(u=0;u<r;u++)for(g=0;g<a;g++)for(i[u*a+g]=0,p=0;p<r;p++)i[u*a+g]+=v[u*r+p]*x[p*a+g];if(d){for(g=0;g<a;g++)if(o[g])for(u=0;u<r;u++)i[u*a+g]=f[u*a]}return d?l&&T:T}function Ew(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function ea(t,e){let r,n,[a,i,s]=t,o=1/3,c=1/6,f=2/3,l=a,u=a;i>l?l=i:i<u&&(u=i),s>l?l=s:s<u&&(u=s);let g=l;g>0?n=(l-u)/l:n=0,n>0?(a===l?r=c*(i-s)/(l-u):i===l?r=o+c*(s-a)/(l-u):r=f+c*(a-i)/(l-u),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=g}function yr(t,e){let[r,n,a]=t,i=1/3,s=1/6,o=2/3,c=5/6,f,l,u;r>s&&r<=i?(l=1,f=(i-r)/s,u=0):r>i&&r<=.5?(l=1,u=(r-i)/s,f=0):r>.5&&r<=o?(u=1,l=(o-r)/s,f=0):r>o&&r<=c?(u=1,f=(r-o)/s,l=0):r>c&&r<=1?(f=1,u=(1-r)/s,l=0):(f=1,l=r/s,u=0),f=n*f+(1-n),l=n*l+(1-n),u=n*u+(1-n),f*=a,l*=a,u*=a,e[0]=f,e[1]=l,e[2]=u}function kp(t,e){let[r,n,a]=t,i=(r+16)/116,s=n/500+i,o=i-a/200;i**3>.008856?i**=3:i=(i-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787;let c=.9505,f=1,l=1.089;e[0]=c*s,e[1]=f*i,e[2]=l*o}function bp(t,e){let[r,n,a]=t,i=.9505,s=1,o=1.089,c=r/i,f=n/s,l=a/o;c>.008856?c**=1/3:c=7.787*c+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,e[0]=116*f-16,e[1]=500*(c-f),e[2]=200*(f-l)}function Up(t,e){let[r,n,a]=t,i=r*3.2406+n*-1.5372+a*-.4986,s=r*-.9689+n*1.8758+a*.0415,o=r*.0557+n*-.204+a*1.057;i>.0031308?i=1.055*i**(1/2.4)-.055:i*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92;let c=i;c<s&&(c=s),c<o&&(c=o),c>1&&(i/=c,s/=c,o/=c),i<0&&(i=0),s<0&&(s=0),o<0&&(o=0),e[0]=i,e[1]=s,e[2]=o}function Np(t,e){let[r,n,a]=t;r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,a>.04045?a=((a+.055)/1.055)**2.4:a/=12.92,e[0]=r*.4124+n*.3576+a*.1805,e[1]=r*.2126+n*.7152+a*.0722,e[2]=r*.0193+n*.1192+a*.9505}function Nr(t,e){let r=[0,0,0];Np(t,r),bp(r,e)}function Ba(t,e){let r=[0,0,0];kp(t,r),Up(r,e)}function Ga(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function _a(t){return!(t[1]-t[0]<0)}function Mw(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function vr(t,e,r){return t<e?e:t>r?r:t}function ts(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=vr(t[0],e[0],r[0]),n[1]=vr(t[1],e[1],r[1]),n[2]=vr(t[2],e[2],r[2]),n}function Rw(t,e){let r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}var Dw=ka("GetScalarTypeFittingRange"),Lw=ka("GetAdjustedScalarRange");function Vw(t,e){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function Fw(t,e,r){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function kw(t,e,r){if(!t||!e||!r)return 0;for(let n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function bw(t,e,r,n){let a=be(3),i=be(3),s=be(3),o=be(3),c=be(3),f=be(3);for(let y=0;y<3;++y)a[y]=t[y]-e[y],i[y]=e[y]-r[y],s[y]=r[y]-t[y],o[y]=-a[y],c[y]=-i[y],f[y]=-s[y];let l=gt(o),u=gt(c),g=gt(s),p=be(3);$e(a,i,p);let d=gt(p),h=l*u*g/(2*d),v=2*d*d,x=u*u*te(a,f)/v,T=g*g*te(o,i)/v,m=l*l*te(s,c)/v;for(let y=0;y<3;++y)n[y]=x*t[y]+T*e[y]+m*r[y];return h}var Uw=1/0,Nw=-1/0,Fc=t=>!Number.isFinite(t),{isFinite:Bw,isNaN:Mc}=Number,pn=Mc;function hn(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Gw(t){let e=-1,r=-1;for(let n=0;n<t.length;n++){let a=Math.abs(t[n]);a>e&&(r=n,e=a)}return r}function _w(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,r=new Array(e),n=new Array(e);for(let i=0;i<e;++i)r[i]=i,n[i]=i;for(let i=e-1;i>0;i--){let s=-1/0,o=0,c=0;for(let f=0;f<=i;++f){let l=r[f];for(let u=0;u<=i;++u){let g=n[u],p=Math.abs(t[l+e*g]);p>s&&(s=p,o=f,c=u)}}[r[i],r[o]]=[r[o],r[i]],[n[i],n[c]]=[n[c],n[i]]}let a=new Array(e*e).fill(0);for(let i=0;i<e;++i){let s=r[i]+e*n[i];a[s]=t[s]<0?-1:1}return a}function Bp(t){let e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function Ww(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(Bp).join("")}`}function Yi(t){return Math.round(t*255)}function zw(t){return t.length===3?`rgb(${t.map(Yi).join(", ")})`:`rgba(${Yi(t[0]||0)}, ${Yi(t[1]||0)}, ${Yi(t[2]||0)}, ${t[3]||0})`}var Xe={Pi:z2,ldexp:A2,radiansFromDegrees:Fe,degreesFromRadians:mr,round:Qn,floor:ba,ceil:P2,ceilLog2:X2,min:H2,max:I2,arrayMin:j2,arrayMax:K2,arrayRange:$2,isPowerOfTwo:Jn,nearestPowerOfTwo:pt,factorial:Y2,binomial:q2,beginCombination:Z2,nextCombination:Q2,randomSeed:J2,getSeed:ew,random:tw,gaussian:rw,add:xr,subtract:Be,multiplyScalar:Cp,multiplyScalar2D:wp,multiplyAccumulate:Zi,multiplyAccumulate2D:nw,dot:te,outer:aw,cross:$e,norm:gt,normalize:tt,perpendiculars:iw,projectVector:sw,projectVector2D:ow,distance2BetweenPoints:Ze,angleBetweenVectors:cw,gaussianAmplitude:fw,gaussianWeight:uw,dot2D:wc,outer2D:lw,norm2D:Ep,normalize2D:Rc,determinant2x2:Ge,LUFactor3x3:gw,LUSolve3x3:pw,linearSolve3x3:hw,multiply3x3_vect3:dw,multiply3x3_mat3:Oc,multiplyMatrix:vw,transpose3x3:Zn,invert3x3:mw,identity3x3:Mp,identity:Rp,isIdentity:xw,isIdentity3x3:yw,determinant3x3:Qi,quaternionToMatrix3x3:Dp,areEquals:Ua,areMatricesEqual:Ur,roundNumber:qi,roundVector:Ji,matrix3x3ToQuaternion:Lp,multiplyQuaternion:Tw,orthogonalize3x3:Vp,diagonalize3x3:Fp,singularValueDecomposition3x3:Sw,solveLinearSystem:Vc,invertMatrix:es,luFactorLinearSystem:Dc,luSolveLinearSystem:Lc,estimateMatrixCondition:Cw,jacobi:ww,jacobiN:Na,solveHomogeneousLeastSquares:Ec,solveLeastSquares:Ow,hex2float:Ew,rgb2hsv:ea,hsv2rgb:yr,lab2xyz:kp,xyz2lab:bp,xyz2rgb:Up,rgb2xyz:Np,rgb2lab:Nr,lab2rgb:Ba,uninitializeBounds:Ga,areBoundsInitialized:_a,computeBoundsFromPoints:Mw,clampValue:vr,clampVector:ts,clampAndNormalizeValue:Rw,getScalarTypeFittingRange:Dw,getAdjustedScalarRange:Lw,extentIsWithinOtherExtent:Vw,boundsIsWithinOtherBounds:Fw,pointIsWithinBounds:kw,solve3PointCircle:bw,inf:Uw,negInf:Nw,isInf:Fc,isNan:Mc,isNaN:Mc,isFinite:Bw,createUninitializedBounds:hn,getMajorAxisIndex:Gw,getSparseOrthogonalMatrix:_w,floatToHex2:Bp,floatRGB2HexCode:Ww,float2CssRGBA:zw};var{vtkErrorMacro:Aw}=De,{DefaultDataType:Pw}=vc,Hw=1e-6;function kc(t,e,r){let n=t.length,a=Number.MAX_VALUE,i=-Number.MAX_VALUE,s,o;for(o=e;o<n;o+=r)if(!Number.isNaN(t[o])){a=t[o],i=a;break}for(;o<n;o+=r)s=t[o],s<a?a=s:s>i&&(i=s);return{min:a,max:i}}function Iw(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(a){t>a&&(t=a),e<a&&(e=a),r++,n+=a},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function _p(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){let a=t.length/r,i=new Float64Array(a);for(let s=0,o=0;s<a;++s){for(let c=o+r;o<c;++o)i[s]+=t[o]*t[o];i[s]**=.5}return kc(i,0,1)}return kc(t,e<0?0:e,r)}function Gp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=t||[];for(;r.length<=e;)r.push(null);return r}function bc(t){return Object.prototype.toString.call(t).slice(8,-1)}function jw(t){let e=t.getNumberOfComponents(),r=0,n=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,n);let i=gt(n,e);i>r&&(r=i)}return r}var Kw={computeRange:_p,createRangeHelper:Iw,fastComputeRange:kc,getDataType:bc,getMaxNorm:jw};function $w(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;let a=t.getNumberOfComponents(),i=e.values.length/(a>0?a:1);if(n===i)return!0;if(n>i){let s=e.values;return e.values=hr(e.dataType,(n+i)*a),e.values.set(s),!0}return e.size>n*a&&(e.size=n*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=n=>{r(t.getNumberOfTuples()+n)},t.resize=n=>{r(n);let a=n*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+a]},t.setComponent=(n,a,i)=>{i!==e.values[n*e.numberOfComponents+a]&&(e.values[n*e.numberOfComponents+a]=i,t.dataChange())},t.getValue=n=>{let a=n/e.numberOfComponents,i=n%e.numberOfComponents;return t.getComponent(a,i)},t.setValue=(n,a)=>{let i=n/e.numberOfComponents,s=n%e.numberOfComponents;t.setComponent(i,s,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=n;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let i=null;return e.ranges||(e.ranges=Gp(e.ranges,e.numberOfComponents)),i=e.ranges[a],i?(e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple):(i=_p(t.getData(),n,e.numberOfComponents),e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple)},t.setRange=(n,a)=>{e.ranges||(e.ranges=Gp(e.ranges,e.numberOfComponents));let i={min:n.min,max:n.max};return e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);let a=[];for(let i=0;i<e.numberOfComponents;i++){let[s,o]=t.getRange(i),c={min:s,max:o};a.push(c)}if(e.numberOfComponents>1){let[i,s]=t.getRange(-1),o={min:i,max:s};a.push(o)}return a},t.setTuple=(n,a)=>{let i=n*e.numberOfComponents;for(let s=0;s<e.numberOfComponents;s++)e.values[i+s]=a[s]},t.setTuples=(n,a)=>{let i=n*e.numberOfComponents,s=Math.min(a.length,e.size-i);for(let o=0;o<s;)e.values[i++]=a[o++]},t.insertTuple=(n,a)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,a),n),t.insertTuples=(n,a)=>{let i=n+a.length/e.numberOfComponents;return e.size<i*e.numberOfComponents&&(e.size=i*e.numberOfComponents,r(i)),t.setTuples(n,a),i},t.insertNextTuple=n=>{let a=e.size/e.numberOfComponents;return t.insertTuple(a,n)},t.insertNextTuples=n=>{let a=e.size/e.numberOfComponents;return t.insertTuples(a,n)},t.findTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hw;for(let i=0;i<e.size;i+=e.numberOfComponents)if(Math.abs(n[0]-e.values[i])<=a){let s=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(n[o]-e.values[i+o])>a){s=!1;break}if(s)return i/e.numberOfComponents}return-1},t.getTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=e.numberOfComponents||1,s=n*i;switch(i){case 4:a[3]=e.values[s+3];case 3:a[2]=e.values[s+2];case 2:a[1]=e.values[s+1];case 1:a[0]=e.values[s];break;default:for(let o=i-1;o>=0;--o)a[o]=e.values[s+o]}return a},t.getTuples=(n,a)=>{let i=(n??0)*e.numberOfComponents,s=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(i,s);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>zp({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,a)=>{e.values=n,e.size=n.length,e.dataType=bc(n),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;let n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(i=>{n[i]||delete n[i]});let a={};return Object.keys(n).sort().forEach(i=>{a[i]=n[i]}),a.mtime&&delete a.mtime,a},t.deepCopy=n=>{let a=t.getDataType(),i=e.values;t.shallowCopy(n),e.ranges=structuredClone(n.getRanges()),i?.length>=n.getNumberOfValues()&&a===n.getDataType()?(i.set(n.getData()),e.values=i,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,a,i,s,o,c)=>{let f=e.numberOfComponents||1;(f!==a.getNumberOfComponents()||f!==s.getNumberOfComponents())&&Aw("numberOfComponents must match");let l=a.getTuple(i),u=s.getTuple(o),g=[];switch(g.length=f,f){case 4:g[3]=l[3]+(u[3]-l[3])*c;case 3:g[2]=l[2]+(u[2]-l[2])*c;case 2:g[1]=l[1]+(u[1]-l[1])*c;case 1:g[0]=l[0]+(u[0]-l[0])*c;break;default:for(let p=0;p<f;p++)g[p]=l[p]+(u[p]-l[p])*c}return t.insertTuple(n,g)}}var Xw={name:"",numberOfComponents:1,dataType:Pw,rangeTuple:[0,0]};function Wp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Xw,r),Array.isArray(r.values)&&r.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Yn(e.dataType,e.values)):e.values=hr(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=bc(e.values)),ae(t,e),un(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");$w(t,e)}var zp=$(Wp,"vtkDataArray"),K={newInstance:zp,extend:Wp,...Kw,...vc};var{isVtkObject:Yw}=w;function Ap(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function Pp(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}var qw={extractCellSizes:Ap,getNumberOfCells:Pp};function Zw(t,e){e.classHierarchy.push("vtkCellArray");let r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=Pp(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=Ap(t.getData())),e.cellSizes),t.resize=n=>{let a=t.getNumberOfTuples();r.resize(n);let i=t.getNumberOfTuples();i<a&&(i===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let a=n,i=e.values[a++];return e.values.subarray(a,a+i)},t.insertNextCell=n=>{let a;Yw(n)?a=n.getPointsIds():a=n;let i=t.getNumberOfCells();return t.insertNextTuples([a.length,...a]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(a.length),i},t.getMaxCellSize=()=>t.getCellSizes().reduce((n,a)=>Math.max(n,a),0)}function Qw(t){return{empty:!0,numberOfComponents:1,dataType:ce.UNSIGNED_INT,...t}}function Hp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};K.extend(t,e,Qw(r)),Zw(t,e)}var Jw=w.newInstance(Hp,"vtkCellArray"),Qt={newInstance:Jw,extend:Hp,...qw};function eO(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);let n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{w.vtkErrorMacro("not implemented")}}var tO={};function Ip(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tO,r),w.obj(t,e),w.setGet(t,e,["transform"]),eO(t,e)}var rO=w.newInstance(Ip,"vtkImplicitFunction"),jp={newInstance:rO,extend:Ip};var Uc=1e-6,Kp="coincide",$p="disjoint";function nO(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function Xp(t,e,r){let n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function Yp(t,e,r,n){let a=[];Be(t,e,a);let i=te(r,a);n[0]=t[0]-i*r[0],n[1]=t[1]-i*r[1],n[2]=t[2]-i*r[2]}function qp(t,e,r){let n=te(t,e),a=te(e,e);return a===0&&(a=1),r[0]=t[0]-n*e[0]/a,r[1]=t[1]-n*e[1]/a,r[2]=t[2]-n*e[2]/a,r}function Zp(t,e,r,n){let a=[];Be(t,e,a);let i=te(r,a),s=te(r,r);s!==0?(n[0]=t[0]-i*r[0]/s,n[1]=t[1]-i*r[1]/s,n[2]=t[2]-i*r[2]/s):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function Qp(t,e,r,n){let a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},i=[],s=[];Be(e,t,i),Be(r,t,s);let o=te(n,s),c=te(n,i),f,l;return c<0?f=-c:f=c,o<0?l=-o*Uc:l=o*Uc,f<=l||(a.t=o/c,a.x[0]=t[0]+a.t*i[0],a.x[1]=t[1]+a.t*i[1],a.x[2]=t[2]+a.t*i[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function Jp(t,e,r,n){let a={intersection:!1,l0:[],l1:[],error:null},i=[];$e(e,n,i);let s=i.map(u=>Math.abs(u));if(s[0]+s[1]+s[2]<Uc){let u=[];return Be(t,r,u),te(e,u)===0?a.error=Kp:a.error=$p,a}let o;s[0]>s[1]&&s[0]>s[2]?o="x":s[1]>s[2]?o="y":o="z";let c=[],f=-te(e,t),l=-te(n,r);switch(o){case"x":c[0]=0,c[1]=(l*e[2]-f*n[2])/i[0],c[2]=(f*n[1]-l*e[1])/i[0];break;case"y":c[0]=(f*n[2]-l*e[2])/i[1],c[1]=0,c[2]=(l*e[0]-f*n[0])/i[1];break;case"z":c[0]=(l*e[1]-f*n[1])/i[2],c[1]=(f*n[0]-l*e[0])/i[2],c[2]=0;break}return a.l0=c,xr(c,i,a.l1),a.intersection=!0,a}var aO={evaluate:nO,distanceToPlane:Xp,projectPoint:Yp,projectVector:qp,generalizedProjectPoint:Zp,intersectWithLine:Qp,intersectWithPlane:Jp,DISJOINT:$p,COINCIDE:Kp};function iO(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>Xp(r,e.origin,e.normal),t.projectPoint=(r,n)=>{Yp(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>qp(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{Zp(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,a)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>Qp(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>Jp(r,n,e.origin,e.normal)}var sO={normal:[0,0,1],origin:[0,0,0]};function e0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sO,r),jp.extend(t,e,r),w.setGetArray(t,e,["normal","origin"],3),iO(t,e)}var oO=w.newInstance(e0,"vtkPlane"),Mt={newInstance:oO,extend:e0,...aO};var ss=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function t0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Tr(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Bc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Gc(t){return Bc(t,ss)}function ns(t,e,r,n){let[a,i,s,o,c,f]=t;return t[0]=a<e?a:e,t[1]=i>e?i:e,t[2]=s<r?s:r,t[3]=o>r?o:r,t[4]=c<n?c:n,t[5]=f>n?f:n,t}function _c(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)ns(t,...e[r]);else for(let r=0;r<e.length;r+=3)ns(t,...e.slice(r,r+3));return t}function r0(t,e,r,n,a,i,s){let[o,c,f,l,u,g]=t;return s===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],f),t[3]=Math.max(e[3],l),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,o),t[1]=Math.max(r,c),t[2]=Math.min(n,f),t[3]=Math.max(a,l),t[4]=Math.min(i,u),t[5]=Math.max(s,g)),t}function n0(t,e,r,n){let[a,i,s,o,c,f]=t;return t[0]=e,t[1]=e>i?e:i,t[2]=r,t[3]=r>o?r:o,t[4]=n,t[5]=n>f?n:f,a!==e||s!==r||c!==n}function a0(t,e,r,n){let[a,i,s,o,c,f]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=r<s?r:s,t[3]=r,t[4]=n<c?n:c,t[5]=n,i!==e||o!==r||f!==n}function Wc(t,e){return e==null?cO(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function cO(t){let e=[0,0,0],r=-1,n=0,a=0;for(let i=0;i<3;++i)a=t[i*2+1]-t[i*2],a>n&&(n=a,r=i),e[i]=a>0?1:0;if(r<0)return Wc(t,.5);for(let i=0;i<3;++i)if(!e[i]){let s=.005*n;t[i*2]-=s,t[i*2+1]+=s}return t}function zc(t,e,r,n){return Tr(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function Ac(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function fO(t,e,r,n){if(!Tr(t))return!1;let a=Ac(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],zc(t,e,r,n),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function Wa(t,e){return t[e*2+1]-t[e*2]}function za(t){return[Wa(t,0),Wa(t,1),Wa(t,2)]}function i0(t){return t.slice(0,2)}function s0(t){return t.slice(2,4)}function o0(t){return t.slice(4,6)}function c0(t){let e=za(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function Pc(t){if(Tr(t)){let e=za(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function f0(t){let e=Pc(t);return e!==null?Math.sqrt(e):null}function os(t){return[t[0],t[2],t[4]]}function cs(t){return[t[1],t[3],t[5]]}function rs(t,e){return t<=0&&e>=0||t>=0&&e<=0}function Hc(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function u0(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function l0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=Hc(t,[]);for(let a=0;a<n.length;++a)P.transformMat4(n[a],n[a],e);return Gc(r),_c(r,n)}function g0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function p0(t,e,r,n){let a=[].concat(ss),i=t.getData();for(let s=0;s<i.length;s+=3){let o=[i[s],i[s+1],i[s+2]],c=te(o,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);let f=te(o,r);a[2]=Math.min(f,a[2]),a[3]=Math.max(f,a[3]);let l=te(o,n);a[4]=Math.min(l,a[4]),a[5]=Math.max(l,a[5])}return a}function h0(t,e,r,n,a){let i=!0,s=[],o=0,c=[],f=[0,0,0],l=0,u=1,g=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(s[p]=u,f[p]=t[2*p],i=!1):e[p]>t[2*p+1]?(s[p]=l,f[p]=t[2*p+1],i=!1):s[p]=g;if(i)return n[0]=e[0],n[1]=e[1],n[2]=e[2],a[0]=0,1;for(let p=0;p<3;p++)s[p]!==g&&r[p]!==0?c[p]=(f[p]-e[p])/r[p]:c[p]=-1;for(let p=0;p<3;p++)c[o]<c[p]&&(o=p);if(c[o]>1||c[o]<0)return 0;a[0]=c[o];for(let p=0;p<3;p++)if(o!==p){if(n[p]=e[p]+c[o]*r[p],n[p]<t[2*p]||n[p]>t[2*p+1])return 0}else n[p]=f[p];return 1}function d0(t,e,r){let n=[],a=0,i=1,s=1;for(let o=4;o<=5;++o){n[2]=t[o];for(let c=2;c<=3;++c){n[1]=t[c];for(let f=0;f<=1;++f)if(n[0]=t[f],a=Mt.evaluate(r,e,n),s&&(i=a>=0?1:-1,s=0),a===0||i>0&&a<0||i<0&&a>0)return 1}}return 0}function v0(t,e){if(!(Tr(t)&&Tr(e)))return!1;let r=[0,0,0,0,0,0],n;for(let a=0;a<3;a++)if(n=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(n=!0,r[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(n=!0,r[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(n=!0,r[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(n=!0,r[a*2+1]=t[a*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function as(t,e){if(!(Tr(t)&&Tr(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function is(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function uO(t,e){return!(!as(t,e)||!is(t,...os(e))||!is(t,...cs(e)))}function m0(t,e,r){let n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0],i=0;for(let u=0;u<2;u++)for(let g=2;g<4;g++)for(let p=4;p<6;p++){let d=[t[u],t[g],t[p]];a[i++]=Mt.evaluate(r,e,d)}let s=2;for(;s--&&!(rs(a[n[s][0]],a[n[s][4]])&&rs(a[n[s][1]],a[n[s][5]])&&rs(a[n[s][2]],a[n[s][6]])&&rs(a[n[s][3]],a[n[s][7]])););if(s<0)return!1;let o=Math.sign(r[s]),c=Math.abs((t[s*2+1]-t[s*2])*r[s]),f=o>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;let g=Math.abs(a[n[s][u]])/c;o>0&&g<f&&(f=g),o<0&&g>f&&(f=g)}let l=(1-f)*t[s*2]+f*t[s*2+1];return o>0?t[s*2]=l:t[s*2+1]=l,!0}function x0(t,e){for(let n=0;n<3;++n)e[n]=e[n]<1?1:e[n];let r=e[0]*e[1]*e[2];for(;r>t;){for(let n=0;n<3;++n)e[n]=e[n]>1?e[n]-1:1;r=e[0]*e[1]*e[2]}}function y0(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let a=0,i=[0,0,0],s=-1,o=0,c=za(t),f=c[0]+c[1]+c[2],l=f*(.001/3);for(let h=0;h<3;++h)c[h]>o&&(s=h,o=c[h]),c[h]>l?(i[h]=1,a++):i[h]=0;let u=os(t),g=cs(t);if(a<1)return r[0]=1,r[1]=1,r[2]=1,n[0]=u[0]-.5,n[1]=g[0]+.5,n[2]=u[1]-.5,n[3]=g[1]+.5,n[4]=u[2]-.5,n[5]=g[2]+.5,1;let p=e;p/=i[0]?c[0]/f:1,p/=i[1]?c[1]/f:1,p/=i[2]?c[2]/f:1,p**=1/a;for(let h=0;h<3;++h)r[h]=i[h]?Math.floor(p*c[h]/f):1,r[h]=r[h]<1?1:r[h];x0(e,r);let d=.5*c[s]/r[s];for(let h=0;h<3;++h)i[h]?(n[2*h]=u[h],n[2*h+1]=g[h]):(n[2*h]=u[h]-d,n[2*h+1]=g[h]+d);return r[0]*r[1]*r[2]}function T0(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;let r=[0,0,0];return t[0]<e[0]?r[0]=e[0]-t[0]:t[0]>e[1]&&(r[0]=t[0]-e[1]),t[1]<e[2]?r[1]=e[2]-t[1]:t[1]>e[3]&&(r[1]=t[1]-e[3]),t[2]<e[4]?r[2]=e[4]-t[2]:t[2]>e[5]&&(r[2]=t[2]-e[5]),te(r,r)}var Nc=class{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(ss))}getBounds(){return this.bounds}equals(e){return t0(this.bounds,e)}isValid(){return Tr(this.bounds)}setBounds(e){return Bc(this.bounds,e)}reset(){return Gc(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ns(this.bounds,...r)}addPoints(e){return _c(this.bounds,e)}addBounds(e,r,n,a,i,s){return r0(this.bounds,e,r,n,a,i,s)}setMinPoint(e,r,n){return n0(this.bounds,e,r,n)}setMaxPoint(e,r,n){return a0(this.bounds,e,r,n)}inflate(e){return Wc(this.bounds,e)}scale(e,r,n){return zc(this.bounds,e,r,n)}getCenter(){return Ac(this.bounds)}getLength(e){return Wa(this.bounds,e)}getLengths(){return za(this.bounds)}getMaxLength(){return c0(this.bounds)}getDiagonalLength(){return f0(this.bounds)}getDiagonalLength2(){return Pc(this.bounds)}getMinPoint(){return os(this.bounds)}getMaxPoint(){return cs(this.bounds)}getXRange(){return i0(this.bounds)}getYRange(){return s0(this.bounds)}getZRange(){return o0(this.bounds)}getCorners(e){return Hc(this.bounds,e)}computeCornerPoints(e,r){return u0(this.bounds,e,r)}computeLocalBounds(e,r,n){return p0(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return l0(this.bounds,e,r)}computeScale3(e){return g0(this.bounds,e)}cutWithPlane(e,r){return m0(this.bounds,e,r)}intersectBox(e,r,n,a){return h0(this.bounds,e,r,n,a)}intersectPlane(e,r){return d0(this.bounds,e,r)}intersect(e){return v0(this.bounds,e)}intersects(e){return as(this.bounds,e)}containsPoint(e,r,n){return is(this.bounds,e,r,n)}contains(e){return as(this.bounds,e)}computeDivisions(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return y0(this.bounds,e,r,n)}distance2ToBounds(e){return T0(e,this.bounds)}};function lO(t){let e=t&&t.bounds;return new Nc(e)}var gO={equals:t0,isValid:Tr,setBounds:Bc,reset:Gc,addPoint:ns,addPoints:_c,addBounds:r0,setMinPoint:n0,setMaxPoint:a0,inflate:Wc,scale:zc,scaleAboutCenter:fO,getCenter:Ac,getLength:Wa,getLengths:za,getMaxLength:c0,getDiagonalLength:f0,getDiagonalLength2:Pc,getMinPoint:os,getMaxPoint:cs,getXRange:i0,getYRange:s0,getZRange:o0,getCorners:Hc,computeCornerPoints:u0,computeLocalBounds:p0,transformBounds:l0,computeScale3:g0,cutWithPlane:m0,intersectBox:h0,intersectPlane:d0,intersect:v0,intersects:as,containsPoint:is,contains:uO,computeDivisions:y0,clampDivisions:x0,distance2ToBounds:T0,INIT_BOUNDS:ss},se={newInstance:lO,...gO};var{vtkErrorMacro:pO}=w;function hO(t,e){let r=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==i&&(e.size=i*s,e.values=w.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(s),t.modified())},t.setPoint=function(i){for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];t.setTuple(i,o)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(i,s,o)=>t.insertNextTuple([i,s,o]),t.insertPoint=(i,s)=>t.insertTuple(i,s);let n=t.getBounds;t.getBounds=()=>(r<e.mtime&&t.computeBounds(),n());let a=t.getBoundsByReference;t.getBoundsByReference=()=>(r<e.mtime&&t.computeBounds(),a()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){let i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];let s=t.getRange(1);e.bounds[2]=s[0],e.bounds[3]=s[1];let o=t.getRange(2);e.bounds[4]=o[0],e.bounds[5]=o[1]}else if(t.getNumberOfComponents()===2){let i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];let s=t.getRange(1);e.bounds[2]=s[0],e.bounds[3]=s[1],e.bounds[4]=0,e.bounds[5]=0}else pO(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),Ga(e.bounds);r=w.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}var dO={empty:!0,numberOfComponents:3,dataType:ce.FLOAT,bounds:[1,-1,1,-1,1,-1]};function S0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dO,r),K.extend(t,e,r),w.getArray(t,e,["bounds"],6),hO(t,e)}var vO=w.newInstance(S0,"vtkPoints"),Sr={newInstance:vO,extend:S0};function mO(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=w.newTypedArray(r.getDataType(),3*e.pointsIds.length));let i=r.getData();e.pointsIds.forEach((s,o)=>{let c=3*s,f=3*o;a[f]=i[c],a[++f]=i[++c],a[++f]=i[++c]}),e.points.setData(a)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let a=r.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{let r=se.getLengths(t.getBounds());return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]},t.getParametricDistance=r=>{let n,a=0;for(let i=0;i<3;i++)r[i]<0?n=-r[i]:r[i]>1?n=r[i]-1:n=0,n>a&&(a=n);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,a,i,s,o,c)=>{},t.evaluatePosition=(r,n,a,i,s,o)=>{w.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}var xO={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function C0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xO,r),w.obj(t,e),e.points||(e.points=Sr.newInstance()),w.get(t,e,["points","pointsIds"]),mO(t,e)}var yO=w.newInstance(C0,"vtkCell"),Rt={newInstance:yO,extend:C0};function TO(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function SO(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{let n=r.getPoints().getNumberOfPoints(),a=r.getNumberOfCells(),i=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let s=0;s<a;++s){let{cellPointIds:o}=r.getCellPoints(s);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(n),e.maxId=n-1;for(let s=0;s<a;++s){let{cellPointIds:o}=r.getCellPoints(s);o.forEach(c=>{t.insertCellReference(c,i[c]++,s)})}}else{for(let s=0;s<a;s++)Rt.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(n),e.maxId=n-1;for(let s=0;s<a;++s)Rt.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,i[c]++,s)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(a=>a!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{TO(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,a)=>{e.array[r].cells[n]=a}}var CO={array:null,maxId:0,extend:0};function w0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CO,r),w.obj(t,e),SO(t,e)}var wO=w.newInstance(w0,"vtkCellLinks"),O0={newInstance:wO,extend:w0};var Se={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},fs=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function OO(t){return t<fs.length?fs[t]:"UnknownClass"}function EO(t){return fs.findIndex(t)}function MO(t){return t<Se.VTK_QUADRATIC_EDGE||t===Se.VTK_CONVEX_POINT_SET||t===Se.VTK_POLYHEDRON}function RO(t){return t===Se.VTK_TRIANGLE_STRIP||t===Se.VTK_POLY_LINE||t===Se.VTK_POLY_VERTEX}var DO={getClassNameFromTypeId:OO,getTypeIdFromClassName:EO,isLinear:MO,hasSubCells:RO};function LO(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,a)=>{e.typeArray[r]=n,e.locationArray[r]=a,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,a)=>{e.size=r,e.typeArray=n,e.locationArray=a,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=Se.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{let n=t.getNumberOfTypes();for(let a=0;a<n;++a)if(r===t.getCellType(a))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}var VO={size:0,maxId:-1,extend:1e3};function E0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VO,r),w.obj(t,e),w.get(t,e,["size","maxId","extend"]),w.getArray(t,e,["typeArray","locationArray"]),LO(t,e)}var FO=w.newInstance(E0,"vtkCellTypes"),M0={newInstance:FO,extend:E0,...DO};var Ic={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2},jc={IntersectionState:Ic};var{IntersectionState:us}=jc;function ta(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a={t:Number.MIN_VALUE,distance:0},i=[],s;i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2];let o=i[0]*(t[0]-e[0])+i[1]*(t[1]-e[1])+i[2]*(t[2]-e[2]),c=te(i,i),f=1e-5*o;return c!==0&&(a.t=o/c),f<0&&(f=-f),-f<c&&c<f||c<=0||a.t<0?s=e:a.t>1?s=r:(s=i,i[0]=e[0]+a.t*i[0],i[1]=e[1]+a.t*i[1],i[2]=e[2]+a.t*i[2]),n&&(n[0]=s[0],n[1]=s[1],n[2]=s[2]),a.distance=Ze(s,t),a}function R0(t,e,r,n,a,i){let s=[],o=[],c=[];a[0]=0,i[0]=0,Be(e,t,s),Be(n,r,o),Be(r,t,c);let f=[te(s,s),-te(s,o),-te(s,o),te(o,o)],l=[];if(l[0]=te(s,c),l[1]=-te(o,c),Vc(f,l,2)===0){let u=Number.MAX_VALUE,g=[t,e,r,n],p=[r,r,t,t],d=[n,n,e,e];i[0],i[0],a[0],a[0],a[0],a[0],i[0],i[0];let h;for(let v=0;v<4;v++)h=ta(g[v],p[v],d[v]),h.distance<u&&(u=h.distance,h.t);return us.ON_LINE}return a[0]=l[0],i[0]=l[1],a[0]>=0&&a[0]<=1&&i[0]>=0&&i[0]<=1?us.YES_INTERSECTION:us.NO_INTERSECTION}var kO={distanceToLine:ta,intersection:R0};function bO(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,a,i,s,o)=>{let c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;let f=[],l=[],u=[];e.points.getPoint(0,l),e.points.getPoint(1,u);let g=[],p=[],d=R0(n,a,l,u,g,p);if(c.t=g[0],c.betweenPoints=r(c.t),o[0]=p[0],d===us.YES_INTERSECTION){for(let h=0;h<3;h++)s[h]=l[h]+o[0]*(u[h]-l[h]),f[h]=n[h]+c.t*(a[h]-n[h]);if(Ze(s,f)<=i*i)return c.intersect=1,c}else{let h;if(c.t<0)return h=ta(n,l,u,s),h.distance<=i*i&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return h=ta(a,l,u,s),h.distance<=i*i&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,h=ta(l,n,a,s),c.t=h.t,h.distance<=i*i&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,h=ta(u,n,a,s),c.t=h.t,h.distance<=i*i&&(c.intersect=1),c}return c},t.evaluateLocation=(n,a,i)=>{let s=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,o);for(let c=0;c<3;c++)a[c]=s[c]+n[0]*(o[c]-s[c]);i[0]=1-n[0],i[1]=n[0]},t.evaluateOrientation=(n,a,i)=>e.orientations?(ze.slerp(a,e.orientations[0],e.orientations[1],n[0]),i[0]=1-n[0],i[1]=n[0],!0):!1}var UO={orientations:null};function D0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UO,r),Rt.extend(t,e,r),w.setGet(t,e,["orientations"]),bO(t,e)}var NO=w.newInstance(D0,"vtkLine"),Ie={newInstance:NO,extend:D0,...kO,...jc};var{vtkErrorMacro:L0,vtkWarningMacro:BO}=w;function GO(t,e){e.classHierarchy.push("vtkFieldData");let r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:ft(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(a=>a),e.arrays=n.getArrays().map(a=>({data:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{let a=n.getName(),{array:i,index:s}=t.getArrayWithIndex(a);return i!=null?(e.arrays[s]={data:n},s):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{let a=e.arrays.findIndex(i=>i.data.getName()===n);return t.removeArrayByIndex(a)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((a,i,s)=>i.data.getName()===n?i.data:a,null),t.getArrayWithIndex=n=>{let a=e.arrays.findIndex(i=>i.data.getName()===n);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{let a=e.arrays[n];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(s=>{let o=t.getFlag(s.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&s){let c=t.getArrayByName(s.getName());if(c)if(s.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<s.getNumberOfTuples()){let f=i>-1?i:a;c.insertTuple(f,s.getTuple(a))}else c.insertTuples(0,s.getTuples());else L0("Unhandled case in passData");else if(a<0||a>s.getNumberOfTuples())t.addArray(s),n.getAttributes(s).forEach(f=>{t.setAttribute(s,f)});else{let f=s.getNumberOfComponents(),l=s.getNumberOfValues(),u=i>-1?i:a;l<=u*f&&(l=(u+1)*f),c=K.newInstance({name:s.getName(),dataType:s.getDataType(),numberOfComponents:f,values:w.newTypedArray(s.getDataType(),l),size:0}),c.insertTuple(u,s.getTuple(a)),t.addArray(c),n.getAttributes(s).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(c=>{let f=t.getFlag(c.getName());if(f!==!1&&!(e.doCopyAllOff&&f!==!0)&&c){let l=t.getArrayByName(c.getName());if(l)if(c.getNumberOfComponents()===l.getNumberOfComponents())if(a>-1&&a<c.getNumberOfTuples()){let u=s>-1?s:a;l.interpolateTuple(u,c,a,c,i,o),BO("Unexpected case in interpolateData")}else l.insertTuples(c.getTuples());else L0("Unhandled case in interpolateData");else if(a<0||i<0||a>c.getNumberOfTuples())t.addArray(c),n.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{let u=c.getNumberOfComponents(),g=c.getNumberOfValues(),p=s>-1?s:a;g<=p*u&&(g=(p+1)*u),l=K.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:w.newTypedArray(c.getDataType(),g),size:0}),l.interpolateTuple(p,c,a,c,i,o),t.addArray(l),n.getAttributes(c).forEach(d=>{t.setAttribute(l,d)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(a=>{let i=a.newClone();return i.deepCopy(a),{data:i}})},t.copyFlags=n=>n.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,a)=>a.data.getMTime()>n?a.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,a)=>n+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{let n=r();return n&&(n.arrays=e.arrays.map(a=>({data:a.data.getState()}))),n}}var _O={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function V0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_O,r),w.obj(t,e),GO(t,e)}var WO=w.newInstance(V0,"vtkFieldData"),F0={newInstance:WO,extend:V0};var zO={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},AO={MAX:0,EXACT:1,NOLIMIT:2},PO={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},HO={DUPLICATEPOINT:1,HIDDENPOINT:2},IO={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},jO="vtkGhostType",KO={DEFAULT:0,SINGLE:1,DOUBLE:2},Kc={AttributeCopyOperations:IO,AttributeLimitTypes:AO,AttributeTypes:zO,CellGhostTypes:PO,DesiredOutputPrecision:KO,PointGhostTypes:HO,ghostArrayName:jO};var{AttributeTypes:Br,AttributeCopyOperations:dn}=Kc,{vtkWarningMacro:ls}=w;function $O(t,e){let r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(s){let o=r.find(c=>Br[c.toUpperCase()]===s||typeof s!="number"&&c.toLowerCase()===s.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");let a={...t};t.checkNumberOfComponents=s=>!0,t.setAttribute=(s,o)=>{let c=n(o);if(s&&c.toUpperCase()==="PEDIGREEIDS"&&!s.isA("vtkDataArray"))return ls(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(s&&!t.checkNumberOfComponents(s,c))return ls(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let f=e[`active${c}`];if(f>=0&&f<e.arrays.length){if(e.arrays[f]===s)return f;t.removeArrayByIndex(f)}return s?(f=t.addArray(s),e[`active${c}`]=f):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=s=>r.filter(o=>t[`get${o}`]()===s),t.setActiveAttributeByName=(s,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(s).index,o),t.setActiveAttributeByIndex=(s,o)=>{let c=n(o);if(s>=0&&s<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){let f=t.getArrayByIndex(s);if(!f.isA("vtkDataArray"))return ls(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(f,c))return ls(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=s,t.modified(),s}return s===-1&&(e[`active${c}`]=s,t.modified()),-1},t.getActiveAttribute=s=>{let o=n(s);return t[`get${o}`]()},t.removeAllArrays=()=>{r.forEach(s=>{e[`active${s}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=s=>(s!==-1&&r.forEach(o=>{s===e[`active${o}`]?e[`active${o}`]=-1:s<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(s)),r.forEach(s=>{let o=`active${s}`;t[`get${s}`]=()=>t.getArrayByIndex(e[o]),t[`set${s}`]=c=>t.setAttribute(c,s),t[`setActive${s}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,s),t[`copy${s}Off`]=()=>{let c=s.toUpperCase();e.copyAttributeFlags[dn.PASSDATA][Br[c]]=!1},t[`copy${s}On`]=()=>{let c=s.toUpperCase();e.copyAttributeFlags[dn.PASSDATA][Br[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(dn).filter(s=>s!=="ALLCOPY").forEach(s=>{e.copyAttributeFlags[dn[s]]=Object.keys(Br).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[Br[c]]=!0,o),[])}),e.copyAttributeFlags[dn.COPYTUPLE][Br.GLOBALIDS]=!1,e.copyAttributeFlags[dn.INTERPOLATE][Br.GLOBALIDS]=!1,e.copyAttributeFlags[dn.COPYTUPLE][Br.PEDIGREEIDS]=!1},t.initialize=w.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(s=>{!e.dataArrays[s].ref&&e.dataArrays[s].type==="vtkDataArray"&&t.addArray(K.newInstance(e.dataArrays[s]))});let i=t.shallowCopy;t.shallowCopy=(s,o)=>{i(s,o),e.arrays=s.getArrays().map(c=>{let f=c.newClone();return f.shallowCopy(c,o),{data:f}})},t.initializeAttributeCopyFlags()}var XO={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function k0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XO,r),F0.extend(t,e,r),w.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),$O(t,e)}var YO=w.newInstance(k0,"vtkDataSetAttributes"),$c={newInstance:YO,extend:k0,...Kc};var qO={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},ZO={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7},b0={FieldDataTypes:qO,FieldAssociations:ZO};var Aa=["pointData","cellData","fieldData"];function QO(t,e){e.classHierarchy.push("vtkDataSet"),Aa.forEach(a=>{e[a]?e[a]=ft(e[a]):e[a]=$c.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){let a=t.getPoints();a?.getNumberOfPoints()?se.setBounds(e.bounds,a.getBoundsByReference()):e.bounds=Xe.createUninitializedBounds(),e.computeTime=w.getCurrentGlobalMTime()}},t.getLength2=()=>{let a=t.getBoundsByReference();return!a||a.length!==6?0:se.getDiagonalLength2(a)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{let a=t.getBoundsByReference();return!a||a.length!==6?[0,0,0]:se.getCenter(a)},t.getCellBounds=a=>{let i=t.getCell(a);return i?i.getBounds():Xe.createUninitializedBounds()},t.getBounds=w.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=w.chain(()=>t.computeBounds,t.getBoundsByReference);let r=t.shallowCopy;t.shallowCopy=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(a,i),Aa.forEach(s=>{e[s]=$c.newInstance(),e[s].shallowCopy(a.getReferenceByName(s))})};let n=t.getMTime;t.getMTime=()=>Aa.reduce((a,i)=>Math.max(a,e[i]?.getMTime()??a),n()),t.initialize=()=>(Aa.forEach(a=>e[a]?.initialize()),t)}var JO={};function U0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JO,r),w.obj(t,e),w.setGet(t,e,Aa),w.getArray(t,e,["bounds"],6),QO(t,e)}var eE=w.newInstance(U0,"vtkDataSet"),yt={newInstance:eE,extend:U0,...b0};function tE(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=ft(e.points):e.points=Sr.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};let r=t.shallowCopy;t.shallowCopy=function(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,s),e.points=Sr.newInstance(),e.points.shallowCopy(i.getPoints())};let n=t.getMTime;t.getMTime=()=>{let i=n();return Math.max(i,e.points?.getMTime()??i)};let a=t.initialize;t.initialize=()=>(e.points?.initialize(),a())}var rE={};function N0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rE,r),yt.extend(t,e,r),w.setGet(t,e,["points"]),tE(t,e)}var nE=w.newInstance(N0,"vtkPointSet"),B0={newInstance:nE,extend:N0};function aE(t,e){e.classHierarchy.push("vtkPolyLine");let r=Ie.newInstance();r.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(n,a,i,s,o,c,f)=>{let l={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},u=t.getNumberOfPoints()-1,g=Number.MAX_VALUE;for(let p=0;p<u;p++){let d=[0,0,0];r.getPoints().getData().set(e.points.getData().subarray(3*p,3*(p+2)));let h=r.intersectWithLine(i,s,o,c,f);if(h.intersect===1&&h.t<=l.t+o&&h.t>=n&&h.t<=a){l.intersect=1;let v=r.getParametricDistance(d);if(v<g||v===g&&h.t<l.t){l.subId=p,l.t=h.t,g=v;for(let x=0;x<3;x++)c[x],d[x]}}}return l},t.evaluateLocation=(n,a,i,s)=>(r.getPoints().getData().set(e.points.getData().subarray(3*n,3*(n+2))),r.evaluateLocation(a,i,s)),t.evaluateOrientation=(n,a,i,s)=>(e.orientations?r.setOrientations([e.orientations[n],e.orientations[n+1]]):r.setOrientations(null),r.evaluateOrientation(a,i,s)),t.getDistancesToFirstPoint=()=>{let n=e.distancesTime.getMTime();if(n<e.points.getMTime()||n<t.getMTime()){let a=t.getNumberOfPoints();if(e.distances?e.distances.length=a:e.distances=new Array(a),a>0){let i=new Array(3),s=new Array(3),o=0;e.distances[0]=o,e.points.getPoint(0,i);for(let c=1;c<a;++c)e.points.getPoint(c,s),o+=e.distanceFunction(i,s),e.distances[c]=o,P.copy(i,s)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=n=>{let a=t.getDistancesToFirstPoint();if(a.length<2)return-1;let i=0,s=a.length-1;if(n<a[i]||n>a[s]||a[s]===0)return-1;for(;s-i>1;){let o=Math.floor((i+s)/2);a[o]<=n?i=o:s=o}return i}}var iE={orientations:null,distanceFunction:P.dist};function G0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iE,r),Rt.extend(t,e,r),w.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},w.obj(e.distancesTime,{mtime:0}),aE(t,e)}var sE=w.newInstance(G0,"vtkPolyLine"),_0={newInstance:sE,extend:G0};function oE(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(r,n)=>{let a=e.elements.findIndex(i=>i.priority>r);e.elements.splice(a,0,{priority:r,element:n})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=r=>{e.elements=e.elements.filter(n=>{let{element:a}=n;return a.id!==r})},t.length=()=>e.elements.length}var cE={elements:[]};function W0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cE,r),w.obj(t,e),oE(t,e)}var fE=w.newInstance(W0,"vtkPriorityQueue"),z0={newInstance:fE,extend:W0};var Xc=11920929e-14,A0=1e-8,Gr={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function P0(t,e,r,n,a){return(n[t]-r[t])*(a[e]-r[e])-(a[t]-r[t])*(n[e]-r[e])}function uE(t,e,r,n){if(t[0]<r[0]||t[0]>r[1]||t[1]<r[2]||t[1]>r[3]||t[2]<r[4]||t[2]>r[5])return Gr.OUTSIDE;if(tt(n)<=Xc)return Gr.FAILURE;let a=A0*((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])+(r[5]-r[4])*(r[5]-r[4]));a*=a,a=a===0?Xc:a;let i=[],s=[];for(let l=0;l<e.length;){if(i[0]=e[l++],i[1]=e[l++],i[2]=e[l++],Ze(t,i)<=a)return Gr.INSIDE;let{distance:u,t:g}=Ie.distanceToLine(t,i,s);if(u<=a&&g>0&&g<1)return Gr.INSIDE}let o,c;Math.abs(n[0])>Math.abs(n[1])?Math.abs(n[0])>Math.abs(n[2])?(o=1,c=2):(o=0,c=1):Math.abs(n[1])>Math.abs(n[2])?(o=0,c=2):(o=0,c=1);let f=0;for(let l=0;l<e.length;)i[0]=e[l++],i[1]=e[l++],i[2]=e[l++],l<e.length?(s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2]):(s[0]=e[0],s[1]=e[1],s[2]=e[2]),i[c]<=t[c]?s[c]>t[c]&&P0(o,c,i,s,t)>0&&++f:s[c]<=t[c]&&P0(o,c,i,s,t)<0&&--f;return f===0?Gr.OUTSIDE:Gr.INSIDE}function lE(t,e,r){let n=t.length,a=[];e.getPoint(t[0],a),r[0]=a[0],r[1]=a[0],r[2]=a[1],r[3]=a[1],r[4]=a[2],r[5]=a[2];for(let s=1;s<n;s++)e.getPoint(t[s],a),se.addPoint(r,...a);let i=se.getLengths(r);return te(i,i)}function gE(t,e,r){r.length=3,r[0]=0,r[1]=0,r[2]=0;let n=[],a=[],i=[],s=[],o=[];e.getPoint(t[0],n),e.getPoint(t[1],a);for(let c=2;c<t.length;c++){e.getPoint(t[c],i),Be(i,a,s),Be(n,a,o);let f=[0,0,0];$e(s,o,f),xr(r,f,r),[a,i]=[i,a]}return tt(r)}function pE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];r[0]=0,r[1]=0,r[2]=0;let n=t.length,a=[];for(let i=0;i<n;i++)e.getPoint(t[i],a),r[0]+=a[0],r[1]+=a[1],r[2]+=a[2];return r[0]/=n,r[1]/=n,r[2]/=n,r}var hE={PolygonWithPointIntersectionState:Gr,pointInPolygon:uE,getBounds:lE,getNormal:gE,computeCentroid:pE};function dE(t,e){e.classHierarchy.push("vtkPolygon");function r(){let o=[0,0,0],c=[0,0,0];e.normal=[0,0,0];let f=[...e.firstPoint.point],l=e.firstPoint;for(let u=0;u<e.pointCount;u++){Be(l.point,f,o),Be(l.next.point,f,c);let g=[0,0,0];$e(o,c,g),xr(e.normal,g,e.normal),l=l.next}return tt(e.normal)}function n(o){let c=[0,0,0],f=[0,0,0],l=[0,0,0],u=[0,0,0];Be(o.point,o.previous.point,c),Be(o.next.point,o.point,f),Be(o.previous.point,o.next.point,l),$e(c,f,u);let g=te(u,e.normal);if(g<=0)return-1;let p=gt(c)+gt(f)+gt(l);return p*p/g}function a(o){if(e.pointCount<=3)return!0;let c=o.previous,f=o.next,l=[0,0,0];Be(f.point,c.point,l);let u=[0,0,0];if($e(l,e.normal,u),tt(u),gt(u)===0)return!1;let g=Mt.evaluate(u,c.point,f.next.point),p=g>1e-6?1:g<-1e-6?-1:0,d=p<0?1:0;for(let h=f.next.next;h.id!==c.id;h=h.next){let v=h.previous;g=Mt.evaluate(u,c.point,h.point);let x=g>1e-6?1:g<-1e-6?-1:0;if(x!==p){if(d||(d=x<=0?1:0),Ie.intersection(c.point,f.point,h.point,v.point,[0],[0])===Ic.YES_INTERSECTION)return!1;p=x}}return d===1}function i(o,c){e.pointCount-=1;let f=o.previous,l=o.next;e.tris=e.tris.concat(o.point),e.tris=e.tris.concat(l.point),e.tris=e.tris.concat(f.point),f.next=l,l.previous=f,c.deleteById(f.id),c.deleteById(l.id);let u=n(f);u>0&&c.push(u,f);let g=n(l);g>0&&c.push(g,l),o.id===e.firstPoint.id&&(e.firstPoint=l)}function s(){r();let o=z0.newInstance(),c=e.firstPoint;for(let f=0;f<e.pointCount;f++){let l=n(c);l>0&&o.push(l,c),c=c.next}for(;e.pointCount>2&&o.length()>0;)if(e.pointCount===o.length()){let f=o.pop();i(f,o)}else{let f=o.pop();a(f)&&i(f,o)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?s():null,t.setPoints=o=>{e.pointCount=o.length,e.firstPoint={id:0,point:o[0],next:null,previous:null};let c=e.firstPoint;for(let f=1;f<e.pointCount;f++)c.next={id:f,point:o[f],next:null,previous:c},c=c.next;e.firstPoint.previous=c,c.next=e.firstPoint},t.getPointArray=()=>e.tris}var vE={firstPoint:null,pointCount:0,tris:[]};function H0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vE,r),w.obj(t,e),dE(t,e)}var mE=w.newInstance(H0,"vtkPolygon"),I0={newInstance:mE,extend:H0,...hE};function Yc(t,e,r,n){let a=r[0]-e[0],i=r[1]-e[1],s=r[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],f=t[2]-e[2];n[0]=i*f-s*c,n[1]=s*o-a*f,n[2]=a*c-i*o}function Pa(t,e,r,n){Yc(t,e,r,n);let a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);a!==0&&(n[0]/=a,n[1]/=a,n[2]/=a)}function j0(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function xE(t,e,r,n,a,i){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1,c=[],f=[],l=[],u=[],g=[];Pa(t,e,r,u),Pa(n,a,i,g);let p=-te(u,t),d=-te(g,n),h=[te(g,t)+d,te(g,e)+d,te(g,r)+d];if(h[0]*h[1]>s&&h[0]*h[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l};let v=[te(u,n)+p,te(u,a)+p,te(u,i)+p];if(v[0]*v[1]>s&&v[0]*v[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l};if(Math.abs(u[0]-g[0])<1e-9&&Math.abs(u[1]-g[1])<1e-9&&Math.abs(u[2]-g[2])<1e-9&&Math.abs(p-d)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l};let x=[t,e,r],T=[n,a,i],m=te(u,g),y=(p-d*m)/(m*m-1),S=(d-p*m)/(m*m-1),C=[y*u[0]+S*g[0],y*u[1]+S*g[1],y*u[2]+S*g[2]],E=$e(u,g,[]);tt(E);let O=0,U=0,k=[],V=[],b=50,R=50;for(let L=0;L<3;L++){let B=L,G=(L+1)%3,F=Mt.intersectWithLine(x[B],x[G],n,g);F.intersection&&F.t>0-s&&F.t<1+s&&(F.t<1+s&&F.t>1-s&&(b=O),k[O++]=te(F.x,E)-te(C,E));let _=Mt.intersectWithLine(T[B],T[G],t,u);_.intersection&&_.t>0-s&&_.t<1+s&&(_.t<1+s&&_.t>1-s&&(R=U),V[U++]=te(_.x,E)-te(C,E))}if(O>2){O--;let L=k[2];k[2]=k[b],k[b]=L}if(U>2){U--;let L=V[2];V[2]=V[R],V[R]=L}if(O!==2||U!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l};if(Number.isNaN(k[0])||Number.isNaN(k[1])||Number.isNaN(V[0])||Number.isNaN(V[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l};if(k[0]>k[1]){let L=k[1];k[1]=k[0],k[0]=L}if(V[0]>V[1]){let L=V[1];V[1]=V[0],V[0]=L}let M,N;return k[1]<V[0]||V[1]<k[0]?{intersect:!1,coplanar:o,pt1:c,pt2:f,surfaceId:l}:(k[0]<V[0]?k[1]<V[1]?(l[0]=2,l[1]=1,M=V[0],N=k[1]):(l[0]=2,l[1]=2,M=V[0],N=V[1]):k[1]<V[1]?(l[0]=1,l[1]=1,M=k[0],N=k[1]):(l[0]=1,l[1]=2,M=k[0],N=V[1]),Zi(C,E,M,c),Zi(C,E,N,f),{intersect:!0,coplanar:o,pt1:c,pt2:f,surfaceId:l})}var yE={computeNormalDirection:Yc,computeNormal:Pa,interpolationDerivs:j0,intersectWithTriangle:xE};function TE(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,a,i,s)=>{let o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};s[2]=0;let c=[],f=a*a,l=[],u=[],g=[];e.points.getPoint(0,l),e.points.getPoint(1,u),e.points.getPoint(2,g);let p=[],d=[];if(Pa(l,u,g,p),p[0]!==0||p[1]!==0||p[2]!==0){let m=Mt.intersectWithLine(r,n,l,p);if(o.betweenPoints=m.betweenPoints,o.t=m.t,i[0]=m.x[0],i[1]=m.x[1],i[2]=m.x[2],!m.intersection)return s[0]=0,s[1]=0,o.intersect=0,o;let y=t.evaluatePosition(i,c,s,d);if(y.evaluation>=0)return y.dist2<=f?(o.intersect=1,o):(o.intersect=y.evaluation,o)}let h=Ze(l,u),v=Ze(u,g),x=Ze(g,l);e.line||(e.line=Ie.newInstance()),h>v&&h>x?(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,u)):v>x&&v>h?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,l));let T=e.line.intersectWithLine(r,n,a,i,s);if(o.betweenPoints=T.betweenPoints,o.t=T.t,T.intersect){let m=[],y=[],S=[];for(let C=0;C<3;C++)m[C]=l[C]-g[C],y[C]=u[C]-g[C],S[C]=i[C]-g[C];return s[0]=te(S,m)/x,s[1]=te(S,y)/v,o.intersect=1,o}return s[0]=0,s[1]=0,o.intersect=0,o},t.evaluatePosition=(r,n,a,i)=>{let s={subId:0,dist2:0,evaluation:-1},o,c,f=[],l=[],u=[],g=[],p,d=[],h=[],v=[],x=0,T=0,m=[],y,S,C,E=[],O=[],U=[],k=[];s.subId=0,a[2]=0,e.points.getPoint(1,f),e.points.getPoint(2,l),e.points.getPoint(0,u),Yc(f,l,u,g),Mt.generalizedProjectPoint(r,f,g,k);let V=0;for(o=0;o<3;o++)g[o]<0?p=-g[o]:p=g[o],p>V&&(V=p,T=o);for(c=0,o=0;o<3;o++)o!==T&&(m[c++]=o);for(o=0;o<2;o++)d[o]=k[m[o]]-u[m[o]],h[o]=f[m[o]]-u[m[o]],v[o]=l[m[o]]-u[m[o]];if(x=Ge(h,v),x===0)return a[0]=0,a[1]=0,s.evaluation=-1,s;if(a[0]=Ge(d,v)/x,a[1]=Ge(h,d)/x,i[0]=1-(a[0]+a[1]),i[1]=a[0],i[2]=a[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)n&&(s.dist2=Ze(k,r),n[0]=k[0],n[1]=k[1],n[2]=k[2]),s.evaluation=1;else{let b;if(n){if(i[1]<0&&i[2]<0)for(y=Ze(r,u),S=Ie.distanceToLine(r,f,u,b,O),C=Ie.distanceToLine(r,u,l,b,U),y<S?(s.dist2=y,E=u):(s.dist2=S,E=O),C<s.dist2&&(s.dist2=C,E=U),o=0;o<3;o++)n[o]=E[o];else if(i[2]<0&&i[0]<0)for(y=Ze(r,f),S=Ie.distanceToLine(r,f,u,b,O),C=Ie.distanceToLine(r,f,l,b,U),y<S?(s.dist2=y,E=f):(s.dist2=S,E=O),C<s.dist2&&(s.dist2=C,E=U),o=0;o<3;o++)n[o]=E[o];else if(i[1]<0&&i[0]<0)for(y=Ze(r,l),S=Ie.distanceToLine(r,l,u,b,O),C=Ie.distanceToLine(r,f,l,b,U),y<S?(s.dist2=y,E=l):(s.dist2=S,E=O),C<s.dist2&&(s.dist2=C,E=U),o=0;o<3;o++)n[o]=E[o];else if(i[0]<0){let R=Ie.distanceToLine(r,f,l,n);s.dist2=R.distance}else if(i[1]<0){let R=Ie.distanceToLine(r,l,u,n);s.dist2=R.distance}else if(i[2]<0){let R=Ie.distanceToLine(r,f,u,n);s.dist2=R.distance}}s.evaluation=0}return s},t.evaluateLocation=(r,n,a)=>{let i=[],s=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,s),e.points.getPoint(2,o);let c=1-r[0]-r[1];for(let f=0;f<3;f++)n[f]=i[f]*c+s[f]*r[0]+o[f]*r[1];a[0]=c,a[1]=r[0],a[2]=r[1]},t.getParametricDistance=r=>{let n,a=0,i=[];i[0]=r[0],i[1]=r[1],i[2]=1-r[0]-r[1];for(let s=0;s<3;s++)i[s]<0?n=-i[s]:i[s]>1?n=i[s]-1:n=0,n>a&&(a=n);return a},t.derivatives=(r,n,a,i,s)=>{let o=e.points.getPoint(0),c=e.points.getPoint(1),f=e.points.getPoint(2),l=[],u=[],g=[],p=[];Pa(o,c,f,l),Be(c,o,u),Be(f,o,p),$e(l,u,g);let d=tt(u);if(d<=0||tt(g)<=0){for(let S=0;S<i;S++)for(let C=0;C<3;C++)s[S*i+C]=0;return}let h=[0,0],v=[d,0],x=[te(p,u),te(p,g)],T=new Array(6);j0(T);let m=[v[0]-h[0],v[1]-h[1],x[0]-h[0],x[1]-h[1]],y=w.newTypedArray(et.Float64Array,4);es(m,y,2);for(let S=0;S<i;S++){let C=0,E=0;for(let k=0;k<3;k++)C+=T[k]*a[i*k+S],E+=T[3+k]*a[i*k+S];let O=C*y[0]+E*y[1],U=C*y[2]+E*y[3];s[3*S]=O*u[0]+U*g[0],s[3*S+1]=O*u[1]+U*g[1],s[3*S+2]=O*u[2]+U*g[2]}},t.cellBoundary=(r,n,a)=>{let i=n[0]-n[1],s=.5*(1-n[0])-n[1],o=2*n[0]+n[1]-1;return i>=0&&s>=0?(a[0]=e.pointsIds[0],a[1]=e.pointsIds[1]):s<0&&o>=0?(a[0]=e.pointsIds[1],a[1]=e.pointsIds[2]):(a[0]=e.pointsIds[2],a[1]=e.pointsIds[0]),!(n[0]<0||n[1]<0||n[0]>1||n[1]>1||1-n[0]-n[1]<0)}}var SE={};function K0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SE,r),Rt.extend(t,e,r),TE(t,e)}var CE=w.newInstance(K0,"vtkTriangle"),_r={newInstance:CE,extend:K0,...yE};function $0(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function wE(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>Se.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(r,n,a,i,s)=>{let o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},c,f=e.points.getPoint(0,[]),l=e.points.getPoint(1,[]),u=e.points.getPoint(2,[]),g=e.points.getPoint(3,[]),p=Ze(f,u),d=Ze(l,g);if(p===d){let C,E=0,O=0;for(let U=0;U<4;U++)C=e.pointsIds[U],C>E&&(E=C,O=U);O===0||O===2?c=0:c=1}else p<d?c=0:c=1;let h=null;e.triangle?h=e.triangle.getPoints():(e.triangle=_r.newInstance(),h=Sr.newInstance(),h.setNumberOfPoints(3),e.triangle.initialize(h));let v,x=$0(),T,m=$0(),y,S;switch(c){case 0:h.setPoint(0,...f),h.setPoint(1,...l),h.setPoint(2,...u),v=e.triangle.intersectWithLine(r,n,a,x.x,x.pCoords),h.setPoint(0,...u),h.setPoint(1,...g),h.setPoint(2,...f),T=e.triangle.intersectWithLine(r,n,a,m.x,m.pCoords),y=v.intersect&&T.intersect?v.t<=T.t:v.intersect,S=v.intersect&&T.intersect?T.t<v.t:T.intersect,y?(o=v,i[0]=x.x[0],i[1]=x.x[1],i[2]=x.x[2],s[0]=x.pCoords[0]+x.pCoords[1],s[1]=x.pCoords[1],s[2]=x.pCoords[2]):S&&(o=T,i[0]=m.x[0],i[1]=m.x[1],i[2]=m.x[2],s[0]=1-(m.pCoords[0]+m.pCoords[1]),s[1]=1-m.pCoords[1],s[2]=m.pCoords[2]);break;case 1:h.setPoint(0,...f),h.setPoint(1,...l),h.setPoint(2,...g),v=e.triangle.intersectWithLine(r,n,a,x.x,x.pCoords),h.setPoint(0,...u),h.setPoint(1,...g),h.setPoint(2,...l),T=e.triangle.intersectWithLine(r,n,a,m.x,m.pCoords),y=v.intersect&&T.intersect?v.t<=T.t:v.intersect,S=v.intersect&&T.intersect?T.t<v.t:T.intersect,y?(o=v,i[0]=x.x[0],i[1]=x.x[1],i[2]=x.x[2],s[0]=x.pCoords[0],s[1]=x.pCoords[1],s[2]=x.pCoords[2]):S&&(o=T,i[0]=m.x[0],i[1]=m.x[1],i[2]=m.x[2],s[0]=1-m.pCoords[0],s[1]=1-m.pCoords[1],s[2]=m.pCoords[2]);break}return o},t.interpolationFunctions=(r,n)=>{let a=1-r[0],i=1-r[1];n[0]=a*i,n[1]=r[0]*i,n[2]=r[0]*r[1],n[3]=a*r[1]},t.evaluateLocation=(r,n,a)=>{let i=[];t.interpolationFunctions(r,a),n[0]=0,n[1]=0,n[2]=0;for(let s=0;s<4;s++){e.points.getPoint(s,i);for(let o=0;o<3;o++)n[o]+=i[o]*a[s]}}}var OE={};function X0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OE,r),Rt.extend(t,e,r),wE(t,e)}var EE=w.newInstance(X0,"vtkQuad"),Y0={newInstance:EE,extend:X0};var{vtkErrorMacro:Z0}=w;function q0(t){return()=>Z0(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function ME(t,e){if(!Array.isArray(t)||t.length<3){Z0("decomposeStrip - Invalid points array");return}let r=t[0],n=t[1];for(let a=0;a<t.length-2;a++){let i=t[a+2];a%2?e.insertNextCell([n,r,i]):e.insertNextCell([r,n,i]),r=n,n=i}}var RE={decomposeStrip:ME};function DE(t,e){e.classHierarchy.push("vtkTriangleStrip");let r=t.initialize;t.initialize=(n,a)=>{e.triangle.initialize(n,a),r(n,a)},t.getCellType=()=>Se.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(n,a,i,s,o)=>{let c=[0,0,0],f=Number.MAX_VALUE,l=0,u=[],g=[],p=[];i[2]=0,g[0]=0,g[1]=0,g[2]=0;let d=e.triangle.getPoints();d.setNumberOfPoints(3);let v=e.triangle.getPointsIds().length;for(let x=0;x<v;x++)o[x]=0;for(let x=0;x<v-2;x++){let T=[];d.getPoint(x,T);let m=[];d.getPoint(x+1,m);let y=[];d.getPoint(x+2,y),d.setData(Float32Array.from([...T,...m,...y]),3);let S=e.triangle.evaluatePosition(n,p,c,u),C=S.dist2;S.evaluation>=0&&(C<f||C===f&&l===0)&&(l=S,a&&(a[0]=p[0],a[1]=p[1],a[2]=p[2]),i[0]=c[0],i[1]=c[1],f=C,g[0]=u[0],g[1]=u[1],g[2]=u[2])}return s[0]=f,o[0]=g[0],o[1]=g[1],o[2]=g[2],l},t.evaluateLocation=(n,a,i,s)=>{let o=[[0,1,2],[1,0,2]],c=n%2,f=e.pointsIds.length;for(let d=0;d<f;d++)s[d]=0;let l=1-a[0]-a[1];s[n]=l,s[n+1]=a[0],s[n+2]=a[1];let u=[];e.points.getPoint(n+o[c][0],u);let g=[];e.points.getPoint(n+o[c][1],g);let p=[];e.points.getPoint(n+o[c][2],p);for(let d=0;d<3;d++)i[d]=u[d]*s[n]+g[d]*s[n+1]+p[d]*s[n+2]},t.cellBoundary=(n,a,i)=>{let s=[[0,1,2],[1,0,2]],o=n%2,c=e.triangle.getPointsIds();return c[0]=e.pointsIds[s[o][0]],c[1]=e.pointsIds[s[o][1]],c[2]=e.pointsIds[s[o][2]],e.triangle.cellBoundary(0,a,i)},t.getEdge=n=>{let a,i,s=e.pointsIds.length;return n===0?(a=0,i=1):n===s-1?(a=n-1,i=n):(a=n-1,i=n+1),e.line.getPointsIds()[0]=e.pointsIds[a],e.line.getPointsIds()[1]=e.pointsIds[i],e.line.getPoints().setPoint(0,e.points.getPoint(a)),e.line.getPoints().setPoint(1,e.points.getPoint(i)),e.line},t.intersectWithLine=(n,a,i,s,o)=>{let c=e.pointsIds.length-2,f=e.triangle.getPoints();f.setNumberOfPoints(3);for(let l=0;l<c;l++){let u=[];e.points.getPoint(e.pointsIds[l],u);let g=[];e.points.getPoint(e.pointsIds[l+1],g);let p=[];e.points.getPoint(e.pointsIds[l+2],p),f.setData(Float32Array.from([...u,...g,...p]),3);let d=e.triangle.intersectWithLine(n,a,i,s,o);if(d.intersect)return d}return!1},t.triangulate=()=>{let n=e.points.getNumberOfPoints()-2;e.tris=new Array(3*n);let a=[[0,1,2],[1,0,2]];for(let i=0;i<n;i++){let s=i%2;for(let o=0;o<3;o++)e.tris[i*3+o]=i+a[s][o]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(n,a,i,s,o)=>{let c=[];e.points.getPoint(n,c);let f=[];e.points.getPoint(n+1,f);let l=[];e.points.getPoint(n+2,l);let u=e.triangle.getPoints();u.setPoint(0,...c),u.setPoint(1,...f),u.setPoint(2,...l),e.triangle.derivatives(0,a,i,s,o)},t.getParametricCenter=n=>(n[0]=.333333,n[1]=.333333,n[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(n,a,i,s,o,c,f,l,u,g,p)=>q0("contour")(),t.clip=(n,a,i,s,o,c,f,l,u,g)=>q0("clip")()}var LE={line:null,triangle:null,tris:null};function Q0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LE,r),Rt.extend(t,e,r),e.line||(e.line=Ie.newInstance()),e.triangle||(e.triangle=_r.newInstance()),DE(t,e)}var VE=w.newInstance(Q0,"vtkTriangleStrip"),J0={newInstance:VE,extend:Q0,...RE};var vn=["verts","lines","polys","strips"];var{vtkWarningMacro:eh}=w,FE={[Se.VTK_LINE]:Ie,[Se.VTK_QUAD]:Y0,[Se.VTK_POLY_LINE]:Ie,[Se.VTK_TRIANGLE]:_r,[Se.VTK_TRIANGLE_STRIP]:J0,[Se.VTK_POLY_LINE]:_0,[Se.VTK_POLYGON]:I0};function kE(t,e){e.classHierarchy.push("vtkPolyData");function r(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,o=>o.toUpperCase()).replace(/\s+/g,"")}vn.forEach(s=>{t[`getNumberOf${r(s)}`]=()=>e[s].getNumberOfCells(),e[s]?e[s]=ft(e[s]):e[s]=Qt.newInstance()}),t.getNumberOfCells=()=>vn.reduce((s,o)=>s+e[o].getNumberOfCells(),0);let n=t.shallowCopy;t.shallowCopy=function(s){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(s,o),vn.forEach(c=>{e[c]=Qt.newInstance(),e[c].shallowCopy(s.getReferenceByName(c))})};let a=t.getMTime;t.getMTime=()=>vn.reduce((s,o)=>Math.max(s,e[o]?.getMTime()??s),a());let i=t.initialize;t.initialize=()=>(vn.forEach(s=>e[s]?.initialize()),i()),t.buildCells=()=>{let s=t.getNumberOfVerts(),o=t.getNumberOfLines(),c=t.getNumberOfPolys(),f=t.getNumberOfStrips(),l=s+o+c+f,u=new Uint8Array(l),g=u,p=new Uint32Array(l),d=p;if(s){let h=0;e.verts.getCellSizes().forEach((v,x)=>{d[x]=h,g[x]=v>1?Se.VTK_POLY_VERTEX:Se.VTK_VERTEX,h+=v+1}),d=d.subarray(s),g=g.subarray(s)}if(o){let h=0;e.lines.getCellSizes().forEach((v,x)=>{d[x]=h,g[x]=v>2?Se.VTK_POLY_LINE:Se.VTK_LINE,v===1&&eh("Building VTK_LINE ",x," with only one point, but VTK_LINE needs at least two points. Check the input."),h+=v+1}),d=d.subarray(o),g=g.subarray(o)}if(c){let h=0;e.polys.getCellSizes().forEach((v,x)=>{switch(d[x]=h,v){case 3:g[x]=Se.VTK_TRIANGLE;break;case 4:g[x]=Se.VTK_QUAD;break;default:g[x]=Se.VTK_POLYGON;break}v<3&&eh("Building VTK_TRIANGLE ",x," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=v+1}),d+=d.subarray(c),g+=g.subarray(c)}if(f){let h=0;g.fill(Se.VTK_TRIANGLE_STRIP,0,f),e.strips.getCellSizes().forEach((v,x)=>{d[x]=h,h+=v+1})}e.cells=M0.newInstance(),e.cells.setCellTypes(l,u,p)},t.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=O0.newInstance(),s>0?e.links.allocate(s):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=s=>e.cells.getCellType(s),t.getCellPoints=s=>{let o=t.getCellType(s),c=null;switch(o){case Se.VTK_VERTEX:case Se.VTK_POLY_VERTEX:c=e.verts;break;case Se.VTK_LINE:case Se.VTK_POLY_LINE:c=e.lines;break;case Se.VTK_TRIANGLE:case Se.VTK_QUAD:case Se.VTK_POLYGON:c=e.polys;break;case Se.VTK_TRIANGLE_STRIP:c=e.strips;break;default:return c=null,{type:0,cellPointIds:null}}let f=e.cells.getCellLocation(s),l=c.getCell(f);return{cellType:o,cellPointIds:l}},t.getPointCells=s=>e.links.getCells(s),t.getCellEdgeNeighbors=(s,o,c)=>{let f=e.links.getLink(o),l=e.links.getLink(c);return f.cells.filter(u=>u!==s&&l.cells.indexOf(u)!==-1)},t.getCell=function(s){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,c=t.getCellPoints(s),f=o||FE[c.cellType].newInstance();return f.initialize(t.getPoints(),c.cellPointIds),f},t.getMaxCellSize=()=>vn.reduce((s,o)=>Math.max(s,e[o]?.getMaxCellSize?.()??0),0)}var bE={};function th(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bE,r),B0.extend(t,e,r),w.get(t,e,["cells","links"]),w.setGet(t,e,["verts","lines","polys","strips"]),kE(t,e)}var UE=w.newInstance(th,"vtkPolyData"),Re={newInstance:UE,extend:th};var{vtkErrorMacro:NE}=w,qc=class{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){let r=e[0],n=e[e.length-1];if(r===n||e.length<2)return;let a=this.segmentMapping[r],i=this.segmentMapping[n];if(a!==void 0&&i!==void 0)if(Math.abs(a)===Math.abs(i)){let s=a<i?i:a,o=this.segments[s];if(a>0)for(let c=1;c<e.length-1;c++)o.push(e[c]);else for(let c=1;c<e.length-1;c++)o.unshift(e[e.length-1-c]);this.faces.push(o),this.segments[s]=null,this.segmentMapping[r]=void 0,this.segmentMapping[n]=void 0}else{let s=Math.abs(a),o=Math.abs(i),c=this.segments[s],f=this.segments[o];this.segments[s]=null,this.segments[o]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[f[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[f[f.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(f)}else if(a!==void 0){if(a>0){let s=this.segments[a];for(let o=1;o<e.length;o++)s.push(e[o]);this.segmentMapping[n]=a}else{let s=this.segments[-a];this.segmentMapping[n]=a;for(let o=1;o<e.length;o++)s.unshift(e[o])}this.segmentMapping[r]=void 0}else if(i!==void 0){if(i>0){let s=this.segments[i];for(let o=1;o<e.length;o++)s.push(e[e.length-1-o]);this.segmentMapping[r]=i}else{let s=this.segments[-i];this.segmentMapping[r]=i;for(let o=1;o<e.length;o++)s.unshift(e[e.length-o-1])}this.segmentMapping[n]=void 0}else{let s=this.segments.length;this.segments.push(e),this.segmentMapping[r]=-s,this.segmentMapping[n]=s}}};function BE(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(r,n)=>{let a=r[0];if(!a){NE("Invalid or missing input");return}let i=n[0]?.initialize()||Re.newInstance();i.shallowCopy(a);let s=new qc,o=a.getLines().getData(),c=0;for(;c<o.length;){let g=o[c++],p=[];for(let d=0;d<g;d++)p.push(o[c+d]);s.addSegment(p),c+=g}let{faces:f}=s,l=f.length;for(let g=0;g<f.length;g++)l+=f[g].length;let u=new Uint16Array(l);c=0;for(let g=0;g<f.length;g++){let p=f[g];u[c++]=p.length;for(let d=0;d<p.length;d++)u[c++]=p[d]}i.setPolys(Qt.newInstance({values:u,name:"faces"})),n[0]=i}}var GE={};function rh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GE,r),w.obj(t,e),w.algo(t,e,1,1),BE(t,e)}var _E=w.newInstance(rh,"vtkClosedPolyLineToSurfaceFilter"),nh={newInstance:_E,extend:rh};var{vtkErrorMacro:ah}=De;function WE(t){let e=t.getPolys().getData(),r=t.getStrips().getData(),n={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(n.polyIdx<e.length){n.cellSize=e[n.polyIdx];let a=n.polyIdx+1,i=a+n.cellSize;n.polyIdx=i;let s=0;for(let o=a;o<i;++o)n.cell[s++]=e[o]}else if(n.stripIdx<r.length){n.cellSize=3,n.remainingStripLength===0&&(n.remainingStripLength=r[n.stripIdx]-2,n.stripIdx+=3);let a=n.stripIdx-2,i=n.stripIdx+1;n.stripIdx++,n.remainingStripLength--;let s=0;for(let o=a;o<i;++o)n.cell[s++]=r[o]}else if(!n.done)n.done=!0;else throw new Error("Iterator is done")}};return n.next(),n}function zE(t,e){e.classHierarchy.push("vtkCutter");let r={...t};t.getMTime=()=>{let a=r.getMTime();return e.cutFunction&&(a=Math.max(a,e.cutFunction.getMTime())),a};function n(a,i){let s=a.getPoints(),o=s.getData(),c=a.getPointData(),f=s.getNumberOfPoints(),l=[],u=[],g=[],p={},d=c.getNumberOfArrays();for(let E=0;E<d;E++)p[c.getArrayName(E)]=[];(!e.cutScalars||e.cutScalars.length<f)&&(e.cutScalars=new Float32Array(f));let h=0,v=0;for(;h<o.length;)e.cutScalars[v++]=e.cutFunction.evaluateFunction(o[h++],o[h++],o[h++]);let x=[],T=new Array(3),m=new Array(3),y=[];for(let E=WE(a);!E.done;E.next()){if(E.cellSize<=2)continue;for(let b=0;b<E.cellSize;)y[b]=e.cutScalars[E.cell[b++]];let O=y[0]>0,U=!0;for(let b=1;b<E.cell.length;b++)if(y[b]>0!==O){U=!1;break}if(U)continue;let k=[];for(let b=0;b<E.cellSize;b++){let R=b+1===E.cellSize?0:b+1,M=y[b]>0;if(y[R]>0===M)continue;let L=b,B=R,G=y[B]-y[L];G<=0&&(L=R,B=b,G*=-1);let F=0;G!==0&&(F=(e.cutValue-y[L])/G);let _=E.cell[L],W=E.cell[B];T[0]=o[_*3],T[1]=o[_*3+1],T[2]=o[_*3+2],m[0]=o[W*3],m[1]=o[W*3+1],m[2]=o[W*3+2];let H=[T[0]+F*(m[0]-T[0]),T[1]+F*(m[1]-T[1]),T[2]+F*(m[2]-T[2])],I={};for(let ve=0;ve<d;ve++){let me=c.getArrayByIndex(ve),ie=c.getArrayName(ve),he=me.getData(),we=me.getNumberOfComponents(),Oe=new Array(we);for(let re=0;re<we;re++){let ne=he[we*_+re],de=he[we*W+re];Oe.push(ne+F*(de-ne))}I[ie]=Oe}k.push({pointEdge1:_,pointEdge2:W,intersectedPoint:H,intersectedArrays:I,newPointID:-1})}for(let b=0;b<k.length;b++){let R=k[b],M=!1;for(let N=0;N<x.length;N++){let L=x[N],B=R.pointEdge1===L.pointEdge1&&R.pointEdge2===L.pointEdge2,G=R.intersectedPoint[0]===L.intersectedPoint[0]&&R.intersectedPoint[1]===L.intersectedPoint[1]&&R.intersectedPoint[2]===L.intersectedPoint[2];if(B||G){M=!0,k[b].newPointID=x[N].newPointID;break}}M||(l.push(R.intersectedPoint[0]),l.push(R.intersectedPoint[1]),l.push(R.intersectedPoint[2]),Object.keys(R.intersectedArrays).forEach(N=>{p[N].push(...R.intersectedArrays[N])}),k[b].newPointID=l.length/3-1,x.push(k[b]))}let V=k.length;V===2?u.push(V,k[0].newPointID,k[1].newPointID):V>2&&(g.push(V),k.forEach(b=>{g.push(b.newPointID)}))}i.getPoints().setData(Yn(s.getDataType(),l),3);let C=i.getPointData();for(let E=0;E<d;E++){let O=c.getArrayName(E),U=K.newInstance({name:O,dataType:c.getArrayByIndex(E).getDataType(),values:p[O],numberOfComponents:c.getArrayByIndex(E).getNumberOfComponents()});C.addArray(U)}u.length!==0&&i.getLines().setData(Uint16Array.from(u)),g.length!==0&&i.getPolys().setData(Uint16Array.from(g))}t.requestData=(a,i)=>{let s=a[0];if(!s){ah("Invalid or missing input");return}if(!e.cutFunction){ah("Missing cut function");return}let o=i[0]?.initialize()||Re.newInstance();n(s,o),i[0]=o}}var AE={cutFunction:null,cutScalars:null,cutValue:0};function ih(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AE,r),ae(t,e),Ii(t,e,1,1),ge(t,e,["cutFunction","cutValue"]),zE(t,e)}var PE=$(ih,"vtkCutter"),sh={newInstance:PE,extend:ih};var mn={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2},Zc={ObjectType:mn};var{ObjectType:ps}=Zc,HE={};function IE(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(o){switch(o){case ps.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case ps.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case ps.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,a=null,i=!0,s="";t.getType=()=>n,t.setType=o=>{n=o},t.getHandle=()=>a,t.isReady=()=>i===!1,t.generateBuffer=o=>{let c=r(o);return a===null&&(a=e.context.createBuffer(),n=o),r(n)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(r(n),a),e.context.bufferData(r(n),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,i=!1,!0):(s="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(r(n),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>s}var jE={objectType:ps.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function oh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jE,r),w.obj(t,e),w.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),w.moveToProtected(t,e,["openGLRenderWindow"]),IE(t,e)}var KE=w.newInstance(oh),Qc={newInstance:KE,extend:oh,...HE,...Zc};var ch={FLAT:0,GOURAUD:1,PHONG:2},_e={POINTS:0,WIREFRAME:1,SURFACE:2},$E=ch,Jc={Shading:ch,Representation:_e,Interpolation:$E};function fh(t){let e=0,r=0;for(let a=0;a<3;++a){let i=t.getRange(a),s=i[1]-i[0];e+=s*s;let o=.5*(i[1]+i[0]);r+=o*o}let n=e>0&&(Math.abs(r)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&r>1e6);if(n){let a=new Float64Array(3),i=new Float64Array(3);for(let s=0;s<3;++s){let o=t.getRange(s),c=o[1]-o[0];a[s]=.5*(o[1]+o[0]),i[s]=c>0?1/c:1}return{useShiftAndScale:n,coordShift:a,coordScale:i}}return{useShiftAndScale:n,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}var{vtkErrorMacro:uh}=w;function XE(t,e){let r=new Float64Array(3);P.inverse(r,e);let n=new Float64Array(16);return D.fromRotationTranslationScale(n,ze.create(),t,r),n}function YE(t,e){return t===null||e===null?!1:!(P.exactEquals(t,[0,0,0])&&P.exactEquals(e,[1,1,1]))}function qE(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(mn.ARRAY_BUFFER),t.createVBO=function(r,n,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];let o=i.points.getData(),c=null,f=null,l=null,u=i.colors?i.colors.getNumberOfComponents():0,g=i.tcoords?i.tcoords.getNumberOfComponents():0;i.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=i.normals.getData()),i.customAttributes&&i.customAttributes.forEach(F=>{F&&(e.customData.push({data:F.getData(),offset:4*e.blockSize,components:F.getNumberOfComponents(),name:F.getName()}),e.blockSize+=F.getNumberOfComponents())}),i.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,f=i.tcoords.getData()),i.colors?(e.colorComponents=i.colors.getNumberOfComponents(),e.colorOffset=0,l=i.colors.getData(),e.colorBO||(e.colorBO=Qc.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,d=0,h=0,v=0,x=0,T=0,m,y={anythingToPoints(F,_,W,H){for(let I=0;I<F;++I)m(_[W+I],H)},linesToWireframe(F,_,W,H){for(let I=0;I<F-1;++I)m(_[W+I],H),m(_[W+I+1],H)},polysToWireframe(F,_,W,H){if(F>2)for(let I=0;I<F;++I)m(_[W+I],H),m(_[W+(I+1)%F],H)},stripsToWireframe(F,_,W,H){if(F>2){for(let I=0;I<F-1;++I)m(_[W+I],H),m(_[W+I+1],H);for(let I=0;I<F-2;I++)m(_[W+I],H),m(_[W+I+2],H)}},polysToSurface(F,_,W,H){for(let I=0;I<F-2;I++)m(_[W+0],H),m(_[W+I+1],H),m(_[W+I+2],H)},stripsToSurface(F,_,W,H){for(let I=0;I<F-2;I++)m(_[W+I],H),m(_[W+I+1+I%2],H),m(_[W+I+1+(I+1)%2],H)}},S={anythingToPoints(F,_){return F},linesToWireframe(F,_){return F>1?(F-1)*2:0},polysToWireframe(F,_){return F>2?F*2:0},stripsToWireframe(F,_){return F>2?F*4-6:0},polysToSurface(F,_){return F>2?(F-2)*3:0},stripsToSurface(F,_,W){return F>2?(F-2)*3:0}},C=null,E=null;a===_e.POINTS||n==="verts"?(C=y.anythingToPoints,E=S.anythingToPoints):a===_e.WIREFRAME||n==="lines"?(C=y[`${n}ToWireframe`],E=S[`${n}ToWireframe`]):(C=y[`${n}ToSurface`],E=S[`${n}ToSurface`]);let O=r.getData(),U=O.length,k=0;for(let F=0;F<U;)k+=E(O[F],O),F+=O[F]+1;let V=null,b=new Float32Array(k*e.blockSize);l&&(V=new Uint8Array(k*4));let R=0,M=0,{useShiftAndScale:N,coordShift:L,coordScale:B}=fh(i.points);if(N?t.setCoordShiftAndScale(L,B):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),s)if(!s.points&&!s.cells)s.points=new Int32Array(k),s.cells=new Int32Array(k);else{let F=new Int32Array(k+s.points.length);F.set(s.points),s.points=F;let _=new Int32Array(k+s.cells.length);_.set(s.cells),s.cells=_}let G=i.vertexOffset;m=function(_,W){if(s&&(s.points[G]=_,s.cells[G]=T+i.cellOffset),++G,p=_*3,e.coordShiftAndScaleEnabled?(b[R++]=(o[p++]-e.coordShift[0])*e.coordScale[0],b[R++]=(o[p++]-e.coordShift[1])*e.coordScale[1],b[R++]=(o[p++]-e.coordShift[2])*e.coordScale[2]):(b[R++]=o[p++],b[R++]=o[p++],b[R++]=o[p++]),c!==null&&(i.haveCellNormals?d=(T+i.cellOffset)*3:d=_*3,b[R++]=c[d++],b[R++]=c[d++],b[R++]=c[d++]),e.customData.forEach(H=>{x=_*H.components;for(let I=0;I<H.components;++I)b[R++]=H.data[x++]}),f!==null){i.useTCoordsPerCell?h=W*g:h=_*g;for(let H=0;H<g;++H)b[R++]=f[h++]}l!==null&&(i.haveCellScalars?v=(T+i.cellOffset)*u:v=_*u,V[M++]=l[v++],V[M++]=l[v++],V[M++]=l[v++],V[M++]=u===4?l[v++]:255)};for(let F=0;F<U;F+=O[F]+1,T++)C(O[F],O,F+1,T+i.cellOffset);return e.elementCount=k,t.upload(b,mn.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(V,mn.ARRAY_BUFFER)),T},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){uh("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){uh("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!P.equals(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!P.equals(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=YE(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=XE(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}var ZE={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function lh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZE,r),Qc.extend(t,e,r),w.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),w.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),qE(t,e)}var QE=w.newInstance(lh),gh={newInstance:QE,extend:lh};var{vtkErrorMacro:JE}=w;function eM(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){let a=e.context.getShaderInfoLog(e.handle);return JE(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}var tM={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function ph(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tM,r),w.obj(t,e),w.setGet(t,e,["shaderType","source","error","handle","context"]),eM(t,e)}var rM=w.newInstance(ph,"vtkShader"),hs={newInstance:rM,extend:ph};var{vtkErrorMacro:Jt}=w;function nM(t,e,r,n){let a=typeof r=="string"?r:r.join(`
`),i=n===!1?e:new RegExp(e,"g"),s=t.replace(i,a);return{replace:s!==a,result:s}}function aM(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Jt(e.error),0):t.link()?(t.setCompiled(!0),1):(Jt(`Links failed: ${e.error}`),0):(Jt(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Jt(e.fragmentShader.getError()),0):(Jt(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Jt(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){let n=e.context.getProgramInfoLog(e.handle);return Jt(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;let i=new Float32Array(n);return e.context.uniformMatrix4fv(a,!1,i),!0},t.setUniformMatrix3x3=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;let i=new Float32Array(n);return e.context.uniformMatrix3fv(a,!1,i),!0},t.setUniformf=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(a,n),!0)},t.setUniformfv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(a,n),!0)},t.setUniformi=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(a,n),!0)},t.setUniformiv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(a,n),!0)},t.setUniform2f=(r,n,a)=>{let i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(i,n,a),!0},t.setUniform2fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(a,n),!0)},t.setUniform2i=(r,n,a)=>{let i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(i,n,a),!0},t.setUniform2iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(a,n),!0)},t.setUniform3f=(r,n,a,i)=>{let s=t.findUniform(r);if(s===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(s,n,a,i),!0},t.setUniform3fArray=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(a,n),!0)},t.setUniform3i=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,o[0],o[1],o[2]),!0},t.setUniform3iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(a,n),!0)},t.setUniform4f=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(a,n),!0)},t.setUniform4i=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(a,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(Jt("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return Jt("attempt to find uniform when the shader program is not linked"),!1;let n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){let n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}var iM={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function hh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iM,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=hs.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=hs.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=hs.newInstance(),e.geometryShader.setShaderType("Geometry"),w.obj(t,e),w.get(t,e,["lastCameraMTime"]),w.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),aM(t,e)}var sM=w.newInstance(hh,"vtkShaderProgram"),z={newInstance:sM,extend:hh,substitute:nM};function oM(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){let r=e.context;for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let i=0;i<a.attributes.length;++i){let s=a.attributes[i],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)r.enableVertexAttribArray(s.index+c),r.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,1):r.vertexAttribDivisor(s.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){let r=e.context;for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let i=0;i<a.attributes.length;++i){let s=a.attributes[i],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)r.enableVertexAttribArray(s.index+c),r.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,0):r.vertexAttribDivisor(s.index+c,0)),r.disableVertexAttribArray(s.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,a,i,s,o,c,f)=>t.addAttributeArrayWithDivisor(r,n,a,i,s,o,c,f,0,!1),t.addAttributeArrayWithDivisor=(r,n,a,i,s,o,c,f,l,u)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==mn.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;let g=e.context,p={};if(p.name=a,p.index=g.getAttribLocation(e.handleProgram,a),p.offset=i,p.stride=s,p.type=o,p.size=c,p.normalize=f,p.isMatrix=u,p.divisor=l,p.Index===-1)return!1;if(n.bind(),g.enableVertexAttribArray(p.index),g.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),l>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):g.vertexAttribDivisor(p.index,1)),p.buffer=n.getHandle(),!e.supported){let d=!1;for(let h=0;h<e.buffers.length;++h){let v=e.buffers[h];if(v.buffer===p.buffer){d=!0;let x=!1;for(let T=0;T<v.attributes.length;++T)v.attributes[T].name===a&&(x=!0,v.attributes[T]=p);x||v.attributes.push(p)}}d||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,a,i,s,o,c,f,l)=>{let u=t.addAttributeArrayWithDivisor(r,n,a,i,s,o,c,f,l,!0);if(!u)return u;let g=e.context,p=g.getAttribLocation(e.handleProgram,a);for(let d=1;d<c;d++)g.enableVertexAttribArray(p+d),g.vertexAttribPointer(p+d,c,o,f,s,i+s*d/c),l>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+d,1):g.vertexAttribDivisor(p+d,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];for(let i=0;i<a.attributes.length;++i)if(a.attributes[i].name===r)return a.attributes.splice(i,1),a.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var cM={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function dh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cM,r),e.buffers=[],w.obj(t,e),w.get(t,e,["supported"]),w.setGet(t,e,["forceEmulation"]),oM(t,e)}var fM=w.newInstance(dh,"vtkOpenGLVertexArrayObject"),ra={newInstance:fM,extend:dh};var Wr={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function uM(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,a,i)=>{if(e.CABO.getElementCount()){let s=t.getOpenGLMode(a),o=t.haveWideLines(r,n),c=e.context,f=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),s===c.LINES&&o?(t.updateShaders(r,n,i),c.drawArraysInstanced(s,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(c.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,i),c.drawArrays(s,0,e.CABO.getElementCount()),c.lineWidth(1));let u=(s===c.POINTS?1:0)||(s===c.LINES?2:3);return e.pointPicking&&c.depthMask(f),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;let n=e.primitiveType;return r===_e.POINTS||n===Wr.Points?e.context.POINTS:r===_e.WIREFRAME||n===Wr.Lines||n===Wr.TrisEdges||n===Wr.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,a)=>!!(a.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,a)=>{if(t.getNeedToRebuildShaders(r,n,a)){let i={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(i,r,n);let s=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);s!==t.getProgram()&&(t.setProgram(s),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,r,n),a.setPropertyShaderParameters(t,r,n),a.setCameraShaderParameters(t,r,n),a.setLightingShaderParameters(t,r,n),a.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,a)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);let i=parseFloat(n.getProperty().getLineWidth()),s=i/2;t.getProgram().setUniformf("lineWidthStepSize",i/Math.ceil(i)),t.getProgram().setUniformf("halfLineWidth",s)}e.primitiveType===Wr.Points||n.getProperty().getRepresentation()===_e.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,a)=>{let i=r.Vertex;i=z.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,i=z.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,a)&&(i=z.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,i=z.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=i},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Wr.Points?2:e.primitiveType===Wr.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}var lM={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function vh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lM,r),w.obj(t,e),e.shaderSourceTime={},w.obj(e.shaderSourceTime),e.attributeUpdateTime={},w.obj(e.attributeUpdateTime),w.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=z.newInstance(),e.VAO=ra.newInstance(),e.CABO=gh.newInstance(),uM(t,e)}var gM=w.newInstance(vh),rt={newInstance:gM,extend:vh,primTypes:Wr};var pM=t=>t,mh=1e-6,ds=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=D.identity(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?pr.toRadian:pM}rotateFromDirections(e,r){let n=new Float64Array(3),a=new Float64Array(3),i=new Float64Array(16);P.set(n,e[0],e[1],e[2]),P.set(a,r[0],r[1],r[2]),P.normalize(n,n),P.normalize(a,a);let s=P.dot(n,a);return s>=1?this:(P.cross(this.tmp,n,a),P.length(this.tmp)<mh&&(P.cross(this.tmp,[1,0,0],e),P.length(this.tmp)<mh&&P.cross(this.tmp,[0,1,0],e)),D.fromRotation(i,Math.acos(s),this.tmp),D.multiply(this.matrix,this.matrix,i),this)}rotate(e,r){return P.set(this.tmp,...r),P.normalize(this.tmp,this.tmp),D.rotate(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return D.rotateX(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return D.rotateY(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return D.rotateZ(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,r,n){return P.set(this.tmp,e,r,n),D.translate(this.matrix,this.matrix,this.tmp),this}scale(e,r,n){return P.set(this.tmp,e,r,n),D.scale(this.matrix,this.matrix,this.tmp),this}multiply(e){return D.multiply(this.matrix,this.matrix,e),this}multiply3x3(e){return D.multiply(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return D.invert(this.matrix,this.matrix),this}identity(){return D.identity(this.matrix),this}apply(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Ur(qn,this.matrix))return this;let a=n===-1?e.length:r+n*3;for(let i=r;i<a;i+=3)P.set(this.tmp,e[i],e[i+1],e[i+2]),P.transformMat4(this.tmp,this.tmp,this.matrix),e[i]=this.tmp[0],e[i+1]=this.tmp[1],e[i+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&D.copy(this.matrix,e),this}};function hM(){return new ds(!0)}function dM(){return new ds(!1)}var xn={buildFromDegree:hM,buildFromRadian:dM};var vM=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],mM=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function xM(t,e){e.classHierarchy.push("vtkCubeSource"),t.requestData=(r,n)=>{let a=n[0]?.initialize()||Re.newInstance();n[0]=a;let i=24,s=w.newTypedArray(e.pointType,i*3);a.getPoints().setData(s,3);let o=w.newTypedArray(e.pointType,i*3),c=K.newInstance({name:"Normals",values:o,numberOfComponents:3});a.getPointData().setNormals(c);let f=2;e.generate3DTextureCoordinates===!0&&(f=3);let l=w.newTypedArray(e.pointType,i*f),u=K.newInstance({name:"TextureCoordinates",values:l,numberOfComponents:f});a.getPointData().setTCoords(u);let g=[0,0,0],p=[0,0,0],d=[0,0],h=0;g[0]=-e.xLength/2,p[0]=-1,p[1]=0,p[2]=0;for(let v=0;v<2;v++){g[1]=-e.yLength/2;for(let x=0;x<2;x++){d[1]=g[1]+.5,g[2]=-e.zLength/2;for(let T=0;T<2;T++)d[0]=(g[2]+.5)*(1-2*v),s[h*3]=g[0],s[h*3+1]=g[1],s[h*3+2]=g[2],o[h*3]=p[0],o[h*3+1]=p[1],o[h*3+2]=p[2],f===2?(l[h*f]=d[0],l[h*f+1]=d[1]):(l[h*f]=2*v-1,l[h*f+1]=2*x-1,l[h*f+2]=2*T-1),h++,g[2]+=e.zLength;g[1]+=e.yLength}g[0]+=e.xLength,p[0]+=2}g[1]=-e.yLength/2,p[1]=-1,p[0]=0,p[2]=0;for(let v=0;v<2;v++){g[0]=-e.xLength/2;for(let x=0;x<2;x++){d[0]=(g[0]+.5)*(2*v-1),g[2]=-e.zLength/2;for(let T=0;T<2;T++)d[1]=(g[2]+.5)*-1,s[h*3]=g[0],s[h*3+1]=g[1],s[h*3+2]=g[2],o[h*3]=p[0],o[h*3+1]=p[1],o[h*3+2]=p[2],f===2?(l[h*f]=d[0],l[h*f+1]=d[1]):(l[h*f]=2*x-1,l[h*f+1]=2*v-1,l[h*f+2]=2*T-1),h++,g[2]+=e.zLength;g[0]+=e.xLength}g[1]+=e.yLength,p[1]+=2}g[2]=-e.zLength/2,p[2]=-1,p[0]=0,p[1]=0;for(let v=0;v<2;v++){g[1]=-e.yLength/2;for(let x=0;x<2;x++){d[1]=g[1]+.5,g[0]=-e.xLength/2;for(let T=0;T<2;T++)d[0]=(g[0]+.5)*(2*v-1),s[h*3]=g[0],s[h*3+1]=g[1],s[h*3+2]=g[2],o[h*3]=p[0],o[h*3+1]=p[1],o[h*3+2]=p[2],f===2?(l[h*f]=d[0],l[h*f+1]=d[1]):(l[h*f]=2*T-1,l[h*f+1]=2*x-1,l[h*f+2]=2*v-1),h++,g[0]+=e.xLength;g[1]+=e.yLength}g[2]+=e.zLength,p[2]+=2}if(e.rotations&&xn.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(o),e.center&&xn.buildFromRadian().translate(...e.center).apply(s),e.matrix){xn.buildFromRadian().setMatrix(e.matrix).apply(s);let v=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];xn.buildFromRadian().setMatrix(v).apply(o)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()},t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let n=0;n<arguments.length;n++)r.push(n<0||arguments.length<=n?void 0:arguments[n]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))}}var yM={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function xh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yM,r),w.obj(t,e),w.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),w.setGetArray(t,e,["center","rotations"],3),w.setGetArray(t,e,["matrix"],16),e._polys=Qt.newInstance({values:Uint16Array.from(mM)}),e._lineCells=Qt.newInstance({values:Uint16Array.from(vM)}),w.moveToProtected(t,e,["polys","lineCells"]),w.algo(t,e,0,1),xM(t,e)}var TM=w.newInstance(xh,"vtkCubeSource"),yh={newInstance:TM,extend:xh};var{vtkErrorMacro:Th}=w;function SM(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");let r={...t};t.requestData=(n,a)=>{let i=n[0];if(!i||!i.isA("vtkImageData")){Th("Invalid or missing input");return}let s=i.getSpatialExtent();if(!s){Th("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(s),e._cubeSource.setMatrix(i.getIndexToWorld()),a[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(r.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}var CM={};function Sh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CM,r),w.obj(t,e),w.algo(t,e,1,1),e._cubeSource=yh.newInstance(),w.moveToProtected(t,e,["cubeSource","tmpOut"]),SM(t,e)}var wM=w.newInstance(Sh,"vtkImageDataOutlineFilter"),Ch={newInstance:wM,extend:Sh};var Mh=Kn(ki(),1);var yn={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Z={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},ef={Wrap:yn,Filter:Z};var wh=new Float32Array(1),OM=new Int32Array(wh.buffer);function EM(t){wh[0]=t;let e=OM[0],r=e>>16&32768,n=e>>12&2047,a=e>>23&255;return a<103?r:a>142?(r|=31744,r|=(a===255?0:1)&&e&8388607,r):a<113?(n|=2048,r|=(n>>114-a)+(n>>113-a&1),r):(r|=a-112<<10|n>>1,r+=n&1,r)}function MM(t){let e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var Tt={fromHalf:MM,toHalf:EM};function RM(){try{let n=new Int16Array([0,32767]),a=[1,1],i=document.createElement("canvas");i.width=4,i.height=4;let s=i.getContext("webgl2");if(!s)return!1;let o=s.getExtension("EXT_texture_norm16");if(!o)return!1;let c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,f=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,l=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(l,c),s.compileShader(l),!s.getShaderParameter(l,s.COMPILE_STATUS))return!1;let u=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(u,f),s.compileShader(u),!s.getShaderParameter(u,s.COMPILE_STATUS))return!1;let g=s.createProgram();if(s.attachShader(g,l),s.attachShader(g,u),s.linkProgram(g),!s.getProgramParameter(g,s.LINK_STATUS))return!1;let p=s.createTexture();s.bindTexture(s.TEXTURE_2D,p),s.texImage2D(s.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,s.RED,s.SHORT,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.useProgram(g),s.drawArrays(s.POINTS,0,1);let d=new Uint8Array(4);s.readPixels(a[0],a[1],1,1,s.RGBA,s.UNSIGNED_BYTE,d);let[h,v,x]=d,T=s.getExtension("WEBGL_lose_context");return T&&T.loseContext(),h===v&&v===x&&h!==0}catch{return!1}}var tf;function Oh(){return tf===void 0&&(tf=RM()),tf}var{Wrap:Cr,Filter:Ye}=ef,{VtkDataTypes:xe}=K,{vtkDebugMacro:rf,vtkErrorMacro:Tn,vtkWarningMacro:Eh,requiredParam:ye}=De,{toHalf:DM}=Tt;function LM(t,e){e.classHierarchy.push("vtkOpenGLTexture");function r(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(d?e._openGLRenderWindow=d:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Ye.LINEAR),t.setMagnificationFilter(Ye.LINEAR)):(t.setMinificationFilter(Ye.NEAREST),t.setMagnificationFilter(Ye.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Cr.REPEAT),t.setWrapS(Cr.REPEAT),t.setWrapT(Cr.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR));let v=e.renderable.getCanvas();t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:xe.UNSIGNED_CHAR,data:v,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){let v=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:xe.UNSIGNED_CHAR,data:v.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}let h=e.renderable.getInputData(0);if(h&&h.getPointData().getScalars()){let v=h.getExtent(),x=h.getPointData().getScalars(),T=[];for(let m=0;m<e.renderable.getNumberOfInputPorts();++m){let y=e.renderable.getInputData(m),S=y?y.getPointData().getScalars().getData():null;S&&T.push(S)}e.renderable.getInterpolate()&&x.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Ye.LINEAR_MIPMAP_LINEAR)),T.length%6===0?t.createCubeFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:x.getNumberOfComponents(),dataType:x.getDataType(),data:T}):t.create2DFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:x.getNumberOfComponents(),dataType:x.getDataType(),data:x.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};let n=()=>{if(!((e.minificationFilter===Ye.LINEAR||e.magnificationFilter===Ye.LINEAR)&&!Oh()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=d=>{d&&e.handle&&(d.activateTexture(t),d.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(d),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let d=!1;if(e.context&&e.handle){let h=0;switch(e.target){case e.context.TEXTURE_2D:h=e.context.TEXTURE_BINDING_2D;break;default:Eh("impossible case");break}d=e.context.getIntegerv(h)===e.handle}return d},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(d,h)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(d,h)),e.internalFormat||rf(`Unable to find suitable internal format for T=${d} NC= ${h}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&Eh("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(d,h)=>{let v=0;return v=e._openGLRenderWindow.getDefaultTextureInternalFormat(d,h,n(),t.useHalfFloat()),v||(v||(rf("Unsupported internal texture type!"),rf(`Unable to find suitable internal format for T=${d} NC= ${h}`)),v)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=d=>{e._forceInternalFormat=!0,d!==e.internalFormat&&(e.internalFormat=d,t.modified())},t.getFormat=(d,h)=>(e.format=t.getDefaultFormat(d,h),e.format),t.getDefaultFormat=(d,h)=>{if(e._openGLRenderWindow.getWebgl2())switch(h){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=d=>{let h=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(d){case xe.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!h&&xe.SHORT):return e.context.SHORT;case(n()&&!h&&xe.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(h&&xe.SHORT):return e.context.HALF_FLOAT;case(h&&xe.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case xe.FLOAT:case xe.VOID:default:return e.context.FLOAT}switch(d){case xe.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case xe.FLOAT:case xe.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{let v=e.context.getExtension("OES_texture_half_float");if(v&&e.context.getExtension("OES_texture_half_float_linear"))return v.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||h)&&(e.openGLDataType=t.getDefaultDataType(d)),e.openGLDataType},t.getShiftAndScale=()=>{let d=0,h=1;switch(e.openGLDataType){case e.context.BYTE:h=127.5,d=h-128;break;case e.context.UNSIGNED_BYTE:h=255,d=0;break;case e.context.SHORT:h=32767.5,d=h-32768;break;case e.context.UNSIGNED_SHORT:h=65536,d=0;break;case e.context.INT:h=21474836475e-1,d=h-2147483648;break;case e.context.UNSIGNED_INT:h=4294967295,d=0;break;case e.context.FLOAT:}return{shift:d,scale:h}},t.getOpenGLFilterMode=d=>{switch(d){case Ye.NEAREST:return e.context.NEAREST;case Ye.LINEAR:return e.context.LINEAR;case Ye.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Ye.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Ye.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Ye.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=d=>{switch(d){case Cr.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Cr.REPEAT:return e.context.REPEAT;case Cr.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function a(d){let[h,v,x,T,m,y]=d;return[v-h+1,T-x+1,y-m+1]}function i(d){let[h,v,x]=a(d);return h*v*x}function s(d,h,v,x,T){let[m,y,S,C,E,O]=v,[U,k]=h,V=U*k,b=T;for(let R=E;R<=O;R++){let M=R*V;for(let N=S;N<=C;N++){let L=M+N*U;for(let B=L+m,G=L+y;B<=G;B++,b++)x[b]=d[B]}}}function o(d,h){let x=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||d.constructor,T=h.reduce((C,E)=>C+i(E),0),m=new x(T),y=[e.width,e.height,e.depth],S=0;return h.forEach(C=>{s(d,y,C,m,S),S+=i(C)}),m}t.updateArrayDataTypeForGL=function(d,h){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],T=[],m=e.width*e.height*e.components;v&&(m*=e.depth);let y=!!x.length;if(d!==xe.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let C=0;C<h.length;C++)if(h[C])if(y)T.push(o(h[C],x,Float32Array));else{let E=h[C].length>m?h[C].subarray(0,m):h[C];T.push(new Float32Array(E))}else T.push(null);if(d!==xe.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let C=0;C<h.length;C++)if(h[C])if(y)T.push(o(h[C],x,Uint8Array));else{let E=h[C].length>m?h[C].subarray(0,m):h[C];T.push(new Uint8Array(E))}else T.push(null);let S=!1;if(e._openGLRenderWindow.getWebgl2())S=e.openGLDataType===e.context.HALF_FLOAT;else{let C=e.context.getExtension("OES_texture_half_float");S=C&&e.openGLDataType===C.HALF_FLOAT_OES}if(S)for(let C=0;C<h.length;C++)if(h[C]){let E=y?o(h[C],x):h[C],O=new Uint16Array(y?E.length:m),U=O.length;for(let k=0;k<U;k++)O[k]=DM(E[k]);T.push(O)}else T.push(null);if(T.length===0)for(let C=0;C<h.length;C++)T.push(y&&h[C]?o(h[C],x):h[C]);return T};function c(d){if(e._openGLRenderWindow.getWebgl2())return d;let h=[],v=e.width,x=e.height,T=e.components;if(d&&(!Jn(v)||!Jn(x))){let m=e.context.getExtension("OES_texture_half_float"),y=pt(v),S=pt(x),C=y*S*e.components;for(let E=0;E<d.length;E++)if(d[E]!==null){let O=null,U=x/S,k=v/y,V=!1;e.openGLDataType===e.context.FLOAT?O=new Float32Array(C):m&&e.openGLDataType===m.HALF_FLOAT_OES?(O=new Uint16Array(C),V=!0):O=new Uint8Array(C);for(let b=0;b<S;b++){let R=b*y*T,M=b*U,N=Math.floor(M),L=Math.ceil(M);L>=x&&(L=x-1);let B=M-N,G=1-B;N=N*v*T,L=L*v*T;for(let F=0;F<y;F++){let _=F*T,W=F*k,H=Math.floor(W),I=Math.ceil(W);I>=v&&(I=v-1);let ve=W-H;H*=T,I*=T;for(let me=0;me<T;me++)V?O[R+_+me]=Tt.toHalf(Tt.fromHalf(d[E][N+H+me])*G*(1-ve)+Tt.fromHalf(d[E][N+I+me])*G*ve+Tt.fromHalf(d[E][L+H+me])*B*(1-ve)+Tt.fromHalf(d[E][L+I+me])*B*ve):O[R+_+me]=d[E][N+H+me]*G*(1-ve)+d[E][N+I+me]*G*ve+d[E][L+H+me]*B*(1-ve)+d[E][L+I+me]*B*ve}}h.push(O),e.width=y,e.height=S}else h.push(null)}if(h.length===0)for(let m=0;m<d.length;m++)h.push(d[m]);return h}function f(d){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(d===xe.UNSIGNED_SHORT||d===xe.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),numComps:v=ye("numComps"),dataType:x=ye("dataType"),data:T=ye("data"),flip:m=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(x,!0),t.getInternalFormat(x,v),t.getFormat(x,v),!e.internalFormat||!e.format||!e.openGLDataType)return Tn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=v,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let y=[T],S=t.updateArrayDataTypeForGL(x,y),C=c(S);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,m),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),f(x)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),C[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,C[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),m&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(x,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),numComps:v=ye("numComps"),dataType:x=ye("dataType"),data:T=ye("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(x),t.getInternalFormat(x,v),t.getFormat(x,v),!e.internalFormat||!e.format||!e.openGLDataType)return Tn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=v,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=T.length/6-1,t.createTexture(),t.bind();let m=t.updateArrayDataTypeForGL(x,T),y=c(m),S=[],C=e.width,E=e.height;for(let O=0;O<y.length;O++){O%6===0&&O!==0&&(C/=2,E/=2),S[O]=hr(x,E*C*e.components);for(let U=0;U<E;++U){let k=U*C*e.components,V=(E-U-1)*C*e.components;S[O].set(y[O].slice(V,V+C*e.components),k)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),f(x)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let O=0;O<6;O++){let U=0,k=e.width,V=e.height;for(;k>=1&&V>=1;){let b=null;U<=e.maxLevel&&(b=S[6*U+O]),f(x)?b!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+O,U,0,0,k,V,e.format,e.openGLDataType,b):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+O,U,e.internalFormat,k,V,0,e.format,e.openGLDataType,b),U++,k/=2,V/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(x,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),dataType:v=ye("dataType"),data:x=ye("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(v),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?v===xe.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Tn("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),f(v)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),x!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,x)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,x),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(v,n(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=d=>{if(t.getOpenGLDataType(xe.UNSIGNED_CHAR),t.getInternalFormat(xe.UNSIGNED_CHAR,4),t.getFormat(xe.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Tn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let h=!e._openGLRenderWindow.getWebgl2()&&(!Jn(d.width)||!Jn(d.height)),v=d,x=d.width,T=d.height,m=!0,y=window.chrome;if(h||y){let S=new OffscreenCanvas(pt(d.width),pt(d.height));x=S.width,T=S.height;let C=S.getContext("2d");C.translate(0,S.height),C.scale(1,-1),C.drawImage(d,0,0,d.width,d.height,0,0,S.width,S.height),v=S,m=!1}return e.width=x,e.height=T,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,m),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),f(xe.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(xe.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=d=>(t.getOpenGLDataType(xe.UNSIGNED_CHAR),t.getInternalFormat(xe.UNSIGNED_CHAR,4),t.getFormat(xe.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(Tn("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=d.width,e.height=d.height,f(xe.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,d)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,d),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(xe.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0));function l(d,h,v){let x=new Array(v),T=new Array(v);for(let m=0;m<v;++m)x[m]=d[m],T[m]=h[m]-d[m]||1;return{scale:T,offset:x}}function u(d,h){for(let v=0;v<d.length;v++){let x=d[v],T=h[v]+x;if(x<-2048||x>2048||T<-2048||T>2048)return!1}return!0}function g(d,h,v,x){t.getOpenGLDataType(d);let T=u(h,v)||x,m=!1;if(e._openGLRenderWindow.getWebgl2())m=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&T||e.openGLDataType===e.context.HALF_FLOAT;else{let y=e.context.getExtension("OES_texture_half_float");m=y&&e.openGLDataType===y.HALF_FLOAT_OES}e.canUseHalfFloat=m&&T}function p(d,h){let v=d.getNumberOfComponents(),x=d.getDataType(),T=d.getData(),m=new Array(v),y=new Array(v);for(let C=0;C<v;++C){let[E,O]=d.getRange(C);m[C]=E,y[C]=O}let S=l(m,y,v);return g(x,S.offset,S.scale,h),t.useHalfFloat()||t.getOpenGLDataType(x,!0),{numComps:v,dataType:x,data:T,scaleOffsets:S}}t.create2DFilterableFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),numComps:v=ye("numComps"),dataType:x=ye("dataType"),data:T=ye("data"),preferSizeOverAccuracy:m=!1,ranges:y=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:d,height:h,dataArray:K.newInstance({numComps:v,dataType:x,values:T,ranges:y}),preferSizeOverAccuracy:m})},t.create2DFilterableFromDataArray=function(){let{width:d=ye("width"),height:h=ye("height"),dataArray:v=ye("dataArray"),preferSizeOverAccuracy:x=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{numComps:T,dataType:m,data:y}=p(v,x);t.create2DFromRaw({width:d,height:h,numComps:T,dataType:m,data:y})},t.updateVolumeInfoForGL=(d,h)=>{let v=!1,x=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(h),offset:new Array(h)});for(let T=0;T<h;++T)e.volumeInfo.scale[T]=1,e.volumeInfo.offset[T]=0;if(n()&&!x&&d===xe.SHORT){for(let T=0;T<h;++T)e.volumeInfo.scale[T]=32767;v=!0}if(n()&&!x&&d===xe.UNSIGNED_SHORT){for(let T=0;T<h;++T)e.volumeInfo.scale[T]=65535;v=!0}if(d===xe.UNSIGNED_CHAR){for(let T=0;T<h;++T)e.volumeInfo.scale[T]=255;v=!0}return(d===xe.FLOAT||x&&(d===xe.SHORT||d===xe.UNSIGNED_SHORT))&&(v=!0),v},t.create3DFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),depth:v=ye("depth"),numComps:x=ye("numComps"),dataType:T=ye("dataType"),data:m=ye("data"),updatedExtents:y=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},S=T,C=m;if(!t.updateVolumeInfoForGL(S,x)&&C){let R=d*h*v,M=structuredClone(e.volumeInfo),N=new Float32Array(R*x);e.volumeInfo.offset=M.offset,e.volumeInfo.scale=M.scale;let L=0,B=M.scale.map(G=>1/G);for(let G=0;G<R;G++)for(let F=0;F<x;F++)N[L]=(C[L]-M.offset[F])*B[F],L++;S=xe.FLOAT,C=N}if(t.getOpenGLDataType(S),t.getInternalFormat(S,x),t.getFormat(S,x),!e.internalFormat||!e.format||!e.openGLDataType)return Tn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=x,e.width=d,e.height=h,e.depth=v,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let E=y.length>0,O=!E||!(0,Mh.default)(e._prevTexParams,r()),U=[C],V=t.updateArrayDataTypeForGL(S,U,!0,O?[]:y),b=c(V);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),O)f(S)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),b[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,b[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,b[0]),e._prevTexParams=r();else if(E){let R=b[0],M=0;for(let N=0;N<y.length;N++){let L=y[N],B=a(L),G=i(L),F=new R.constructor(R.buffer,M,G);M+=F.byteLength,e.context.texSubImage3D(e.target,0,L[0],L[2],L[4],B[0],B[1],B[2],e.format,e.openGLDataType,F)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(S,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:d=ye("width"),height:h=ye("height"),depth:v=ye("depth"),numComps:x=ye("numComps"),dataType:T=ye("dataType"),data:m=ye("data"),preferSizeOverAccuracy:y=!1,ranges:S=void 0,updatedExtents:C=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:d,height:h,depth:v,dataArray:K.newInstance({numComps:x,dataType:T,values:m,ranges:S}),preferSizeOverAccuracy:y,updatedExtents:C})},t.create3DFilterableFromDataArray=function(){let{width:d=ye("width"),height:h=ye("height"),depth:v=ye("depth"),dataArray:x=ye("dataArray"),preferSizeOverAccuracy:T=!1,updatedExtents:m=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{numComps:y,dataType:S,data:C,scaleOffsets:E}=p(x,T),O=[],U=[];for(let ie=0;ie<y;++ie)O[ie]=0,U[ie]=1;if(e.volumeInfo={scale:U,offset:O,dataComputedScale:E.scale,dataComputedOffset:E.offset,width:d,height:h,depth:v},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:d,height:h,depth:v,numComps:y,dataType:S,data:C,updatedExtents:m});let k=d*h*v,V=structuredClone(E),b=(ie,he,we,Oe,re)=>{ie[he]=we},R=xe.UNSIGNED_CHAR;if(S===xe.UNSIGNED_CHAR)for(let ie=0;ie<y;++ie)V.offset[ie]=0,V.scale[ie]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(R=xe.FLOAT,b=(ie,he,we,Oe,re)=>{ie[he]=(we-Oe)/re}):(R=xe.UNSIGNED_CHAR,b=(ie,he,we,Oe,re)=>{ie[he]=255*(we-Oe)/re});if(t.getOpenGLDataType(R),t.getInternalFormat(R,y),t.getFormat(R,y),!e.internalFormat||!e.format||!e.openGLDataType)return Tn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=y,e.depth=1,e.numberOfDimensions=2;let M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);M>4096&&(R===xe.FLOAT||y>=3)&&(M=4096);let N=1,L=1;k>M*M&&(N=Math.ceil(Math.sqrt(k/(M*M))),L=N);let B=Math.sqrt(k)/N;B=pt(B);let G=Math.floor(B*N/d),F=Math.ceil(v/G),_=pt(h*F/L);e.width=B,e.height=_,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=G,e.volumeInfo.yreps=F,e.volumeInfo.xstride=N,e.volumeInfo.ystride=L,e.volumeInfo.offset=V.offset,e.volumeInfo.scale=V.scale;let W,H=B*_*y;R===xe.FLOAT?W=new Float32Array(H):W=new Uint8Array(H);let I=0,ve=Math.floor(d/N),me=Math.floor(h/L);for(let ie=0;ie<F;ie++){let he=Math.min(G,v-ie*G),we=y*(e.width-he*Math.floor(d/N));for(let Oe=0;Oe<me;Oe++){for(let re=0;re<he;re++){let ne=y*((ie*G+re)*d*h+L*Oe*d);for(let de=0;de<ve;de++)for(let ct=0;ct<y;ct++)b(W,I,C[ne+N*de*y+ct],V.offset[ct],V.scale[ct]),I++}I+=we}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),f(R)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),W!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,W)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,W),t.deactivate(),!0},t.setOpenGLRenderWindow=d=>{e._openGLRenderWindow!==d&&(t.releaseGraphicsResources(),e._openGLRenderWindow=d,e.context=null,d&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=d=>d&&d.isCurrent()?d.getIntegerv(d.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=d=>{e.enableUseHalfFloat=d}}var VM={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Cr.CLAMP_TO_EDGE,wrapT:Cr.CLAMP_TO_EDGE,wrapR:Cr.CLAMP_TO_EDGE,minificationFilter:Ye.NEAREST,magnificationFilter:Ye.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function Rh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VM,r),Q.extend(t,e,r),e.sendParametersTime={},ae(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},ae(e.textureBuildTime,{mtime:0}),un(t,e,["format","openGLDataType"]),ge(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Me(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),kr(t,e,["openGLRenderWindow"]),LM(t,e)}var Dh=$(Rh,"vtkOpenGLTexture"),Ce={newInstance:Dh,extend:Rh,...ef};Te("vtkTexture",Dh);function FM(t,e){t.replaceShaderCoincidentOffset=(r,n,a)=>{let i=t.getCoincidentParameters(n,a);if(i&&(i.factor!==0||i.offset!==0)){let s=r.Fragment;s=z.substitute(s,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(i.factor!==0?(s=z.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=z.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=z.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(i.factor!==0?(s=z.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=z.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=z.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=s}}}function kM(t,e){t.applyShaderReplacements=(r,n,a)=>{let i=null;if(n&&(i=n.ShaderReplacements),i)for(let s=0;s<i.length;s++){let o=i[s];if(a&&o.replaceFirst||!a&&!o.replaceFirst){let c=o.shaderType,f=r[c],l=z.substitute(f,o.originalValue,o.replacementValue,o.replaceAll);r[c]=l.result}}},t.buildShaders=(r,n,a)=>{t.getReplacedShaderTemplate(r,n,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);let i=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,i,!0),t.replaceShaderValues(r,n,a),t.applyShaderReplacements(r,i)},t.getReplacedShaderTemplate=(r,n,a)=>{let i=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,a);let s=r.Vertex;if(i){let f=i.VertexShaderCode;f!==void 0&&f!==""&&(s=f)}r.Vertex=s;let o=r.Fragment;if(i){let f=i.FragmentShaderCode;f!==void 0&&f!==""&&(o=f)}r.Fragment=o;let c=r.Geometry;if(i){let f=i.GeometryShaderCode;f!==void 0&&(c=f)}r.Geometry=c}}var ut={implementReplaceShaderCoincidentOffset:FM,implementBuildShadersWithReplacements:kM};var{vtkWarningMacro:bM}=w,nf;function UM(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(r,n)=>(P.transformMat4(n,r,e.matrix),n),t.transformPoints=(r,n)=>{let a=new Float64Array(3),i=new Float64Array(3);for(let s=0;s<r.length;s+=3)a[0]=r[s],a[1]=r[s+1],a[2]=r[s+2],P.transformMat4(i,a,e.matrix),n[s]=i[0],n[s+1]=i[1],n[s+2]=i[2];return n},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(r,n)=>(e.preMultiplyFlag?D.multiply(n,e.matrix,r):D.multiply(n,r,e.matrix),n),t.transformMatrices=(r,n)=>{let a=new Float64Array(16),i=new Float64Array(16),s=e.preMultiplyFlag?()=>D.multiply(i,e.matrix,a):()=>D.multiply(i,a,e.matrix);for(let o=0;o<r.length;o+=16){for(let c=0;c<16;++c)a[c]=r[o+c];s();for(let c=0;c<16;++c)n[o+c]=i[c]}return n},t.getInverse=()=>nf({matrix:Xe.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag}),t.translate=(r,n,a)=>{if(r===0&&n===0&&a===0)return;let i=D.create();D.fromTranslation(i,[r,n,a]),e.preMultiplyFlag?D.multiply(e.matrix,e.matrix,i):D.multiply(e.matrix,i,e.matrix),t.modified()},t.rotateWXYZ=(r,n,a,i)=>{if(n===0&&a===0&&i===0){bM("No rotation applied, axis is zero vector.");return}if(r===0)return;let s=Xe.radiansFromDegrees(r),o=ze.create();ze.setAxisAngle(o,[n,a,i],s);let c=new Float64Array(16);D.fromQuat(c,o),e.preMultiplyFlag?D.multiply(e.matrix,e.matrix,c):D.multiply(e.matrix,c,e.matrix),t.modified()},t.rotateX=r=>{t.rotateWXYZ(r,1,0,0)},t.rotateY=r=>{t.rotateWXYZ(r,0,1,0)},t.rotateZ=r=>{t.rotateWXYZ(r,0,0,1)},t.scale=(r,n,a)=>{if(r===1&&n===1&&a===1)return;let i=D.create();D.fromScaling(i,[r,n,a]),e.preMultiplyFlag?D.multiply(e.matrix,e.matrix,i):D.multiply(e.matrix,i,e.matrix),t.modified()},t.transformNormal=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=ee.fromMat4(ee.create(),e.matrix),i=ee.create();ee.invert(i,a);let s=ee.create();return ee.transpose(s,i),t.transformVector(r,n,s),Xe.normalize(n),n},t.transformNormals=(r,n)=>{let a=r.getData(),i=n.getData(),s=[0,0,0],o=ee.fromMat4(ee.create(),e.matrix),c=ee.create();ee.invert(c,o);let f=ee.create();ee.transpose(f,c);for(let l=0;l<a.length;l+=3)s[0]=a[l],s[1]=a[l+1],s[2]=a[l+2],t.transformVector(s,s,f),Xe.normalize(s),i[l]=s[0],i[l+1]=s[1],i[l+2]=s[2]},t.transformVector=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||ee.fromMat4(ee.create(),e.matrix);return P.transformMat3(n,r,i),n},t.transformVectors=(r,n)=>{let a=r.getData(),i=n.getData(),s=[0,0,0];for(let o=0;o<a.length;o+=3)s[0]=a[o],s[1]=a[o+1],s[2]=a[o+2],t.transformVector(s,s),Xe.normalize(s),i[o]=s[0],i[o+1]=s[1],i[o+2]=s[2]},t.transformPointsNormalsVectors=function(r,n,a,i,s,o){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=r.getNumberOfPoints(),u=c?.length??0,g=new Float64Array(3),p=new Float64Array(3),d=new Float64Array(3),h=new Float64Array(3),v=!1,x=!1,T=!1,m=[];for(let y=0;y<l;y++){if(r.getPoint(y,g),p.set(g),t.transformPoint(g,g),n.setPoint(y,...g),Xe.areEquals(p,g)||(v=!0),s){let S=s.getData(),C=o.getData();g[0]=S[y*3],g[1]=S[y*3+1],g[2]=S[y*3+2],d.set(g),t.transformVector(g,g),C[y*3]=g[0],C[y*3+1]=g[1],C[y*3+2]=g[2],Xe.areEquals(d,g)||(x=!0)}if(a){let S=a.getData(),C=i.getData();g[0]=S[y*3],g[1]=S[y*3+1],g[2]=S[y*3+2],h.set(g),t.transformNormal(g,g),C[y*3]=g[0],C[y*3+1]=g[1],C[y*3+2]=g[2],Xe.areEquals(h,g)||(T=!0)}if(c)for(let S=0;S<u;S++){let C=c[S].getData(),E=f[S].getData();g[0]=C[y*3],g[1]=C[y*3+1],g[2]=C[y*3+2],d.set(g),t.transformVector(g,g),E[y*3]=g[0],E[y*3+1]=g[1],E[y*3+2]=g[2],!Xe.arrayEqual(d,g)&&!m.includes(S)&&m.push(S)}}v&&n.modified(),x&&o.modified(),T&&i.modified(),m.forEach(y=>f[y].modified())}}var NM={preMultiplyFlag:!1,matrix:[...qn]};function Lh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NM,r),w.obj(t,e),w.setGet(t,e,["preMultiplyFlag"]),w.setGetArray(t,e,["matrix"],16),UM(t,e)}nf=w.newInstance(Lh,"vtkTransform");var Vh={newInstance:nf,extend:Lh};function Bt(t,e,r){return t.length>0?`${t.map(n=>n?.getMTime()??"x").join("/")}-${e}-${r}`:"0"}function na(t,e){return`${e.getMTime()}`}var Fh=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`;var kh=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;var Ht={NEAREST:0,LINEAR:1};var st={Off:0,PolygonOffset:1},af=st.PolygonOffset,vs=st.Off,BM=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function GM(){return af}function _M(t){let e=af===t;return af=t,e}function WM(){return vs}function ms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=vs===t;return vs=t,e}function zM(){return ms(st.Off)}function AM(){return ms(st.Off)}function PM(){return ms(st.PolygonOffset)}function HM(){return BM[vs]}var xs={Resolve:st,getResolveCoincidentTopologyAsString:HM,getResolveCoincidentTopologyPolygonOffsetFaces:GM,getResolveCoincidentTopology:WM,setResolveCoincidentTopology:ms,setResolveCoincidentTopologyPolygonOffsetFaces:_M,setResolveCoincidentTopologyToDefault:zM,setResolveCoincidentTopologyToOff:AM,setResolveCoincidentTopologyToPolygonOffset:PM};function bh(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=w.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}var sf=["Polygon","Line","Point"],IM={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},jM=()=>{},Sn={modified:jM};bh(Sn,IM,sf.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function KM(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),w.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(xs).forEach(r=>{t[r]=xs[r]}),Object.keys(Sn).filter(r=>r!=="modified").forEach(r=>{t[r]=Sn[r]}),bh(t,e.topologyOffset,sf.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{let r=Sn.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{let r=Sn.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{let r=Sn.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var of={implementCoincidentTopologyMethods:KM,staticOffsetAPI:Sn,otherStaticMethods:xs,CATEGORIES:sf,Resolve:st};var{vtkErrorMacro:Cn}=De;function Uh(t,e,r){return e.identity(r),t.reduce((n,a,i)=>i===0?a?e.copy(n,a):e.identity(n):a?e.multiply(n,n,a):n,r)}function $M(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");let r=new Map;function n(c,f){if(!f)return;let u=(r.get(f)??0)-1;u<=0?(c.unregisterGraphicsResourceUser(f,t),r.delete(f)):r.set(f,u)}function a(c,f){if(!f)return;let l=r.get(f)??0,u=l+1;r.set(f,u),l<=0&&c.registerGraphicsResourceUser(f,t)}function i(c,f,l){f!==l&&(n(c,f),a(c,l))}function s(c){[...r.keys()].forEach(f=>c.unregisterGraphicsResourceUser(f,t))}t.buildPass=c=>{if(c){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");let f=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(f.getActiveCamera());let l=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),l&&!l.isDeleted()&&l!==e._openGLRenderWindow&&s(l),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(c,f)=>{c&&(e.currentRenderPass=f,t.render())},t.zBufferPass=c=>{c&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=c=>t.zBufferPass(c),t.opaquePass=c=>{c&&t.render()},t.getCoincidentParameters=(c,f)=>e.renderable.getResolveCoincidentTopology()==st.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{let c=e._openGLImageSlice.getRenderable(),f=e._openGLRenderer.getRenderable();t.renderPiece(f,c)},t.renderPiece=(c,f)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();let l=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let d=0;d<l;++d){let h=e.renderable.getInputData(d);h&&!h.isDeleted()&&e.currentValidInputs.push({imageData:h,inputIndex:d})}let u=e.currentValidInputs.length;if(u<=0){Cn("No input!");return}let p=e.currentValidInputs[0].imageData.getPointData().getScalars();e.multiTexturePerVolumeEnabled=u>1,e.numberOfComponents=e.multiTexturePerVolumeEnabled?u:p.getNumberOfComponents(),t.updateResliceGeometry(),t.renderPieceStart(c,f),t.renderPieceDraw(c,f),t.renderPieceFinish(c,f),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(c,f)=>{t.updateBufferObjects(c,f);let l=f.getProperties();e.currentValidInputs.forEach(d=>{let{inputIndex:h}=d,x=l[h].getInterpolationType(),T=e.scalarTextures[h];x===Ht.NEAREST?(T.setMinificationFilter(Z.NEAREST),T.setMagnificationFilter(Z.NEAREST)):(T.setMinificationFilter(Z.LINEAR),T.setMagnificationFilter(Z.LINEAR))});let u=e.currentValidInputs[0];l[u.inputIndex].getInterpolationType()===Ht.NEAREST?(e.colorTexture.setMinificationFilter(Z.NEAREST),e.colorTexture.setMagnificationFilter(Z.NEAREST),e.pwfTexture.setMinificationFilter(Z.NEAREST),e.pwfTexture.setMagnificationFilter(Z.NEAREST)):(e.colorTexture.setMinificationFilter(Z.LINEAR),e.colorTexture.setMagnificationFilter(Z.LINEAR),e.pwfTexture.setMinificationFilter(Z.LINEAR),e.pwfTexture.setMagnificationFilter(Z.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(c,f)=>{let l=e.context,u=[...e.scalarTextures,e.colorTexture,e.pwfTexture];u.forEach(g=>g.activate()),t.updateShaders(e.tris,c,f),l.drawArrays(l.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),u.forEach(g=>g.deactivate())},t.renderPieceFinish=(c,f)=>{},t.updateBufferObjects=(c,f)=>{t.getNeedToRebuildBufferObjects(c,f)&&t.buildBufferObjects(c,f)},t.getNeedToRebuildBufferObjects=(c,f)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<f.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<f.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.currentValidInputs.some(l=>{let{imageData:u}=l;return e.VBOBuildTime.getMTime()<u.getMTime()})||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(l=>!!l?.getHandle())||!e.colorTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(c,f)=>{let l=f.getProperties();e.currentValidInputs.forEach((V,b)=>{let{imageData:R}=V,M=R.getPointData().getScalars(),N=e._openGLRenderWindow.getGraphicsResourceForObject(M),L=na(R,M),B=!N?.oglObject?.getHandle()||N?.hash!==L,G=l[b],F=G.getUpdatedExtents(),_=!!F.length;if(B&&!_){let W=Ce.newInstance();W.setOpenGLRenderWindow(e._openGLRenderWindow);let H=R.getDimensions();W.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),W.resetFormatAndType(),W.create3DFilterableFromDataArray({width:H[0],height:H[1],depth:H[2],dataArray:M}),e._openGLRenderWindow.setGraphicsResourceForObject(M,W,L),e.scalarTextures[b]=W}else e.scalarTextures[b]=N.oglObject;if(_){G.setUpdatedExtents([]);let W=R.getDimensions();e.scalarTextures[b].create3DFilterableFromDataArray({width:W[0],height:W[1],depth:W[2],dataArray:M,updatedExtents:F})}i(e._openGLRenderWindow,e._scalarTexturesCore[b],M),e._scalarTexturesCore[b]=M});let u=e.currentValidInputs[0],g=l[u.inputIndex],p=g.getIndependentComponents(),d=p?e.numberOfComponents:1,h=p?2*d:1,v=[];for(let V=0;V<d;++V)v.push(g.getRGBTransferFunction(V));let x=Bt(v,p,d),T=g.getRGBTransferFunction(),m=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!m?.oglObject?.getHandle()||m?.hash!==x){let V=e.renderable.getColorTextureWidth();V<=0&&(V=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let b=V*h*3,R=new Uint8ClampedArray(b),M=Ce.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),T){let N=new Float32Array(V*3);for(let L=0;L<d;L++){let B=g.getRGBTransferFunction(L),G=B.getRange();if(B.getTable(G[0],G[1],V,N,1),p)for(let F=0;F<V*3;F++)R[L*V*6+F]=255*N[F],R[L*V*6+F+V*3]=255*N[F];else for(let F=0;F<V*3;F++)R[L*V*3+F]=255*N[F]}M.resetFormatAndType(),M.create2DFromRaw({width:V,height:h,numComps:3,dataType:ce.UNSIGNED_CHAR,data:R})}else{for(let N=0;N<V*3;++N){let L=255*N/((V-1)*3);for(let B=0;B<h;++B)R[B*V*3+N+0]=L,R[B*V*3+N+1]=L,R[B*V*3+N+2]=L}M.resetFormatAndType(),M.create2DFromRaw({width:V,height:1,numComps:3,dataType:ce.UNSIGNED_CHAR,data:R})}T&&e._openGLRenderWindow.setGraphicsResourceForObject(T,M,x),e.colorTexture=M}else e.colorTexture=m.oglObject;i(e._openGLRenderWindow,e._colorTextureCore,T),e._colorTextureCore=T;let S=[];for(let V=0;V<d;++V)S.push(g.getPiecewiseFunction(V));let C=Bt(S,p,d),E=g.getPiecewiseFunction(),O=e._openGLRenderWindow.getGraphicsResourceForObject(E);if(!O?.oglObject?.getHandle()||O?.hash!==C){let V=e.renderable.getOpacityTextureWidth();V<=0&&(V=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let b=V*h,R=new Uint8ClampedArray(b),M=Ce.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),E){let N=new Float32Array(b),L=new Float32Array(V);for(let B=0;B<d;++B){let G=g.getPiecewiseFunction(B);if(G===null)N.fill(1);else{let F=G.getRange();if(G.getTable(F[0],F[1],V,L,1),p)for(let _=0;_<V;_++)N[B*V*2+_]=L[_],N[B*V*2+_+V]=L[_];else for(let _=0;_<V;_++)N[_]=L[_]}}M.resetFormatAndType(),M.create2DFromRaw({width:V,height:h,numComps:1,dataType:ce.FLOAT,data:N})}else R.fill(255),M.resetFormatAndType(),M.create2DFromRaw({width:V,height:h,numComps:1,dataType:ce.UNSIGNED_CHAR,data:R});E&&e._openGLRenderWindow.setGraphicsResourceForObject(E,M,C),e.pwfTexture=M}else e.pwfTexture=O.oglObject;i(e._openGLRenderWindow,e._pwfTextureCore,E),e._pwfTextureCore=E;let k=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==k){let V=K.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});V.setName("points");let b=K.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),R={points:V,cellOffset:0};if(e.renderable.getSlabThickness()>0){let M=e.resliceGeom.getPointData().getNormals();M?R.normals=M:Cn("Slab mode requested without normals")}e.tris.getCABO().createVBO(b,"polys",_e.SURFACE,R)}e.VBOBuildString=k,e.VBOBuildTime.modified()},t.updateShaders=(c,f,l)=>{if(e.lastBoundBO=c,t.getNeedToRebuildShaders(c,f,l)){let u={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(u,f,l);let g=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(u.Vertex,u.Fragment,u.Geometry);g!==c.getProgram()&&(c.setProgram(g),c.getVAO().releaseGraphicsResources()),c.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(c.getProgram());c.getVAO().bind(),t.setMapperShaderParameters(c,f,l),t.setCameraShaderParameters(c,f,l),t.setPropertyShaderParameters(c,f,l)},t.setMapperShaderParameters=(c,f,l)=>{let u=c.getProgram(),g=e.currentValidInputs[0].imageData;if(c.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>c.getAttributeUpdateTime().getMTime()||c.getShaderSourceTime().getMTime()>c.getAttributeUpdateTime().getMTime())){e.scalarTextures.forEach((h,v)=>{u.setUniformi(`volumeTexture[${v}]`,h.getTextureUnit())}),u.isAttributeUsed("vertexWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"vertexWC",c.getCABO().getVertexOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Cn("Error setting vertexWC in shader VAO.")),u.isAttributeUsed("normalWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"normalWC",c.getCABO().getNormalOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Cn("Error setting normalWC in shader VAO.")),u.isUniformUsed("slabThickness")&&u.setUniformf("slabThickness",e.renderable.getSlabThickness()),u.isUniformUsed("spacing")&&u.setUniform3fv("spacing",g.getSpacing()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabTrapezoid")&&u.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());let d=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null;if(u.isUniformUsed("WCTCMatrix")){let h=g.getDimensions();D.copy(e.tmpMat4,g.getIndexToWorld()),D.translate(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),D.scale(e.tmpMat4,e.tmpMat4,h),D.invert(e.tmpMat4,e.tmpMat4),d&&D.multiply(e.tmpMat4,e.tmpMat4,d),u.setUniformMatrix("WCTCMatrix",e.tmpMat4)}u.isUniformUsed("vboScaling")&&u.setUniform3fv("vboScaling",c.getCABO().getCoordScale()??[1,1,1]),c.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&c.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),c.getProgram().isUniformUsed("coffset")){let p=t.getCoincidentParameters(f,l);c.getProgram().setUniformf("coffset",p.offset),c.getProgram().isUniformUsed("cfactor")&&c.getProgram().setUniformf("cfactor",p.factor)}},t.setCameraShaderParameters=(c,f,l)=>{let u=e._openGLCamera.getKeyMatrices(f),g=e._openGLImageSlice.getKeyMatrices(),d=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null,h=c.getProgram();h.isUniformUsed("MCPCMatrix")&&(D.identity(e.tmpMat4),h.setUniformMatrix("MCPCMatrix",Uh([u.wcpc,g.mcwc,d],D,e.tmpMat4))),h.isUniformUsed("MCVCMatrix")&&(D.identity(e.tmpMat4),h.setUniformMatrix("MCVCMatrix",Uh([u.wcvc,g.mcwc,d],D,e.tmpMat4)))},t.setPropertyShaderParameters=(c,f,l)=>{let u=c.getProgram(),g=l.getProperty(e.currentValidInputs[0].inputIndex),p=g.getOpacity();u.setUniformf("opacity",p);let d=e.numberOfComponents,h=g.getIndependentComponents();if(h)for(let T=0;T<d;++T)u.setUniformf(`mix${T}`,g.getComponentWeight(T));for(let T=0;T<d;T++){let m=e.multiTexturePerVolumeEnabled,y=m?T:0,S=m?0:T,E=e.scalarTextures[y].getVolumeInfo(),O=E.scale[S],U=E.offset[S],k=h?T:0,V=g.getColorWindow(),b=g.getColorLevel(),R=g.getRGBTransferFunction(k);if(R&&g.getUseLookupTableScalarRange()){let F=R.getRange();V=F[1]-F[0],b=.5*(F[1]+F[0])}let M=O/V,N=(U-b)/V+.5;u.setUniformf(`cshift${T}`,N),u.setUniformf(`cscale${T}`,M);let L=1,B=0,G=g.getPiecewiseFunction(k);if(G){let F=G.getRange(),_=F[1]-F[0],W=.5*(F[0]+F[1]);L=O/_,B=(U-W)/_+.5}u.setUniformf(`pwfshift${T}`,B),u.setUniformf(`pwfscale${T}`,L)}let v=e.colorTexture.getTextureUnit();u.setUniformi("colorTexture1",v);let x=e.pwfTexture.getTextureUnit();u.setUniformi("pwfTexture1",x),u.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(c,f,l)=>{let u=l.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents(),g=e.renderable.getSlabThickness(),p=e.renderable.getSlabType(),d=e.renderable.getSlabTrapezoidIntegration(),h=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(h=!0),h||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastNumberOfComponents!==e.numberOfComponents||e.lastMultiTexturePerVolumeEnabled!==e.multiTexturePerVolumeEnabled||c.getProgram()?.getHandle()===0||e.lastIndependentComponents!==u||e.lastSlabThickness!==g||e.lastSlabType!==p||e.lastSlabTrapezoidIntegration!==d?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastNumberOfComponents=e.numberOfComponents,e.lastMultiTexturePerVolumeEnabled=e.multiTexturePerVolumeEnabled,e.lastIndependentComponents=u,e.lastSlabThickness=g,e.lastSlabType=p,e.lastSlabTrapezoidIntegration=d,!0):!1},t.getShaderTemplate=(c,f,l)=>{c.Vertex=Fh,c.Fragment=kh,c.Geometry=""},t.replaceShaderValues=(c,f,l)=>{if(t.replaceShaderTCoord(c,f,l),t.replaceShaderPositionVC(c,f,l),e.haveSeenDepthRequest){let u=c.Fragment;u=z.substitute(u,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,u=z.substitute(u,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,c.Fragment=u}t.replaceShaderCoincidentOffset(c,f,l)},t.replaceShaderTCoord=(c,f,l)=>{let u=c.Vertex,g=c.Geometry,p=c.Fragment,d=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],h=e.renderable.getSlabThickness();u=z.substitute(u,"//VTK::TCoord::Dec",d).result;let v=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];u=z.substitute(u,"//VTK::TCoord::Impl",v).result;let x=e.numberOfComponents,T=l.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents(),m=["in vec3 fragTexCoord;",`uniform highp sampler3D volumeTexture[${e.scalarTextures.length}];`,"uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(m.push("vec4 rawSampleTexture(vec3 pos) {"),!e.multiTexturePerVolumeEnabled)m.push("return texture(volumeTexture[0], pos);","}");else{m.push("vec4 rawSample;");for(let S=0;S<e.scalarTextures.length;++S)m.push(`rawSample[${S}] = texture(volumeTexture[${S}], pos)[0];`);m.push("return rawSample;","}")}if(T){for(let S=1;S<x;S++)m=m.concat([`uniform float cshift${S};`,`uniform float cscale${S};`,`uniform float pwfshift${S};`,`uniform float pwfscale${S};`]);switch(x){case 1:m=m.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:m=m.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:m=m.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:m=m.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Cn("Unsupported number of independent coordinates.")}}h>0&&(m=m.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),m=m.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),p=z.substitute(p,"//VTK::TCoord::Dec",m).result;let y=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = rawSampleTexture(fragTexCoord);"];if(h>0&&(y=y.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),T){let S=["r","g","b","a"];for(let C=0;C<x;++C)y=y.concat([`vec3 tcolor${C} = texture2D(colorTexture1, vec2(tvalue.${S[C]} * cscale${C} + cshift${C}, height${C})).rgb;`,`float compWeight${C} = mix${C} * texture2D(pwfTexture1, vec2(tvalue.${S[C]} * pwfscale${C} + pwfshift${C}, height${C})).r;`]);switch(x){case 1:y=y.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:y=y.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Cn("Unsupported number of independent coordinates.")}}else switch(x){case 1:y=y.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:y=y.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}p=z.substitute(p,"//VTK::TCoord::Impl",y).result,c.Vertex=u,c.Fragment=p,c.Geometry=g},t.replaceShaderPositionVC=(c,f,l)=>{let u=c.Vertex,g=c.Geometry,p=c.Fragment,d=e.renderable.getSlabThickness(),h=["attribute vec4 vertexWC;"];h=h.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),d>0&&(h=h.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),u=z.substitute(u,"//VTK::PositionVC::Dec",h).result;let v=["gl_Position = MCPCMatrix * vertexWC;"];d>0&&(v=v.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),u=z.substitute(u,"//VTK::PositionVC::Impl",v).result,u=z.substitute(u,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let x=[];d>0&&(x=x.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),p=z.substitute(p,"//VTK::PositionVC::Dec",x).result,c.Vertex=u,c.Geometry=g,c.Fragment=p};function o(c){Xe.normalize(c);let f=[0,0,0];for(let l=0;l<3;++l){P.zero(f),f[l]=1;let u=Xe.dot(c,f);if(u<-.999999||u>.999999)return[!0,l]}return[!1,2]}t.updateResliceGeometry=()=>{let c="",f=e.currentValidInputs[0].imageData,l=f?.getBounds(),u=!0,g=2,p=e.renderable.getSlicePolyData(),d=e.renderable.getSlicePlane();if(p)c=c.concat(`PolyData${p.getMTime()}`);else if(d){c=c.concat(`Plane${d.getMTime()}`);let h=ee.create();f&&(c=c.concat(`Image${f.getMTime()}`),ee.set(h,...f.getDirection()),ee.invert(h,h));let v=[...d.getNormal()];P.transformMat3(v,v,h),[u,g]=o(v)}else{let h=Mt.newInstance();h.setNormal(0,0,1);let v=[0,1,0,1,0,1];f&&(v=l),h.setOrigin(v[0],v[2],.5*(v[5]+v[4])),e.renderable.setSlicePlane(h),c=c.concat(`Plane${d?.getMTime()}`),f&&(c=c.concat(`Image${f.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==c){if(p)e.resliceGeom||(e.resliceGeom=Re.newInstance()),e.resliceGeom.getPoints().setData(p.getPoints().getData(),3),e.resliceGeom.getPolys().setData(p.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(p.getPointData().getNormals());else if(d)if(u){let h=new Float32Array(12),v=f.worldToIndex(d.getOrigin(),[0,0,0]),x=[(g+1)%3,(g+2)%3].sort(),T=f.getSpatialExtent(),m=0;for(let O=0;O<2;++O)for(let U=0;U<2;++U)h[m+g]=v[g],h[m+x[0]]=T[2*x[0]+U],h[m+x[1]]=T[2*x[1]+O],m+=3;e.transform.setMatrix(f.getIndexToWorld()),e.transform.transformPoints(h,h);let y=new Uint16Array(8);y[0]=3,y[1]=0,y[2]=1,y[3]=3,y[4]=3,y[5]=0,y[6]=3,y[7]=2;let S=d.getNormal();Xe.normalize(S);let C=new Float32Array(12);for(let O=0;O<4;++O)C[3*O]=S[0],C[3*O+1]=S[1],C[3*O+2]=S[2];e.resliceGeom||(e.resliceGeom=Re.newInstance()),e.resliceGeom.getPoints().setData(h,3),e.resliceGeom.getPolys().setData(y,1);let E=K.newInstance({numberOfComponents:3,values:C,name:"Normals"});e.resliceGeom.getPointData().setNormals(E)}else{e.outlineFilter.setInputData(f),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(d),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=Re.newInstance());let h=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(h.getPoints().getData(),3),e.resliceGeom.getPolys().setData(h.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(h.getPointData().getNormals());let v=d.getNormal(),x=e.resliceGeom.getNumberOfPoints();Xe.normalize(v);let T=new Float32Array(x*3);for(let y=0;y<x;++y)T[3*y]=v[0],T[3*y+1]=v[1],T[3*y+2]=v[2];let m=K.newInstance({numberOfComponents:3,values:T,name:"Normals"});e.resliceGeom.getPointData().setNormals(m)}else Cn("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=c,e.resliceGeom?.modified()}},t.setScalarTextures=c=>{e.scalarTextures=[...c],e._externalOpenGLTexture=!0},t.delete=br(()=>{e._openGLRenderWindow&&s(e._openGLRenderWindow)},t.delete)}var XM={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastNumberOfComponents:0,lastMultiTexturePerVolumeEnabled:!1,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,scalarTextures:[],_scalarTexturesCore:[],colorTexture:null,_colorTextureCore:null,pwfTexture:null,_pwfTextureCore:null,_externalOpenGLTexture:!1,resliceGeom:null,resliceGeomUpdateString:null,tris:null};function YM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XM,r),Q.extend(t,e,r),ut.implementReplaceShaderCoincidentOffset(t,e,r),ut.implementBuildShadersWithReplacements(t,e,r),e.tris=rt.newInstance(),e.scalarTextures=[],e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},ae(e.VBOBuildTime),e.tmpMat4=D.identity(new Float64Array(16)),e.outlineFilter=Ch.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=Re.newInstance(),e.cutter=sh.newInstance(),e.lineToSurfaceFilter=nh.newInstance(),e.transform=Vh.newInstance(),Me(t,e,["scalarTextures"]),$M(t,e)}var qM=$(YM,"vtkOpenGLImageResliceMapper");Te("vtkImageResliceMapper",qM);var ZM={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5},ys={SlicingMode:ZM};var aa=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`;var ia=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;var{vtkErrorMacro:sa}=De,{SlicingMode:Dt}=ys;function QM(t){let e=t.split(`
`),r=[];for(let n=0;n<e.length;++n){let a=e[n].trim();a.length>0&&r.push(a)}return r}function JM(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function r(n){e.openGLTexture.releaseGraphicsResources(n),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray,e._labelOutlineOpacity].forEach(a=>n.unregisterGraphicsResourceUser(a,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");let a=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&r(a),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);let i=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(i.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(i.getActiveCamera())}},t.translucentPass=(n,a)=>{n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.getCoincidentParameters=(n,a)=>e.renderable.getResolveCoincidentTopology()==st.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{let n=e.openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,n)},t.getShaderTemplate=(n,a,i)=>{n.Vertex=aa,n.Fragment=ia,n.Geometry=""},t.replaceShaderValues=(n,a,i)=>{let s=n.Vertex,o=n.Fragment;s=z.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=z.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,s=z.substitute(s,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,s=z.substitute(s,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;let c=e.openGLTexture.getComponents(),f=i.getProperty().getIndependentComponents(),l=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(i.getProperty().getUseLabelOutline()&&(l=l.concat(["uniform sampler2D labelOutlineTexture1;","uniform sampler2D labelOutlineOpacityTexture1;"])),f){for(let g=1;g<c;g++)l=l.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:l=l.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:l=l.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:l=l.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:l=l.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:sa("Unsupported number of independent coordinates.")}}if(o=z.substitute(o,"//VTK::TCoord::Dec",l).result,i.getProperty().getUseLabelOutline()===!0&&(o=z.substitute(o,"//VTK::LabelOutline::Dec",["uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,o=z.substitute(o,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,o=z.substitute(o,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),f){let g=["r","g","b","a"],p=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let d=0;d<c;d++)p=p.concat([`vec3 tcolor${d} = mix${d} * texture2D(colorTexture1, vec2(tvalue.${g[d]} * cscale${d} + cshift${d}, height${d})).rgb;`,`float compWeight${d} = mix${d} * texture2D(pwfTexture1, vec2(tvalue.${g[d]} * pwfscale${d} + pwfshift${d}, height${d})).r;`]);switch(c){case 1:p=p.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:p=p.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:p=p.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:p=p.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:sa("Unsupported number of independent coordinates.")}o=z.substitute(o,"//VTK::TCoord::Impl",p).result}else switch(c){case 1:o=z.substitute(o,"//VTK::TCoord::Impl",[...QM(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  float outlineOpacity = texture2D(labelOutlineOpacityTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:o=z.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=z.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=z.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=z.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=z.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=s,n.Fragment=o,t.replaceShaderClip(n,a,i),t.replaceShaderCoincidentOffset(n,a,i)},t.replaceShaderClip=(n,a,i)=>{let s=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(le("OpenGL has a limit of 6 clipping planes"),c=6),s=z.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=z.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=z.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=z.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=s,n.Fragment=o},t.getNeedToRebuildShaders=(n,a,i)=>{let s=e.openGLTexture.getComponents(),o=i.getProperty().getIndependentComponents(),c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getProgram()?.getHandle()===0||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<i.getProperty().getMTime()||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.updateShaders=(n,a,i)=>{if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,a,i)){let s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,i);let o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,a,i),t.setCameraShaderParameters(n,a,i),t.setPropertyShaderParameters(n,a,i)},t.setMapperShaderParameters=(n,a,i)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||sa("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||sa("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());let s=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",s);let o=e.openGLTexture.getComponents(),c=i.getProperty().getIndependentComponents();if(c)for(let g=0;g<o;g++)n.getProgram().setUniformf(`mix${g}`,i.getProperty().getComponentWeight(g));let f=e.openGLTexture.getShiftAndScale();for(let g=0;g<o;g++){let p=i.getProperty().getColorWindow(),d=i.getProperty().getColorLevel(),h=c?g:0,v=i.getProperty().getRGBTransferFunction(h);if(v&&i.getProperty().getUseLookupTableScalarRange()){let m=v.getRange();p=m[1]-m[0],d=.5*(m[1]+m[0])}let x=f.scale/p,T=(f.shift-d)/p+.5;n.getProgram().setUniformf(`cshift${g}`,T),n.getProgram().setUniformf(`cscale${g}`,x)}for(let g=0;g<o;g++){let p=1,d=0,h=c?g:0,v=i.getProperty().getPiecewiseFunction(h);if(v){let x=v.getRange(),T=x[1]-x[0],m=.5*(x[0]+x[1]);p=f.scale/T,d=(f.shift-m)/T+.5}n.getProgram().setUniformf(`pwfshift${g}`,d),n.getProgram().setUniformf(`pwfscale${g}`,p)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){let g=t.getCoincidentParameters(a,i);n.getProgram().setUniformf("coffset",g.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",g.factor)}let l=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",l);let u=e.pwfTexture.getTextureUnit();if(n.getProgram().setUniformi("pwfTexture1",u),i.getProperty().getUseLabelOutline()){let g=e.labelOutlineThicknessTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineTexture1",g);let p=e.labelOutlineOpacityTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineOpacityTexture1",p)}if(e.renderable.getNumberOfClippingPlanes()){let g=e.renderable.getNumberOfClippingPlanes();g>6&&(le("OpenGL has a limit of 6 clipping planes"),g=6);let d=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,h=d?D.copy(e.imagematinv,i.getMatrix()):i.getMatrix();d&&(D.transpose(h,h),D.multiply(h,h,d),D.transpose(h,h)),D.transpose(e.imagemat,e.currentInput.getIndexToWorld()),D.multiply(e.imagematinv,h,e.imagemat);let v=[];for(let x=0;x<g;x++){let T=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,x,T);for(let m=0;m<4;m++)v.push(T[m])}n.getProgram().setUniformi("numClipPlanes",g),n.getProgram().setUniform4fv("clipPlanes",v)}},t.setCameraShaderParameters=(n,a,i)=>{let s=n.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,f=c.getIndexToWorld();D.multiply(e.imagemat,o.mcwc,f);let l=e.openGLCamera.getKeyMatrices(a);if(D.multiply(e.imagemat,l.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){let g=n.getCABO().getInverseShiftAndScaleMatrix();D.multiply(e.imagemat,e.imagemat,g)}if(s.setUniformMatrix("MCPCMatrix",e.imagemat),i.getProperty().getUseLabelOutline()===!0){let g=c.getWorldToIndex(),p=c.getDimensions(),d=e.renderable.getClosestIJKAxis().ijkMode;d===Dt.NONE&&(d=Dt.K),s.setUniform3i("imageDimensions",p[0],p[1],p[2]),s.setUniformi("sliceAxis",d),s.setUniformMatrix("vWCtoIDX",g);let h=e.openGLCamera.getKeyMatrices(a);D.invert(e.projectionToWorld,h.wcpc),e.openGLCamera.getKeyMatrices(a),s.setUniformMatrix("PCWCMatrix",e.projectionToWorld);let v=t.getRenderTargetSize();s.setUniformf("vpWidth",v[0]),s.setUniformf("vpHeight",v[1]);let x=t.getRenderTargetOffset();s.setUniformf("vpOffsetX",x[0]/v[0]),s.setUniformf("vpOffsetY",x[1]/v[1])}},t.setPropertyShaderParameters=(n,a,i)=>{let s=n.getProgram(),c=i.getProperty().getOpacity();s.setUniformf("opacity",c)},t.renderPieceStart=(n,a)=>{t.updateBufferObjects(n,a),e.lastBoundBO=null},t.renderPieceDraw=(n,a)=>{let i=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),a.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.activate(),e.labelOutlineOpacityTexture.activate()),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,a),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),a.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.deactivate(),e.labelOutlineOpacityTexture.deactivate()),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,a)=>{},t.renderPiece=(n,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){sa("No input!");return}t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=(n,a)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||a.getProperty().getUseLabelOutline()&&(!e.labelOutlineThicknessTexture?.getHandle()||!e.labelOutlineOpacityTexture?.getHandle())||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(n,a)=>{let i=e.currentInput;if(!i)return;let s=i.getPointData()&&i.getPointData().getScalars();if(!s)return;let o=s.getDataType(),c=s.getNumberOfComponents(),f=a.getProperty(),l=f.getInterpolationType(),u=f.getIndependentComponents(),g=u?c:1,p=u?2*g:1,d=[];for(let M=0;M<g;++M)d.push(f.getRGBTransferFunction(M));let h=Bt(d,u,g),v=f.getRGBTransferFunction(),x=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!x?.oglObject?.getHandle()||x?.hash!==h){e.colorTexture=Ce.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let M=e.renderable.getColorTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let N=M*p*3,L=new Uint8ClampedArray(N);if(l===Ht.NEAREST?(e.colorTexture.setMinificationFilter(Z.NEAREST),e.colorTexture.setMagnificationFilter(Z.NEAREST)):(e.colorTexture.setMinificationFilter(Z.LINEAR),e.colorTexture.setMagnificationFilter(Z.LINEAR)),v){let B=new Float32Array(M*3);for(let G=0;G<g;G++){let F=f.getRGBTransferFunction(G),_=F.getRange();if(F.getTable(_[0],_[1],M,B,1),u)for(let W=0;W<M*3;W++)L[G*M*6+W]=255*B[W],L[G*M*6+W+M*3]=255*B[W];else for(let W=0;W<M*3;W++)L[G*M*6+W]=255*B[W]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:M,height:p,numComps:3,dataType:ce.UNSIGNED_CHAR,data:L})}else{for(let B=0;B<M*3;++B)L[B]=255*B/((M-1)*3),L[B+1]=255*B/((M-1)*3),L[B+2]=255*B/((M-1)*3);e.colorTexture.create2DFromRaw({width:M,height:1,numComps:3,dataType:ce.UNSIGNED_CHAR,data:L})}v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.colorTexture,h),v!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=v)}else e.colorTexture=x.oglObject;let m=[];for(let M=0;M<g;++M)m.push(f.getPiecewiseFunction(M));let y=Bt(m,u,g),S=f.getPiecewiseFunction(),C=e._openGLRenderWindow.getGraphicsResourceForObject(S);if(!C?.oglObject?.getHandle()||C?.hash!==y){let M=e.renderable.getOpacityTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let N=M*p,L=new Uint8ClampedArray(N);if(e.pwfTexture=Ce.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),l===Ht.NEAREST?(e.pwfTexture.setMinificationFilter(Z.NEAREST),e.pwfTexture.setMagnificationFilter(Z.NEAREST)):(e.pwfTexture.setMinificationFilter(Z.LINEAR),e.pwfTexture.setMagnificationFilter(Z.LINEAR)),S){let B=new Float32Array(N),G=new Float32Array(M);for(let F=0;F<g;++F){let _=f.getPiecewiseFunction(F);if(_===null)B.fill(1);else{let W=_.getRange();if(_.getTable(W[0],W[1],M,G,1),u)for(let H=0;H<M;H++)B[F*M*2+H]=G[H],B[F*M*2+H+M]=G[H];else for(let H=0;H<M;H++)B[F*M*2+H]=G[H]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:M,height:p,numComps:1,dataType:ce.FLOAT,data:B})}else L.fill(255),e.pwfTexture.create2DFromRaw({width:M,height:1,numComps:1,dataType:ce.UNSIGNED_CHAR,data:L});S&&(e._openGLRenderWindow.setGraphicsResourceForObject(S,e.pwfTexture,y),S!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(S,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=S)}else e.pwfTexture=C.oglObject;a.getProperty().getUseLabelOutline()&&(t.updatelabelOutlineThicknessTexture(a),t.updateLabelOutlineOpacityTexture(a));let{ijkMode:O}=e.renderable.getClosestIJKAxis(),U=e.renderable.getSlice();O!==e.renderable.getSlicingMode()&&(U=e.renderable.getSliceAtPosition(U));let k=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(U),V=i.getExtent(),b;O===Dt.I&&(b=k-V[0]),O===Dt.J&&(b=k-V[2]),(O===Dt.K||O===Dt.NONE)&&(b=k-V[4]);let R=`${U}A${i.getMTime()}A${s.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${a.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==R){let M=i.getDimensions();e.openGLTexture||(e.openGLTexture=Ce.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),l===Ht.NEAREST?(new Set([1,3,4]).has(c)&&o===ce.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Z.NEAREST)):e.openGLTexture.setMinificationFilter(Z.NEAREST),e.openGLTexture.setMagnificationFilter(Z.NEAREST)):(c===4&&o===ce.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Z.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(Z.LINEAR),e.openGLTexture.setMagnificationFilter(Z.LINEAR)),e.openGLTexture.setWrapS(yn.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(yn.CLAMP_TO_EDGE);let N=M[0]*M[1]*c,L=new Float32Array(12),B=new Float32Array(8);for(let he=0;he<4;he++)B[he*2]=he%2?1:0,B[he*2+1]=he>1?1:0;let G=[Dt.X,Dt.Y,Dt.Z].includes(e.renderable.getSlicingMode())?U:k,F=i.getSpatialExtent(),_=s.getData(),W=null;if(O===Dt.I){W=new _.constructor(M[2]*M[1]*c);let he=0;for(let we=0;we<M[2];we++)for(let Oe=0;Oe<M[1];Oe++){let re=(b+Oe*M[0]+we*M[0]*M[1])*c;he=(we*M[1]+Oe)*c;let ne=re+c;for(;re<ne;)W[he++]=_[re++]}M[0]=M[1],M[1]=M[2],L[0]=G,L[1]=F[2],L[2]=F[4],L[3]=G,L[4]=F[3],L[5]=F[4],L[6]=G,L[7]=F[2],L[8]=F[5],L[9]=G,L[10]=F[3],L[11]=F[5]}else if(O===Dt.J){W=new _.constructor(M[2]*M[0]*c);let he=0;for(let we=0;we<M[2];we++)for(let Oe=0;Oe<M[0];Oe++){let re=(Oe+b*M[0]+we*M[0]*M[1])*c;he=(we*M[0]+Oe)*c;let ne=re+c;for(;re<ne;)W[he++]=_[re++]}M[1]=M[2],L[0]=F[0],L[1]=G,L[2]=F[4],L[3]=F[1],L[4]=G,L[5]=F[4],L[6]=F[0],L[7]=G,L[8]=F[5],L[9]=F[1],L[10]=G,L[11]=F[5]}else O===Dt.K||O===Dt.NONE?(W=_.subarray(b*N,(b+1)*N),L[0]=F[0],L[1]=F[2],L[2]=G,L[3]=F[1],L[4]=F[2],L[5]=G,L[6]=F[0],L[7]=F[3],L[8]=G,L[9]=F[1],L[10]=F[3],L[11]=G):sa("Reformat slicing not yet supported.");let H=s.getRanges();e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw({width:M[0],height:M[1],numComps:c,dataType:s.getDataType(),data:W,preferSizeOverAccuracy:!!e.renderable.getPreferSizeOverAccuracy?.(),ranges:H}),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();let I=K.newInstance({numberOfComponents:3,values:L});I.setName("points");let ve=K.newInstance({numberOfComponents:2,values:B});ve.setName("tcoords");let me=new Uint16Array(8);me[0]=3,me[1]=0,me[2]=1,me[3]=3,me[4]=3,me[5]=0,me[6]=3,me[7]=2;let ie=K.newInstance({numberOfComponents:1,values:me});e.tris.getCABO().createVBO(ie,"polys",_e.SURFACE,{points:I,tcoords:ve,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=R}},t.updateLabelOutlineOpacityTexture=n=>{let a=n.getProperty().getLabelOutlineOpacity();typeof a=="number"&&(e._cachedLabelOutlineOpacityObj?.[0]===a?a=e._cachedLabelOutlineOpacityObj:a=[a],e._cachedLabelOutlineOpacityObj=a);let i=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!i?.oglObject?.getHandle()||i?.hash!==s){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let f=1,l=c*f,u=new Float32Array(l);for(let g=0;g<c;++g)u[g]=a[g]??a[0];e.labelOutlineOpacityTexture=Ce.newInstance({resizable:!1}),e.labelOutlineOpacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineOpacityTexture.resetFormatAndType(),e.labelOutlineOpacityTexture.setMinificationFilter(Z.NEAREST),e.labelOutlineOpacityTexture.setMagnificationFilter(Z.NEAREST),e.labelOutlineOpacityTexture.create2DFromRaw({width:c,height:f,numComps:1,dataType:ce.FLOAT,data:u}),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineOpacityTexture,s),a!==e._labelOutlineOpacity&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineOpacity,t)),e._labelOutlineOpacity=a)}else e.labelOutlineOpacityTexture=i.oglObject},t.updatelabelOutlineThicknessTexture=n=>{let a=n.getProperty().getLabelOutlineThicknessByReference(),i=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!i?.oglObject?.getHandle()||i?.hash!==s){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let f=1,l=c*f,u=new Uint8Array(l);for(let g=0;g<c;++g){let p=typeof a[g]<"u"?a[g]:a[0];u[g]=p}e.labelOutlineThicknessTexture=Ce.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Z.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Z.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw({width:c,height:f,numComps:1,dataType:ce.UNSIGNED_CHAR,data:u}),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,s),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=i.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];let{usize:n,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,a]},t.getRenderTargetOffset=()=>{let{lowerLeftU:n,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,a]},t.delete=br(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}var eR={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineOpacityTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function tR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eR,r),Q.extend(t,e,r),ut.implementReplaceShaderCoincidentOffset(t,e,r),ut.implementBuildShadersWithReplacements(t,e,r),e.tris=rt.newInstance(),e.imagemat=D.identity(new Float64Array(16)),e.imagematinv=D.identity(new Float64Array(16)),e.projectionToWorld=D.identity(new Float64Array(16)),e.idxToView=D.identity(new Float64Array(16)),e.idxNormalMatrix=ee.identity(new Float64Array(9)),e.modelToView=D.identity(new Float64Array(16)),e.projectionToView=D.identity(new Float64Array(16)),ge(t,e,[]),e.VBOBuildTime={},ae(e.VBOBuildTime),JM(t,e)}var rR=$(tR,"vtkOpenGLImageMapper");Te("vtkAbstractImageMapper",rR);var zr={MAX:0,MIN:1,AVERAGE:2};var{vtkErrorMacro:Ts}=w;function nR(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function r(n){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>n.unregisterGraphicsResourceUser(a,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");let a=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&r(a),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(n,a)=>{n&&(e.currentRenderPass=a,t.render())},t.opaqueZBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(n,a)=>e.renderable.getResolveCoincidentTopology()===st.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{let n=e.openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,n)},t.renderPiece=(n,a)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a))},t.renderPieceStart=(n,a)=>{t.updateBufferObjects(n,a)},t.renderPieceDraw=(n,a)=>{let i=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,a),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,a)=>{},t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a),a.getProperty().getInterpolationType()===Ht.NEAREST?(e.volumeTexture.setMinificationFilter(Z.NEAREST),e.volumeTexture.setMagnificationFilter(Z.NEAREST),e.colorTexture.setMinificationFilter(Z.NEAREST),e.colorTexture.setMagnificationFilter(Z.NEAREST),e.pwfTexture.setMinificationFilter(Z.NEAREST),e.pwfTexture.setMagnificationFilter(Z.NEAREST)):(e.volumeTexture.setMinificationFilter(Z.LINEAR),e.volumeTexture.setMagnificationFilter(Z.LINEAR),e.colorTexture.setMinificationFilter(Z.LINEAR),e.colorTexture.setMagnificationFilter(Z.LINEAR),e.pwfTexture.setMinificationFilter(Z.LINEAR),e.pwfTexture.setMagnificationFilter(Z.LINEAR))},t.getNeedToRebuildBufferObjects=(n,a)=>{let i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentImageDataInput.getMTime()||i<e.currentCenterlineInput.getMTime()||!e.volumeTexture?.getHandle()},t.buildBufferObjects=(n,a)=>{let i=e.currentImageDataInput,s=e.currentCenterlineInput,o=a.getProperty(),c=i?.getPointData()?.getScalars();if(!c)return;let f=e._openGLRenderWindow.getGraphicsResourceForObject(c),l=na(i,c),u=!f?.oglObject?.getHandle()||f?.hash!==l,g=o.getUpdatedExtents(),p=!!g.length;if(u){e.volumeTexture=Ce.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let R=i.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray({width:R[0],height:R[1],depth:R[2],dataArray:c,preferSizeOverAccuracy:e.renderable.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(c,e.volumeTexture,l),c!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=c}else e.volumeTexture=f.oglObject;if(p){o.setUpdatedExtents([]);let R=i.getDimensions();e.volumeTexture.create3DFilterableFromDataArray({width:R[0],height:R[1],depth:R[2],dataArray:c,updatedExtents:g})}let d=c.getNumberOfComponents(),h=a.getProperty(),v=h.getIndependentComponents(),x=v?d:1,T=v?2*x:1,m=[];for(let R=0;R<x;++R)m.push(h.getRGBTransferFunction(R));let y=Bt(m,v,x),S=h.getRGBTransferFunction(),C=e._openGLRenderWindow.getGraphicsResourceForObject(S);if(!C?.oglObject?.getHandle()||C?.hash!==y){let R=e.renderable.getColorTextureWidth();R<=0&&(R=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let M=R*T*3,N=new Uint8ClampedArray(M);if(e.colorTexture=Ce.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),S){let L=new Float32Array(R*3);for(let B=0;B<x;B++){let G=h.getRGBTransferFunction(B),F=G.getRange();if(G.getTable(F[0],F[1],R,L,1),v)for(let _=0;_<R*3;_++)N[B*R*6+_]=255*L[_],N[B*R*6+_+R*3]=255*L[_];else for(let _=0;_<R*3;_++)N[B*R*6+_]=255*L[_]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:R,height:T,numComps:3,dataType:ce.UNSIGNED_CHAR,data:N})}else{for(let L=0;L<R*3;++L)N[L]=255*L/((R-1)*3),N[L+1]=255*L/((R-1)*3),N[L+2]=255*L/((R-1)*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:R,height:1,numComps:3,dataType:ce.UNSIGNED_CHAR,data:N})}S&&(e._openGLRenderWindow.setGraphicsResourceForObject(S,e.colorTexture,y),S!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(S,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=S)}else e.colorTexture=C.oglObject;let O=[];for(let R=0;R<x;++R)O.push(h.getPiecewiseFunction(R));let U=Bt(O,v,x),k=h.getPiecewiseFunction(),V=e._openGLRenderWindow.getGraphicsResourceForObject(k);if(!V?.oglObject?.getHandle()||V?.hash!==U){let R=e.renderable.getOpacityTextureWidth();R<=0&&(R=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let M=R*T,N=new Uint8ClampedArray(M);if(e.pwfTexture=Ce.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),k){let L=new Float32Array(M),B=new Float32Array(R);for(let G=0;G<x;++G){let F=h.getPiecewiseFunction(G);if(F===null)L.fill(1);else{let _=F.getRange();if(F.getTable(_[0],_[1],R,B,1),v)for(let W=0;W<R;W++)L[G*R*2+W]=B[W],L[G*R*2+W+R]=B[W];else for(let W=0;W<R;W++)L[G*R*2+W]=B[W]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:R,height:T,numComps:1,dataType:ce.FLOAT,data:L})}else N.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:R,height:1,numComps:1,dataType:ce.UNSIGNED_CHAR,data:N});k&&(e._openGLRenderWindow.setGraphicsResourceForObject(k,e.pwfTexture,U),k!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(k,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=k)}else e.pwfTexture=V.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()){let R=s.getNumberOfPoints(),M=R<=1?0:R-1,N=s.getDistancesToFirstPoint(),L=e.renderable.getHeight(),B=4*M,G=new Float32Array(3*B),F=e.renderable.getWidth();for(let ne=0,de=0;ne<M;++ne)G.set([0,L-N[ne],0],de),de+=3,G.set([F,L-N[ne],0],de),de+=3,G.set([F,L-N[ne+1],0],de),de+=3,G.set([0,L-N[ne+1],0],de),de+=3;let _=K.newInstance({numberOfComponents:3,values:G});_.setName("points");let W=new Uint16Array(5*M);for(let ne=0,de=0,ct=0;ne<M;++ne)W.set([4,ct+3,ct+2,ct+1,ct],de),de+=5,ct+=4;let H=K.newInstance({numberOfComponents:1,values:W}),I=s.getPoints(),ve=new Float32Array(3*B),me=new Array(3),ie=new Array(3);for(let ne=0,de=0;ne<M;++ne)I.getPoint(ne,me),I.getPoint(ne+1,ie),ve.set(me,de),de+=3,ve.set(me,de),de+=3,ve.set(ie,de),de+=3,ve.set(ie,de),de+=3;let he=K.newInstance({numberOfComponents:3,values:ve,name:"centerlinePosition"}),we=new Float32Array(B);for(let ne=0,de=0;ne<M;++ne)we.set([0,1,3,2],de),de+=4;let Oe=K.newInstance({numberOfComponents:1,values:we,name:"quadIndex"}),re=[he,Oe];if(!e.renderable.getUseUniformOrientation()){let ne=e.renderable.getOrientedCenterline().getOrientations()??[],de=new Float32Array(4*B),ct=new Float32Array(4*B);for(let gr=0;gr<M;++gr){let Zt=ne[gr],Go=ne[gr+1];for(let Ma=0;Ma<4;++Ma){let Ei=4*(Ma+4*gr);de.set(Zt,Ei),ct.set(Go,Ei)}}let No=K.newInstance({numberOfComponents:4,values:de,name:"centerlineTopOrientation"}),Bo=K.newInstance({numberOfComponents:4,values:ct,name:"centerlineBotOrientation"});re.push(No,Bo)}e.tris.getCABO().createVBO(H,"polys",_e.SURFACE,{points:_,customAttributes:re}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(n,a,i)=>{let s=e.volumeTexture.getComponents(),o=i.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),f=e.renderable.getUseUniformOrientation(),l=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return n.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==f||e.lastProjectionMode!==l||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=f,e.lastProjectionMode=l,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.buildShaders=(n,a,i)=>{t.getShaderTemplate(n,a,i),t.replaceShaderValues(n,a,i)},t.replaceShaderValues=(n,a,i)=>{let s=n.Vertex,o=n.Fragment,c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];s=z.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=z.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;let f=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],l=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(f.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),l&&f.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):f.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),s=z.substitute(s,"//VTK::Color::Dec",f).result;let g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),l&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),s=z.substitute(s,"//VTK::Color::Impl",g).result;let p=e.volumeTexture.getComponents(),d=i.getProperty().getIndependentComponents(),h=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];l&&h.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(h.push("in vec3 samplingDirVSOutput;"),l&&h.push("in vec3 projectionDirVSOutput;")):(h.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),l&&h.push("uniform vec3 bitangentDirection;"));let v=e.renderable.getCenterPoint();if(v&&h.push("uniform vec3 globalCenterPoint;"),d){for(let T=1;T<p;T++)h=h.concat([`uniform float cshift${T};`,`uniform float cscale${T};`,`uniform float pwfshift${T};`,`uniform float pwfscale${T};`]);switch(p){case 1:h=h.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:h=h.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:h=h.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:h=h.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Ts("Unsupported number of independent coordinates.")}}o=z.substitute(o,"//VTK::TCoord::Dec",h).result;let x=[];if(u?(x.push("vec3 samplingDirection = samplingDirVSOutput;"),l&&x.push("vec3 projectionDirection = projectionDirVSOutput;")):(x.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),l&&x.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),v?x.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):x.push("float horizontalOffset = quadOffsetVSOutput.x;"),x.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),l){let T=e.renderable.getProjectionMode();switch(T){case zr.MIN:x.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case zr.MAX:case zr.AVERAGE:default:x.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(x.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),T){case zr.MAX:x.push("  tvalue = max(tvalue, sampledTextureValue);");break;case zr.MIN:x.push("  tvalue = min(tvalue, sampledTextureValue);");break;case zr.AVERAGE:default:x.push("  tvalue = tvalue + sampledTextureValue;");break}x.push("}"),T===zr.AVERAGE&&x.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else x.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(d){let T=["r","g","b","a"];for(let m=0;m<p;++m)x=x.concat([`vec3 tcolor${m} = mix${m} * texture2D(colorTexture1, vec2(tvalue.${T[m]} * cscale${m} + cshift${m}, height${m})).rgb;`,`float compWeight${m} = mix${m} * texture2D(pwfTexture1, vec2(tvalue.${T[m]} * pwfscale${m} + pwfshift${m}, height${m})).r;`]);switch(p){case 1:x=x.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:x=x.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:x=x.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:x=x.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Ts("Unsupported number of independent coordinates.")}}else switch(p){case 1:x=x.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:x=x.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:x=x.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:x=x.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}o=z.substitute(o,"//VTK::TCoord::Impl",x).result,e.haveSeenDepthRequest&&(o=z.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=z.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=s,n.Fragment=o,t.replaceShaderClip(n,a,i),t.replaceShaderCoincidentOffset(n,a,i)},t.replaceShaderClip=(n,a,i)=>{let s=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(w.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),s=z.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=z.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=z.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=z.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=s,n.Fragment=o},t.getShaderTemplate=(n,a,i)=>{n.Vertex=aa,n.Fragment=ia,n.Geometry=""},t.setMapperShaderParameters=(n,a,i)=>{let s=n.getProgram(),o=n.getCABO();o.getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(s,o,"vertexMC",o.getVertexOffset(),o.getStride(),e.context.FLOAT,3,e.context.FALSE)||Ts("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(p=>{p&&s.isAttributeUsed(p.name)&&!n.getVAO().addAttributeArray(s,o,p.name,p.offset,o.getStride(),e.context.FLOAT,p.components,e.context.FALSE)&&Ts(`Error setting ${p.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());let c=e.volumeTexture.getTextureUnit();if(s.setUniformi("volumeTexture",c),s.setUniformf("width",e.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),s.isUniformUsed("tangentDirection")){let p=e.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",p)}if(s.isUniformUsed("bitangentDirection")){let p=e.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",p)}if(s.isUniformUsed("centerlineOrientation")){let p=e.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",p)}if(s.isUniformUsed("globalCenterPoint")){let p=e.renderable.getCenterPoint();s.setUniform3fArray("globalCenterPoint",p)}if(e.renderable.isProjectionEnabled()){let p=e.currentImageDataInput,d=p.getSpacing(),h=p.getDimensions(),v=e.renderable.getProjectionSlabThickness(),x=e.renderable.getProjectionSlabNumberOfSamples(),T=P.mul([],d,h);s.setUniform3fArray("volumeSizeMC",T),s.setUniformi("projectionSlabNumberOfSamples",x);let m=-.5*v;s.setUniformf("projectionConstantOffset",m);let y=v/(x-1);s.setUniformf("projectionStepLength",y)}let f=e.currentImageDataInput,l=f.getWorldToIndex(),u=D.fromScaling(new Float32Array(16),P.inverse([],f.getDimensions())),g=D.mul(u,u,l);if(s.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let p=e.renderable.getNumberOfClippingPlanes();p>6&&(w.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),p=6);let h=o.getCoordShiftAndScaleEnabled()?o.getInverseShiftAndScaleMatrix():null,v=h?D.copy(e.imagematinv,i.getMatrix()):i.getMatrix();h&&(D.transpose(v,v),D.multiply(v,v,h),D.transpose(v,v)),D.transpose(e.imagemat,e.currentImageDataInput.getIndexToWorld()),D.multiply(e.imagematinv,v,e.imagemat);let x=[];for(let T=0;T<p;T++){let m=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,T,m);for(let y=0;y<4;y++)x.push(m[y])}s.setUniformi("numClipPlanes",p),s.setUniform4fv("clipPlanes",x)}if(s.isUniformUsed("coffset")){let p=t.getCoincidentParameters(a,i);s.setUniformf("coffset",p.offset),s.isUniformUsed("cfactor")&&s.setUniformf("cfactor",p.factor)}},t.setCameraShaderParameters=(n,a,i)=>{let s=e.openGLImageSlice.getKeyMatrices().mcwc,o=e.openGLCamera.getKeyMatrices(a).wcpc;if(D.multiply(e.imagemat,o,s),n.getCABO().getCoordShiftAndScaleEnabled()){let c=n.getCABO().getInverseShiftAndScaleMatrix();D.multiply(e.imagemat,e.imagemat,c)}n.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(n,a,i)=>{let s=n.getProgram(),o=i.getProperty(),c=o.getOpacity();s.setUniformf("opacity",c);let f=e.volumeTexture.getComponents(),l=o.getIndependentComponents();if(l)for(let d=0;d<f;++d)s.setUniformf(`mix${d}`,o.getComponentWeight(d));let u=e.volumeTexture.getVolumeInfo();for(let d=0;d<f;d++){let h=o.getColorWindow(),v=o.getColorLevel(),x=l?d:0,T=o.getRGBTransferFunction(x);if(T&&o.getUseLookupTableScalarRange()){let S=T.getRange();h=S[1]-S[0],v=.5*(S[1]+S[0])}let m=u.scale[d]/h,y=(u.offset[d]-v)/h+.5;s.setUniformf(`cshift${d}`,y),s.setUniformf(`cscale${d}`,m)}let g=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",g);for(let d=0;d<f;d++){let h=1,v=0,x=l?d:0,T=o.getPiecewiseFunction(x);if(T){let m=T.getRange(),y=m[1]-m[0],S=.5*(m[0]+m[1]);h=u.scale[d]/y,v=(u.offset[d]-S)/y+.5}s.setUniformf(`pwfshift${d}`,v),s.setUniformf(`pwfscale${d}`,h)}let p=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",p)},t.updateShaders=(n,a,i)=>{if(t.getNeedToRebuildShaders(n,a,i)){let s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,i);let o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,a,i),t.setCameraShaderParameters(n,a,i),t.setPropertyShaderParameters(n,a,i)},t.delete=w.chain(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}var aR={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function Nh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aR,r),Q.extend(t,e,r),ut.implementReplaceShaderCoincidentOffset(t,e,r),w.algo(t,e,2,0),e.tris=rt.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=D.identity(new Float64Array(16)),e.imagematinv=D.identity(new Float64Array(16)),e.VBOBuildTime={},w.obj(e.VBOBuildTime,{mtime:0}),nR(t,e)}var Bh=w.newInstance(Nh,"vtkOpenGLImageCPRMapper"),iR={},I6={newInstance:Bh,extend:Nh,...iR};Te("vtkImageCPRMapper",Bh);function sR(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{r&&e.context.depthMask(!0)},t.translucentPass=(r,n)=>{e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(D.copy(e.keyMatrices.mcwc,e.renderable.getMatrix()),D.transpose(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}var oR={context:null,keyMatrixTime:null,keyMatrices:null};function cR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oR,r),Q.extend(t,e,r),e.keyMatrixTime={},ae(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:D.identity(new Float64Array(16))},ge(t,e,["context"]),sR(t,e)}var fR=$(cR,"vtkOpenGLImageSlice");Te("vtkImageSlice",fR);function uR(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=r=>{!e.renderable||!e.renderable.getVisibility()||r&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementVolumeCount()}},t.traverseVolumePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0].traverse(r),t.apply(r,!1))},t.volumePass=r=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),D.copy(e.MCWCMatrix,e.renderable.getMatrix()),D.transpose(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?ee.identity(e.normalMatrix):(ee.fromMat4(e.normalMatrix,e.MCWCMatrix),ee.invert(e.normalMatrix,e.normalMatrix),ee.transpose(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}var lR={};function gR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lR,r),Q.extend(t,e,r),e.keyMatrixTime={},ae(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),ge(t,e,["context"]),uR(t,e)}var pR=$(gR,"vtkOpenGLVolume");Te("vtkVolume",pR);var Ph=Kn(ki(),1);function hR(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{let n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}let n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{let n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}let n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=e.context;if(!a){le("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let i=a.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{le("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,a.framebufferTexture2D(a.FRAMEBUFFER,i,a.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=e.context;if(!n){le("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{le("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,a,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){let n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else le("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){let r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else le("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){le("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();let r=e.context,n=Ce.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(Z.LINEAR),n.setMagnificationFilter(Z.LINEAR),n.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:ce.UNSIGNED_CHAR,data:null}),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}var dR={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Gh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dR,r),ae(t,e),e.colorBuffers&&le("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],dr(t,e,["colorBuffers"]),hR(t,e)}var vR=$(Gh,"vtkFramebuffer"),Ar={newInstance:vR,extend:Gh};var cf={NEAREST:0,LINEAR:1,FAST_LINEAR:2},ff={FRACTIONAL:0,PROPORTIONAL:1},Ha={DEFAULT:0,ADDITIVE:1,COLORIZE:2,CUSTOM:3},mR={OFF:0,NORMALIZED:1,RAW:2},uf={InterpolationType:cf,OpacityMode:ff,ColorMixPreset:Ha,FilterMode:mR};var St={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},_h={BlendMode:St};var Wh=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`;var zh=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

const float infinity = 3.402823466e38;

// the output of this shader
//VTK::Output::Dec

in vec3 vertexVCVSOutput;

// From Sources\\Rendering\\Core\\VolumeProperty\\Constants.js
#define COMPOSITE_BLEND 0
#define MAXIMUM_INTENSITY_BLEND 1
#define MINIMUM_INTENSITY_BLEND 2
#define AVERAGE_INTENSITY_BLEND 3
#define ADDITIVE_INTENSITY_BLEND 4
#define RADON_TRANSFORM_BLEND 5
#define LABELMAP_EDGE_PROJECTION_BLEND 6

#define vtkNumberOfLights //VTK::NumberOfLights
#define vtkMaxLaoKernelSize //VTK::MaxLaoKernelSize
#define vtkNumberOfComponents //VTK::NumberOfComponents
#define vtkBlendMode //VTK::BlendMode
#define vtkMaximumNumberOfSamples //VTK::MaximumNumberOfSamples

//VTK::EnabledColorFunctions

//VTK::EnabledLightings

//VTK::EnabledMultiTexturePerVolume

//VTK::EnabledGradientOpacity

//VTK::EnabledIndependentComponents

//VTK::vtkProportionalComponents

//VTK::vtkForceNearestComponents

uniform int twoSidedLighting;

#if vtkMaxLaoKernelSize > 0
  vec2 kernelSample[vtkMaxLaoKernelSize];
#endif

// Textures
#ifdef EnabledMultiTexturePerVolume
  #define vtkNumberOfVolumeTextures vtkNumberOfComponents
#else
  #define vtkNumberOfVolumeTextures 1
#endif
uniform highp sampler3D volumeTexture[vtkNumberOfVolumeTextures];
uniform sampler2D colorTexture;
uniform sampler2D opacityTexture;
uniform sampler2D jtexture;
uniform sampler2D labelOutlineThicknessTexture;

struct Volume {
  // ---- Volume geometry settings ----

  vec3 originVC;          // in VC
  vec3 spacing;           // in VC per IC
  vec3 inverseSpacing;    // 1/spacing
  ivec3 dimensions;       // in IC
  vec3 inverseDimensions; // 1/vec3(dimensions)
  mat3 vecISToVCMatrix;   // convert from IS to VC without translation
  mat3 vecVCToISMatrix;   // convert from VC to IS without translation
  mat4 PCWCMatrix;
  mat4 worldToIndex;
  float diagonalLength; // in VC, this is: length(size)

  // ---- Texture settings ----

  // Texture shift and scale
  vec4 colorTextureScale;
  vec4 colorTextureShift;
  vec4 opacityTextureScale;
  vec4 opacityTextureShift;

  // The heights defined below are the locations for the up to four components
  // of the transfer functions. The transfer functions have a height of (2 *
  // numberOfComponents) pixels so the values are computed to hit the middle of
  // the two rows for that component
  vec4 transferFunctionsSampleHeight;

  // ---- Mode specific settings ----

  // Independent component default preset settings per component
  vec4 independentComponentMix;

  // Additive / average blending mode settings
  vec4 ipScalarRangeMin;
  vec4 ipScalarRangeMax;

  // ---- Rendering settings ----

  // Lighting
  float ambient;
  float diffuse;
  float specular;
  float specularPower;
  int computeNormalFromOpacity;

  // Gradient opacity
  vec4 gradientOpacityScale;
  vec4 gradientOpacityShift;
  vec4 gradientOpacityMin;
  vec4 gradientOpacityMax;

  // Volume shadow
  float volumetricScatteringBlending;
  float globalIlluminationReach;
  float anisotropy;
  float anisotropySquared;

  // LAO
  int kernelSize;
  int kernelRadius;

  // Label outline
  float outlineOpacity;
};
uniform Volume volume;

struct Light {
  vec3 color;
  vec3 positionVC;
  vec3 directionVC; // normalized
  vec3 halfAngleVC;
  vec3 attenuation;
  float exponent;
  float coneAngle;
  int isPositional;
};
#if vtkNumberOfLights > 0
  uniform Light lights[vtkNumberOfLights];
#endif

uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;

// Bitmasks for label outline
const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
#define MAX_SEGMENTS 256
#define UINT_SIZE 32
// We add UINT_SIZE - 1, as we want the ceil of the division instead of the
// floor
#define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)
uint labelOutlineBitmasks[BITMASK_SIZE];

// Set the corresponding bit in the bitmask
void setLabelOutlineBit(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  labelOutlineBitmasks[arrayIndex] |= 1u << bitIndex;
}

// Check if a bit is set in the bitmask
bool isLabelOutlineBitSet(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  return ((labelOutlineBitmasks[arrayIndex] & (1u << bitIndex)) != 0u);
}

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

//VTK::ClipPlane::Dec

// A random number between 0 and 1 that only depends on the fragment
// It uses the jtexture, so this random seed repeats by blocks of 32 fragments
// in screen space
float fragmentSeed;

// sample texture is global
uniform float sampleDistance;
uniform float volumeShadowSampleDistance;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics
// rendering module is complete)
vec3 rayDirVC;

#define INV4PI 0.0796
#define EPSILON 0.001
#define PI 3.1415
#define PI2 9.8696

vec4 rawSampleTexture(vec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    rawSample[0] = texture(volumeTexture[0], pos)[0];
  #if vtkNumberOfComponents > 1
    rawSample[1] = texture(volumeTexture[1], pos)[0];
  #endif
  #if vtkNumberOfComponents > 2
    rawSample[2] = texture(volumeTexture[2], pos)[0];
  #endif
  #if vtkNumberOfComponents > 3
    rawSample[3] = texture(volumeTexture[3], pos)[0];
  #endif
    return rawSample;
  #else
    return texture(volumeTexture[0], pos);
  #endif
}

vec4 rawFetchTexture(ivec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    #if vtkNumberOfComponents > 0
      rawSample[0] = texelFetch(volumeTexture[0], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 1
      rawSample[1] = texelFetch(volumeTexture[1], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 2
      rawSample[2] = texelFetch(volumeTexture[2], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 3
      rawSample[3] = texelFetch(volumeTexture[3], pos, 0)[0];
    #endif
    return rawSample;
  #else
    return texelFetch(volumeTexture[0], pos, 0);
  #endif
}

vec4 getTextureValue(vec3 pos) {
  vec4 tmp = rawSampleTexture(pos);

  // Force nearest
  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volume.dimensions)) + 0.5) *
                      volume.inverseDimensions;
    vec4 nearestValue = rawSampleTexture(nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  // Set alpha when using dependent components
  #ifndef EnabledIndependentComponents
    #if vtkNumberOfComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumberOfComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumberOfComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

// \`height\` is usually \`volume.transferFunctionsSampleHeight[component]\`
// when using independent component and \`0.5\` otherwise. Don't move the if
// statement in these function, as the callers usually already knows if it is
// using independent component or not
float getOpacityFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.opacityTextureScale[component] +
                       volume.opacityTextureShift[component];
  return texture2D(opacityTexture, vec2(scaledScalar, height)).r;
}
vec3 getColorFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.colorTextureScale[component] +
                       volume.colorTextureShift[component];
  return texture2D(colorTexture, vec2(scaledScalar, height)).rgb;
}

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
vec3 posIStoVC(vec3 posIS) {
  return volume.vecISToVCMatrix * posIS + volume.originVC;
}

// convert vector position from vc to idx
vec3 posVCtoIS(vec3 posVC) {
  return volume.vecVCToISMatrix * (posVC - volume.originVC);
}

// Rotate vector to view coordinate
vec3 vecISToVC(vec3 dirIS) {
  return volume.vecISToVCMatrix * dirIS;
}

// Rotate vector to idx coordinate
vec3 vecVCToIS(vec3 dirVC) {
  return volume.vecVCToISMatrix * dirVC;
}

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(float normalMag, int component) {
  float goscale = volume.gradientOpacityScale[component];
  float goshift = volume.gradientOpacityShift[component];
  float gomin = volume.gradientOpacityMin[component];
  float gomax = volume.gradientOpacityMax[component];
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

#ifdef vtkClippingPlanesOn
  bool isPointClipped(vec3 posVC) {
    for (int i = 0; i < clip_numPlanes; ++i) {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0) {
        return true;
      }
    }
    return false;
  }
#endif

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward
// difference

// The output normal is in VC
vec4 computeDensityNormal(vec3 opacityUCoords[2], float opacityTextureHeight,
                          float gradientOpacity, int component) {
  // Pass the scalars through the opacity functions
  vec4 opacityG;
  opacityG.x += getOpacityFromTexture(opacityUCoords[0].x, component,
                                      opacityTextureHeight);
  opacityG.y += getOpacityFromTexture(opacityUCoords[0].y, component,
                                      opacityTextureHeight);
  opacityG.z += getOpacityFromTexture(opacityUCoords[0].z, component,
                                      opacityTextureHeight);
  opacityG.x -= getOpacityFromTexture(opacityUCoords[1].x, component,
                                      opacityTextureHeight);
  opacityG.y -= getOpacityFromTexture(opacityUCoords[1].y, component,
                                      opacityTextureHeight);
  opacityG.z -= getOpacityFromTexture(opacityUCoords[1].z, component,
                                      opacityTextureHeight);

  // Divide by spacing and convert to VC
  opacityG.xyz *= gradientOpacity * volume.inverseSpacing;
  opacityG.w = length(opacityG.xyz);
  if (opacityG.w == 0.0) {
    return vec4(0.0);
  }

  // Normalize
  opacityG.xyz = normalize(vecISToVC(opacityG.xyz));

  return opacityG;
}

// The output normal is in VC
vec4 computeNormalForDensity(vec3 posIS, out vec3 scalarInterp[2],
                             const int opacityComponent) {
  vec3 offsetedPosIS;
  for (int axis = 0; axis < 3; ++axis) {
    // Positive direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] += volume.inverseDimensions[axis];
    scalarInterp[0][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[0][axis] = 0.0;
      }
    #endif

    // Negative direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] -= volume.inverseDimensions[axis];
    scalarInterp[1][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[1][axis] = 0.0;
      }
    #endif
  }

  vec4 result;
  result.xyz = (scalarInterp[0] - scalarInterp[1]) * volume.inverseSpacing;
  result.w = length(result.xyz);
  if (result.w == 0.0) {
    return vec4(0.0);
  }
  result.xyz = normalize(vecISToVC(result.xyz));
  return result;
}

vec4 fragCoordToPCPos(vec4 fragCoord) {
  return vec4((fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
              (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
              (fragCoord.z - 0.5) * 2.0, 1.0);
}

vec4 pcPosToWorldCoord(vec4 pcPos) {
  return volume.PCWCMatrix * pcPos;
}

vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  vec4 vertex = (worldCoord / worldCoord.w);

  vec3 index = (volume.worldToIndex * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) * volume.inverseDimensions;
}

vec3 fragCoordToWorld(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  return worldCoord.xyz;
}

//=======================================================================
// Compute the normals and gradient magnitudes for a position for independent
// components The output normals are in VC
mat4 computeMat4Normal(vec3 posIS, vec4 tValue) {
  vec3 xvec = vec3(volume.inverseDimensions.x, 0.0, 0.0);
  vec3 yvec = vec3(0.0, volume.inverseDimensions.y, 0.0);
  vec3 zvec = vec3(0.0, 0.0, volume.inverseDimensions.z);

  vec4 distX = getTextureValue(posIS + xvec) - getTextureValue(posIS - xvec);
  vec4 distY = getTextureValue(posIS + yvec) - getTextureValue(posIS - yvec);
  vec4 distZ = getTextureValue(posIS + zvec) - getTextureValue(posIS - zvec);

  // divide by spacing
  distX *= 0.5 * volume.inverseSpacing.x;
  distY *= 0.5 * volume.inverseSpacing.y;
  distZ *= 0.5 * volume.inverseSpacing.z;

  mat4 result;

  // optionally compute the 1st component
  #if vtkNumberOfComponents > 0 && !defined(vtkComponent0Proportional)
    {
      const int component = 0;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 2nd component
  #if vtkNumberOfComponents > 1 && !defined(vtkComponent1Proportional)
    {
      const int component = 1;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 3rd component
  #if vtkNumberOfComponents > 2 && !defined(vtkComponent2Proportional)
    {
      const int component = 2;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 4th component
  #if vtkNumberOfComponents > 3 && !defined(vtkComponent3Proportional)
    {
      const int component = 3;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  return result;
}

//=======================================================================
// global shadow - secondary ray

// henyey greenstein phase function
float phaseFunction(float cos_angle) {
  // divide by 2.0 instead of 4pi to increase intensity
  float anisotropy = volume.anisotropy;
  if (abs(anisotropy) <= EPSILON) {
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    return 0.5;
  }
  float anisotropy2 = volume.anisotropySquared;
  return ((1.0 - anisotropy2) /
          pow(1.0 + anisotropy2 - 2.0 * anisotropy * cos_angle, 1.5)) /
         2.0;
}

// Compute the two intersection distances of the ray with the volume in VC
// The entry point is \`rayOriginVC + distanceMin * rayDirVC\` and the exit point
// is \`rayOriginVC + distanceMax * rayDirVC\` If distanceMin < distanceMax, the
// volume is not intersected The ray origin is inside the box when distanceMin <
// 0.0 < distanceMax
vec2 rayIntersectVolumeDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  // Compute origin and direction in IS
  vec3 rayOriginIS = posVCtoIS(rayOriginVC);
  vec3 rayDirIS = vecVCToIS(rayDirVC);
  // Don't check for infinity as the min/max combination afterward will always
  // find an intersection before infinity
  vec3 invDir = 1.0 / rayDirIS;

  // We have: bound = origin + t * dir
  // So: t = (1/dir) * (bound - origin)
  vec3 distancesTo0 = invDir * (vec3(0.0) - rayOriginIS);
  vec3 distancesTo1 = invDir * (vec3(1.0) - rayOriginIS);
  // Min and max distances to plane intersection per plane
  vec3 dMinPerAxis = min(distancesTo0, distancesTo1);
  vec3 dMaxPerAxis = max(distancesTo0, distancesTo1);
  // Overall first and last intersection
  float distanceMin = max(dMinPerAxis.x, max(dMinPerAxis.y, dMinPerAxis.z));
  float distanceMax = min(dMaxPerAxis.x, min(dMaxPerAxis.y, dMaxPerAxis.z));
  return vec2(distanceMin, distanceMax);
}

//=======================================================================
// local ambient occlusion
#if vtkMaxLaoKernelSize > 0

  // Return a random point on the unit sphere
  vec3 sampleDirectionUniform(int rayIndex) {
    // Each ray of each fragment should be different, two sources of randomness
    // are used. Only depends on ray index
    vec2 rayRandomness = kernelSample[rayIndex];
    // Only depends on fragment
    float fragmentRandomness = fragmentSeed;
    // Merge both source of randomness in a single uniform random variable using
    // the formula (x+y < 1 ? x+y : x+y-1). The simpler formula (x+y)/2 doesn't
    // result in a uniform distribution
    vec2 mergedRandom = rayRandomness + vec2(fragmentRandomness);
    mergedRandom -= vec2(greaterThanEqual(mergedRandom, vec2(1.0)));

    // Insipred by:
    // https://karthikkaranth.me/blog/generating-random-points-in-a-sphere/#better-choice-of-spherical-coordinates
    float u = mergedRandom[0];
    float v = mergedRandom[1];
    float theta = u * 2.0 * PI;
    float phi = acos(2.0 * v - 1.0);
    float sinTheta = sin(theta);
    float cosTheta = cos(theta);
    float sinPhi = sin(phi);
    float cosPhi = cos(phi);
    return vec3(sinPhi * cosTheta, sinPhi * sinTheta, cosPhi);
  }

  float computeLAO(vec3 posVC, vec4 normalVC, float originalOpacity) {
    // apply LAO only at selected locations, otherwise return full brightness
    if (normalVC.w <= 0.0 || originalOpacity <= 0.05) {
      return 1.0;
    }

    #ifdef EnabledGradientOpacity
      float gradientOpacityFactor = computeGradientOpacityFactor(normalVC.w, 0);
    #endif

    float visibilitySum = 0.0;
    float weightSum = 0.0;
    for (int i = 0; i < volume.kernelSize; i++) {
      // Only sample on an hemisphere around the normalVC.xyz axis, so
      // normalDotRay should be negative
      vec3 rayDirectionVC = sampleDirectionUniform(i);
      float normalDotRay = dot(normalVC.xyz, rayDirectionVC);
      if (normalDotRay > 0.0) {
        // Flip rayDirectionVC when it is in the wrong hemisphere
        rayDirectionVC = -rayDirectionVC;
        normalDotRay = -normalDotRay;
      }

      vec3 currPosIS = posVCtoIS(posVC);
      float visibility = 1.0;
      vec3 randomDirStepIS = vecVCToIS(rayDirectionVC * sampleDistance);
      for (int j = 0; j < volume.kernelRadius; j++) {
        currPosIS += randomDirStepIS;
        // If out of the volume, we are done
        if (any(lessThan(currPosIS, vec3(0.0))) ||
            any(greaterThan(currPosIS, vec3(1.0)))) {
          break;
        }
        float opacity = getOpacityFromTexture(getTextureValue(currPosIS).r, 0, 0.5);
        #ifdef EnabledGradientOpacity
          opacity *= gradientOpacityFactor;
        #endif
        visibility *= 1.0 - opacity;
        // If visibility is less than EPSILON, consider it to be 0
        if (visibility < EPSILON) {
          visibility = 0.0;
          break;
        }
      }
      float rayWeight = -normalDotRay;
      visibilitySum += visibility * rayWeight;
      weightSum += rayWeight;
    }

    // If no sample, LAO factor is one
    if (weightSum == 0.0) {
      return 1.0;
    }

    // LAO factor is the average visibility:
    // - visibility low => ambient low
    // - visibility high => ambient high
    float lao = visibilitySum / weightSum;

    // Reduce variance by clamping
    return clamp(lao, 0.3, 1.0);
  }
#endif

//=======================================================================
// Volume shadows
#if vtkNumberOfLights > 0

  // Non-memoised version
  float computeVolumeShadowWithoutCache(vec3 posVC, vec3 lightDirNormVC) {
    // modify sample distance with a random number between 1.5 and 3.0
    float rayStepLength =
        volumeShadowSampleDistance * mix(1.5, 3.0, fragmentSeed);

    // in case the first sample near surface has a very tiled light ray, we need
    // to offset start position
    vec3 initialPosVC = posVC + rayStepLength * lightDirNormVC;

    #ifdef vtkClippingPlanesOn
      float clippingPlanesMaxDistance = infinity;
      for (int i = 0; i < clip_numPlanes; ++i) {
        // Find distance of intersection with the plane
        // Points are clipped when:
        // dot(planeOrigin - (rayOrigin + distance * rayDirection), planeNormal) > 0
        // This is equivalent to:
        // dot(planeOrigin - rayOrigin, planeNormal) - distance * dot(rayDirection,
        // planeNormal) > 0.0
        // We precompute the dot products, so we clip ray points when:
        // dotOrigin - distance * dotDirection > 0.0
        float dotOrigin =
            dot(vClipPlaneOrigins[i] - initialPosVC, vClipPlaneNormals[i]);
        if (dotOrigin > 0.0) {
          // The initialPosVC is clipped by this plane
          return 1.0;
        }
        float dotDirection = dot(lightDirNormVC, vClipPlaneNormals[i]);
        if (dotDirection < 0.0) {
          // We only hit the plane if dotDirection is negative, as (distance is
          // positive)
          float intersectionDistance =
              dotOrigin / dotDirection; // negative divided by negative => positive
          clippingPlanesMaxDistance =
              min(clippingPlanesMaxDistance, intersectionDistance);
        }
      }
    #endif

    vec2 intersectionDistances =
        rayIntersectVolumeDistances(initialPosVC, lightDirNormVC);

    if (intersectionDistances[1] <= intersectionDistances[0] ||
        intersectionDistances[1] <= 0.0) {
      // Volume not hit or behind the ray
      return 1.0;
    }

    // When globalIlluminationReach is 0, no sample at all
    // When globalIlluminationReach is 1, the ray will go through the whole
    // volume
    float maxTravelDistance = mix(0.0, volume.diagonalLength,
                                  volume.globalIlluminationReach);
    float startDistance = max(intersectionDistances[0], 0.0);
    float endDistance = min(intersectionDistances[1], startDistance + maxTravelDistance);
    #ifdef vtkClippingPlanesOn
      endDistance = min(endDistance, clippingPlanesMaxDistance);
    #endif
    if (endDistance - startDistance < 0.0) {
      return 1.0;
    }

    // These two variables are used to compute posIS, without having to call
    // VCtoIS at each step
    vec3 initialPosIS = posVCtoIS(initialPosVC);
    // The light dir is scaled and rotated, but not translated, as it is a
    // vector (w = 0)
    vec3 scaledLightDirIS = vecVCToIS(lightDirNormVC);

    float shadow = 1.0;
    for (float currentDistance = startDistance; currentDistance <= endDistance;
          currentDistance += rayStepLength) {
      vec3 posIS = initialPosIS + currentDistance * scaledLightDirIS;
      vec4 scalar = getTextureValue(posIS);
      float opacity = getOpacityFromTexture(scalar.r, 0, 0.5);
      #if defined(EnabledGradientOpacity) && !defined(EnabledIndependentComponents)
        vec3 scalarInterp[2];
        vec4 normal = computeNormalForDensity(posIS, scalarInterp, 3);
        float opacityFactor = computeGradientOpacityFactor(normal.w, 0);
        opacity *= opacityFactor;
      #endif
      shadow *= 1.0 - opacity;

      // Early termination if shadow coeff is near 0.0
      if (shadow < EPSILON) {
        return 0.0;
      }
    }
    return shadow;
  }

  // Some cache for volume shadows
  struct {
    vec3 posVC;
    float shadow;
  } cachedShadows[vtkNumberOfLights];

  // Memoised version
  float computeVolumeShadow(vec3 posVC, vec3 lightDirNormVC, int lightIdx) {
    if (posVC == cachedShadows[lightIdx].posVC) {
      return cachedShadows[lightIdx].shadow;
    }
    float shadow = computeVolumeShadowWithoutCache(posVC, lightDirNormVC);
    cachedShadows[lightIdx].posVC = posVC;
    cachedShadows[lightIdx].shadow = shadow;
    return shadow;
  }

#endif

//=======================================================================
// surface light contribution
#if vtkNumberOfLights > 0
  vec3 applyLighting(vec3 tColor, vec4 normalVC) {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      float df = dot(normalVC.xyz, lights[lightIdx].directionVC);
      if (df > 0.0) {
        diffuse += df * lights[lightIdx].color;
        float sf = dot(normalVC.xyz, -lights[lightIdx].halfAngleVC);
        if (sf > 0.0) {
          specular += pow(sf, volume.specularPower) * lights[lightIdx].color;
        }
      }
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient) +
          specular * volume.specular;
  }

  vec3 applySurfaceShadowLighting(vec3 tColor, float alpha, vec3 posVC,
                                  vec4 normalVC) {
    // everything in VC
    vec3 diffuse = vec3(0.0);
    vec3 specular = vec3(0.0);
    for (int ligthIdx = 0; ligthIdx < vtkNumberOfLights; ligthIdx++) {
      vec3 vertLightDirection;
      float attenuation;
      if (lights[ligthIdx].isPositional == 1) {
        vertLightDirection = posVC - lights[ligthIdx].positionVC;
        float lightDistance = length(vertLightDirection);
        // Normalize with precomputed length
        vertLightDirection = vertLightDirection / lightDistance;
        // Base attenuation
        vec3 attenuationPolynom = lights[ligthIdx].attenuation;
        attenuation =
            1.0 / (attenuationPolynom[0] +
                  lightDistance * (attenuationPolynom[1] +
                                    lightDistance * attenuationPolynom[2]));
        // Cone attenuation
        float coneDot = dot(vertLightDirection, lights[ligthIdx].directionVC);
        // Per OpenGL standard cone angle is 90 or less for a spot light
        if (lights[ligthIdx].coneAngle <= 90.0) {
          if (coneDot >= cos(radians(lights[ligthIdx].coneAngle))) {
            // Inside the cone
            attenuation *= pow(coneDot, lights[ligthIdx].exponent);
          } else {
            // Outside the cone
            attenuation = 0.0;
          }
        }
      } else {
        vertLightDirection = lights[ligthIdx].directionVC;
        attenuation = 1.0;
      }

      float ndotL = dot(normalVC.xyz, vertLightDirection);
      if (ndotL < 0.0 && twoSidedLighting == 1) {
        ndotL = -ndotL;
      }
      if (ndotL > 0.0) {
        // Diffuse
        diffuse += ndotL * attenuation * lights[ligthIdx].color;
        // Specular
        float vdotR =
            dot(-rayDirVC, normalize(vertLightDirection - 2.0 * ndotL * normalVC.xyz));
        if (vdotR > 0.0) {
          specular += pow(vdotR, volume.specularPower) * attenuation *
                      lights[ligthIdx].color;
        }
      }
    }
    #if vtkMaxLaoKernelSize > 0
      float laoFactor = computeLAO(posVC, normalVC, alpha);
    #else
      const float laoFactor = 1.0;
    #endif
    return tColor * (diffuse * volume.diffuse +
                    volume.ambient * laoFactor) +
          specular * volume.specular;
  }

  vec3 applyVolumeShadowLighting(vec3 tColor, vec3 posVC) {
    // Here we have no effect of cones and no attenuation
    vec3 diffuse = vec3(0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      vec3 lightDirVC = lights[lightIdx].isPositional == 1
                            ? normalize(lights[lightIdx].positionVC - posVC)
                            : -lights[lightIdx].directionVC;
      float shadowCoeff = computeVolumeShadow(posVC, lightDirVC, lightIdx);
      float phaseAttenuation = phaseFunction(dot(rayDirVC, lightDirVC));
      diffuse += phaseAttenuation * shadowCoeff * lights[lightIdx].color;
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient);
  }
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posVC,
                       vec4 surfaceNormalVC) {
  #if vtkNumberOfLights > 0
    // 0 <= volCoeff < EPSILON => only surface shadows
    // EPSILON <= volCoeff < 1 - EPSILON => mix of surface and volume shadows
    // 1 - EPSILON <= volCoeff => only volume shadows
    float volCoeff = volume.volumetricScatteringBlending *
                    (1.0 - alpha / 2.0) *
                    (1.0 - atan(surfaceNormalVC.w) * INV4PI);

    // Compute surface lighting if needed
    vec3 surfaceShadedColor = tColor;
    #ifdef EnableSurfaceLighting
      if (volCoeff < 1.0 - EPSILON) {
        surfaceShadedColor =
            applySurfaceShadowLighting(tColor, alpha, posVC, surfaceNormalVC);
      }
    #endif

    // Compute volume lighting if needed
    vec3 volumeShadedColor = tColor;
    #ifdef EnableVolumeLighting
      if (volCoeff >= EPSILON) {
        volumeShadedColor = applyVolumeShadowLighting(tColor, posVC);
      }
    #endif

    // Return the right mix
    if (volCoeff < EPSILON) {
      // Surface shadows
      return surfaceShadedColor;
    }
    if (volCoeff >= 1.0 - EPSILON) {
      // Volume shadows
      return volumeShadedColor;
    }
    // Mix of surface and volume shadows
    return mix(surfaceShadedColor, volumeShadedColor, volCoeff);
  #endif
  return tColor;
}

vec4 getColorForLabelOutline() {
  vec3 centerPosIS =
      fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = vec4(getColorFromTexture(centerValue.r, 0, 0.5),
                     getOpacityFromTexture(centerValue.r, 0, 0.5));

  int segmentIndex = int(centerValue.r * 255.0);

  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue =
      texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;
  int actualThickness = int(textureValue * 255.0);

  // If it is the background (segment index 0), we should quickly bail out.
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0) {
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't
  // invisible. Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord =
          vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j),
               gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = volume.outlineOpacity;
  }

  return tColor;
}

vec4 getColorForAdditivePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLights[2];
  normalLights[0] = normalMat[0];
  normalLights[1] = normalMat[1];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      for (int component = 0; component < 2; ++component) {
        vec3 scalarInterp[2];
        float height = volume.transferFunctionsSampleHeight[component];
        computeNormalForDensity(posIS, scalarInterp, component);
        normalLights[component] =
            computeDensityNormal(scalarInterp, height, 1.0, component);
      }
    }
  #endif

  // compute opacities
  float opacities[2];
  opacities[0] = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  opacities[1] = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);
  #ifdef EnabledGradientOpacity
    for (int component = 0; component < 2; ++component) {
      opacities[component] *=
          computeGradientOpacityFactor(normalMat[component].a, component);
    }
  #endif
  float opacitySum = opacities[0] + opacities[1];
  if (opacitySum <= 0.0) {
    return vec4(0.0);
  }

  // mix the colors and opacities
  vec3 colors[2];
  for (int component = 0; component < 2; ++component) {
    float sampleHeight = volume.transferFunctionsSampleHeight[component];
    vec3 color = getColorFromTexture(tValue[component], component, sampleHeight);
    color = applyAllLightning(color, opacities[component], posVC,
                              normalLights[component]);
    colors[component] = color;
  }
  vec3 mixedColor =
      (opacities[0] * colors[0] + opacities[1] * colors[1]) / opacitySum;
  return vec4(mixedColor, min(1.0, opacitySum));
}

vec4 getColorForColorizePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLight = normalMat[0];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      vec3 scalarInterp[2];
      float height = volume.transferFunctionsSampleHeight[0];
      computeNormalForDensity(posIS, scalarInterp, 0);
      normalLight = computeDensityNormal(scalarInterp, height, 1.0, 0);
    }
  #endif

  // compute opacities
  float opacity = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  #ifdef EnabledGradientOpacity
    opacity *= computeGradientOpacityFactor(normalMat[0].a, 0);
  #endif

  // colorizing component
  vec3 colorizingColor = getColorFromTexture(
      tValue[0], 1, volume.transferFunctionsSampleHeight[1]);
  float colorizingOpacity = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);

  // mix the colors and opacities
  vec3 color =
      getColorFromTexture(tValue[0], 0,
                          volume.transferFunctionsSampleHeight[0]) *
      mix(vec3(1.0), colorizingColor, colorizingOpacity);
  color = applyAllLightning(color, opacity, posVC, normalLight);
  return vec4(color, opacity);
}

vec4 getColorForDefaultIndependentPreset(vec4 tValue, vec3 posIS) {

  // compute the normal vectors as needed
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    mat4 normalMat = computeMat4Normal(posIS, tValue);
  #endif

  // process color and opacity for each component
  // initial value of alpha is determined by wether the first component is
  // proportional or not
  #if defined(vtkComponent0Proportional)
    // when it is proportional, it starts at 1 (neutral for multiplications)
    float alpha = 1.0;
  #else
    // when it is not proportional, it starts at 0 (neutral for additions)
    float alpha = 0.0;
  #endif

  vec3 mixedColor = vec3(0.0);
  #if vtkNumberOfComponents > 0
    {
      const int component = 0;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent0Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 1
    {
      const int component = 1;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent1Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 2
    {
      const int component = 2;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent2Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 3
    {
      const int component = 3;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent3Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif

  return vec4(mixedColor, alpha);
}

vec4 getColorForDependentComponents(vec4 tValue, vec3 posVC, vec3 posIS) {
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    // use component 3 of the opacity texture as getTextureValue() sets alpha to
    // the opacity value
    vec3 scalarInterp[2];
    vec4 normal0 = computeNormalForDensity(posIS, scalarInterp, 3);
    float gradientOpacity = computeGradientOpacityFactor(normal0.a, 0);
  #endif

  // get color and opacity
  #if vtkNumberOfComponents == 1
    vec3 tColor = getColorFromTexture(tValue.r, 0, 0.5);
    float alpha = getOpacityFromTexture(tValue.r, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 2
    vec3 tColor = vec3(tValue.r * volume.colorTextureScale[0] +
                  volume.colorTextureShift[0]);
    float alpha = getOpacityFromTexture(tValue.a, 1, 0.5);
  #endif
  #if vtkNumberOfComponents == 3
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 4
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 3, 0.5);
  #endif

  // Apply gradient opacity
  #if defined(EnabledGradientOpacity)
    alpha *= gradientOpacity;
  #endif

  #if vtkNumberOfComponents == 1
    if (alpha < EPSILON) {
      return vec4(0.0);
    }
  #endif

  // lighting
  #if vtkNumberOfLights > 0
    vec4 normalLight;
    if (volume.computeNormalFromOpacity == 1) {
      if (normal0[3] != 0.0) {
        normalLight =
            computeDensityNormal(scalarInterp, 0.5, gradientOpacity, 0);
        if (normalLight[3] == 0.0) {
          normalLight = normal0;
        }
      }
    } else {
      normalLight = normal0;
    }
    tColor = applyAllLightning(tColor, alpha, posVC, normalLight);
  #endif

  return vec4(tColor, alpha);
}

vec4 getColorForValue(vec4 tValue, vec3 posVC, vec3 posIS) {
  #ifdef EnableColorForValueFunctionId0
    return getColorForDependentComponents(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId1
    return getColorForAdditivePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId2
    return getColorForColorizePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId3
    /*
      * Mix the color information from all the independent components to get a
      * single rgba output. See other shader functions like
      * \`getColorForAdditivePreset\` to learn how to create a custom color mix.
      * The custom color mix should return a value, but if it doesn't, it will
      * fallback on the default shading
      */
    //VTK::CustomColorMix
  #endif

  #if defined(EnableColorForValueFunctionId4) || defined(EnableColorForValueFunctionId3)
    return getColorForDefaultIndependentPreset(tValue, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId5
    return getColorForLabelOutline();
  #endif
}

bool valueWithinScalarRange(vec4 val) {
  #if vtkNumberOfComponents > 1 && !defined(EnabledIndependentComponents)
    return false;
  #endif
  vec4 rangeMin = volume.ipScalarRangeMin;
  vec4 rangeMax = volume.ipScalarRangeMax;
  for (int component = 0; component < vtkNumberOfComponents; ++component) {
    if (val[component] < rangeMin[component] ||
        rangeMax[component] < val[component]) {
      return false;
    }
  }
  return true;
}

#if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
  bool checkOnEdgeForNeighbor(int xFragmentOffset, int yFragmentOffset,
                              int segmentIndex, vec3 stepIS) {
    vec3 volumeDimensions = vec3(volume.dimensions);
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(xFragmentOffset),
                                  gl_FragCoord.y + float(yFragmentOffset),
                                  gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    vec3 neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS += stepIS;
    }

    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS -= stepIS;
    }

    // onedge
    float sampleHeight = volume.transferFunctionsSampleHeight[1];
    vec3 tColorSegment =
        getColorFromTexture(float(segmentIndex), 1, sampleHeight);
    float pwfValueSegment =
        getOpacityFromTexture(float(segmentIndex), 1, sampleHeight);
    gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
    return true;
  }
#endif

vec4 getColorAtPos(vec3 posVC) {
  vec3 posIS = posVCtoIS(posVC);
  vec4 texValue = getTextureValue(posIS);
  return getColorForValue(texValue, posVC, posIS);
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 rayOriginVC, vec3 rayDirVC, float minDistance,
                float maxDistance) {
  // start slightly inside and apply some jitter
  vec3 stepVC = rayDirVC * sampleDistance;
  float raySteps = (maxDistance - minDistance) / sampleDistance;

  // Avoid 0.0 jitter
  float jitter = 0.01 + 0.99 * fragmentSeed;

  #if vtkBlendMode == COMPOSITE_BLEND
    // now map through opacity and color
    vec3 firstPosVC = rayOriginVC + minDistance * rayDirVC;
    vec4 firstColor = getColorAtPos(firstPosVC);

    // handle very thin volumes
    if (raySteps <= 1.0) {
      firstColor.a = 1.0 - pow(1.0 - firstColor.a, raySteps);
      gl_FragData[0] = firstColor;
      return;
    }

    // first color only counts for \`jitter\` factor of the step
    firstColor.a = 1.0 - pow(1.0 - firstColor.a, jitter);
    vec4 color = vec4(firstColor.rgb * firstColor.a, firstColor.a);
    vec3 posVC = firstPosVC + jitter * stepVC;
    float stepsTraveled = jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }
      vec4 tColor = getColorAtPos(posVC);

      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * (1.0 - color.a);
      stepsTraveled++;
      posVC += stepVC;
      if (color.a > 0.99) {
        color.a = 1.0;
        break;
      }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0) {
      vec3 endPosVC = rayOriginVC + maxDistance * rayDirVC;
      vec4 tColor = getColorAtPos(endPosVC);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * mix;
    }

    gl_FragData[0] = vec4(color.rgb / color.a, color.a);
  #endif

  #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND ||                                 \\
      vtkBlendMode == MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND
      #define OP max
    #else
      #define OP min
    #endif

    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // Find a value to initialize the selected variables
    vec4 selectedValue;
    vec3 selectedPosVC;
    vec3 selectedPosIS;
    {
      vec3 posIS = posVCtoIS(posVC);
      selectedValue = getTextureValue(posIS);
      selectedPosVC = posVC;
      selectedPosIS = posIS;
    }

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // Get selected values
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    {
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }
    }

    gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
  #endif

  #if vtkBlendMode == ADDITIVE_INTENSITY_BLEND ||                                \\
      vtkBlendMode == AVERAGE_INTENSITY_BLEND
    vec4 sum = vec4(0.);
    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      float totalWeight = 0.0;
    #endif
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    vec3 posIS = posVCtoIS(posVC);
    vec4 value = getTextureValue(posIS);

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(value * raySteps, posVC, posIS);
      return;
    }

    if (valueWithinScalarRange(value)) {
      sum += value * jitter;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += jitter;
      #endif
    }
    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      posIS = posVCtoIS(posVC);
      value = getTextureValue(posIS);
      // One can control the scalar range by setting the AverageIPScalarRange to
      // disregard scalar values, not in the range of interest, from the average
      // computation. Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(value)) {
        sum += value;
        #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
          totalWeight++;
        #endif
      }

      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    posIS = posVCtoIS(posVC);
    value = getTextureValue(posIS);
    if (valueWithinScalarRange(value)) {
      sum += value;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += raySteps - stepsTraveled;
      #endif
    }

    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      sum /= vec4(totalWeight, totalWeight, totalWeight, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posVC, posIS);
  #endif

  #if vtkBlendMode == RADON_TRANSFORM_BLEND
    float normalizedRayIntensity = 1.0;
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // handle very thin volumes
    if (raySteps <= 1.0) {
      vec3 posIS = posVCtoIS(posVC);
      vec4 tValue = getTextureValue(posIS);
      normalizedRayIntensity -= raySteps * sampleDistance *
                                getOpacityFromTexture(tValue.r, 0, 0.5);
      gl_FragData[0] =
          vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      vec3 posIS = posVCtoIS(posVC);
      vec4 value = getTextureValue(posIS);
      // Convert scalar value to normalizedRayIntensity coefficient and
      // accumulate normalizedRayIntensity
      normalizedRayIntensity -=
          sampleDistance * getOpacityFromTexture(value.r, 0, 0.5);

      posVC += stepVC;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] =
        vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
  #endif

  #if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
    // Only works with a single volume
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;
    vec3 posIS = posVCtoIS(posVC);
    vec4 tValue = getTextureValue(posIS);
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(tValue, posVC, posIS);
      return;
    }

    vec3 stepIS = vecVCToIS(stepVC);
    vec4 value = tValue;
    posIS += jitter * stepIS;
    stepsTraveled += jitter;
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the
      // segment index and later check if the bit is set via bit operations
      setLabelOutlineBit(segmentIndex);
    }

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setLabelOutlineBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value = tValue;   // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = posVCtoIS(rayOriginVC + maxDistance * rayDirVC);
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue;   // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      vec3 maxPosVC = posIStoVC(maxPosIS);
      gl_FragData[0] = getColorForValue(value, maxPosVC, maxPosIS);
      return;
    }

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    vec3 volumeSpacings = volume.spacing;
    float minVoxelSpacing =
        min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base =
        vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z,
                          gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z,
                          gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not
      // been seen by the center segment
      if (!isLabelOutlineBitSet(s)) {
        continue;
      }

      // Use texture sampling for outlineThickness so that we can have
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue =
          texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out
      // faster if we find the edge
      bool onEdge = checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s,
                                          stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety
      // of the all the fragments inside. i.e., this happens when we zoom out,
      if (minVoxelSpacing >
          (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }

      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
        for (int j = -actualThickness; j <= actualThickness; j++) {
          if (i == 0 && j == 0)
            continue; // Skip the center
          if (abs(i) == actualThickness && abs(j) == actualThickness)
            continue; // Skip corners
          if (checkOnEdgeForNeighbor(i, j, s, stepIS)) {
            return;
          }
        }
      }
    }

    float sampleHeight = volume.transferFunctionsSampleHeight[0];
    vec3 tColor0 = getColorFromTexture(value.r, 0, sampleHeight);
    float pwfValue0 = getOpacityFromTexture(value.r, 0, sampleHeight);
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  vec2 dists = rayIntersectVolumeDistances(rayOriginVC, rayDirVC);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0, dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick / rayDirVC.z;
  dists.y = min(farDist, dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

float getFragmentSeed() {
  // This first noise has a diagonal pattern
  float firstNoise =
      fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);
  // This second noise is made out of blocks of CPU generated noise
  float secondNoise = texture2D(jtexture, gl_FragCoord.xy / 32.0).r;
  // Combine the two sources of noise in a way that the distribution is uniform
  // in [0,1[
  float noiseSum = firstNoise + secondNoise;
  return noiseSum < 1.0 ? noiseSum : noiseSum - 1.0;
}

void main() {
  fragmentSeed = getFragmentSeed();

  if (cameraParallel == 1) {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 rayOriginVC = vertexVCVSOutput;
  vec2 rayStartEndDistancesVC = computeRayDistances(rayOriginVC, rayDirVC);
  if (rayStartEndDistancesVC[1] <= rayStartEndDistancesVC[0] ||
      rayStartEndDistancesVC[1] <= 0.0) {
    // Volume not hit or behind the ray
    discard;
  }

  // Perform the blending operation along the ray
  applyBlend(rayOriginVC, rayDirVC, rayStartEndDistancesVC[0], rayStartEndDistancesVC[1]);
}
`;var{vtkWarningMacro:xR,vtkErrorMacro:Ah}=De,yR={idxToView:D.identity(new Float64Array(16)),vecISToVCMatrix:ee.identity(new Float64Array(9)),modelToView:D.identity(new Float64Array(16)),projectionToView:D.identity(new Float64Array(16)),projectionToWorld:D.identity(new Float64Array(16))};function TR(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function r(f,l){let u=f.getIndependentComponents(),g=f.getColorMixPreset();return u&&l>=2||!!g}function n(f){return f.getUseLabelOutline()||e.renderable.getBlendMode()===St.LABELMAP_EDGE_PROJECTION_BLEND}let a=new Map;function i(f,l){if(!l)return;let g=(a.get(l)??0)-1;g<=0?(f.unregisterGraphicsResourceUser(l,t),a.delete(l)):a.set(l,g)}function s(f,l){if(!l)return;let u=a.get(l)??0,g=u+1;a.set(l,g),u<=0&&f.registerGraphicsResourceUser(l,t)}function o(f,l,u){l!==u&&(i(f,l),s(f,u))}function c(f){[...a.keys()].forEach(l=>f.unregisterGraphicsResourceUser(l,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(f,l)=>{if(f){let u=l.getZBufferTexture();u!==e.zBufferTexture&&(e.zBufferTexture=u)}},t.opaqueZBufferPass=(f,l)=>t.zBufferPass(f,l),t.volumePass=(f,l)=>{if(f){let u=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),u&&!u.isDeleted()&&u!==e._openGLRenderWindow&&c(u),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");let g=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");let p=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(p.getActiveCamera()),t.renderPiece(p,g)}},t.getShaderTemplate=(f,l,u)=>{f.Vertex=Wh,f.Fragment=zh,f.Geometry=""},t.replaceShaderValues=(f,l,u)=>{let g=f.Fragment;g=z.substitute(g,"//VTK::EnabledColorFunctions",`#define EnableColorForValueFunctionId${e.previousState.colorForValueFunctionId}`).result;let p=[];e.previousState.surfaceLightingEnabled&&p.push("Surface"),e.previousState.volumeLightingEnabled&&p.push("Volume"),g=z.substitute(g,"//VTK::EnabledLightings",p.map(h=>`#define Enable${h}Lighting`)).result,e.previousState.multiTexturePerVolumeEnabled&&(g=z.substitute(g,"//VTK::EnabledMultiTexturePerVolume","#define EnabledMultiTexturePerVolume").result),e.previousState.useIndependentComponents&&(g=z.substitute(g,"//VTK::EnabledIndependentComponents","#define EnabledIndependentComponents").result),e.previousState.gradientOpacityEnabled&&(g=z.substitute(g,"//VTK::EnabledGradientOpacity","#define EnabledGradientOpacity").result),g=z.substitute(g,"//VTK::vtkProportionalComponents",e.previousState.proportionalComponents.map(h=>`#define vtkComponent${h}Proportional`).join(`
`)).result,g=z.substitute(g,"//VTK::vtkForceNearestComponents",e.previousState.forceNearestComponents.map(h=>`#define vtkComponent${h}ForceNearest`).join(`
`)).result,e.previousState.hasZBufferTexture&&(g=z.substitute(g,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,g=z.substitute(g,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDirVC.z;","dists.y = min(zdepth,dists.y);"]).result),g=z.substitute(g,"//VTK::BlendMode",`${e.previousState.blendMode}`).result,g=z.substitute(g,"//VTK::NumberOfLights",`${e.previousState.numberOfLights}`).result,g=z.substitute(g,"//VTK::MaxLaoKernelSize",`${e.previousState.maxLaoKernelSize}`).result,g=z.substitute(g,"//VTK::NumberOfComponents",`${e.previousState.numberOfComponents}`).result,g=z.substitute(g,"//VTK::MaximumNumberOfSamples",`${e.previousState.maximumNumberOfSamples}`).result,f.Fragment=g;let d=e.previousState.numberOfClippingPlanes;d>0&&(g=z.substitute(g,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,g=z.substitute(g,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${d}; i++) {`,"  float rayDirRatio = dot(rayDirVC, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result),f.Fragment=g},t.getNeedToRebuildShaders=(f,l,u)=>{let g=!!e.zBufferTexture,p=e.currentValidInputs.length,d=e.numberOfLights,h=e.numberOfComponents,v=e.useIndependentComponents,x=u.getProperties(),T=e.currentValidInputs[0],m=x[T.inputIndex],y=p>1,S=T.imageData.getBounds(),C=se.getDiagonalLength(S),E=Math.ceil(C/t.getCurrentSampleDistance(l));E>e.renderable.getMaximumSamplesPerRay()&&xR(`The number of steps required ${E} is larger than the specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
Please either change the volumeMapper sampleDistance or its maximum number of samples.`);let O=v?h:1,U=!1;for(let I=0;I<O;++I)if(m.getUseGradientOpacity(I)){U=!0;break}let k=0,V=m.getLAOKernelSize();V>k&&m.getLocalAmbientOcclusion()&&m.getAmbient()>0&&(k=V);let b=e.renderable.getClippingPlanes().length,R=e.renderable.getViewSpecificProperties().OpenGL?.ShaderReplacements,M=e.currentRenderPass?.getShaderReplacement(),N=e.renderable.getBlendMode(),L=(()=>{if(N!==St.LABELMAP_EDGE_PROJECTION_BLEND&&n(m))return 5;if(v)switch(m.getColorMixPreset()){case Ha.ADDITIVE:return 1;case Ha.COLORIZE:return 2;case Ha.CUSTOM:return 3;default:return 4}return 0})(),B=m.getVolumetricScatteringBlending()<1,G=m.getVolumetricScatteringBlending()>0,F=!1;for(let I=0;I<h;++I)if(m.getForceNearestInterpolation(I)){F=!0;break}let _=[],W=[];for(let I=0;I<h;I++)m.getOpacityMode(I)===ff.PROPORTIONAL&&_.push(I),m.getForceNearestInterpolation(I)&&W.push(I);let H={numberOfComponents:h,useIndependentComponents:v,proportionalComponents:_,forceNearestComponents:W,blendMode:N,numberOfLights:d,numberOfValidInputs:p,maximumNumberOfSamples:E,hasZBufferTexture:g,maxLaoKernelSize:k,numberOfClippingPlanes:b,mapperShaderReplacements:R,renderPassShaderReplacements:M,colorForValueFunctionId:L,surfaceLightingEnabled:B,volumeLightingEnabled:G,forceNearestInterpolationEnabled:F,multiTexturePerVolumeEnabled:y,gradientOpacityEnabled:U};return f.getProgram()?.getHandle()===0||!e.previousState||!(0,Ph.default)(e.previousState,H)?(e.previousState=H,!0):!1},t.updateShaders=(f,l,u)=>{if(t.getNeedToRebuildShaders(f,l,u)){let g={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(g,l,u);let p=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(g.Vertex,g.Fragment,g.Geometry);p!==f.getProgram()&&(f.setProgram(p),f.getVAO().releaseGraphicsResources()),f.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(f.getProgram());f.getVAO().bind(),t.setMapperShaderParameters(f,l,u),t.setCameraShaderParameters(f,l,u),t.setPropertyShaderParameters(f,l,u),t.getClippingPlaneShaderParameters(f,l,u)},t.setMapperShaderParameters=(f,l,u)=>{let g=f.getProgram();f.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>f.getAttributeUpdateTime().getMTime()||f.getShaderSourceTime().getMTime()>f.getAttributeUpdateTime().getMTime())&&(g.isAttributeUsed("vertexDC")&&(f.getVAO().addAttributeArray(g,f.getCABO(),"vertexDC",f.getCABO().getVertexOffset(),f.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Ah("Error setting vertexDC in shader VAO.")),f.getAttributeUpdateTime().modified());let p=t.getCurrentSampleDistance(l);g.setUniformf("sampleDistance",p);let d=p*e.renderable.getVolumeShadowSamplingDistFactor();g.setUniformf("volumeShadowSampleDistance",d),e.scalarTextures.forEach((E,O)=>{g.setUniformi(`volumeTexture[${O}]`,E.getTextureUnit())});let h=u.getProperties(),v=e.currentValidInputs[0],T=h[v.inputIndex].getIpScalarRange(),m=new Float32Array(4),y=new Float32Array(4),S=(E,O,U)=>{O?.dataComputedScale?.length&&(m[E]=T[0]*O.dataComputedScale[U]+O.dataComputedOffset[U],y[E]=T[1]*O.dataComputedScale[U]+O.dataComputedOffset[U],m[E]=(m[E]-O.offset[U])/O.scale[U],y[E]=(y[E]-O.offset[U])/O.scale[U])};if(e.previousState.multiTexturePerVolumeEnabled)e.scalarTextures.forEach((E,O)=>{let U=E.getVolumeInfo();S(O,U,0)});else{let E=e.scalarTextures[0].getVolumeInfo();for(let O=0;O<4;++O)S(O,E,O)}let C="volume";if(g.setUniform4f(`${C}.ipScalarRangeMin`,m[0],m[1],m[2],m[3]),g.setUniform4f(`${C}.ipScalarRangeMax`,y[0],y[1],y[2],y[3]),e.zBufferTexture!==null){g.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());let E=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();g.setUniformf("vpZWidth",E[0]),g.setUniformf("vpZHeight",E[1])}},t.setCameraShaderParameters=(f,l,u)=>{let{idxToView:g,vecISToVCMatrix:p,modelToView:d,projectionToView:h,projectionToWorld:v}=yR,x=e.openGLCamera.getKeyMatrices(l),T=e.openGLVolume.getKeyMatrices();D.multiply(d,x.wcvc,T.mcwc);let m=f.getProgram(),y=e.openGLCamera.getRenderable(),S=y.getParallelProjection(),C=y.getClippingRange();m.setUniformf("camThick",C[1]-C[0]),m.setUniformf("camNear",C[0]),m.setUniformf("camFar",C[1]),m.setUniformi("cameraParallel",S);let E=e.currentValidInputs[0],O=E.imageData.getBounds(),k=se.getCorners(O,[]).map(re=>{if(P.transformMat4(re,re,d),!S){let ne=-C[0]/(re[2]*P.length(re));P.scale(re,re,ne)}return P.transformMat4(re,re,x.vcpc),re}),V=se.addPoints([...se.INIT_BOUNDS],k);m.setUniformf("dcxmin",V[0]),m.setUniformf("dcxmax",V[1]),m.setUniformf("dcymin",V[2]),m.setUniformf("dcymax",V[3]);let b=t.getRenderTargetSize();m.setUniformf("vpWidth",b[0]),m.setUniformf("vpHeight",b[1]);let R=t.getRenderTargetOffset();m.setUniformf("vpOffsetX",R[0]/b[0]),m.setUniformf("vpOffsetY",R[1]/b[1]),D.invert(h,x.vcpc),m.setUniformMatrix("PCVCMatrix",h),m.setUniformi("twoSidedLighting",l.getTwoSidedLighting());let M=new Array(2*e.previousState.maxLaoKernelSize);for(let re=0;re<e.previousState.maxLaoKernelSize;re++)M[re*2]=Math.random(),M[re*2+1]=Math.random();if(m.setUniform2fv("kernelSample",M),e.numberOfLights>0){let re=0;l.getLights().forEach(ne=>{if(ne.getSwitch()>0){let de=`lights[${re}]`,ct=ne.getColor(),No=ne.getIntensity(),Bo=P.scale([],ct,No);m.setUniform3fv(`${de}.color`,Bo);let gr=ne.getTransformedPosition();P.transformMat4(gr,gr,d),m.setUniform3fv(`${de}.positionVC`,gr);let Zt=[...ne.getDirection()];P.transformMat3(Zt,Zt,x.normalMatrix),P.normalize(Zt,Zt),m.setUniform3fv(`${de}.directionVC`,Zt);let Go=[-.5*Zt[0],-.5*Zt[1],-.5*(Zt[2]-1)];m.setUniform3fv(`${de}.halfAngleVC`,Go);let Ma=ne.getAttenuationValues();m.setUniform3fv(`${de}.attenuation`,Ma);let Ju=ne.getExponent();m.setUniformf(`${de}.exponent`,Ju);let Ei=ne.getConeAngle();m.setUniformf(`${de}.coneAngle`,Ei);let Gy=ne.getPositional();m.setUniformi(`${de}.isPositional`,Gy),re++}})}let N="volume",B=u.getProperties()[E.inputIndex],G=E.imageData,F=G.getSpatialExtent(),_=G.getSpacing(),W=G.getDimensions(),H=G.getIndexToWorld(),I=G.getWorldToIndex(),ve=G.getDirectionByReference();D.multiply(g,d,H),m.setUniform3fv(`${N}.spacing`,_);let me=P.inverse([],_);m.setUniform3fv(`${N}.inverseSpacing`,me),m.setUniform3iv(`${N}.dimensions`,W),m.setUniform3fv(`${N}.inverseDimensions`,P.inverse([],W)),m.setUniformMatrix(`${N}.worldToIndex`,I),p.fill(0);let ie=P.multiply(new Float64Array(3),W,_);p[0]=ie[0],p[4]=ie[1],p[8]=ie[2],ee.multiply(p,ve,p),ee.multiply(p,T.normalMatrix,p),ee.multiply(p,x.normalMatrix,p),m.setUniformMatrix3x3(`${N}.vecISToVCMatrix`,p),m.setUniformMatrix3x3(`${N}.vecVCToISMatrix`,ee.invert(new Float32Array(9),p));let he=P.fromValues(F[0],F[2],F[4]),we=P.transformMat4(new Float64Array(3),he,g);m.setUniform3fv(`${N}.originVC`,we);let Oe=P.length(ie);if(m.setUniformf(`${N}.diagonalLength`,Oe),n(B)){let re=y.getDistance();y.setClippingRange(re,re+.1);let ne=e.openGLCamera.getKeyMatrices(l);D.invert(v,ne.wcpc),y.setClippingRange(C[0],C[1]),e.openGLCamera.getKeyMatrices(l),m.setUniformMatrix(`${N}.PCWCMatrix`,v)}if(B.getVolumetricScatteringBlending()>0&&(m.setUniformf(`${N}.globalIlluminationReach`,B.getGlobalIlluminationReach()),m.setUniformf(`${N}.volumetricScatteringBlending`,B.getVolumetricScatteringBlending()),m.setUniformf(`${N}.anisotropy`,B.getAnisotropy()),m.setUniformf(`${N}.anisotropySquared`,B.getAnisotropy()**2)),B.getLocalAmbientOcclusion()&&B.getAmbient()>0){let re=B.getLAOKernelSize();m.setUniformi(`${N}.kernelSize`,re);let ne=B.getLAOKernelRadius();m.setUniformi(`${N}.kernelRadius`,ne)}else m.setUniformi(`${N}.kernelSize`,0)},t.setPropertyShaderParameters=(f,l,u)=>{let g=f.getProgram();g.setUniformi("jtexture",e.jitterTexture.getTextureUnit());let p=u.getProperties();g.setUniformi("labelOutlineThicknessTexture",e.labelOutlineThicknessTexture.getTextureUnit()),g.setUniformi("opacityTexture",e.opacityTexture.getTextureUnit()),g.setUniformi("colorTexture",e.colorTexture.getTextureUnit());let d="volume",h=e.currentValidInputs[0],v=p[h.inputIndex],x=e.previousState.numberOfComponents,T=e.previousState.useIndependentComponents;if(T){let k=new Float32Array(4);for(let R=0;R<x;R++)k[R]=v.getComponentWeight(R);g.setUniform4fv(`${d}.independentComponentMix`,k);let V=new Float32Array(4),b=1/x;for(let R=0;R<x;++R)V[R]=(R+.5)*b;g.setUniform4fv(`${d}.transferFunctionsSampleHeight`,V)}let m=e.colorForValueFunctionId;g.setUniformi(`${d}.colorForValueFunctionId`,m);let y=v.getComputeNormalFromOpacity();g.setUniformi(`${d}.computeNormalFromOpacity`,y);let S=new Float32Array(4),C=new Float32Array(4),E=new Float32Array(4),O=new Float32Array(4);for(let k=0;k<x;k++){let V=e.previousState.multiTexturePerVolumeEnabled,b=V?k:0,R=V?0:k,N=e.scalarTextures[b].getVolumeInfo(),L=T?k:0,B=N.scale[R],F=v.getRGBTransferFunction(L).getRange();S[k]=B/(F[1]-F[0]),C[k]=(N.offset[R]-F[0])/(F[1]-F[0]);let W=v.getScalarOpacity(L).getRange();E[k]=B/(W[1]-W[0]),O[k]=(N.offset[R]-W[0])/(W[1]-W[0])}if(g.setUniform4fv(`${d}.colorTextureScale`,S),g.setUniform4fv(`${d}.colorTextureShift`,C),g.setUniform4fv(`${d}.opacityTextureScale`,E),g.setUniform4fv(`${d}.opacityTextureShift`,O),e.previousState.gradientOpacityEnabled){let k=new Array(4),V=new Array(4),b=new Array(4),R=new Array(4);if(T)for(let M=0;M<x;++M){let N=e.previousState.multiTexturePerVolumeEnabled,L=N?M:0,B=N?0:M,_=e.scalarTextures[L].getVolumeInfo().scale[B];if(v.getUseGradientOpacity(M)){let H=[v.getGradientOpacityMinimumOpacity(M),v.getGradientOpacityMaximumOpacity(M)],I=[v.getGradientOpacityMinimumValue(M),v.getGradientOpacityMaximumValue(M)];b[M]=H[0],R[M]=H[1],k[M]=_*(H[1]-H[0])/(I[1]-I[0]),V[M]=-I[0]*(H[1]-H[0])/(I[1]-I[0])+H[0]}else b[M]=1,R[M]=1,k[M]=0,V[M]=1}else{let M=x-1,N=e.previousState.multiTexturePerVolumeEnabled,L=N?M:0,B=N?0:M,_=e.scalarTextures[L].getVolumeInfo().scale[B],W=[v.getGradientOpacityMinimumOpacity(0),v.getGradientOpacityMaximumOpacity(0)],H=[v.getGradientOpacityMinimumValue(0),v.getGradientOpacityMaximumValue(0)];b[0]=W[0],R[0]=W[1],k[0]=_*(W[1]-W[0])/(H[1]-H[0]),V[0]=-H[0]*(W[1]-W[0])/(H[1]-H[0])+W[0]}g.setUniform4f(`${d}.gradientOpacityScale`,k),g.setUniform4f(`${d}.gradientOpacityShift`,V),g.setUniform4f(`${d}.gradientOpacityMin`,b),g.setUniform4f(`${d}.gradientOpacityMax`,R)}let U=v.getLabelOutlineOpacity();if(g.setUniformf(`${d}.outlineOpacity`,U),e.numberOfLights>0){g.setUniformf(`${d}.ambient`,v.getAmbient()),g.setUniformf(`${d}.diffuse`,v.getDiffuse()),g.setUniformf(`${d}.specular`,v.getSpecular());let k=v.getSpecularPower();g.setUniformf(`${d}.specularPower`,k===0?1:k)}},t.getClippingPlaneShaderParameters=(f,l,u)=>{if(e.renderable.getClippingPlanes().length>0){let g=e.openGLCamera.getKeyMatrices(l),p=[],d=[],h=[],v=e.renderable.getClippingPlanes(),x=v.length;for(let m=0;m<x;++m){let y=v[m].getNormal(),S=v[m].getOrigin();P.transformMat3(y,y,g.normalMatrix),P.transformMat4(S,S,g.wcvc);let C=-1*P.dot(S,y);p.push(y[0]),p.push(y[1]),p.push(y[2]),d.push(C),h.push(S[0]),h.push(S[1]),h.push(S[2])}let T=f.getProgram();T.setUniform3fv("vClipPlaneNormals",p),T.setUniformfv("vClipPlaneDistances",d),T.setUniform3fv("vClipPlaneOrigins",h),T.setUniformi("clip_numPlanes",x)}},t.delete=br(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&c(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];let{usize:f,vsize:l}=e._openGLRenderer.getTiledSizeAndOrigin();return[f,l]},t.getRenderTargetOffset=()=>{let{lowerLeftU:f,lowerLeftV:l}=e._openGLRenderer.getTiledSizeAndOrigin();return[f,l]},t.getCurrentSampleDistance=f=>{let l=f.getVTKWindow().getInteractor(),u=e.renderable.getSampleDistance();if(l.isAnimating()){let g=e.renderable.getInteractionSampleDistanceFactor();return u*g}return u},t.renderPieceStart=(f,l)=>{let u=f.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,u.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=u.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){let p=u.getRecentAnimationFrameRate(),d=u.getDesiredUpdateRate()/p;(d>1.15||d<.85)&&(e._lastScale*=d),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){let p=e._openGLRenderWindow.getFramebufferSize(),d=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(d*p[0]),e._smallViewportHeight=Math.ceil(d*p[1]),e._smallViewportHeight>p[1]&&(e._smallViewportHeight=p[1]),e._smallViewportWidth>p[0]&&(e._smallViewportWidth=p[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(p[0],p[1]),e.framebuffer.populateFramebuffer();else{let v=e.framebuffer.getSize();(!v||v[0]!==p[0]||v[1]!==p[1])&&(e.framebuffer.create(p[0],p[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();let h=e.context;h.clearColor(0,0,0,0),h.colorMask(!0,!0,!0,!0),h.clear(h.COLOR_BUFFER_BIT),h.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/p[0],e._smallViewportHeight/p[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(f,l);let g=l.getProperties();e.currentValidInputs.forEach(p=>{let{inputIndex:d}=p,v=g[d].getInterpolationType(),x=e.scalarTextures[d];v===cf.NEAREST?(x.setMinificationFilter(Z.NEAREST),x.setMagnificationFilter(Z.NEAREST)):(x.setMinificationFilter(Z.LINEAR),x.setMagnificationFilter(Z.LINEAR))}),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(f,l)=>{let u=e.context,g=[...e.scalarTextures,e.colorTexture,e.opacityTexture,e.labelOutlineThicknessTexture,e.jitterTexture];g.forEach(p=>p.activate()),t.updateShaders(e.tris,f,l),u.drawArrays(u.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),g.forEach(p=>p.deactivate())},t.renderPieceFinish=(f,l)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");let d=e.copyShader;e.copyVAO=ra.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(d,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Ah("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);let u=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,u[0],u[1]);let g=e.framebuffer.getColorTexture();g.activate(),e.copyShader.setUniformi("texture",g.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);let p=e.context;p.blendFuncSeparate(p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),g.deactivate(),p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(f,l)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();let u=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let p=0;p<u;++p){let d=e.renderable.getInputData(p);d&&!d.isDeleted()&&e.currentValidInputs.push({imageData:d,inputIndex:p})}let g=0;if(e.currentValidInputs.length>0){let p=l.getProperties(),d=e.currentValidInputs[0],v=d.imageData.getPointData().getScalars(),x=p[d.inputIndex];x.getShade()&&e.renderable.getBlendMode()===St.COMPOSITE_BLEND&&f.getLights().forEach(y=>{y.getSwitch()>0&&g++});let T=e.currentValidInputs.length,m=T>1;e.numberOfComponents=m?T:v.getNumberOfComponents(),e.useIndependentComponents=r(x,e.numberOfComponents)}g!==e.numberOfLights&&(e.numberOfLights=g,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(f,l),t.renderPieceDraw(f,l),t.renderPieceFinish(f,l))},t.updateBufferObjects=(f,l)=>{t.getNeedToRebuildBufferObjects(f,l)&&t.buildBufferObjects(f,l)},t.getNeedToRebuildBufferObjects=(f,l)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<l.getMTime()||e.VBOBuildTime.getMTime()<l.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.currentValidInputs.some(u=>{let{imageData:g}=u;return e.VBOBuildTime.getMTime()<g.getMTime()})||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(u=>!!u?.getHandle())||!e.colorTexture?.getHandle()||!e.opacityTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()||!e.jitterTexture?.getHandle(),t.buildBufferObjects=(f,l)=>{if(!e.jitterTexture.getHandle()){let N=new Float32Array(1024);for(let L=0;L<1024;++L)N[L]=Math.random();e.jitterTexture.setMinificationFilter(Z.NEAREST),e.jitterTexture.setMagnificationFilter(Z.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:ce.FLOAT,data:N})}let u=l.getProperties(),g=e.currentValidInputs[0],p=u[g.inputIndex],d=e.numberOfComponents,h=e.useIndependentComponents,v=h?d:1,x=[];for(let N=0;N<v;++N)x.push(p.getScalarOpacity(N));let T=Bt(x,h,v),m=p.getScalarOpacity(),y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!y?.oglObject?.getHandle()||y.hash!==T){let N=Ce.newInstance();N.setOpenGLRenderWindow(e._openGLRenderWindow);let L=e.renderable.getOpacityTextureWidth();L<=0&&(L=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let B=L*2*v,G=new Float32Array(B),F=new Float32Array(L);for(let _=0;_<v;++_){let W=p.getScalarOpacity(_),H=t.getCurrentSampleDistance(f)/p.getScalarOpacityUnitDistance(_),I=W.getRange();W.getTable(I[0],I[1],L,F,1);for(let ve=0;ve<L;++ve)G[_*L*2+ve]=1-(1-F[ve])**H,G[_*L*2+ve+L]=G[_*L*2+ve]}if(N.resetFormatAndType(),N.setMinificationFilter(Z.LINEAR),N.setMagnificationFilter(Z.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))N.create2DFromRaw({width:L,height:2*v,numComps:1,dataType:ce.FLOAT,data:G});else{let _=new Uint8ClampedArray(B);for(let W=0;W<B;++W)_[W]=255*G[W];N.create2DFromRaw({width:L,height:2*v,numComps:1,dataType:ce.UNSIGNED_CHAR,data:_})}m&&e._openGLRenderWindow.setGraphicsResourceForObject(m,N,T),e.opacityTexture=N}else e.opacityTexture=y.oglObject;o(e._openGLRenderWindow,e._opacityTextureCore,m),e._opacityTextureCore=m;let C=[];for(let N=0;N<v;++N)C.push(p.getRGBTransferFunction(N));let E=Bt(C,h,v),O=p.getRGBTransferFunction(),U=e._openGLRenderWindow.getGraphicsResourceForObject(O);if(!U?.oglObject?.getHandle()||U?.hash!==E){let N=Ce.newInstance();N.setOpenGLRenderWindow(e._openGLRenderWindow);let L=e.renderable.getColorTextureWidth();L<=0&&(L=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let B=L*2*v*3,G=new Uint8ClampedArray(B),F=new Float32Array(L*3);for(let _=0;_<v;++_){let W=p.getRGBTransferFunction(_),H=W.getRange();W.getTable(H[0],H[1],L,F,1);for(let I=0;I<L*3;++I)G[_*L*6+I]=255*F[I],G[_*L*6+I+L*3]=255*F[I]}N.resetFormatAndType(),N.setMinificationFilter(Z.LINEAR),N.setMagnificationFilter(Z.LINEAR),N.create2DFromRaw({width:L,height:2*v,numComps:3,dataType:ce.UNSIGNED_CHAR,data:G}),e._openGLRenderWindow.setGraphicsResourceForObject(O,N,E),e.colorTexture=N}else e.colorTexture=U.oglObject;o(e._openGLRenderWindow,e._colorTextureCore,O),e._colorTextureCore=O,e.currentValidInputs.forEach((N,L)=>{let{imageData:B,inputIndex:G}=N,F=u[G],_=B.getPointData().getScalars(),W=e._openGLRenderWindow.getGraphicsResourceForObject(_),H=na(B,_),I=!W?.oglObject?.getHandle()||W?.hash!==H,ve=F.getUpdatedExtents(),me=!!ve.length;if(I&&!me){let ie=Ce.newInstance();ie.setOpenGLRenderWindow(e._openGLRenderWindow);let he=B.getDimensions();ie.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),ie.resetFormatAndType(),ie.create3DFilterableFromDataArray({width:he[0],height:he[1],depth:he[2],dataArray:_,preferSizeOverAccuracy:F.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(_,ie,H),e.scalarTextures[L]=ie}else e.scalarTextures[L]=W.oglObject;if(me){F.setUpdatedExtents([]);let ie=B.getDimensions();e.scalarTextures[L].create3DFilterableFromDataArray({width:ie[0],height:ie[1],depth:ie[2],dataArray:_,updatedExtents:ve})}o(e._openGLRenderWindow,e._scalarTexturesCore[L],_),e._scalarTexturesCore[L]=_});let V=p.getLabelOutlineThickness(),b=e._openGLRenderWindow.getGraphicsResourceForObject(V),R=V.join("-");if(!b?.oglObject?.getHandle()||b?.hash!==R){let N=Ce.newInstance();N.setOpenGLRenderWindow(e._openGLRenderWindow);let L=e.renderable.getLabelOutlineTextureWidth();L<=0&&(L=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));let B=1,G=L*B,F=new Uint8Array(G);for(let _=0;_<L;++_){let W=typeof V[_]<"u"?V[_]:V[0];F[_]=W}N.resetFormatAndType(),N.setMinificationFilter(Z.NEAREST),N.setMagnificationFilter(Z.NEAREST),N.create2DFromRaw({width:L,height:B,numComps:1,dataType:ce.UNSIGNED_CHAR,data:F}),V&&e._openGLRenderWindow.setGraphicsResourceForObject(V,N,R),e.labelOutlineThicknessTexture=N}else e.labelOutlineThicknessTexture=b.oglObject;if(o(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,V),e._labelOutlineThicknessTextureCore=V,!e.tris.getCABO().getElementCount()){let N=new Float32Array(12);for(let F=0;F<4;F++)N[F*3]=F%2*2-1,N[F*3+1]=F>1?1:-1,N[F*3+2]=-1;let L=new Uint16Array(8);L[0]=3,L[1]=0,L[2]=1,L[3]=3,L[4]=3,L[5]=0,L[6]=3,L[7]=2;let B=K.newInstance({numberOfComponents:3,values:N});B.setName("points");let G=K.newInstance({numberOfComponents:1,values:L});e.tris.getCABO().createVBO(G,"polys",_e.SURFACE,{points:B,cellOffset:0})}e.VBOBuildTime.modified()}}var SR={context:null,VBOBuildTime:null,scalarTextures:[],_scalarTexturesCore:[],opacityTexture:null,_opacityTextureCore:null,colorTexture:null,_colorTextureCore:null,labelOutlineThicknessTexture:null,_labelOutlineThicknessTextureCore:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,fullViewportTime:1,idxToView:null,vecISToVCMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function CR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SR,r),Q.extend(t,e,r),ut.implementBuildShadersWithReplacements(t,e,r),e.VBOBuildTime={},ae(e.VBOBuildTime,{mtime:0}),e.tris=rt.newInstance(),e.jitterTexture=Ce.newInstance(),e.jitterTexture.setWrapS(yn.REPEAT),e.jitterTexture.setWrapT(yn.REPEAT),e.framebuffer=Ar.newInstance(),ge(t,e,["context"]),TR(t,e)}var wR=$(CR,"vtkOpenGLVolumeMapper");Te("vtkVolumeMapper",wR);var{vtkDebugMacro:OR}=De;function ER(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");let a=e._openGLRenderer.getAspectRatio(),i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin(),o=null;if(e.renderable.getUseZValues()){let c=n.getZBufferTexture(),f=Math.floor(c.getWidth()),l=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();let g=n.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():OR("No framebuffer to save/restore");let p=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,p),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(f*l*4),u.viewport(0,0,f,l),u.readPixels(0,0,f,l,u.RGBA,u.UNSIGNED_BYTE,o)),g&&g.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),i,a,s,o)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}var MR={};function RR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MR,r),Q.extend(t,e,r),ER(t,e)}var DR=$(RR,"vtkOpenGLPixelSpaceCallbackMapper");Te("vtkPixelSpaceCallbackMapper",DR);var Hh=Object.create(null);function Ue(t,e){Hh[t]=e}function LR(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}var VR={};function Ih(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VR,r),e.overrides=Hh,ji.extend(t,e,r),LR(t,e)}var FR=w.newInstance(Ih,"vtkWebGPUViewNodeFactory"),jh={newInstance:FR,extend:Ih};function kR(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,a,i)=>{if(D.identity(r),e.renderable.getParallelProjection()){let s=e.renderable.getParallelScale(),o=s*n,c=s,f=(i[0]-1)*o,l=(i[0]+1)*o,u=(i[1]-1)*c,g=(i[1]+1)*c,p=1/(l-f),d=1/(g-u);r[0]=2*p,r[5]=2*d,r[10]=1/(a[1]-a[0]),r[12]=(l+f)*p,r[13]=(g+u)*d,r[14]=a[1]/(a[1]-a[0])}else{let s=Math.tan(Math.PI*e.renderable.getViewAngle()/360),o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*s,c=a[0]*s/n):(o=a[0]*s*n,c=a[0]*s);let f=(i[0]-1)*o,l=(i[0]+1)*o,u=(i[1]-1)*c,g=(i[1]+1)*c;r[0]=2*a[0]/(l-f),r[5]=2*a[0]/(g-u),r[12]=(f+l)/(l-f),r[13]=(u+g)/(g-u),r[10]=0,r[14]=a[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;let n=e.renderable.getClippingRangeByReference(),a=-n[0]/r;return a=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(a*(n[1]-n[0])),.5*a+.5},t.getKeyMatrices=r=>{let n=r.getRenderable(),a=r.getParent();if(Math.max(a.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){let i=e.renderable.getViewMatrix();D.copy(e.keyMatrices.normalMatrix,i),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,D.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),D.transpose(e.keyMatrices.wcvc,i);let s=r.getStabilizedCenterByReference();D.translate(e.keyMatrices.scvc,e.keyMatrices.wcvc,s);let o=r.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),D.multiply(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),D.invert(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}var bR={keyMatrixTime:null,keyMatrices:null};function UR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bR,r),Q.extend(t,e,r),e.keyMatrixTime={},w.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},w.setGet(t,e,["keyMatrixTime"]),kR(t,e)}var NR=w.newInstance(UR);Ue("vtkCamera",NR);function BR(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==r[a]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{let n=[];for(let a=0;a<e.bindables.length;a++){let i=e.bindables[a].getBindGroupLayoutEntry();i.binding=a,n.push(i)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let i=0;i<e.bindables.length;i++){let s=e.bindables[i].getBindGroupTime().getMTime();n=s>n?s:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;let a=[];for(let i=0;i<e.bindables.length;i++){let s=e.bindables[i].getBindGroupEntry();s.binding=i,a.push(s)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{let n=[],a=r.getBindGroupLayoutCount(e.label);for(let i=0;i<e.bindables.length;i++)n.push(e.bindables[i].getShaderCode(i,a));return n.join(`
`)}}var GR={device:null,handle:null,label:null};function Kh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GR,r),w.obj(t,e),e.bindables=[],e.bindGroupTime={},w.obj(e.bindGroupTime,{mtime:0}),w.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),w.setGet(t,e,["label","device","arrayInformation"]),BR(t,e)}var _R=w.newInstance(Kh),Ss={newInstance:_R,extend:Kh};function WR(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}var zR={device:null,handle:null};function $h(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zR,r),w.obj(t,e),w.get(t,e,["lastCameraMTime"]),w.setGet(t,e,["device","handle"]),WR(t,e)}var AR=w.newInstance($h,"vtkWebGPUShaderModule"),Xh={newInstance:AR,extend:$h};function PR(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Array.isArray(r)?r.join(`
`):r,i=!1;t.search(e)!==-1&&(i=!0);let s="";n&&(s="g");let o=new RegExp(e,s),c=t.replace(o,a);return{replace:i,result:c}}function HR(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{let n=r.getType(),a=r.getHash(),i=e._shaderModules.keys();for(let o=0;o<i.length;o++){let c=i[o];if(c.getHash()===a&&c.getType()===n)return e._shaderModules.get(c)}let s=Xh.newInstance();return s.initialize(e.device,r),e._shaderModules.set(r,s),s}}var IR={shaderModules:null,device:null,window:null};function Yh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IR,r),e._shaderModules=new Map,w.obj(t,e),w.setGet(t,e,["device","window"]),HR(t,e)}var jR=w.newInstance(Yh,"vtkWebGPUShaderCache"),J={newInstance:jR,extend:Yh,substitute:PR};function KR(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;let a=[];for(let i=0;i<e.layouts.length;i++)a.push(e.layouts[i].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let i=0;i<e.shaderDescriptions.length;i++){let s=e.shaderDescriptions[i],o=r.getShaderModule(s);s.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),s.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}var $R={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function qh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$R,r),ae(t,e),e.layouts=[],e.shaderDescriptions=[],Me(t,e,["handle","pipelineDescription"]),ge(t,e,["device","renderEncoder","topology","vertexState"]),KR(t,e)}var XR=$(qh,"vtkWebGPUPipeline"),Zh={newInstance:XR,extend:qh};function YR(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(a)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{let a=[],i=[];if(n&&a.push(n.getShaderCode()),r||e.builtinInputNames.length){let s=[];if(s.push(`struct ${e.type}Input
{`),r){let o=r.getOutputNamesByReference(),c=r.getOutputTypesByReference(),f=r.getOutputInterpolationsByReference();for(let l=0;l<o.length;l++)f[l]!==void 0?s.push(`  @location(${l}) @interpolate(${f[l]}) ${o[l]} : ${c[l]},`):s.push(`  @location(${l}) ${o[l]} : ${c[l]},`)}for(let o=0;o<e.builtinInputNames.length;o++)s.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);s.length>1&&(s.push("};"),i=s,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=J.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){let s=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?s.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):s.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)s.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);s.push("};"),i=i.concat(s),e.code=J.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=J.substitute(e.code,"//VTK::IOStructs::Dec",i).result}}var qR={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function Qh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qR,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],w.obj(t,e),w.setGet(t,e,["type","hash","code"]),w.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),YR(t,e)}var ZR=w.newInstance(Qh,"vtkWebGPUShaderDescription"),lf={newInstance:ZR,extend:Qh};var Jh={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function QR(t){return!t||t.length<6?0:t in Jh?Jh[t]:(le(`unknown format ${t}`),null)}function JR(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));let r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return le(`unknown format ${t}`),0;let a=5-n/2;return e*a}function eD(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function tD(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{le(`unknown format ${t}`);return}let r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){le(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function rD(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{le(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function nD(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function aD(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";le(`unknown format ${t}`)}}var Ne={getDetailsFromTextureFormat:QR,getByteStrideFromBufferFormat:JR,getNumberOfComponentsFromBufferFormat:eD,getNativeTypeFromBufferFormat:tD,getShaderTypeFromBufferFormat:rD,getByteStrideFromShaderFormat:nD,getNativeTypeFromShaderFormat:aD};function iD(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function sD(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",i=n;Array.isArray(i)||(i=[i]);for(let s=0;s<e.inputs.length;s++)if(iD(e.inputs[s].names,i)){if(e.inputs[s].buffer===r)return;e.inputs[s].buffer=r;return}e.inputs.push({buffer:r,stepMode:a,names:i}),e.inputs=e.inputs.sort((s,o)=>s.names[0]<o.names[0]?-1:s.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let a=0;a<e.inputs.length;a++)for(let i=0;i<e.inputs[a].names.length;i++){let s=e.inputs[a].buffer.getArrayInformation()[i],o=Ne.getShaderTypeFromBufferFormat(s.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[a].names[i]} : ${o}`,n++}return r},t.getVertexInputInformation=()=>{let r={};if(e.inputs.length){let n=[],a=0;for(let i=0;i<e.inputs.length;i++){let s=e.inputs[i].buffer,o={arrayStride:s.getStrideInBytes(),stepMode:e.inputs[i].stepMode,attributes:[]},c=s.getArrayInformation();for(let f=0;f<e.inputs[i].names.length;f++)o.attributes.push({shaderLocation:a,offset:c[f].offset,format:c[f].format}),a++;n.push(o)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}var oD={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function ed(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oD,r),ae(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],ge(t,e,["created","device","handle","indexBuffer"]),sD(t,e)}var cD=$(ed,"vtkWebGPUVertexInput"),td={newInstance:cD,extend:ed};var fD=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,uD=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function lD(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,a)=>{let i=lf.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),s=lf.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),o=n.getShaderDescriptions();o.push(i),o.push(s);let c=e.vertexShaderTemplate+e.fragmentShaderTemplate,f=new RegExp("//VTK::[^:]*::","g"),u=c.match(f).filter((g,p,d)=>d.indexOf(g)===p).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<u.length;g++){let p=u[g];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(r,n,a)}t.replaceShaderIOStructs(r,n,a)},t.replaceShaderIOStructs=(r,n,a)=>{let i=n.getShaderDescription("vertex");i.replaceShaderCode(null,a),n.getShaderDescription("fragment").replaceShaderCode(i)},t.replaceShaderRenderEncoder=(r,n,a)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,a)=>{if(!e.WebGPURenderer)return;let i=e.WebGPURenderer.getBindGroup().getShaderCode(n),s=n.getShaderDescription("vertex"),o=s.getCode();o=J.substitute(o,"//VTK::Renderer::Dec",[i]).result,s.setCode(o);let c=n.getShaderDescription("fragment");o=c.getCode(),o=J.substitute(o,"//VTK::Renderer::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,a)=>{let i=e.bindGroup.getShaderCode(n),s=n.getShaderDescription("vertex"),o=s.getCode();o=J.substitute(o,"//VTK::Mapper::Dec",[i]).result,s.setCode(o);let c=n.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=J.substitute(o,"//VTK::Mapper::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,a)=>{let i=n.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let s=i.getCode();s=J.substitute(s,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,i.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,a)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{let n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);let a=e.vertexInput.getIndexBuffer();a?r.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{let r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);let a=e.textureViews[n].getSampler();a&&r.push(a)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Zh.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}var gD={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function rd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gD,r),Q.extend(t,e,r),e.textureViews=[],e.vertexInput=td.newInstance(),e.bindGroup=Ss.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||uD,e.vertexShaderTemplate=e.vertexShaderTemplate||fD,e.shaderReplacements=new Map,w.get(t,e,["pipeline","vertexInput"]),w.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),lD(t,e)}var pD=w.newInstance(rd,"vtkWebGPUSimpleMapper"),oa={newInstance:pD,extend:rd};function hD(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,a)=>{let i=n.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),i.addOutput("vec4<f32>","vertexVC");let s=i.getCode();s=J.substitute(s,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,i.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{let r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}var dD={};function nd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dD,r),oa.extend(t,e,r),hD(t,e)}var vD=w.newInstance(nd,"vtkWebGPUFullScreenQuad"),Lt={newInstance:vD,extend:nd};var mD={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},xD={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6},Pr={BufferUsage:mD,PrimitiveTypes:xD};var gf=["getMappedRange","mapAsync","unmap"];function yD(t,e,r,n){let a=n.byteLength,i=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),s=i.getMappedRange(0,a);new Uint8Array(s).set(new Uint8Array(n)),i.unmap();let o=t.createCommandEncoder();o.copyBufferToBuffer(i,0,e,r,a);let c=o.finish();t.queue.submit([c]),i.destroy()}function TD(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{yD(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{let a=Math.ceil(r.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:a,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=a,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<gf.length;r++)t[gf[r]]=function(){return e.handle[gf[r]](...arguments)}}var SD={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function ad(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SD,r),w.obj(t,e),w.get(t,e,["handle","sizeInBytes","usage"]),w.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),TD(t,e)}var CD=w.newInstance(ad),er={newInstance:CD,extend:ad,...Pr};var{Representation:Ia,Interpolation:ja}=Jc;function id(t){return()=>w.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function wD(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,a)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==a)&&(e.color[0]=r,e.color[1]=n,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=id("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{let n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=id("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(ja.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(ja.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(ja.PHONG),t.getInterpolationAsString=()=>w.enumToString(ja,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Ia.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Ia.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Ia.POINTS),t.getRepresentationAsString=()=>w.enumToString(Ia,e.representation)}var OD={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:ja.GOURAUD,representation:Ia.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function sd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OD,r),w.obj(t,e),w.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),w.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),wD(t,e)}var ED=w.newInstance(sd,"vtkProperty"),Gt={newInstance:ED,extend:sd,...Jc};var{Representation:od}=Gt,{PrimitiveTypes:Ir}=Pr,hf=class{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}};function MD(t){switch(t){case Ir.Points:return"points";case Ir.Lines:return"lines";case Ir.Triangles:case Ir.TriangleEdges:return"polys";case Ir.TriangleStripEdges:case Ir.TriangleStrips:return"strips";default:return""}}function Cs(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function RD(t,e,r){let n=t.length;for(let s=0;s<n;s++){let o=t[s];if(r.cellProvokedMap.has(o)){r.ibo[r.iboId++]=r.cellProvokedMap.get(o);for(let c=s+1;c<s+n;c++){o=t[c%n];let f=Cs(r,o,e);r.ibo[r.iboId++]=f}return}}for(let s=0;s<n;s++){let o=t[s];if(!r.provokedPointIds[o]){let c=Cs(r,o,e);r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,c),r.flatIdToCellId[c]=e,r.ibo[r.iboId++]=c;for(let f=s+1;f<s+n;f++)o=t[f%n],c=Cs(r,o,e),r.ibo[r.iboId++]=c;return}}let a=t[0],i=r.flatId;r.cellProvokedMap.set(a,i),r.flatIdToPointId[r.flatId]=a,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=i;for(let s=1;s<n;s++)a=t[s],i=Cs(r,a,e),r.ibo[r.iboId++]=i}function DD(t,e,r){let n=t.length;r.iboSize+=n;for(let a=0;a<n;a++){let i=t[a];if(r.cellProvokedMap.has(i))return}for(let a=0;a<n;a++){let i=t[a];if(!r.provokedPointIds[i]){r.provokedPointIds[i]=1,r.cellProvokedMap.set(i,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}var wr,cd=new Uint32Array(1),_t=new Uint32Array(2),Hr=new Uint32Array(3),pf={anythingToPoints(t,e,r,n,a){for(let i=0;i<t;++i)cd[0]=e[r+i],wr(cd,n,a)},linesToWireframe(t,e,r,n,a){for(let i=0;i<t-1;++i)_t[0]=e[r+i],_t[1]=e[r+i+1],wr(_t,n,a)},polysToWireframe(t,e,r,n,a){if(t>2)for(let i=0;i<t;++i)_t[0]=e[r+i],_t[1]=e[r+(i+1)%t],wr(_t,n,a)},stripsToWireframe(t,e,r,n,a){if(t>2){for(let i=0;i<t-1;++i)_t[0]=e[r+i],_t[1]=e[r+i+1],wr(_t,n,a);for(let i=0;i<t-2;i++)_t[0]=e[r+i],_t[1]=e[r+i+2],wr(_t,n,a)}},polysToSurface(t,e,r,n,a){for(let i=0;i<t-2;i++)Hr[0]=e[r],Hr[1]=e[r+i+1],Hr[2]=e[r+i+2],wr(Hr,n,a)},stripsToSurface(t,e,r,n,a){for(let i=0;i<t-2;i++)Hr[0]=e[r+i],Hr[1]=e[r+i+1+i%2],Hr[2]=e[r+i+1+(i+1)%2],wr(Hr,n,a)}};function LD(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{let n=r.cells,a=r.primitiveType,i=r.representation,s=r.cellOffset,o=n.getData(),c=o.length,f=MD(a),l=r.numberOfPoints,u={provokedPointIds:new Uint8Array(l),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new hf},g=null;i===od.POINTS||a===Ir.Points?g=pf.anythingToPoints:i===od.WIREFRAME||a===Ir.Lines?g=pf[`${f}ToWireframe`]:g=pf[`${f}ToSurface`],wr=DD;let p=s||0;for(let d=0;d<c;)u.cellProvokedMap.clear(),g(o[d],o,d+1,p,u),d+=o[d]+1,p++;l<=65535?u.flatIdToPointId=new Uint16Array(l+u.extraPoints):u.flatIdToPointId=new Uint32Array(l+u.extraPoints),l+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(l):u.pointIdToFlatId=new Int32Array(l),l+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),r.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),r.format="uint32"),p<=65535?u.flatIdToCellId=new Uint16Array(l+u.extraPoints):u.flatIdToCellId=new Uint32Array(l+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),wr=RD,p=s||0;for(let d=0;d<c;)u.cellProvokedMap.clear(),g(o[d],o,d+1,p,u),d+=o[d]+1,p++;delete u.provokedPointIds,delete u.pointIdToFlatId,r.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}var VD={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function fd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VD,r),er.extend(t,e,r),w.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),LD(t,e)}var FD=w.newInstance(fd),ud={newInstance:FD,extend:fd,...Pr};var{BufferUsage:jr}=Pr,{vtkErrorMacro:kD}=De,{VtkDataTypes:wn}=K,bD={};function UD(t){let e;switch(t.getDataType()){case wn.UNSIGNED_CHAR:e="uint8";break;case wn.FLOAT:e="float32";break;case wn.UNSIGNED_INT:e="uint32";break;case wn.INT:e="sint32";break;case wn.DOUBLE:e="float32";break;case wn.UNSIGNED_SHORT:e="uint16";break;case wn.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||kD(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function ld(t,e,r,n,a){let i={},s=t.getFlatSize();if(!s)return i;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));let f=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1,l,u=0,g=r+(f?1:0),p=hr(n,s*g),d=t.getFlatIdToPointId();a.cellData&&(d=t.getFlatIdToCellId()),r===1?l=function(v){p[u++]=c[0]*e[v]+o[0]}:r===2?l=function(v){p[u++]=c[0]*e[v]+o[0],p[u++]=c[1]*e[v+1]+o[1]}:r===3&&!f?l=function(v){p[u++]=c[0]*e[v]+o[0],p[u++]=c[1]*e[v+1]+o[1],p[u++]=c[2]*e[v+2]+o[2]}:r===3&&f?l=function(v){p[u++]=c[0]*e[v]+o[0],p[u++]=c[1]*e[v+1]+o[1],p[u++]=c[2]*e[v+2]+o[2],p[u++]=c[3]*1+o[3]}:r===4&&(l=function(v){p[u++]=c[0]*e[v]+o[0],p[u++]=c[1]*e[v+1]+o[1],p[u++]=c[2]*e[v+2]+o[2],p[u++]=c[3]*e[v+3]+o[3]});for(let h=0;h<s;h++){let v=r*d[h];l(v)}return i.nativeArray=p,i}function ND(t,e,r,n){let a=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],i=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],s=[];return $e(a,i,s),tt(s),s}function BD(t,e){let r=e.getData(),n=t.getData();if(!n||!r)return null;let a=new Int8Array(t.getNumberOfCells()*4),i=n.length,s=0;for(let o=0;o<i;){let c=ND(r,n[o+1],n[o+2],n[o+3]);a[s++]=127*c[0],a[s++]=127*c[1],a[s++]=127*c[2],a[s++]=127,o+=n[o]+1}return a}function GD(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let a,i;if(n.usage===jr.Index&&(a=ud.newInstance({label:n.label}),a.setDevice(e.device),i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(n),a.createAndWrite(n.nativeArray,i),a.setArrayInformation([{format:n.format}])),a||(a=er.newInstance({label:n.label}),a.setDevice(e.device)),n.usage===jr.UniformArray&&(i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,i)),n.usage===jr.Storage&&(i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,i)),n.usage===jr.Texture&&(i=GPUBufferUsage.COPY_SRC,a.createAndWrite(n.nativeArray,i)),n.usage===jr.PointArray){i=GPUBufferUsage.VERTEX;let s=Ne.getNativeTypeFromBufferFormat(n.format),o=ld(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),s,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});a.createAndWrite(o.nativeArray,i),a.setStrideInBytes(Ne.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===jr.NormalsFromPoints){i=GPUBufferUsage.VERTEX;let s=Ne.getNativeTypeFromBufferFormat(n.format),o=BD(n.cells,n.dataArray),c=ld(n.indexBuffer,o,4,s,{cellData:!0});a.createAndWrite(c.nativeArray,i),a.setStrideInBytes(Ne.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===jr.RawVertex&&(i=GPUBufferUsage.VERTEX,a.createAndWrite(n.nativeArray,i),a.setStrideInBytes(Ne.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format}])),a.setSourceTime(n.time),a}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,a)=>{let i=UD(n),s={hash:`${n.getMTime()}I${a.getMTime()}${i}`,usage:jr.PointArray,format:i,dataArray:n,indexBuffer:a};return t.getBuffer(s)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=er.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);let n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}var _D={device:null,fullScreenQuadBuffer:null};function gd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_D,r),ae(t,e),ge(t,e,["device"]),GD(t,e)}var WD=$(gd),Ct={newInstance:WD,extend:gd,...bD,...Pr};var{BufferUsage:zD}=Ct,{vtkErrorMacro:ca}=w;function AD(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){ca(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);let a=Ne.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:a,offset:e.sizeInBytes,nativeType:Ne.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=a},t.send=r=>{if(!e._buffer){let n={nativeArray:e.Float32Array,usage:zD.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=w.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,a)=>{let i=e._bufferEntryNames.get(r);if(i===void 0){ca(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[i];t.createView(s.nativeType);let o=e[s.nativeType];o[(s.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(r,n,a)=>{let i=e._bufferEntryNames.get(r);if(i===void 0){ca(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[i];t.createView(s.nativeType);let o=e[s.nativeType],c=(s.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<a.length;f++)o[c+f]=a[f]},t.setAllInstancesFromArray=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){ca(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[a];t.createView(i.nativeType);let s=e[i.nativeType],o=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){let f=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<o;l++)s[f+l]=n[c*o+l]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){ca(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[a];t.createView(i.nativeType);let s=e[i.nativeType],o=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){let f=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<o;l++)s[f+l]=n[c*o+l]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){ca(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[a];t.createView(i.nativeType);let s=e[i.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){let f=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<3;l++)for(let u=0;u<3;u++)s[f+l*4+u]=n[c*o+l*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{let a=[`struct ${e.label}StructEntry
{`];for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];a.push(`  ${s.name}: ${s.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}var PD={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function pd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PD,r),w.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},w.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},w.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},w.get(t,e,["bindGroupTime"]),w.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),AD(t,e)}var HD=w.newInstance(pd,"vtkWebGPUStorageBuffer"),Ka={newInstance:HD,extend:pd};var{BufferUsage:ID}=Ct,{vtkErrorMacro:df}=w;function jD(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){df(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:Ne.getByteStrideFromShaderFormat(n),offset:-1,nativeType:Ne.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0,n=[],a=4;for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];s.sizeInBytes%16===0&&(a=Math.max(16,a)),s.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];s.packed===!1&&s.sizeInBytes%16===0&&(s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];if(s.packed===!1&&s.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){let c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];if(!s.packed&&s.sizeInBytes%8===0)for(let o=i+1;o<e.bufferEntries.length;o++){let c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];if(!s.packed&&s.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){let f=e.bufferEntries[c];if(!f.packed&&f.sizeInBytes===4)for(let l=c+1;l<e.bufferEntries.length;l++){let u=e.bufferEntries[l];if(!u.packed&&u.sizeInBytes===4){s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes,f.packed=!0,f.offset=r,n.push(f),r+=f.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,o=!0;break}}}}}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];!s.packed&&s.sizeInBytes>4&&(s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];s.packed||(s.packed=!0,s.offset=r,n.push(s),r+=s.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let i=0;i<e.bufferEntries.length;i++)e._bufferEntryNames.set(e.bufferEntries[i].name,i);e.sizeInBytes=r,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){let n={nativeArray:e.Float32Array,usage:ID.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=w.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();let a=e._bufferEntryNames.get(r);if(a===void 0){df(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[a];t.createView(i.nativeType);let s=e[i.nativeType];i.lastValue!==n&&(s[i.offset/s.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),i.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();let a=e._bufferEntryNames.get(r);if(a===void 0){df(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[a];t.createView(i.nativeType);let s=e[i.nativeType],o=!1;for(let c=0;c<n.length;c++)(!i.lastValue||i.lastValue[c]!==n[c])&&(s[i.offset/s.BYTES_PER_ELEMENT+c]=n[c],o=!0);o&&(e.sendDirty=!0,i.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();let a=[`struct ${e.label}Struct
{`];for(let i=0;i<e.bufferEntries.length;i++){let s=e.bufferEntries[i];a.push(`  ${s.name}: ${s.type},`)}return a.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}var KD={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function hd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KD,r),w.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},w.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},w.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,w.get(t,e,["binding","bindGroupTime"]),w.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),jD(t,e)}var $D=w.newInstance(hd,"vtkWebGPUUniformBuffer"),Vt={newInstance:$D,extend:hd};var{vtkDebugMacro:XD}=De,dd=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,YD=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,ws=new Float64Array(16),vd=new Float64Array(16);function qD(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function ZD(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{let r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),i=[],s=[];P.scale(s,a,.5*(r[0]+r[1])),P.add(i,n,s),P.sub(s,i,e.stabilizedCenter),P.len(s)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=i,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0,n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(XD("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{let r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){let n=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",n.wcvc),e.UBO.setArray("SCPCMatrix",n.scpc),e.UBO.setArray("PCSCMatrix",n.pcsc),e.UBO.setArray("SCVCMatrix",n.scvc),e.UBO.setArray("VCPCMatrix",n.vcpc),e.UBO.setArray("WCVCNormals",n.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());let a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());let i=e._parent.getDevice();e.UBO.sendIfNeeded(i)}},t.updateSSBO=()=>{let r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t),a=`${e.renderable.getMTime()}`;for(let i=0;i<r.length;i++)a+=r[i].getMTime();if(a!==e.lightTimeString){let i=new Float32Array(r.length*4),s=new Float32Array(r.length*4),o=new Float32Array(r.length*4),c=new Float32Array(r.length*4);for(let l=0;l<r.length;l++){let u=l*4,g=r[l].getPosition();P.transformMat4(g,g,n.wcvc),i[u]=g[0],i[u+1]=g[1],i[u+2]=g[2],i[u+3]=0,s[u]=-r[l].getDirection()[0],s[u+1]=-r[l].getDirection()[1],s[u+2]=-r[l].getDirection()[2],s[u+3]=0,o[u]=r[l].getColor()[0],o[u+1]=r[l].getColor()[1],o[u+2]=r[l].getColor()[2],o[u+3]=r[l].getIntensity()*5,c[u]=qD(r[l]),c[u+1]=Math.cos(Fe(r[l].getConeAngle())),c[u+2]=Math.cos(Fe(r[l].getConeAngle()+r[l].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",i),e.SSBO.setAllInstancesFromArray("LightDir",s),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);let f=e._parent.getDevice();e.SSBO.send(f)}e.lightTimeString=a},t.scissorAndViewport=r=>{let n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;let r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=Lt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(dd);let i=Vt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(YD);let i=Vt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i);let s=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(s.getReady()){let o=s.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([o]),e.backgroundTexLoaded=!0;let c=e.backgroundTex.getInterpolate()?"linear":"nearest";o.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=Lt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(dd);let i=Vt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i)}let n=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),D.transpose(vd,n.normalMatrix),D.mul(ws,n.scvc,n.pcsc),D.mul(ws,vd,ws),e.clearFSQ.getUBO().setArray("FSQMatrix",ws),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{let r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{let r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{let r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],i=r[1]-n[1],s=e._parent.normalizedDisplayToDisplay(a,i),o=Math.round(s[0]),c=Math.round(s[1]),f=r[2]-n[0],l=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(f,l),g=Math.round(u[0])-o,p=Math.round(u[1])-c;return g<0&&(g=0),p<0&&(p=0),{usize:g,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}var QD={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function JD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QD,r),Q.extend(t,e,r),e.UBO=Vt.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=Ka.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=Ss.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=D.identity(new Float64Array(16)),e.stabilizedTime={},ae(e.stabilizedTime,{mtime:0}),Me(t,e,["bindGroup","stabilizedTime"]),dr(t,e,["stabilizedCenter"]),ge(t,e,["renderEncoder","selector","suppressClear","UBO"]),ZD(t,e)}var eL=$(JD,"vtkWebGPURenderer");Ue("vtkRenderer",eL);function tL(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}var rL={device:null,handle:null,label:null,options:null};function md(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rL,r),w.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},w.obj(e.bindGroupTime,{mtime:0}),w.get(t,e,["bindGroupTime","handle","options"]),w.setGet(t,e,["bindGroupLayoutEntry","device","label"]),tL(t,e)}var nL=w.newInstance(md),Kr={newInstance:nL,extend:md};var{SlicingMode:xd}=ys,aL=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function iL(t,e,r){if(e.apply(t)){let a=t.getIndependentComponents();return`${t.getMTime()}-${a}-${r}`}return"0"}var Ft=new Float64Array(16),tr=new Float64Array(16),Os=new Float64Array(16),Or=new Float64Array(4),qe=new Float64Array(4);function sL(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=a=>{if(a){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();let i=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(i.getActiveCamera())}},t.translucentPass=a=>{a&&t.render()},t.opaquePass=a=>{a&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{let a=e.currentInput.getExtent();a[0]===a[1]||a[2]===a[3]||a[4]===a[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{let a=e.UBO.getSendTime(),i=e.WebGPUImageSlice.getRenderable(),s=i.getMapper();if(t.getMTime()>a||e.renderable.getMTime()>a||i.getProperty().getMTime()>a){let o=s.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();D.identity(Ft),D.translate(Ft,Ft,c);let f=i.getMatrix();D.transpose(tr,f),D.invert(tr,tr),D.multiply(Ft,tr,Ft);let l=o.getWorldToIndex();D.multiply(Ft,l,Ft),D.invert(Os,Ft),D.fromTranslation(tr,[.5,.5,.5]),D.multiply(Ft,tr,Ft);let u=o.getDimensions();D.identity(tr),D.scale(tr,tr,[1/u[0],1/u[1],1/u[2]]),D.multiply(Ft,tr,Ft),e.UBO.setArray("SCTCMatrix",Ft);let g=e.currentInput.getExtent(),{ijkMode:p}=e.renderable.getClosestIJKAxis(),d=e.renderable.getSlice();p!==e.renderable.getSlicingMode()&&(d=e.renderable.getSliceAtPosition(d));let h=2,v=0,x=1;p===xd.I?(h=0,v=1,x=2):p===xd.J&&(h=1,v=2,x=0),Or[h]=d,Or[v]=g[v*2]-.5,Or[x]=g[x*2]-.5,Or[3]=1,lt.transformMat4(Or,Or,Os),e.UBO.setArray("Origin",Or),qe[h]=d,qe[v]=g[v*2+1]+.5,qe[x]=g[x*2]-.5,qe[3]=1,lt.transformMat4(qe,qe,Os),lt.subtract(qe,qe,Or),qe[3]=1,e.UBO.setArray("Axis1",qe),qe[h]=d,qe[v]=g[v*2]-.5,qe[x]=g[x*2+1]+.5,qe[3]=1,lt.transformMat4(qe,qe,Os),lt.subtract(qe,qe,Or),qe[3]=1,e.UBO.setArray("Axis2",qe);let T=[1,1,1,1],m=[0,0,0,0],y=e.textureViews[0],S=y.getTexture().getScale(),C=y.getTexture().getNumberOfComponents();for(let E=0;E<C;E++){let O=i.getProperty().getColorWindow(),U=i.getProperty().getColorLevel(),V=i.getProperty().getRGBTransferFunction(0);if(V){let b=V.getRange();O=b[1]-b[0],U=.5*(b[1]+b[0])}T[E]=S/O,m[E]=-U/O+.5}e.UBO.setArray("cScale",T),e.UBO.setArray("cShift",m),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{let a=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();let s=1,o=iL(a,a.getRGBTransferFunction,s);if(e.colorTextureString!==o){e.numRows=s;let c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),f=a.getRGBTransferFunction();if(f){let l=new Float32Array(e.rowLength*3);for(let u=0;u<s;u++){f=a.getRGBTransferFunction(u);let g=f.getRange();f.getTable(g[0],g[1],e.rowLength,l,1);for(let p=0;p<e.rowLength;p++){let d=u*e.rowLength*8+p*4;c[d]=255*l[p*3],c[d+1]=255*l[p*3+1],c[d+2]=255*l[p*3+2],c[d+3]=255;for(let h=0;h<4;h++)c[d+e.rowLength*4+h]=c[d+h]}}}else for(let l=0;l<e.rowLength;++l){let u=255*l/(e.rowLength-1);c[l*4]=u,c[l*4+1]=u,c[l*4+2]=u,c[l*4+3]=255;for(let g=0;g<4;g++)c[l*4+e.rowLength*4+g]=c[l*4+g]}{let l={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(l).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=o}};let r=t.updateBuffers;t.updateBuffers=()=>{r();let a=e.device.getTextureManager().getTextureForImageData(e.currentInput),i=e.textureViews;if(!i[0]||i[0].getTexture()!==a){let c=a.createView("imgTexture");i[0]=c}t.updateLUTImage(),t.updateUBO();let o=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Ht.NEAREST?"nearest":"linear";(!e.clampSampler||o!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=Kr.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:o,magFilter:o}),e.additionalBindables=[e.clampSampler])};let n=t.getShaderReplacements();t.replaceShaderPosition=(a,i,s)=>{let o=i.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode(),f=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?f.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):f.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),f.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=J.substitute(c,"//VTK::Position::Impl",f).result,o.setCode(c)},n.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(a,i,s)=>{let o=i.getShaderDescription("vertex");e.dimensions===2?o.addOutput("vec2<f32>","tcoordVS"):o.addOutput("vec3<f32>","tcoordVS")},n.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(a,i,s)=>{let o=i.getShaderDescription("fragment"),c=o.getCode();e.dimensions===3?c=J.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=J.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=J.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,o.setCode(c)},n.set("replaceShaderImage",t.replaceShaderImage)}var oL={rowLength:1024};function cL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oL,r),Lt.extend(t,e,r),t.setFragmentShaderTemplate(aL),e.UBO=Vt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},ae(e.lutBuildTime,{mtime:0}),e.imagemat=D.identity(new Float64Array(16)),e.imagematinv=D.identity(new Float64Array(16)),e.VBOBuildTime={},ae(e.VBOBuildTime),sL(t,e)}var fL=$(cL,"vtkWebGPUImageMapper");Ue("vtkImageMapper",fL);function uL(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();let n=e.renderable.getMatrix(),a=r.getStabilizedCenterByReference();e.bufferShift[0]=n[3]-a[0],e.bufferShift[1]=n[7]-a[1],e.bufferShift[2]=n[11]-a[2],D.transpose(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?D.identity(e.keyMatrices.normalMatrix):(D.copy(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,D.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),D.transpose(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),D.translate(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),D.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}var lL={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function gL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lL,r),Q.extend(t,e,r),e.keyMatricesTime={},ae(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},ae(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:D.identity(new Float64Array(16))},e.bufferShift=[0,0,0,0],Me(t,e,["propID","keyMatricesTime"]),uL(t,e)}var pL=$(gL,"vtkWebGPUImageSlice");Ue("vtkImageSlice",pL);function hL(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=a=>{!e.renderable||!e.renderable.getVisibility()||a&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(a,i)=>{if(a){if(!e.renderable||!e.renderable.getVisibility())return;let s=e.renderable.getMapper().getBounds();if(!s||s.length!==6||s[0]>s[1])return;i.addVolume(t)}};let r=new Float64Array(3),n=new Float64Array(3);t.getBoundingCubePoints=(a,i)=>{let s=e.renderable.getMapper().getInputData();if(!s)return;let o=s.getExtent(),c=e.renderable.getMatrix(),f=0;for(let l=4;l<6;l++){r[2]=o[l];for(let u=2;u<4;u++){r[1]=o[u];for(let g=0;g<2;g++){r[0]=o[g],s.indexToWorld(r,n);let p=i+f*3;a[p++]=c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3],a[p++]=c[4]*n[0]+c[5]*n[1]+c[6]*n[2]+c[7],a[p++]=c[8]*n[0]+c[9]*n[1]+c[10]*n[2]+c[11],f++}}}},t.getKeyMatrices=a=>{if(Math.max(e.renderable.getMTime(),a.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();let i=e.renderable.getMatrix(),s=a.getStabilizedCenterByReference();D.transpose(e.keyMatrices.bcwc,i),D.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-s[0],-s[1],-s[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}var dL={propID:void 0,keyMatricesTime:null};function vL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dL,r),Q.extend(t,e,r),e.keyMatricesTime={},w.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},w.get(t,e,["propID","keyMatricesTime"]),hL(t,e)}var mL=w.newInstance(vL,"vtkWebGPUVolume");Ue("vtkVolume",mL);function xL(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();let a=e.WebGPURenderer.getAspectRatio(),i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),i,a,s,o)}}var yL={};function TL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yL,r),Q.extend(t,e,r),xL(t,e)}var SL=w.newInstance(TL,"vtkWebGPUPixelSpaceCallbackMapper");Ue("vtkPixelSpaceCallbackMapper",SL);function CL(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){let a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){let n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),D.copy(e.keyMatrices.mcwc,e.renderable.getMatrix()),D.transpose(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?ee.identity(e.keyMatrices.normalMatrix):(ee.fromMat4(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),ee.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ee.transpose(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}var wL={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function OL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wL,r),Q.extend(t,e,r),e.keyMatrixTime={},ae(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ee.identity(new Float64Array(9)),mcwc:D.identity(new Float64Array(16))},ge(t,e,["context"]),Me(t,e,["activeTextures"]),CL(t,e)}var EL=$(OL);Te("vtkActor",EL);function ML(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){let a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){let n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}var RL={context:null,activeTextures:null};function DL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RL,r),Q.extend(t,e,r),ge(t,e,["context"]),Me(t,e,["activeTextures"]),ML(t,e)}var LL=$(DL);Te("vtkActor2D",LL);function On(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function vf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Es(t){let e,r,n;t.length!==2?(e=On,r=(o,c)=>On(t(o),c),n=(o,c)=>t(o)-c):(e=t===On||t===vf?t:VL,r=t,n=t);function a(o,c,f=0,l=o.length){if(f<l){if(e(c,c)!==0)return l;do{let u=f+l>>>1;r(o[u],c)<0?f=u+1:l=u}while(f<l)}return f}function i(o,c,f=0,l=o.length){if(f<l){if(e(c,c)!==0)return l;do{let u=f+l>>>1;r(o[u],c)<=0?f=u+1:l=u}while(f<l)}return f}function s(o,c,f=0,l=o.length){let u=a(o,c,f,l-1);return u>f&&n(o[u-1],c)>-n(o[u],c)?u-1:u}return{left:a,center:s,right:i}}function VL(){return 0}function mf(t){return t===null?NaN:+t}var yd=Es(On),Td=yd.right,FL=yd.left,kL=Es(mf).center,xf=Td;var bL=Math.sqrt(50),UL=Math.sqrt(10),NL=Math.sqrt(2);function Ms(t,e,r){let n=(e-t)/Math.max(0,r),a=Math.floor(Math.log10(n)),i=n/Math.pow(10,a),s=i>=bL?10:i>=UL?5:i>=NL?2:1,o,c,f;return a<0?(f=Math.pow(10,-a)/s,o=Math.round(t*f),c=Math.round(e*f),o/f<t&&++o,c/f>e&&--c,f=-f):(f=Math.pow(10,a)*s,o=Math.round(t/f),c=Math.round(e/f),o*f<t&&++o,c*f>e&&--c),c<o&&.5<=r&&r<2?Ms(t,e,r*2):[o,c,f]}function Rs(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];let n=e<t,[a,i,s]=n?Ms(e,t,r):Ms(t,e,r);if(!(i>=a))return[];let o=i-a+1,c=new Array(o);if(n)if(s<0)for(let f=0;f<o;++f)c[f]=(i-f)/-s;else for(let f=0;f<o;++f)c[f]=(i-f)*s;else if(s<0)for(let f=0;f<o;++f)c[f]=(a+f)/-s;else for(let f=0;f<o;++f)c[f]=(a+f)*s;return c}function $a(t,e,r){return e=+e,t=+t,r=+r,Ms(t,e,r)[2]}function yf(t,e,r){e=+e,t=+t,r=+r;let n=e<t,a=n?$a(e,t,r):$a(t,e,r);return(n?-1:1)*(a<0?1/-a:a)}function Sd(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Ds(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Tf(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function qa(){}var Xa=.7,Fs=1/Xa,fa="\\s*([+-]?\\d+)\\s*",Ya="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",rr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BL=/^#([0-9a-f]{3,8})$/,GL=new RegExp(`^rgb\\(${fa},${fa},${fa}\\)$`),_L=new RegExp(`^rgb\\(${rr},${rr},${rr}\\)$`),WL=new RegExp(`^rgba\\(${fa},${fa},${fa},${Ya}\\)$`),zL=new RegExp(`^rgba\\(${rr},${rr},${rr},${Ya}\\)$`),AL=new RegExp(`^hsl\\(${Ya},${rr},${rr}\\)$`),PL=new RegExp(`^hsla\\(${Ya},${rr},${rr},${Ya}\\)$`),Cd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ds(qa,$r,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:wd,formatHex:wd,formatHex8:HL,formatHsl:IL,formatRgb:Od,toString:Od});function wd(){return this.rgb().formatHex()}function HL(){return this.rgb().formatHex8()}function IL(){return Vd(this).formatHsl()}function Od(){return this.rgb().formatRgb()}function $r(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=BL.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?Ed(e):r===3?new wt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Ls(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Ls(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=GL.exec(t))?new wt(e[1],e[2],e[3],1):(e=_L.exec(t))?new wt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=WL.exec(t))?Ls(e[1],e[2],e[3],e[4]):(e=zL.exec(t))?Ls(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=AL.exec(t))?Dd(e[1],e[2]/100,e[3]/100,1):(e=PL.exec(t))?Dd(e[1],e[2]/100,e[3]/100,e[4]):Cd.hasOwnProperty(t)?Ed(Cd[t]):t==="transparent"?new wt(NaN,NaN,NaN,0):null}function Ed(t){return new wt(t>>16&255,t>>8&255,t&255,1)}function Ls(t,e,r,n){return n<=0&&(t=e=r=NaN),new wt(t,e,r,n)}function jL(t){return t instanceof qa||(t=$r(t)),t?(t=t.rgb(),new wt(t.r,t.g,t.b,t.opacity)):new wt}function ua(t,e,r,n){return arguments.length===1?jL(t):new wt(t,e,r,n??1)}function wt(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}Ds(wt,ua,Tf(qa,{brighter(t){return t=t==null?Fs:Math.pow(Fs,t),new wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Xa:Math.pow(Xa,t),new wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new wt(Mn(this.r),Mn(this.g),Mn(this.b),ks(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Md,formatHex:Md,formatHex8:KL,formatRgb:Rd,toString:Rd}));function Md(){return`#${En(this.r)}${En(this.g)}${En(this.b)}`}function KL(){return`#${En(this.r)}${En(this.g)}${En(this.b)}${En((isNaN(this.opacity)?1:this.opacity)*255)}`}function Rd(){let t=ks(this.opacity);return`${t===1?"rgb(":"rgba("}${Mn(this.r)}, ${Mn(this.g)}, ${Mn(this.b)}${t===1?")":`, ${t})`}`}function ks(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Mn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function En(t){return t=Mn(t),(t<16?"0":"")+t.toString(16)}function Dd(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new It(t,e,r,n)}function Vd(t){if(t instanceof It)return new It(t.h,t.s,t.l,t.opacity);if(t instanceof qa||(t=$r(t)),!t)return new It;if(t instanceof It)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,a=Math.min(e,r,n),i=Math.max(e,r,n),s=NaN,o=i-a,c=(i+a)/2;return o?(e===i?s=(r-n)/o+(r<n)*6:r===i?s=(n-e)/o+2:s=(e-r)/o+4,o/=c<.5?i+a:2-i-a,s*=60):o=c>0&&c<1?0:s,new It(s,o,c,t.opacity)}function Fd(t,e,r,n){return arguments.length===1?Vd(t):new It(t,e,r,n??1)}function It(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}Ds(It,Fd,Tf(qa,{brighter(t){return t=t==null?Fs:Math.pow(Fs,t),new It(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Xa:Math.pow(Xa,t),new It(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,a=2*r-n;return new wt(Sf(t>=240?t-240:t+120,a,n),Sf(t,a,n),Sf(t<120?t+240:t-120,a,n),this.opacity)},clamp(){return new It(Ld(this.h),Vs(this.s),Vs(this.l),ks(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=ks(this.opacity);return`${t===1?"hsl(":"hsla("}${Ld(this.h)}, ${Vs(this.s)*100}%, ${Vs(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ld(t){return t=(t||0)%360,t<0?t+360:t}function Vs(t){return Math.max(0,Math.min(1,t||0))}function Sf(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}function Cf(t,e,r,n,a){var i=t*t,s=i*t;return((1-3*t+3*i-s)*e+(4-6*i+3*s)*r+(1+3*t+3*i-3*s)*n+s*a)/6}function kd(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),a=t[n],i=t[n+1],s=n>0?t[n-1]:2*a-i,o=n<e-1?t[n+2]:2*i-a;return Cf((r-n/e)*e,s,a,i,o)}}function bd(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),a=t[(n+e-1)%e],i=t[n%e],s=t[(n+1)%e],o=t[(n+2)%e];return Cf((r-n/e)*e,a,i,s,o)}}var Za=t=>()=>t;function $L(t,e){return function(r){return t+r*e}}function XL(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Ud(t){return(t=+t)==1?bs:function(e,r){return r-e?XL(e,r,t):Za(isNaN(e)?r:e)}}function bs(t,e){var r=e-t;return r?$L(t,r):Za(isNaN(t)?e:t)}var wf=(function t(e){var r=Ud(e);function n(a,i){var s=r((a=ua(a)).r,(i=ua(i)).r),o=r(a.g,i.g),c=r(a.b,i.b),f=bs(a.opacity,i.opacity);return function(l){return a.r=s(l),a.g=o(l),a.b=c(l),a.opacity=f(l),a+""}}return n.gamma=t,n})(1);function Nd(t){return function(e){var r=e.length,n=new Array(r),a=new Array(r),i=new Array(r),s,o;for(s=0;s<r;++s)o=ua(e[s]),n[s]=o.r||0,a[s]=o.g||0,i[s]=o.b||0;return n=t(n),a=t(a),i=t(i),o.opacity=1,function(c){return o.r=n(c),o.g=a(c),o.b=i(c),o+""}}}var Lj=Nd(kd),Vj=Nd(bd);function Bd(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),a;return function(i){for(a=0;a<r;++a)n[a]=t[a]*(1-i)+e[a]*i;return n}}function Gd(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _d(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,a=new Array(n),i=new Array(r),s;for(s=0;s<n;++s)a[s]=Rn(t[s],e[s]);for(;s<r;++s)i[s]=e[s];return function(o){for(s=0;s<n;++s)i[s]=a[s](o);return i}}function Wd(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function Xr(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function zd(t,e){var r={},n={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?r[a]=Rn(t[a],e[a]):n[a]=e[a];return function(i){for(a in r)n[a]=r[a](i);return n}}var Ef=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Of=new RegExp(Ef.source,"g");function YL(t){return function(){return t}}function qL(t){return function(e){return t(e)+""}}function Ad(t,e){var r=Ef.lastIndex=Of.lastIndex=0,n,a,i,s=-1,o=[],c=[];for(t=t+"",e=e+"";(n=Ef.exec(t))&&(a=Of.exec(e));)(i=a.index)>r&&(i=e.slice(r,i),o[s]?o[s]+=i:o[++s]=i),(n=n[0])===(a=a[0])?o[s]?o[s]+=a:o[++s]=a:(o[++s]=null,c.push({i:s,x:Xr(n,a)})),r=Of.lastIndex;return r<e.length&&(i=e.slice(r),o[s]?o[s]+=i:o[++s]=i),o.length<2?c[0]?qL(c[0].x):YL(e):(e=c.length,function(f){for(var l=0,u;l<e;++l)o[(u=c[l]).i]=u.x(f);return o.join("")})}function Rn(t,e){var r=typeof e,n;return e==null||r==="boolean"?Za(e):(r==="number"?Xr:r==="string"?(n=$r(e))?(e=n,wf):Ad:e instanceof $r?wf:e instanceof Date?Wd:Gd(e)?Bd:Array.isArray(e)?_d:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?zd:Xr)(t,e)}function Mf(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function Rf(t){return function(){return t}}function Df(t){return+t}var Pd=[0,1];function la(t){return t}function Lf(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:Rf(isNaN(e)?NaN:.5)}function ZL(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function QL(t,e,r){var n=t[0],a=t[1],i=e[0],s=e[1];return a<n?(n=Lf(a,n),i=r(s,i)):(n=Lf(n,a),i=r(i,s)),function(o){return i(n(o))}}function JL(t,e,r){var n=Math.min(t.length,e.length)-1,a=new Array(n),i=new Array(n),s=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<n;)a[s]=Lf(t[s],t[s+1]),i[s]=r(e[s],e[s+1]);return function(o){var c=xf(t,o,1,n)-1;return i[c](a[c](o))}}function Hd(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function eV(){var t=Pd,e=Pd,r=Rn,n,a,i,s=la,o,c,f;function l(){var g=Math.min(t.length,e.length);return s!==la&&(s=ZL(t[0],t[g-1])),o=g>2?JL:QL,c=f=null,u}function u(g){return g==null||isNaN(g=+g)?i:(c||(c=o(t.map(n),e,r)))(n(s(g)))}return u.invert=function(g){return s(a((f||(f=o(e,t.map(n),Xr)))(g)))},u.domain=function(g){return arguments.length?(t=Array.from(g,Df),l()):t.slice()},u.range=function(g){return arguments.length?(e=Array.from(g),l()):e.slice()},u.rangeRound=function(g){return e=Array.from(g),r=Mf,l()},u.clamp=function(g){return arguments.length?(s=g?!0:la,l()):s!==la},u.interpolate=function(g){return arguments.length?(r=g,l()):r},u.unknown=function(g){return arguments.length?(i=g,u):i},function(g,p){return n=g,a=p,l()}}function Vf(){return eV()(la,la)}function Id(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Dn(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function nr(t){return t=Dn(Math.abs(t)),t?t[1]:NaN}function jd(t,e){return function(r,n){for(var a=r.length,i=[],s=0,o=t[0],c=0;a>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),i.push(r.substring(a-=o,a+o)),!((c+=o+1)>n));)o=t[s=(s+1)%t.length];return i.reverse().join(e)}}function Kd(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var tV=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Yr(t){if(!(e=tV.exec(t)))throw new Error("invalid format: "+t);var e;return new Us({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Yr.prototype=Us.prototype;function Us(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Us.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $d(t){e:for(var e=t.length,r=1,n=-1,a;r<e;++r)switch(t[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(a+1):t}var Ff;function Xd(t,e){var r=Dn(t,e);if(!r)return t+"";var n=r[0],a=r[1],i=a-(Ff=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=n.length;return i===s?n:i>s?n+new Array(i-s+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+Dn(t,Math.max(0,e+i-1))[0]}function kf(t,e){var r=Dn(t,e);if(!r)return t+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var bf={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Id,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>kf(t*100,e),r:kf,s:Xd,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Uf(t){return t}var Yd=Array.prototype.map,qd=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Zd(t){var e=t.grouping===void 0||t.thousands===void 0?Uf:jd(Yd.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?Uf:Kd(Yd.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"\u2212":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function f(u){u=Yr(u);var g=u.fill,p=u.align,d=u.sign,h=u.symbol,v=u.zero,x=u.width,T=u.comma,m=u.precision,y=u.trim,S=u.type;S==="n"?(T=!0,S="g"):bf[S]||(m===void 0&&(m=12),y=!0,S="g"),(v||g==="0"&&p==="=")&&(v=!0,g="0",p="=");var C=h==="$"?r:h==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",E=h==="$"?n:/[%p]/.test(S)?s:"",O=bf[S],U=/[defgprs%]/.test(S);m=m===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function k(V){var b=C,R=E,M,N,L;if(S==="c")R=O(V)+R,V="";else{V=+V;var B=V<0||1/V<0;if(V=isNaN(V)?c:O(Math.abs(V),m),y&&(V=$d(V)),B&&+V==0&&d!=="+"&&(B=!1),b=(B?d==="("?d:o:d==="-"||d==="("?"":d)+b,R=(S==="s"?qd[8+Ff/3]:"")+R+(B&&d==="("?")":""),U){for(M=-1,N=V.length;++M<N;)if(L=V.charCodeAt(M),48>L||L>57){R=(L===46?a+V.slice(M+1):V.slice(M))+R,V=V.slice(0,M);break}}}T&&!v&&(V=e(V,1/0));var G=b.length+V.length+R.length,F=G<x?new Array(x-G+1).join(g):"";switch(T&&v&&(V=e(F+V,F.length?x-R.length:1/0),F=""),p){case"<":V=b+V+R+F;break;case"=":V=b+F+V+R;break;case"^":V=F.slice(0,G=F.length>>1)+b+V+R+F.slice(G);break;default:V=F+b+V+R;break}return i(V)}return k.toString=function(){return u+""},k}function l(u,g){var p=f((u=Yr(u),u.type="f",u)),d=Math.max(-8,Math.min(8,Math.floor(nr(g)/3)))*3,h=Math.pow(10,-d),v=qd[8+d/3];return function(x){return p(h*x)+v}}return{format:f,formatPrefix:l}}var Ns,Bs,Gs;Nf({thousands:",",grouping:[3],currency:["$",""]});function Nf(t){return Ns=Zd(t),Bs=Ns.format,Gs=Ns.formatPrefix,Ns}function Bf(t){return Math.max(0,-nr(Math.abs(t)))}function Gf(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(nr(e)/3)))*3-nr(Math.abs(t)))}function _f(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,nr(e)-nr(t))+1}function Wf(t,e,r,n){var a=yf(t,e,r),i;switch(n=Yr(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(i=Gf(a,s))&&(n.precision=i),Gs(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=_f(a,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=Bf(a))&&(n.precision=i-(n.type==="%")*2);break}}return Bs(n)}function rV(t){var e=t.domain;return t.ticks=function(r){var n=e();return Rs(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var a=e();return Wf(a[0],a[a.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),a=0,i=n.length-1,s=n[a],o=n[i],c,f,l=10;for(o<s&&(f=s,s=o,o=f,f=a,a=i,i=f);l-- >0;){if(f=$a(s,o,r),f===c)return n[a]=s,n[i]=o,e(n);if(f>0)s=Math.floor(s/f)*f,o=Math.ceil(o/f)*f;else if(f<0)s=Math.ceil(s*f)/f,o=Math.floor(o*f)/f;else break;c=f}return t},t}function Ln(){var t=Vf();return t.copy=function(){return Hd(t,Ln())},Sd.apply(t,arguments),rV(t)}var nV={DISPLAY:0,WORLD:1},zf={CoordinateSystem:nV};var{CoordinateSystem:Af}=zf;function Jd(t){return()=>w.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function aV(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){let a=e.textures[n].getMTime();a>r&&(r=a)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=Jd("pick"),t.hasKey=Jd("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{let n=e.textures.filter(a=>a!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(Af.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(Af.DISPLAY)}var iV={allocatedRenderTime:10,coordinateSystem:Af.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function ev(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iV,r),w.obj(t,e),w.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),w.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),w.moveToProtected(t,e,["parentProp"]),aV(t,e)}var sV=w.newInstance(ev,"vtkProp"),ar={newInstance:sV,extend:ev,...zf};var oV=1e-6;function cV(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((a,i)=>a+n[i]),t.modified()},t.getOrientationWXYZ=()=>{let n=ze.create();D.getRotation(n,e.rotation);let a=new Float64Array(3),i=ze.getAxisAngle(a,n);return[mr(i),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return D.getRotation(n,e.rotation)},t.rotateX=n=>{n!==0&&(D.rotateX(e.rotation,e.rotation,Fe(n)),t.modified())},t.rotateY=n=>{n!==0&&(D.rotateY(e.rotation,e.rotation,Fe(n)),t.modified())},t.rotateZ=n=>{n!==0&&(D.rotateZ(e.rotation,e.rotation,Fe(n)),t.modified())},t.rotateWXYZ=(n,a,i,s)=>{if(n===0||a===0&&i===0&&s===0)return;let o=Fe(n),c=ze.create();ze.setAxisAngle(c,[a,i,s],o);let f=new Float64Array(16);D.fromQuat(f,c),D.multiply(e.rotation,e.rotation,f),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-oV)return;let a=D.fromQuat(new Float64Array(16),n);D.multiply(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(n,a,i)=>n===e.orientation[0]&&a===e.orientation[1]&&i===e.orientation[2]?!1:(e.orientation=[n,a,i],D.identity(e.rotation),t.rotateZ(i),t.rotateX(n),t.rotateY(a),t.modified(),!0),t.setOrientationFromQuaternion=n=>{let a=D.create();return D.fromQuat(a,n),Ur(a,e.rotation)?!1:(e.rotation=a,t.modified(),!0)},t.setUserMatrix=n=>Ur(e.userMatrix,n)?!1:(D.copy(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){D.identity(e.matrix),e.userMatrix&&D.multiply(e.matrix,e.matrix,e.userMatrix),D.translate(e.matrix,e.matrix,e.origin),D.translate(e.matrix,e.matrix,e.position),D.multiply(e.matrix,e.matrix,e.rotation),D.scale(e.matrix,e.matrix,e.scale),D.translate(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),D.transpose(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let a=0;a<4;++a)(n===a?1:0)!==e.matrix[n+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;let n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n,e.bounds=[...se.INIT_BOUNDS],e.boundsMTime.modified(),n;if(!e.mapperBounds||!n.every((a,i)=>n[i]===e.mapperBounds[i])||t.getMTime()>e.boundsMTime.getMTime()){w.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=n,t.computeMatrix();let a=new Float64Array(16);D.transpose(a,e.matrix),se.transformBounds(n,a,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{let n=t.getBoundsByReference();try{return[...n]}catch{return n}},t.getCenter=()=>se.getCenter(e.bounds),t.getLength=()=>se.getLength(e.bounds),t.getXRange=()=>se.getXRange(e.bounds),t.getYRange=()=>se.getYRange(e.bounds),t.getZRange=()=>se.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r),t.getProperty=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[n]==null&&(e.properties[n]=t.makeProperty?.()),e.properties[n]},t.getProperties=()=>(e.properties.length===0&&(e.properties[0]=t.makeProperty?.()),e.properties),t.setProperty=(n,a)=>{let i=Number.isInteger(n),[s,o]=i?[n,a]:[0,n];return e.properties[s]===o?!1:(e.properties[s]=o,!0)},t.getMTime=()=>{let n=e.mtime;return e.properties.forEach(a=>{if(a!==null){let i=a.getMTime();n=i>n?i:n}}),n}}var fV={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...se.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function tv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fV,r),ar.extend(t,e,r),e.matrixMTime={},w.obj(e.matrixMTime),w.get(t,e,["isIdentity"]),w.getArray(t,e,["orientation"]),w.setGetArray(t,e,["origin","position","scale"],3),w.setGet(t,e,["properties"]),e.matrix=D.identity(new Float64Array(16)),e.rotation=D.identity(new Float64Array(16)),e.userMatrix=D.identity(new Float64Array(16)),e.transform=null,cV(t,e)}var uV=w.newInstance(tv,"vtkProp3D"),_s={newInstance:uV,extend:tv};function lV(t,e){e.classHierarchy.push("vtkActor");let r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let n=e.properties[0].getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=Gt.newInstance,t.getMTime=()=>{let n=r.getMTime();if(e.backfaceProperty!==null){let a=e.backfaceProperty.getMTime();n=a>n?a:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();n=a>n?a:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),n=a>n?a:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,a)}}var gV={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function rv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gV,r),_s.extend(t,e,r),e.boundsMTime={},w.obj(e.boundsMTime),w.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),lV(t,e)}var pV=w.newInstance(rv,"vtkActor"),Wt={newInstance:pV,extend:rv};function hV(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{let n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{let n=r.length;for(let a=0;a<n&&a<6;a++)t.addClippingPlane(r[a])}},t.getClippingPlaneInDataCoords=(r,n,a)=>{let i=e.clippingPlanes,s=r;if(i){let o=i.length;if(n>=0&&n<o){let c=i[n],f=c.getNormal(),l=c.getOrigin(),u=f[0],g=f[1],p=f[2],d=-(u*l[0]+g*l[1]+p*l[2]);a[0]=u*s[0]+g*s[4]+p*s[8]+d*s[12],a[1]=u*s[1]+g*s[5]+p*s[9]+d*s[13],a[2]=u*s[2]+g*s[6]+p*s[10]+d*s[14],a[3]=u*s[3]+g*s[7]+p*s[11]+d*s[15];return}}w.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}var dV={clippingPlanes:[]};function vV(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dV,r),w.obj(t,e),w.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),hV(t,e)}var nv={extend:vV};function mV(t,e){t.getBounds=()=>(w.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),hn()),t.getCenter=()=>{let r=t.getBounds();return e.center=se.isValid(r)?se.getCenter(r):null,e.center?.slice()},t.getLength=()=>{let r=t.getBounds();return se.getDiagonalLength(r)}}var xV=t=>({bounds:[...se.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function yV(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xV(r)),nv.extend(t,e,r),w.setGet(t,e,["viewSpecificProperties"]),mV(t,e)}var Ws={extend:yV};var kt={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9},Pf={StructuredType:kt};var{StructuredType:Er}=Pf;function TV(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Er.EMPTY:e===3?Er.XYZ_GRID:e===2?t[0]===t[1]?Er.YZ_PLANE:t[2]===t[3]?Er.XZ_PLANE:Er.XY_PLANE:e===1?t[0]<t[1]?Er.X_LINE:t[2]<t[3]?Er.Y_LINE:Er.Z_LINE:Er.SINGLE_POINT}var av={getDataDescriptionFromExtent:TV,...Pf};var{vtkErrorMacro:Vn}=w;function SV(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Vn("instance deleted - cannot call any method"),!1;for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];let s=a.length===1?a[0]:a;if(s.length!==6)return!1;let o=e.extent.some((c,f)=>c!==s[f]);return o&&(e.extent=s.slice(),e.dataDescription=av.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,a,i;if(e.deleted){Vn("instance deleted - cannot call any method");return}if(arguments.length===1){let s=arguments.length<=0?void 0:arguments[0];n=s[0],a=s[1],i=s[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],a=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{Vn("Bad dimension specification");return}t.setExtent(0,n-1,0,a-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{let n=t.getDimensions(),a=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(a*=n[i]-1)}return a},t.getNumberOfPoints=()=>{let n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{let a=t.getDimensions();if(a[0]===0||a[1]===0||a[2]===0)return Vn("Requesting a point from an empty image."),null;let i=new Float64Array(3);switch(e.dataDescription){case kt.EMPTY:return null;case kt.SINGLE_POINT:break;case kt.X_LINE:i[0]=n;break;case kt.Y_LINE:i[1]=n;break;case kt.Z_LINE:i[2]=n;break;case kt.XY_PLANE:i[0]=n%a[0],i[1]=n/a[0];break;case kt.YZ_PLANE:i[1]=n%a[1],i[2]=n/a[1];break;case kt.XZ_PLANE:i[0]=n%a[0],i[2]=n/a[0];break;case kt.XYZ_GRID:i[0]=n%a[0],i[1]=n/a[0]%a[1],i[2]=n/(a[0]*a[1]);break;default:Vn("Invalid dataDescription");break}let s=[0,0,0];return t.indexToWorld(i,s),s},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>se.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>se.inflate([...e.extent],.5),t.computeTransforms=()=>{D.fromTranslation(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],D.scale(e.indexToWorld,e.indexToWorld,e.spacing),D.invert(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return P.transformMat4(a,n,e.indexToWorld),a},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return P.transformMat4(a,n,e.worldToIndex),a},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return se.transformBounds(n,e.indexToWorld,a)},t.worldToIndexBounds=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return se.transformBounds(n,e.worldToIndex,a)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>se.getCenter(t.getBounds()),t.computeHistogram=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);let s=[0,0,0],o=[0,0,0];se.computeCornerPoints(i,s,o),Ji(s,s),Ji(o,o);let c=t.getDimensions();ts(s,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],s),ts(o,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],o);let f=c[0],l=c[0]*c[1],u=t.getPointData().getScalars().getData(),g=-1/0,p=1/0,d=0,h=0,v=0;for(let y=s[2];y<=o[2];y++)for(let S=s[1];S<=o[1];S++){let C=s[0]+S*f+y*l;for(let E=s[0];E<=o[0];E++){if(!a||a([E,S,y],i)){let O=u[C];O>g&&(g=O),O<p&&(p=O),d+=O*O,h+=O,v+=1}++C}}let x=v>0?h/v:0,T=v?Math.abs(d/v-x*x):0,m=Math.sqrt(T);return{minimum:p,maximum:g,average:x,variance:T,sigma:m,count:v}},t.computeIncrements=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=[],s=a;for(let o=0;o<3;++o)i[o]=s,s*=n[o*2+1]-n[o*2]+1;return i},t.computeOffsetIndex=n=>{let[a,i,s]=n,o=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),f=t.computeIncrements(o,c);return Math.floor((Math.round(a)-o[0])*f[0]+(Math.round(i)-o[2])*f[1]+(Math.round(s)-o[4])*f[2])},t.getOffsetIndexFromWorld=n=>{let a=t.getExtent(),i=t.worldToIndex(n);for(let s=0;s<3;++s)if(i[s]<a[s*2]||i[s]>a[s*2+1])return Vn(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${a}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=t.getPointData().getScalars().getNumberOfComponents();if(a<0||a>=i)return Vn(`GetScalarPointer: Scalar Component ${a} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;let s=t.getOffsetIndexFromWorld(n);return Number.isNaN(s)?s:t.getPointData().getScalars().getComponent(s,a)};let r=t.initialize;t.initialize=()=>(t.set({direction:ee.identity(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:kt.EMPTY}),r())}var CV={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:kt.EMPTY};function iv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CV,r),yt.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=ee.identity(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),w.get(t,e,["indexToWorld","worldToIndex"]),w.setGetArray(t,e,["origin","spacing"],3),w.setGetArray(t,e,["direction"],9),w.getArray(t,e,["extent"],6),SV(t,e)}var wV=w.newInstance(iv,"vtkImageData"),zs={newInstance:wV,extend:iv};var OV={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},As={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},EV={LINEAR:0,LOG10:1},Qa={VectorMode:OV,ScalarMappingTarget:As,Scale:EV};var MV={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},RV={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},DV={BY_ID:0,BY_NAME:1},Ja={ColorMode:MV,GetArray:DV,ScalarMode:RV};var{ScalarMappingTarget:sv,Scale:LV,VectorMode:ir}=Qa,{VtkDataTypes:qr}=K,{ColorMode:Ps}=Ja,{vtkErrorMacro:ov}=w;function VV(t){return t}function cv(t){return Math.floor(t*255+.5)}function FV(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(ir.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(ir.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(ir.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){ov("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){let a=n.length;for(let i=0;i<a;i++)e.annotationArray.push({value:r[i],annotation:String(n[i])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let a=t.checkForAnnotatedValue(r),i=!1;return a>=0?e.annotationArray[a].annotation!==n&&(e.annotationArray[a].annotation=n,i=!0):(e.annotationArray.push({value:r,annotation:n}),a=e.annotationArray.length-1,i=!0),i&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{let n=t.checkForAnnotatedValue(r),a=n>=0;return a&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){let a=t.getAnnotatedValueIndex(r);t.getIndexedColor(a,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){let n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];let r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,a)=>{let i=r.getNumberOfComponents(),s=null;if(n===Ps.DEFAULT&&(r.getDataType()===qr.UNSIGNED_CHAR||r.getDataType()===qr.UNSIGNED_CHAR_CLAMPED)||n===Ps.DIRECT_SCALARS&&r)s=t.convertToRGBA(r,i,r.getNumberOfTuples());else{let o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:qr.UNSIGNED_CHAR},c=w.newTypedArray(o.dataType,4*r.getNumberOfTuples());o.values=c,o.size=c.length,s=K.newInstance(o);let f=a;f<0&&i>1?t.mapVectorsThroughTable(r,s,sv.RGBA,-1,-1):(f<0&&(f=0),f>=i&&(f=i-1),t.mapScalarsThroughTable(r,s,sv.RGBA,f))}return s},t.mapVectorsToMagnitude=(r,n,a)=>{let i=r.getNumberOfTuples(),s=r.getNumberOfComponents(),o=n.getData(),c=r.getData();for(let f=0;f<i;f++){let l=0;for(let u=0;u<a;u++)l+=c[f*s+u]*c[f*s+u];o[f]=Math.sqrt(l)}},t.mapVectorsThroughTable=(r,n,a,i,s)=>{let o=t.getVectorMode(),c=s,f=i,l=r.getNumberOfComponents();o===ir.COMPONENT?(f===-1&&(f=t.getVectorComponent()),f<0&&(f=0),f>=l&&(f=l-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(f=0,c=l):(f<0&&(f=0),f>=l&&(f=l-1),f+c>l&&(c=l-f)),o===ir.MAGNITUDE&&(l===1||c===1)&&(o=ir.COMPONENT));let u=0;switch(f>0&&(u=f),o){case ir.COMPONENT:{t.mapScalarsThroughTable(r,n,a,u);break}case ir.RGBCOLORS:break;case ir.MAGNITUDE:default:{let g=K.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,g,c),t.mapScalarsThroughTable(g,n,a,0);break}}},t.luminanceToRGBA=(r,n,a,i)=>{let s=i(a),o=n.getData(),c=r.getData(),f=o.length,l=0,u=1,g=0;for(let p=l;p<f;p+=u){let d=i(o[p]);c[g*4]=d,c[g*4+1]=d,c[g*4+2]=d,c[g*4+3]=s,g++}},t.luminanceAlphaToRGBA=(r,n,a,i)=>{let s=n.getData(),o=r.getData(),c=s.length,f=0,l=2,u=0;for(let g=f;g<c;g+=l){let p=i(s[g]);o[u]=p,o[u+1]=p,o[u+2]=p,o[u+3]=i(s[g+1])*a,u+=4}},t.rGBToRGBA=(r,n,a,i)=>{let s=cv(a),o=n.getData(),c=r.getData(),f=o.length,l=0,u=3,g=0;for(let p=l;p<f;p+=u)c[g*4]=i(o[p]),c[g*4+1]=i(o[p+1]),c[g*4+2]=i(o[p+2]),c[g*4+3]=s,g++},t.rGBAToRGBA=(r,n,a,i)=>{let s=n.getData(),o=r.getData(),c=s.length,f=0,l=4,u=0;for(let g=f;g<c;g+=l)o[u*4]=i(s[g]),o[u*4+1]=i(s[g+1]),o[u*4+2]=i(s[g+2]),o[u*4+3]=i(s[g+3])*a,u++},t.convertToRGBA=(r,n,a)=>{let{alpha:i}=e;if(n===4&&i>=1&&r.getDataType()===qr.UNSIGNED_CHAR)return r;let s=K.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:qr.UNSIGNED_CHAR});if(a<=0)return s;i=i>0?i:0,i=i<1?i:1;let o=VV;switch((r.getDataType()===qr.FLOAT||r.getDataType()===qr.DOUBLE)&&(o=cv),n){case 1:t.luminanceToRGBA(s,r,i,o);break;case 2:t.luminanceAlphaToRGBA(s,r,o);break;case 3:t.rGBToRGBA(s,r,i,o);break;case 4:t.rGBAToRGBA(s,r,i,o);break;default:return ov("Cannot convert colors"),null}return s},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,a)=>{if(!r)return t.isOpaque();let i=r.getNumberOfComponents();return n===Ps.DEFAULT&&r.getDataType()===qr.UNSIGNED_CHAR||n===Ps.DIRECT_SCALARS?i===3||i===1?e.alpha>=1:r.getRange(i-1)[0]===255:!0}}var kV={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:ir.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:LV.LINEAR};function fv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kV,r),w.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],w.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),w.setArray(t,e,["mappingRange"],2),w.getArray(t,e,["mappingRange"]),FV(t,e)}var bV=w.newInstance(fv,"vtkScalarsToColors"),Fn={newInstance:bV,extend:fv,...Qa};var{vtkErrorMacro:uv}=w,lv=0,gv=1,Hf=2;function UV(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let a=0,i=Number(r);return i<n.range[0]?a=n.maxIndex+lv+1.5:i>n.range[1]?a=n.maxIndex+gv+1.5:(a=(i+n.shift)*n.scale,a=a<n.maxIndex?a:n.maxIndex),Math.floor(a)},t.linearLookup=(r,n,a)=>{let i=0;pn(r)?i=Math.floor(a.maxIndex+1.5+Hf):i=t.linearIndexLookup(r,a);let s=4*i;return n.slice(s,s+4)},t.indexedLookupFunction=(r,n,a)=>{let i=t.getAnnotatedValueIndexInternal(r);i===-1&&(i=e.numberOfColors+Hf);let s=4*i;return[n[s],n[s+1],n[s+2],n[s+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,a,i)=>{let s=t.linearLookup;e.indexedLookup&&(s=t.indexedLookupFunction);let o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);let f=t.getAlpha(),l=r.getNumberOfTuples(),u=r.getNumberOfComponents(),g=n.getData(),p=r.getData();if(f>=1){if(a===As.RGBA)for(let d=0;d<l;d++){let h=s(p[d*u+i],e.table,c);g[d*4]=h[0],g[d*4+1]=h[1],g[d*4+2]=h[2],g[d*4+3]=h[3]}}else if(a===As.RGBA)for(let d=0;d<l;d++){let h=s(p[d*u+i],e.table,c);g[d*4]=h[0],g[d*4+1]=h[1],g[d*4+2]=h[2],g[d*4+3]=Math.floor(h[3]*f+.5)}},t.forceBuild=()=>{let r=0,n=0,a=0,i=0,s=e.numberOfColors-1;s&&(r=(e.hueRange[1]-e.hueRange[0])/s,n=(e.saturationRange[1]-e.saturationRange[0])/s,a=(e.valueRange[1]-e.valueRange[0])/s,i=(e.alphaRange[1]-e.alphaRange[0])/s),e.table.length=4*s+16;let o=[],c=[];for(let f=0;f<=s;f++)o[0]=e.hueRange[0]+f*r,o[1]=e.saturationRange[0]+f*n,o[2]=e.valueRange[0]+f*a,yr(o,c),c[3]=e.alphaRange[0]+f*i,e.table[f*4]=c[0]*255+.5,e.table[f*4+1]=c[1]*255+.5,e.table[f*4+2]=c[2]*255+.5,e.table[f*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){let a=r[0].length;e.numberOfColors=r.length;let i=4-a,s=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<r.length;o++){let c=r[o];for(let f=0;f<a;f++)e.table[s++]=c[f];s+=i}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return uv("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==ce.UNSIGNED_CHAR)return uv("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();let n=r.getData();e.table.length=n.length;for(let a=0;a<n.length;a++)e.table[a]=n[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{let{numberOfColors:r}=e,n=e.table,a=(r+lv)*4;e.useBelowRangeColor||r===0?(n[a]=e.belowRangeColor[0]*255+.5,n[a+1]=e.belowRangeColor[1]*255+.5,n[a+2]=e.belowRangeColor[2]*255+.5,n[a+3]=e.belowRangeColor[3]*255+.5):(n[a]=n[0],n[a+1]=n[1],n[a+2]=n[2],n[a+3]=n[3]),a=(r+gv)*4,e.useAboveRangeColor||r===0?(n[a]=e.aboveRangeColor[0]*255+.5,n[a+1]=e.aboveRangeColor[1]*255+.5,n[a+2]=e.aboveRangeColor[2]*255+.5,n[a+3]=e.aboveRangeColor[3]*255+.5):(n[a]=n[4*(r-1)+0],n[a+1]=n[4*(r-1)+1],n[a+2]=n[4*(r-1)+2],n[a+3]=n[4*(r-1)+3]),a=(r+Hf)*4,n[a]=e.nanColor[0]*255+.5,n[a+1]=e.nanColor[1]*255+.5,n[a+2]=e.nanColor[2]*255+.5,n[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}var NV={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function pv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NV,r),Fn.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},w.obj(e.buildTime),e.opaqueFlagBuildTime={},w.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},w.obj(e.insertTime,{mtime:0}),w.get(t,e,["buildTime"]),w.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),w.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),w.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),w.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),UV(t,e)}var BV=w.newInstance(pv,"vtkLookupTable"),hv={newInstance:BV,extend:pv};var ot={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3},If={PassTypes:ot};var{FieldAssociations:dv}=yt,{staticOffsetAPI:GV,otherStaticMethods:_V}=of,{ColorMode:Hs,ScalarMode:kn,GetArray:jf}=Ja,{VectorMode:WV}=Qa,{VtkDataTypes:zV}=K;function ei(t){return()=>w.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function AV(t,e){let r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){let n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function PV(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function vv(t,e,r){let n=Math.floor(e),a=n%(2*r[0]),i,s;a<r[0]?(t[0]=a,i=1,s=t[0]===r[0]-1):(t[0]=2*r[0]-1-a,i=-1,s=t[0]===0);let o=Math.floor(n/r[0]),c=o%(2*r[1]),f,l;c<r[1]?(t[1]=c,f=1,l=t[1]===r[1]-1):(t[1]=2*r[1]-1-c,f=-1,l=t[1]===0),t[2]=Math.floor(o/r[1]);let u=e-n;s?l?t[2]+=u:t[1]+=f*u:t[0]+=i*u,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}var mv=new WeakMap;function HV(t,e,r,n,a,i,s){let o=new Array(arguments.length);for(let b=0;b<arguments.length;++b){let R=arguments[b];o[b]=R.getMTime?.()??R}let c=o.join("/"),f=mv.get(t);if(f&&f.stringHash===c)return f.textureCoordinates;let l=(r[1]-r[0])/(a-1),[u,g]=[r[0]-l,r[1]+l],p=u-.5*l,d=1/(g-u+l),h=u,v=(a+1)/(g-u),x=t.getData(),T=t.getNumberOfTuples(),m=t.getNumberOfComponents(),y=e<0||e>=m,S=i[2]<=1?2:3,C=K.newInstance({numberOfComponents:S,values:new Float32Array(T*S)}),E=C.getData(),O=[0,0,0];vv(O,a+2,i);let U=0,k=0,V=[.5,.5,.5];for(let b=0;b<T;++b){let R;if(y){let M=0;for(let N=0;N<m;++N){let L=Number(x[U+N]);M+=L*L}R=Math.sqrt(M)}else R=Number(x[U+e]);if(n&&(R=Math.log10(R)),U+=m,pn(R))V[0]=O[0],V[1]=O[1],V[2]=O[2];else if(s){let M=(R-h)*v;M<1?M=0:M>a&&(M=a+1),vv(V,M,i)}else{V[1]=.49;let M=(R-p)*d;M>1e3?V[0]=1e3:M<-1e3?V[0]=-1e3:V[0]=M}for(let M=0;M<S;++M)E[k++]=V[M]}return mv.set(t,{stringHash:c,textureCoordinates:C}),C}function IV(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{let r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=hn(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=hv.newInstance()},t.getColorModeAsString=()=>w.enumToString(Hs,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>w.enumToString(kn,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,a,i,s)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(n===kn.DEFAULT)o=r.getPointData().getScalars(),o||(o=r.getCellData().getScalars(),c=!0);else if(n===kn.USE_POINT_DATA)o=r.getPointData().getScalars();else if(n===kn.USE_CELL_DATA)o=r.getCellData().getScalars(),c=!0;else if(n===kn.USE_POINT_FIELD_DATA){let f=r.getPointData();a===jf.BY_ID?o=f.getArrayByIndex(i):o=f.getArrayByName(s)}else if(n===kn.USE_CELL_FIELD_DATA){let f=r.getCellData();c=!0,a===jf.BY_ID?o=f.getArrayByIndex(i):o=f.getArrayByName(s)}else if(n===kn.USE_FIELD_DATA){let f=r.getFieldData();a===jf.BY_ID?o=f.getArrayByIndex(i):o=f.getArrayByName(s)}return{scalars:o,cellFlag:c}},t.mapScalars=(r,n)=>{let{scalars:a,cellFlag:i}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=i,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}let s=`${t.getMTime()}${a.getMTime()}${n}`;if(e.colorBuildString!==s){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,i))e.mapScalarsToTexture(a,i,n);else{e.colorCoordinates=null,e.colorTextureMap=null;let o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,a)=>{let i=e.lookupTable.getRange(),s=e.lookupTable.usingLogScale(),o=e.lookupTable.getAlpha(),c=s?[Math.log10(i[0]),Math.log10(i[1])]:i;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();let l=e.lookupTable.getNumberOfAvailableColors(),u=2048,g=u**3-3,d=4096-2,h=2,v=n?g:d;e.numberOfColorsInRange=Math.min(Math.max(l,h),v);let x=e.numberOfColorsInRange+3,T=e.numberOfColorsInRange+2,m=n?[Math.min(Math.ceil(x/u**0),u),Math.min(Math.ceil(x/u**1),u),Math.min(Math.ceil(x/u**2),u)]:[T,2,1],y=m[0]*m[1]*m[2],S=new Float64Array(y);S.fill(NaN);let C=e.numberOfColorsInRange,E=C+2,O=[0,0,0],U=c[0],k=c[1]-c[0];for(let R=0;R<E;++R){let M=PV(O,m),N=U+k*(R-1)/(C-1),L=s?10**N:N;S[M]=L,AV(O,m)}let V=K.newInstance({numberOfComponents:1,values:S}),b=e.lookupTable.mapScalars(V,e.colorMode,0);e.colorTextureMap=zs.newInstance(),e.colorTextureMap.setDimensions(m),e.colorTextureMap.getPointData().setScalars(b),e.lookupTable.setAlpha(o)}let f=e.lookupTable.getVectorMode()===WV.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=HV(r,f,c,s,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),n)},t.getIsOpaque=()=>{let r=t.getInputData(),a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;let i=t.getLookupTable();return i?(i.build(),i.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==Hs.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===Hs.DEFAULT&&r.getDataType()===zV.UNSIGNED_CHAR||e.colorMode===Hs.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){let n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{let r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=ei("AcquireInvertibleLookupTable"),t.valueToColor=ei("ValueToColor"),t.colorToValue=ei("ColorToValue"),t.useInvertibleColorFor=ei("UseInvertibleColorFor"),t.clearInvertibleColor=ei("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;let a=r.getRawPixelBuffer(ot.ID_LOW24),i=r.getRawPixelBuffer(ot.ID_HIGH24),s=r.getCurrentPass(),o=r.getFieldAssociation(),c=null;o===dv.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===dv.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&n.forEach(f=>{if(s===ot.ID_LOW24){let l=0;i&&(l+=i[f],l*=256),l+=a[f+2],l*=256,l+=a[f+1],l*=256,l+=a[f];let u=c[l],g=r.getPixelBuffer(ot.ID_LOW24);g[f]=u&255,g[f+1]=(u&65280)>>8,g[f+2]=(u&16711680)>>16}else if(s===ot.ID_HIGH24&&i){let l=0;l+=i[f],l*=256,l+=a[f+2],l*=256,l+=a[f+1],l*=256,l+=a[f];let u=c[l],g=r.getPixelBuffer(ot.ID_HIGH24);g[f]=(u&4278190080)>>24}})}}var jV={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function xv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jV,r),Ws.extend(t,e,r),w.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),w.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),w.setGetArray(t,e,["scalarRange"],2),of.implementCoincidentTopologyMethods(t,e),IV(t,e)}var KV=w.newInstance(xv,"vtkMapper"),ht={newInstance:KV,extend:xv,...GV,..._V,...Ja};function $V(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.imageBitmap=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setImageBitmap=r=>{e.imageBitmap!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.jsImageData=null),e.imageBitmap=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.imageBitmap=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null,e.imageBitmap=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,a=1;if(t.getInputData()){let s=t.getInputData();r=s.getDimensions()[0],n=s.getDimensions()[1],a=s.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),e.imageBitmap&&(r=e.imageBitmap.width,n=e.imageBitmap.height),(r>1)+(n>1)+(a>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData;if(e.imageBitmap)return e.imageBitmap;if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){let r=e.image.width,n=e.image.height,i=new OffscreenCanvas(r,n).getContext("2d");return i.translate(0,n),i.scale(1,-1),i.drawImage(e.image,0,0,r,n),i.getImageData(0,0,r,n)}return null}}var XV=(t,e,r)=>{let a=t.createShaderModule({code:`
    @group(0) @binding(0) var inputTexture: texture_2d<f32>;
    @group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;

    @compute @workgroup_size(8, 8)
    fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
      let texelCoord = vec2<i32>(global_id.xy);
      let outputSize = textureDimensions(outputTexture);

      if (texelCoord.x >= i32(outputSize.x) || texelCoord.y >= i32(outputSize.y)) {
        return;
      }

      let inputSize = textureDimensions(inputTexture);
      let scale = vec2<f32>(inputSize) / vec2<f32>(outputSize);

      // Compute the floating-point source coordinate
      let srcCoord = (vec2<f32>(texelCoord) + 0.5) * scale - 0.5;

      // Get integer coordinates for the four surrounding texels
      let x0 = i32(floor(srcCoord.x));
      let x1 = min(x0 + 1, i32(inputSize.x) - 1);
      let y0 = i32(floor(srcCoord.y));
      let y1 = min(y0 + 1, i32(inputSize.y) - 1);

      // Compute the weights
      let wx = srcCoord.x - f32(x0);
      let wy = srcCoord.y - f32(y0);

      // Fetch the four texels
      let c00 = textureLoad(inputTexture, vec2<i32>(x0, y0), 0);
      let c10 = textureLoad(inputTexture, vec2<i32>(x1, y0), 0);
      let c01 = textureLoad(inputTexture, vec2<i32>(x0, y1), 0);
      let c11 = textureLoad(inputTexture, vec2<i32>(x1, y1), 0);

      // Bilinear interpolation
      let color = mix(
        mix(c00, c10, wx),
        mix(c01, c11, wx),
        wy
      );

      textureStore(outputTexture, texelCoord, color);
    }
  `}),i=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm",access:"write-only"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),s=t.createPipelineLayout({bindGroupLayouts:[i]}),o=t.createComputePipeline({label:"ComputeMipmapPipeline",layout:s,compute:{module:a,entryPoint:"main"}}),c=t.createSampler({magFilter:"linear",minFilter:"linear"});for(let f=1;f<r;f++){let l=e.createView({baseMipLevel:f-1,mipLevelCount:1}),u=e.createView({baseMipLevel:f,mipLevelCount:1}),g=t.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:l},{binding:1,resource:u},{binding:2,resource:c}]}),p=t.createCommandEncoder({label:"MipmapGenerateCommandEncoder"}),d=p.beginComputePass();d.setPipeline(o),d.setBindGroup(0,g);let h=Math.max(1,e.width>>f),v=Math.max(1,e.height>>f),x=Math.ceil(h/8),T=Math.ceil(v/8);d.dispatchWorkgroups(x,T),d.end(),t.queue.submit([p.finish()])}},YV={image:null,canvas:null,jsImageData:null,imageBitmap:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function yv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YV,r),w.obj(t,e),w.algo(t,e,6,0),w.get(t,e,["canvas","image","jsImageData","imageBitmap","imageLoaded","resizable"]),w.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),$V(t,e)}var qV=w.newInstance(yv,"vtkTexture"),ZV={generateMipmaps:XV},Mr={newInstance:qV,extend:yv,...ZV};var QV=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],Tv=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],Is=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],Sv=[0,1,0,1,0,1,0,1,2,2,2,2],We=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],pe=new Float64Array(3),js=new Float64Array(3),Ee=new Float64Array(3),Un=new Float64Array(3),bn=new Float64Array(3),Ks=new Float64Array(3),Kf=new Float64Array(16);function $f(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function Cv(t){let e=[],r=[];for(let n=0;n<3;n++){let a=Ln().domain([t[n*2],t[n*2+1]]);e[n]=a.ticks(5);let i=a.tickFormat(5);r[n]=e[n].map(i)}return{ticks:e,tickStrings:r}}function JV(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=r=>{e.renderable!==r&&(e.renderable=r,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(r.getProperty()),e.tmActor.setParentProp(r),t.modified())},t.createPolyDataForOneLabel=(r,n,a,i,s,o,c)=>{let f=e.renderable.get_tmAtlas().get(r);if(!f)return;let l=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;pe[0]=l[n*3],pe[1]=l[n*3+1],pe[2]=l[n*3+2],P.transformMat4(Ee,pe,a),Ee[0]+=.1,P.transformMat4(js,Ee,i),P.subtract(bn,js,pe),Ee[0]-=.1,Ee[1]+=.1,P.transformMat4(js,Ee,i),P.subtract(Ks,js,pe);for(let d=0;d<3;d++)bn[d]/=.5*.1*u[0],Ks[d]/=.5*.1*u[1];let g=c.ptIdx,p=c.cellIdx;pe[0]=l[n*3],pe[1]=l[n*3+1],pe[2]=l[n*3+2],s[0]<-.5?P.scale(Ee,bn,s[0]*o-f.width):s[0]>.5?P.scale(Ee,bn,s[0]*o):P.scale(Ee,bn,s[0]*o-f.width/2),P.add(pe,pe,Ee),P.scale(Ee,Ks,s[1]*o-f.height/2),P.add(pe,pe,Ee),c.points[g*3]=pe[0],c.points[g*3+1]=pe[1],c.points[g*3+2]=pe[2],c.tcoords[g*2]=f.tcoords[0],c.tcoords[g*2+1]=f.tcoords[1],g++,P.scale(Ee,bn,f.width),P.add(pe,pe,Ee),c.points[g*3]=pe[0],c.points[g*3+1]=pe[1],c.points[g*3+2]=pe[2],c.tcoords[g*2]=f.tcoords[2],c.tcoords[g*2+1]=f.tcoords[3],g++,P.scale(Ee,Ks,f.height),P.add(pe,pe,Ee),c.points[g*3]=pe[0],c.points[g*3+1]=pe[1],c.points[g*3+2]=pe[2],c.tcoords[g*2]=f.tcoords[4],c.tcoords[g*2+1]=f.tcoords[5],g++,P.scale(Ee,bn,f.width),P.subtract(pe,pe,Ee),c.points[g*3]=pe[0],c.points[g*3+1]=pe[1],c.points[g*3+2]=pe[2],c.tcoords[g*2]=f.tcoords[6],c.tcoords[g*2+1]=f.tcoords[7],g++,c.polys[p*4]=3,c.polys[p*4+1]=g-4,c.polys[p*4+2]=g-3,c.polys[p*4+3]=g-2,p++,c.polys[p*4]=3,c.polys[p*4+1]=g-4,c.polys[p*4+2]=g-2,c.polys[p*4+3]=g-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{let r=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);D.transpose(r,r);let n=e.renderable.getTextValues().length,a=n*4,i=n*2,s=new Float64Array(a*3),o=new Uint16Array(i*4),c=new Float32Array(a*2);D.invert(Kf,r);let f={ptIdx:0,cellIdx:0,polys:o,points:s,tcoords:c},l=0,u=0,g=0,p=e.renderable.getTextPolyData().getPoints().getData(),d=e.renderable.getTextValues();for(;l<p.length/3;){pe[0]=p[l*3],pe[1]=p[l*3+1],pe[2]=p[l*3+2],P.transformMat4(Ee,pe,r),pe[0]=p[l*3+3],pe[1]=p[l*3+4],pe[2]=p[l*3+5],P.transformMat4(Un,pe,r),P.subtract(Ee,Ee,Un);let v=[Ee[0],Ee[1]];Rc(v),t.createPolyDataForOneLabel(d[u],l,r,Kf,v,e.renderable.getAxisTitlePixelOffset(),f),l+=2,u++;for(let x=0;x<e.renderable.getTickCounts()[g];x++)t.createPolyDataForOneLabel(d[u],l,r,Kf,v,e.renderable.getTickLabelPixelOffset(),f),l++,u++;g++}let h=K.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(h),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(r,n,a)=>{(e.lastSize[0]!==r[0]||e.lastSize[1]!==r[1])&&(e.lastSize[0]=r[0],e.lastSize[1]=r[1],e.lastAspectRatio=r[0]/r[1],e.forceUpdate=!0),e.camera=n,t.updateTexturePolyData()}}var eF=w.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),w.obj(t,e),e.tmPolyData=Re.newInstance(),e.tmMapper=ht.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=Wt.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),w.setGet(t,e,["renderable"]),w.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},w.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},w.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],JV(t,e)},"vtkCubeAxesActorHelper");function tF(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=n=>{e.camera!==n&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=n,n&&(e.cameraModifiedSub=n.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{let n=e.camera.getViewMatrix();D.transpose(n,n);let a=!1,i=se.getDiagonalLength(e.dataBounds),s=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let c=!1,f=Math.floor(o/2),l=(f+1)%3,u=(f+2)%3;e.dataBounds[l*2]!==e.dataBounds[l*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&(pe[f]=e.dataBounds[o]-.1*i*QV[o][f],pe[l]=.5*(e.dataBounds[l*2]+e.dataBounds[l*2+1]),pe[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),P.transformMat4(Ee,pe,n),pe[f]=e.dataBounds[o],P.transformMat4(Un,pe,n),P.subtract(Ee,Un,Ee),P.normalize(Ee,Ee),c=Ee[2]>s,e.camera.getParallelProjection()||(P.normalize(Un,Un),c=P.dot(Un,Ee)>s)),c!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=c,a=!0)}return a},t.updatePolyData=(n,a,i)=>{let s=0,o=0;s+=8;let c=0;for(let p=0;p<12;p++)a[p]>0&&c++;if(o+=c,e.gridLines)for(let p=0;p<6;p++)n[p]&&(s+=i[We[p][0]].length*2+i[We[p][1]].length*2,o+=i[We[p][0]].length+i[We[p][1]].length);let f=new Float64Array(s*3),l=new Uint32Array(o*3),u=0,g=0;for(let p=0;p<2;p++)for(let d=0;d<2;d++)for(let h=0;h<2;h++)f[u*3]=e.dataBounds[h],f[u*3+1]=e.dataBounds[2+d],f[u*3+2]=e.dataBounds[4+p],u++;for(let p=0;p<12;p++)a[p]>0&&(l[g*3]=2,l[g*3+1]=Is[p][0],l[g*3+2]=Is[p][1],g++);if(e.gridLines){for(let p=0;p<6;p++)if(n[p]){let d=Math.floor(p/2),h=i[We[p][0]];for(let v=0;v<h.length;v++)f[u*3+d]=e.dataBounds[p],f[u*3+We[p][0]]=h[v],f[u*3+We[p][1]]=e.dataBounds[We[p][1]*2],u++,f[u*3+d]=e.dataBounds[p],f[u*3+We[p][0]]=h[v],f[u*3+We[p][1]]=e.dataBounds[We[p][1]*2+1],u++,l[g*3]=2,l[g*3+1]=u-2,l[g*3+2]=u-1,g++;h=i[We[p][1]];for(let v=0;v<h.length;v++)f[u*3+d]=e.dataBounds[p],f[u*3+We[p][1]]=h[v],f[u*3+We[p][0]]=e.dataBounds[We[p][0]*2],u++,f[u*3+d]=e.dataBounds[p],f[u*3+We[p][1]]=h[v],f[u*3+We[p][0]]=e.dataBounds[We[p][0]*2+1],u++,l[g*3]=2,l[g*3+1]=u-2,l[g*3+2]=u-1,g++}}e.polyData.getPoints().setData(f,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(l,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(n,a,i,s)=>{let o=0;for(let p=0;p<12;p++)a[p]===1&&(o+=2,o+=i[Sv[p]].length);let c=e.polyData.getPoints().getData(),f=new Float64Array(o*3),l=0,u=0,g=0;for(let p=0;p<6;p++)if(n[p])for(let d=0;d<4;d++){let h=Tv[p][d];if(a[h]===1){let v=Sv[h],x=Is[h][0]*3,T=Is[h][1]*3;f[l*3]=.5*(c[x]+c[T]),f[l*3+1]=.5*(c[x+1]+c[T+1]),f[l*3+2]=.5*(c[x+2]+c[T+2]),l++;let m=Math.floor(p/2);f[l*3+m]=e.dataBounds[p],f[l*3+We[p][0]]=.5*(e.dataBounds[We[p][0]*2]+e.dataBounds[We[p][0]*2+1]),f[l*3+We[p][1]]=.5*(e.dataBounds[We[p][1]*2]+e.dataBounds[We[p][1]*2+1]),l++,e.textValues[u]=e.axisLabels[v],u++;let y=(v+1)%3,S=(v+2)%3,C=i[v],E=s[v];e.tickCounts[g]=C.length;for(let O=0;O<C.length;O++)f[l*3+v]=C[O],f[l*3+y]=c[x+y],f[l*3+S]=c[x+S],l++,e.textValues[u]=E[O],u++;g++}}e.textPolyData.getPoints().setData(f,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;let n=t.computeFacesToDraw(),a=e.lastFacesToDraw,i=!1;for(let s=0;s<6;s++)e.dataBounds[s]!==e.lastTickBounds[s]&&(i=!0,e.lastTickBounds[s]=e.dataBounds[s]);if(n||i||e.forceUpdate){let s=new Array(12).fill(0);for(let c=0;c<6;c++)if(a[c])for(let f=0;f<4;f++)s[Tv[c][f]]++;let o=e.generateTicks(e.dataBounds);t.updatePolyData(a,s,o.ticks),t.updateTextData(a,s,o.ticks,o.tickStrings),(i||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=n=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let a=0,i=1;for(let s=0;s<3;s++){if(!e._tmAtlas.has(e.axisLabels[s])){$f(e.tmContext,e.axisTextStyle);let o=e.tmContext.measureText(e.axisLabels[s]),c={height:o.actualBoundingBoxAscent+2,startingHeight:i,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[s],c),i+=c.height,a<c.width&&(a=c.width)}$f(e.tmContext,e.tickTextStyle);for(let o=0;o<n[s].length;o++)if(!e._tmAtlas.has(n[s][o])){let c=e.tmContext.measureText(n[s][o]),f={height:c.actualBoundingBoxAscent+2,startingHeight:i,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(n[s][o],f),i+=f.height,a<f.width&&(a=f.width)}}a=pt(a),i=pt(i),e._tmAtlas.forEach(s=>{s.tcoords=[0,(i-s.startingHeight-s.height)/i,s.width/a,(i-s.startingHeight-s.height)/i,s.width/a,(i-s.startingHeight)/i,0,(i-s.startingHeight)/i]}),e.tmCanvas.width=a,e.tmCanvas.height=i,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,i),e._tmAtlas.forEach((s,o)=>{$f(e.tmContext,s.textStyle),e.tmContext.fillText(o,1,s.startingHeight+s.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),se.setBounds(e.bounds,e.gridActor.getBounds()),se.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);let r=w.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=n=>r(n)[0]}function rF(t,e,r){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...se.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:Cv,...r,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...r?.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...r?.tickTextStyle}}}function wv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Wt.extend(t,e,rF(t,e,r)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=Mr.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=ht.newInstance(),e.polyData=Re.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=Wt.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Re.newInstance(),w.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),w.setGetArray(t,e,["dataBounds"],6),w.setGetArray(t,e,["axisLabels"],3),w.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),tF(t,e)}var nF=w.newInstance(wv,"vtkCubeAxesActor"),$s={newInstance:nF,extend:wv,newCubeAxesActorHelper:eF,defaultGenerateTicks:Cv};function aF(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([i.usize,i.vsize],a,e._openGLRenderWindow.getRenderable())}}}var iF={};function sF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iF,r),Q.extend(t,e,r),e.CubeAxesActorHelper=$s.newCubeAxesActorHelper(),aF(t,e)}var oF=$(sF,"vtkOpenGLCubeAxesActor");Te("vtkCubeAxesActor",oF);var{FieldAssociations:Xf}=yt,{primTypes:Qe}=rt,{Representation:ga,Shading:Ov}=Gt,{ScalarMode:Xs}=ht,{Filter:Ev,Wrap:Mv}=Ce,{vtkErrorMacro:Nn}=De,cF={type:"StartEvent"},fF={type:"EndEvent"},{CoordinateSystem:uF}=ar;function lF(t){let e=t.getSelector();return e?e.getCurrentPass():ot.MIN_KNOWN_PASS-1}function gF(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,a)=>{n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{let n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let s=Qe.Start;s<Qe.End;s++)e.primitives[s].setOpenGLRenderWindow(e._openGLRenderWindow)}let a=e.openGLActor.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,a)},t.getShaderTemplate=(n,a,i)=>{n.Vertex=aa,n.Fragment=ia,n.Geometry=""},t.replaceShaderColor=(n,a,i)=>{let s=n.Vertex,o=n.Geometry,c=n.Fragment,f=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];f&&(l=l.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];f&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),f&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(l=l.concat(["varying vec4 vertexColorVSOutput;"]),s=z.substitute(s,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,s=z.substitute(s,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=z.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=z.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=z.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=z.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(i.getBackfaceProperty()&&!e.drawingEdges&&(l=l.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),f?(l=l.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(l=l.concat(["uniform samplerBuffer texture1;"])),c=z.substitute(c,"//VTK::Color::Impl",u).result),c=z.substitute(c,"//VTK::Color::Dec",l).result,n.Vertex=s,n.Geometry=o,n.Fragment=c},t.replaceShaderLight=(n,a,i)=>{let s=n.Fragment,o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),f=e.lastBoundBO.getReferenceByName("lastLightCount"),l=[];switch(c){case 0:s=z.substitute(s,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:s=z.substitute(s,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<f;++u)l=l.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);s=z.substitute(s,"//VTK::Light::Dec",l).result,l=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<f;++u)l=l.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${o}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${u});`,"    }"]);l=l.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),s=z.substitute(s,"//VTK::Light::Impl",l,!1).result;break;case 3:for(let u=0;u<f;++u)l=l.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);s=z.substitute(s,"//VTK::Light::Dec",l).result,l=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<f;++u)l=l.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${u});`,"    }"]);l=l.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),s=z.substitute(s,"//VTK::Light::Impl",l,!1).result;break;default:Nn("bad light complexity")}n.Fragment=s},t.replaceShaderNormal=(n,a,i)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=n.Vertex,c=n.Geometry,f=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=z.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=z.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=z.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=z.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,f=z.substitute(f,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,f=z.substitute(f,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(f=z.substitute(f,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,f=z.substitute(f,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES?(f=z.substitute(f,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,f=z.substitute(f,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(f=z.substitute(f,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,f=z.substitute(f,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,f=z.substitute(f,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=o,n.Geometry=c,n.Fragment=f}},t.replaceShaderPositionVC=(n,a,i)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,i);let s=n.Vertex,o=n.Geometry,c=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(s=z.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=z.substitute(s,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,s=z.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=z.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=z.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=z.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=z.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(s=z.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=z.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=s,n.Geometry=o,n.Fragment=c},t.replaceShaderTCoord=(n,a,i)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let s=n.Vertex,o=n.Geometry,c=n.Fragment;if(e.drawingEdges)return;s=z.substitute(s,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;let f=e.openGLActor.getActiveTextures(),l=2,u=2;if(f&&f.length>0&&(l=f[0].getComponents(),f[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(l=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(s=z.substitute(s,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=z.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=z.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=z.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,f&&f.length>=1)switch(l){case 1:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(s=z.substitute(s,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=z.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=z.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=z.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,l){case 1:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=z.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=s,n.Geometry=o,n.Fragment=c}},t.replaceShaderClip=(n,a,i)=>{let s=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();s=z.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,s=z.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=z.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=z.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=s,n.Fragment=o},t.getCoincidentParameters=(n,a)=>{let i={factor:0,offset:0},s=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==st.PolygonOffset||s.getEdgeVisibility()&&s.getRepresentation()===ga.SURFACE){let c=e.lastBoundBO.getPrimitiveType();c===Qe.Points||s.getRepresentation()===ga.POINTS?i=e.renderable.getCoincidentTopologyPointOffsetParameter():c===Qe.Lines||s.getRepresentation()===ga.WIREFRAME?i=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===Qe.Tris||c===Qe.TriStrips)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===Qe.TrisEdges||c===Qe.TriStripsEdges)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),i.factor/=2,i.offset/=2)}let o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===Xf.FIELD_ASSOCIATION_POINTS&&(i.offset-=2),i},t.replaceShaderPicking=(n,a,i)=>{let s=n.Fragment,o=n.Vertex;if(s=z.substitute(s,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===ot.ID_LOW24||e.lastSelectionState===ot.ID_HIGH24)&&(o=z.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=z.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,s=z.substitute(s,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,s=z.substitute(s,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case ot.ID_LOW24:s=z.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case ot.ID_HIGH24:s=z.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:s=z.substitute(s,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,s=z.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=s,n.Vertex=o}},t.replaceShaderValues=(n,a,i)=>{if(t.replaceShaderColor(n,a,i),t.replaceShaderNormal(n,a,i),t.replaceShaderLight(n,a,i),t.replaceShaderTCoord(n,a,i),t.replaceShaderPicking(n,a,i),t.replaceShaderClip(n,a,i),t.replaceShaderCoincidentOffset(n,a,i),t.replaceShaderPositionVC(n,a,i),e.haveSeenDepthRequest){let s=n.Fragment;s=z.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=z.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=s}},t.getNeedToRebuildShaders=(n,a,i)=>{let s=0,o=0,c=n.getPrimitiveType(),f=e.currentInput,l=!1,u=f.getPointData().getNormals(),g=f.getCellData().getNormals(),p=i.getProperty().getInterpolation()===Ov.FLAT,d=i.getProperty().getRepresentation(),h=n.getOpenGLMode(d,c);if((h===e.context.TRIANGLES||g&&!u||!p&&u||!p&&h===e.context.LINES)&&(l=!0),i.getProperty().getLighting()&&l){s=0;let m=a.getLightsByReference();for(let y=0;y<m.length;++y){let S=m[y];S.getSwitch()>0&&(o++,s===0&&(s=1)),s===1&&(o>1||S.getIntensity()!==1||!S.lightTypeIsHeadLight())&&(s=2),s<3&&S.getPositional()&&(s=3)}}let v=!1,x=e.lastBoundBO.getReferenceByName("lastLightComplexity"),T=e.lastBoundBO.getReferenceByName("lastLightCount");return(x!==s||T!==o)&&(e.lastBoundBO.set({lastLightComplexity:s},!0),e.lastBoundBO.set({lastLightCount:o},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,a,i)=>{let s=e.renderable.getViewSpecificProperties().ShadersCallbacks;s&&s.forEach(o=>{o.callback(o.userData,n,a,i)})},t.setMapperShaderParameters=(n,a,i)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){let c=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Nn("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&c>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Nn("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((f,l)=>{n.getProgram().isAttributeUsed(`${f}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${f}MC`,n.getCABO().getCustomData()[l].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[l].components,!1)||Nn(`Error setting ${f}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Nn("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Nn("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes(),f=[],u=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,g=u?D.copy(e.tmpMat4,i.getMatrix()):i.getMatrix();u&&(D.transpose(g,g),D.multiply(g,g,u),D.transpose(g,g));for(let p=0;p<c;p++){let d=[];e.renderable.getClippingPlaneInDataCoords(g,p,d);for(let h=0;h<4;h++)f.push(d[h])}n.getProgram().setUniformi("numClipPlanes",c),n.getProgram().setUniform4fv("clipPlanes",f)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());let s=e.openGLActor.getActiveTextures();if(s)for(let c=0;c<s.length;++c){let l=s[c].getTextureUnit(),u=`texture${l+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,l)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){let c=t.getCoincidentParameters(a,i);n.getProgram().setUniformf("coffset",c.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",c.factor)}n.setMapperShaderParameters(a,i,e._openGLRenderer.getTiledSizeAndOrigin());let o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,a,i)=>{let s=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(s<2)return;let o=n.getProgram(),c=0,f=a.getLightsByReference();for(let g=0;g<f.length;++g){let p=f[g];if(p.getSwitch()>0){let h=p.getColorByReference(),v=p.getIntensity();e.lightColor[0]=h[0]*v,e.lightColor[1]=h[1]*v,e.lightColor[2]=h[2]*v;let x=p.getDirection(),T=a.getActiveCamera().getViewMatrix(),m=[...x];p.lightTypeIsSceneLight()&&(m[0]=T[0]*x[0]+T[1]*x[1]+T[2]*x[2],m[1]=T[4]*x[0]+T[5]*x[1]+T[6]*x[2],m[2]=T[8]*x[0]+T[9]*x[1]+T[10]*x[2],tt(m)),e.lightDirection[0]=m[0],e.lightDirection[1]=m[1],e.lightDirection[2]=m[2],tt(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(s<3)return;let u=a.getActiveCamera().getViewMatrix();D.transpose(u,u),c=0;for(let g=0;g<f.length;++g){let p=f[g];if(p.getSwitch()>0){let h=p.getTransformedPosition(),v=new Float64Array(3);P.transformMat4(v,h,u),o.setUniform3fArray(`lightAttenuation${c}`,p.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,p.getPositional()),o.setUniformf(`lightExponent${c}`,p.getExponent()),o.setUniformf(`lightConeAngle${c}`,p.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[v[0],v[1],v[2]]),c++}}};function r(n,a,i){return a.identity(i),n.reduce((s,o,c)=>c===0?o?a.copy(s,o):a.identity(s):o?a.multiply(s,s,o):s,i)}t.setCameraShaderParameters=(n,a,i)=>{let s=n.getProgram(),o=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),f=e.openGLCamera.getKeyMatrixTime().getMTime(),l=s.getLastCameraMTime(),g=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,p=i.getIsIdentity(),d=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(i.getCoordinateSystem()===uF.DISPLAY){let h=e._openGLRenderer.getTiledSizeAndOrigin();D.identity(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,D.multiply(e.tmpMat4,e.tmpMat4,g),s.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else s.setUniformMatrix("MCPCMatrix",r([o.wcpc,d.mcwc,g],D,e.tmpMat4));s.isUniformUsed("MCVCMatrix")&&s.setUniformMatrix("MCVCMatrix",r([o.wcvc,d.mcwc,g],D,e.tmpMat4)),s.isUniformUsed("normalMatrix")&&s.setUniformMatrix3x3("normalMatrix",r([o.normalMatrix,d.normalMatrix],ee,e.tmpMat3)),l!==f&&(s.isUniformUsed("cameraParallel")&&s.setUniformi("cameraParallel",c.getParallelProjection()),s.setLastCameraMTime(f)),p||s.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,a,i)=>{let s=n.getProgram(),o=i.getProperty(),c=o.getOpacity(),f=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),l=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),u=e.drawingEdges?1:o.getAmbient(),g=e.drawingEdges?0:o.getDiffuse(),p=e.drawingEdges?0:o.getSpecular(),d=o.getSpecularPower();s.setUniformf("opacityUniform",c),s.setUniform3fArray("ambientColorUniform",f),s.setUniform3fArray("diffuseColorUniform",l),s.setUniformf("ambient",u),s.setUniformf("diffuse",g);let h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let v=o.getSpecularColorByReference();if(s.setUniform3fArray("specularColorUniform",v),s.setUniformf("specularPowerUniform",d),s.setUniformf("specular",p),s.isUniformUsed("ambientIntensityBF")){if(o=i.getBackfaceProperty(),c=o.getOpacity(),f=o.getAmbientColor(),u=o.getAmbient(),l=o.getDiffuseColor(),g=o.getDiffuse(),v=o.getSpecularColor(),p=o.getSpecular(),s.setUniformf("ambientIntensityBF",u),s.setUniformf("diffuseIntensityBF",g),s.setUniformf("opacityUniformBF",c),s.setUniform3fArray("ambientColorUniformBF",f),s.setUniform3fArray("diffuseColorUniformBF",l),h<1)return;s.setUniformf("specularIntensityBF",p),s.setUniform3fArray("specularColorUniformBF",v),s.setUniformf("specularPowerUniformBF",d)}},t.updateMaximumPointCellIds=(n,a)=>{let i=e._openGLRenderer.getSelector();if(!i)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){let o=e.selectionWebGLIdsToVTKIds.points.length;i.setMaximumPointId(o-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){let o=e.selectionWebGLIdsToVTKIds.cells.length;i.setMaximumCellId(o-1)}i.getFieldAssociation()===Xf.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;let i=lF(e._openGLRenderer);e.lastSelectionState!==i&&(e.selectionStateChanged.modified(),e.lastSelectionState=i),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(a),t.updateBufferObjects(n,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,a)=>{let i=a.getProperty().getRepresentation(),s=a.getProperty().getEdgeVisibility()&&i===ga.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===Xf.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===ot.ID_LOW24||e.lastSelectionState===ot.ID_HIGH24);for(let f=Qe.Start;f<Qe.End;f++)e.primitives[f].setPointPicking(c),e.primitives[f].getCABO().getElementCount()&&(e.drawingEdges=s&&(f===Qe.TrisEdges||f===Qe.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[f],e.primitiveIDOffset+=e.primitives[f].drawArrays(n,a,i,t),e.vertexIDOffset+=e.primitives[f].getCABO().getElementCount()))},t.renderPieceFinish=(n,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,a)=>{if(t.invokeEvent(cF),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(fF),!e.currentInput){Nn("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;let i=e.context,s=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!s&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,a)=>{let i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()},t.buildBufferObjects=(n,a)=>{let i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,1);let s=e.renderable.getColorMapColors();e.haveCellScalars=!1;let o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Xs.USE_CELL_DATA||o===Xs.USE_CELL_FIELD_DATA||o===Xs.USE_FIELD_DATA||!i.getPointData().getScalars())&&o!==Xs.USE_POINT_FIELD_DATA&&s&&(e.haveCellScalars=!0);let c=a.getProperty().getInterpolation()!==Ov.FLAT?i.getPointData().getNormals():null;c===null&&i.getCellData().getNormals()&&(e.haveCellNormals=!0,c=i.getCellData().getNormals());let f=a.getProperty().getRepresentation(),l=i.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(l=null);let u=!1;if(e.renderable.getColorCoordinates()){l=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Ce.newInstance({resizable:!0}));let p=e.internalColorTexture;p.setMinificationFilter(Ev.NEAREST),p.setMagnificationFilter(Ev.NEAREST),p.setWrapS(Mv.CLAMP_TO_EDGE),p.setWrapT(Mv.CLAMP_TO_EDGE),p.setOpenGLRenderWindow(e._openGLRenderWindow);let d=e.renderable.getColorTextureMap(),h=d.getExtent(),v=d.getPointData().getScalars();p.create2DFromRaw({width:h[1]-h[0]+1,height:h[3]-h[2]+1,numComps:v.getNumberOfComponents(),dataType:v.getDataType(),data:v.getData()}),p.activate(),p.sendParameters(),p.deactivate()}let g=`${i.getMTime()}A${f}B${i.getMTime()}C${c?c.getMTime():1}D${s?s.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${l?l.getMTime():1}`;if(e.VBOBuildString!==g){let d={points:i.getPoints(),normals:c,tcoords:l,colors:s,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(x=>i.getPointData().getArrayByName(x))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});let h=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],v=a.getProperty().getEdgeVisibility()&&f===ga.SURFACE;for(let x=Qe.Start;x<Qe.End;x++)x!==Qe.TrisEdges&&x!==Qe.TriStripsEdges?(d.cellOffset+=e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,f,d,e.selectionWebGLIdsToVTKIds),d.vertexOffset+=e.primitives[x].getCABO().getElementCount()):v?e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,ga.WIREFRAME,{...d,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[x].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=g}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}var pF={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:ot.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function hF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pF,r),Q.extend(t,e,r),ut.implementReplaceShaderCoincidentOffset(t,e,r),ut.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Qe,e.tmpMat3=ee.identity(new Float64Array(9)),e.tmpMat4=D.identity(new Float64Array(16));for(let n=Qe.Start;n<Qe.End;n++)e.primitives[n]=rt.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ge(t,e,["context"]),e.VBOBuildTime={},ae(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},ae(e.selectionStateChanged,{mtime:0}),gF(t,e)}var dF=$(hF,"vtkOpenGLPolyDataMapper");Te("vtkMapper",dF);var Rv=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`;var Dv=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;var Yf={BACKGROUND:0,FOREGROUND:1},qf={DisplayLocation:Yf};var{primTypes:jt}=rt,{Filter:Lv,Wrap:Vv}=Ce,{vtkErrorMacro:ti}=De,vF={type:"StartEvent"},mF={type:"EndEvent"};function xF(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=n=>{n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=n=>{n&&t.render()},t.getShaderTemplate=(n,a,i)=>{n.Vertex=Dv,n.Fragment=Rv,n.Geometry=""},t.render=()=>{let n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let s=jt.Start;s<jt.End;s++)e.primitives[s].setOpenGLRenderWindow(e._openGLRenderWindow)}let a=e.openGLActor2D.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,a)},t.renderPiece=(n,a)=>{if(t.invokeEvent(vF),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(mF),!e.currentInput){ti("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;let i=e.context;e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.renderPieceStart=(n,a)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),t.updateBufferObjects(n,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=(n,a,i)=>n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=(n,a)=>{let i=e.VBOBuildTime.getMTime();return!!(i<t.getMTime()||i<e._openGLRenderWindow.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&i<n.getMTime())},t.buildBufferObjects=(n,a)=>{let i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,a.getProperty().getOpacity());let s=e.renderable.getColorMapColors(),o=a.getProperty().getRepresentation(),c=i.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(c=null);let f=!1;if(e.renderable.getColorCoordinates()){c=e.renderable.getColorCoordinates(),f=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Ce.newInstance({resizable:!0}));let d=e.internalColorTexture;d.setMinificationFilter(Lv.NEAREST),d.setMagnificationFilter(Lv.NEAREST),d.setWrapS(Vv.CLAMP_TO_EDGE),d.setWrapT(Vv.CLAMP_TO_EDGE),d.setOpenGLRenderWindow(e._openGLRenderWindow);let h=e.renderable.getColorTextureMap(),v=h.getExtent(),x=h.getPointData().getScalars();d.create2DFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:x.getNumberOfComponents(),dataType:x.getDataType(),data:x.getData()}),d.activate(),d.sendParameters(),d.deactivate()}let l=e.renderable.getTransformCoordinate(),g=n.getRenderWindow().getViews()[0].getViewportSize(n),p=`${i.getMTime()}A${o}B${i.getMTime()}C${s?s.getMTime():1}D${c?c.getMTime():1}E${l?n.getMTime():1}F${g}`;if(e.VBOBuildString!==p){let d=i.getPoints();if(l){let v=Sr.newInstance(),x=d.getNumberOfPoints();v.setNumberOfPoints(x);let T=[];for(let m=0;m<x;++m){d.getPoint(m,T),l.setValue(T);let y=l.getComputedDoubleViewportValue(n);v.setPoint(m,y[0],y[1],0)}d=v}let h={points:d,tcoords:c,colors:s,cellOffset:0,useTCoordsPerCell:f,haveCellScalars:e.renderable.getAreScalarsMappedFromCells(),customAttributes:e.renderable.getCustomShaderAttributes().map(v=>i.getPointData().getArrayByName(v))};h.cellOffset+=e.primitives[jt.Points].getCABO().createVBO(i.getVerts(),"verts",o,h),h.cellOffset+=e.primitives[jt.Lines].getCABO().createVBO(i.getLines(),"lines",o,h),h.cellOffset+=e.primitives[jt.Tris].getCABO().createVBO(i.getPolys(),"polys",o,h),h.cellOffset+=e.primitives[jt.TriStrips].getCABO().createVBO(i.getStrips(),"strips",o,h),e.VBOBuildTime.modified(),e.VBOBuildString=p}},t.renderPieceDraw=(n,a)=>{let i=a.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=jt.Start;o<jt.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(n,a,i,t))},t.renderPieceFinish=(n,a)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.replaceShaderValues=(n,a,i)=>{t.replaceShaderColor(n,a,i),t.replaceShaderTCoord(n,a,i),t.replaceShaderPicking(n,a,i),t.replaceShaderPositionVC(n,a,i)},t.replaceShaderColor=(n,a,i)=>{let s=n.Vertex,o=n.Geometry,c=n.Fragment,f=["uniform vec3 diffuseColorUniform;","uniform float opacityUniform;"],l=["vec3 diffuseColor = diffuseColorUniform;","float opacity = opacityUniform;"];e.lastBoundBO.getCABO().getColorComponents()!==0?(f=f.concat(["varying vec4 vertexColorVSOutput;"]),s=z.substitute(s,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,s=z.substitute(s,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=z.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=z.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,c=z.substitute(c,"//VTK::Color::Impl",l.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result):e.renderable.getAreScalarsMappedFromCells()&&(l=l.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  opacity = opacity*texColor.a;"])),l=l.concat(["gl_FragData[0] = vec4(diffuseColor, opacity);"]),c=z.substitute(c,"//VTK::Color::Dec",f).result,c=z.substitute(c,"//VTK::Color::Impl",l).result,n.Vertex=s,n.Geometry=o,n.Fragment=c},t.replaceShaderTCoord=(n,a,i)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let s=n.Vertex,o=n.Geometry,c=n.Fragment,f=e.lastBoundBO.getCABO().getTCoordComponents();f===1?(s=z.substitute(s,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,s=z.substitute(s,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=z.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=z.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=z.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=z.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):f===2&&(s=z.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,s=z.substitute(s,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=z.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=z.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=z.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=z.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.renderable.getAreScalarsMappedFromCells()&&(o=z.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=s,n.Geometry=o,n.Fragment=c}},t.replaceShaderPicking=(n,a,i)=>{let s=n.Fragment;s=z.substitute(s,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,s=z.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=s},t.replaceShaderPositionVC=(n,a,i)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,i)},t.invokeShaderCallbacks=(n,a,i)=>{let s=e.renderable.getViewSpecificProperties().ShadersCallbacks;s&&s.forEach(o=>{o.callback(o.userData,n,a,i)})},t.setMapperShaderParameters=(n,a,i)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||ti("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,f)=>{n.getProgram().isAttributeUsed(`${c}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${c}MC`,n.getCABO().getCustomData()[f].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[f].components,!1)||ti(`Error setting ${c}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||ti("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||ti("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&e.internalColorTexture.getTextureUnit()>-1&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());let s=e.openGLActor2D.getActiveTextures();if(s)for(let c=0;c<s.length;++c){let l=s[c].getTextureUnit(),u=`texture${l+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,l)}n.setMapperShaderParameters(a,i,e._openGLRenderer.getTiledSizeAndOrigin());let o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(n,a,i)=>{let s=e.renderable.getColorMapColors();if(!s||s.getNumberOfComponents()===0){let o=n.getProgram(),c=i.getProperty(),f=c.getOpacity();o.setUniformf("opacityUniform",f);let l=c.getColor();o.setUniform3fArray("diffuseColorUniform",l)}},t.setLightingShaderParameters=(n,a,i)=>{};function r(n,a,i){return a.identity(i),n.reduce((s,o,c)=>c===0?o?a.copy(s,o):a.identity(s):o?a.multiply(s,s,o):s,i)}t.setCameraShaderParameters=(n,a,i)=>{let s=n.getProgram(),c=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,l=a.getRenderWindow().getViews()[0].getViewportSize(a),u=a.getViewport(),g=i.getActualPositionCoordinate().getComputedDoubleViewportValue(a),p=[0,0,1,1],d=[0,0,1,1];if(d[0]=u[0]>=p[0]?u[0]:p[0],d[1]=u[1]>=p[1]?u[1]:p[1],d[2]=u[2]<=p[2]?u[2]:p[2],d[3]=u[3]<=p[3]?u[3]:p[3],d[0]>=d[2]||d[1]>=d[3])return;l[0]=Qn(l[0]*(d[2]-d[0])/(u[2]-u[0])),l[1]=Qn(l[1]*(d[3]-d[1])/(u[3]-u[1]));let h=e._openGLRenderer.getParent().getSize(),v=Qn(g[0]-(d[0]-u[0])*h[0]),x=Qn(g[1]-(d[1]-u[1])*h[1]),T=-v,m=-v+l[0],y=-x,S=-x+l[1];T===m&&(m=T+1),y===S&&(S=y+1);let C=D.identity(new Float64Array(16));C[0]=2/(m-T),C[5]=2/(S-y),C[3]=-1*(m+T)/(m-T),C[7]=-1*(S+y)/(S-y),C[10]=0,C[11]=i.getProperty().getDisplayLocation()===Yf.FOREGROUND?-1:1,C[15]=1,D.transpose(C,C),s.setUniformMatrix("WCVCMatrix",r([C,c],D,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}var yF={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function TF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yF,r),Q.extend(t,e,r),ut.implementReplaceShaderCoincidentOffset(t,e,r),ut.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=jt,e.tmpMat4=D.identity(new Float64Array(16));for(let n=jt.Start;n<jt.End;n++)e.primitives[n]=rt.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ge(t,e,["context"]),e.VBOBuildTime={},ae(e.VBOBuildTime,{mtime:0}),xF(t,e)}var SF=$(TF,"vtkOpenGLPolyDataMapper2D");Te("vtkMapper2D",SF);var{VectorMode:CF}=Fn;function Zf(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function Fv(t,e){return r=>{let n=r.getLastSize(),a=(n[0]/700)**.8,i=(n[1]/700)**.8,s=Math.min(a,i),o=r.getAxisTextStyle(),c=r.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(c,e.tickTextStyle),o.fontSize=Math.max(24*s,12),r.getLastAspectRatio()>1?c.fontSize=Math.max(20*s,10):c.fontSize=Math.max(16*s,10);let f=r.updateTextureAtlas();r.setTopTitle(!1);let l=r.getBoxSizeByReference();if(r.getLastAspectRatio()>1)r.setTickLabelPixelOffset(.3*c.fontSize),f.titleWidth<=f.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize?(r.setTopTitle(!0),r.setAxisTitlePixelOffset(.2*c.fontSize),l[0]=2*(f.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.98-l[0],-.92])):(r.setAxisTitlePixelOffset(.2*c.fontSize),l[0]=2*(f.titleHeight+r.getAxisTitlePixelOffset()+f.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.99-l[0],-.92])),l[1]=Math.max(1.2,Math.min(1.84/i,1.84));else{r.setAxisTitlePixelOffset(1.2*c.fontSize),r.setTickLabelPixelOffset(.1*c.fontSize);let u=2*(.8*c.fontSize+f.titleHeight+r.getAxisTitlePixelOffset())/n[1],g=2*f.tickWidth/n[0];l[0]=Math.min(1.9,Math.max(1.4,1.4*g*(r.getTicks().length+3))),l[1]=u,r.setBoxPosition([-.5*l[0],-.97])}r.recomputeBarSegments(f)}}function kv(t,e){return r=>{let n=r.getLastTickBounds(),a=Ln().domain([n[0],n[1]]),i=a.ticks(5),s=a.tickFormat(5);r.setTicks(i),r.setTickStrings(i.map(s))}}function wF(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=a=>{e.renderable!==a&&(e.renderable=a,e.barActor.setProperty(a.getProperty()),e.barActor.setParentProp(a),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(a.getProperty()),e.tmActor.setParentProp(a),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=a.generateTicks,e.axisTextStyle={...a.getAxisTextStyle()},e.tickTextStyle={...a.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(a,i,s)=>{(e.lastSize[0]!==a[0]||e.lastSize[1]!==a[1])&&(e.lastSize[0]=a[0],e.lastSize[1]=a[1],e.lastAspectRatio=a[0]/a[1],e.forceUpdate=!0);let o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=i,e.renderWindow=s,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){let c=o.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();let f=t.updateTextureAtlas();t.recomputeBarSegments(f)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";let a={},i=new Map,s=0,o=1;Zf(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),f={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.axisTextStyle};i.set(e.renderable.getAxisLabel(),f),o+=f.height,s=f.width,a.titleWidth=f.width,a.titleHeight=f.height,a.tickWidth=0,a.tickHeight=0,Zf(e.tmContext,e.tickTextStyle);let l=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<l.length;u++)i.has(l[u])||(c=e.tmContext.measureText(l[u]),f={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle},i.set(l[u],f),o+=f.height,s<f.width&&(s=f.width),a.tickWidth<f.width&&(a.tickWidth=f.width),a.tickHeight<f.height&&(a.tickHeight=f.height));return s=pt(s),o=pt(o),i.forEach(u=>{u.tcoords=[0,(o-u.startingHeight-u.height)/o,u.width/s,(o-u.startingHeight-u.height)/o,u.width/s,(o-u.startingHeight)/o,0,(o-u.startingHeight)/o]}),e.tmCanvas.width=s,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,s,o),i.forEach((u,g)=>{Zf(e.tmContext,u.textStyle),e.tmContext.fillText(g,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=i,a},t.computeBarSize=a=>{e.vertical=e.boxSize[1]>e.boxSize[0];let i=2*a.tickHeight/e.lastSize[1],s=[1,1];if(e.vertical){let o=2*(a.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){let c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-c}else{let c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],s[1]=i}else{let o=(2*a.tickWidth-8)/e.lastSize[0],c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],s[0]=o}return s},t.recomputeBarSegments=a=>{let i=t.computeBarSize(a);e.barSegments=[];let s=[0,0],o=e.vertical?1:0,c=e.vertical?.01:.02;function f(g,p){e.barSegments.push({corners:[[...s],[s[0]+i[0],s[1]],[s[0]+i[0],s[1]+i[1]],[s[0],s[1]+i[1]]],scalars:p,title:g}),s[o]+=i[o]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&f("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&e.renderable.getScalarsToColors().getUseBelowRangeColor?.()&&f("Below",[-.1,-.1,-.1,-.1]);let l=e.renderable.getScalarsToColors().getUseAboveRangeColor?.();s[o]+=c;let u=i[o];i[o]=l?1-2*c-i[o]-s[o]:1-c-s[o],f("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&l&&(i[o]=u,s[o]+=c,f("Above",[1.1,1.1,1.1,1.1]))};let r=new Float64Array(3);t.createPolyDataForOneLabel=(a,i,s,o,c,f)=>{let l=e._tmAtlas.get(a);if(!l)return;let u=f.ptIdx,g=f.cellIdx;r[0]=(.5*i[0]+.5)*e.lastSize[0],r[1]=(.5*i[1]+.5)*e.lastSize[1],r[2]=i[2],r[0]+=c[0],r[1]+=c[1];let p=[],d=o==="vertical"?[1,0]:[0,1];o==="vertical"?(p[0]=l.width,p[1]=-l.height,s[0]==="middle"?r[1]-=l.width/2:s[0]==="right"&&(r[1]-=l.width),s[1]==="middle"?r[0]+=l.height/2:s[1]==="top"&&(r[0]+=l.height)):(p[0]=l.width,p[1]=l.height,s[0]==="middle"?r[0]-=l.width/2:s[0]==="right"&&(r[0]-=l.width),s[1]==="middle"?r[1]-=l.height/2:s[1]==="top"&&(r[1]-=l.height)),f.points[u*3]=r[0],f.points[u*3+1]=r[1],f.points[u*3+2]=r[2],f.tcoords[u*2]=l.tcoords[0],f.tcoords[u*2+1]=l.tcoords[1],u++,r[d[0]]+=p[0],f.points[u*3]=r[0],f.points[u*3+1]=r[1],f.points[u*3+2]=r[2],f.tcoords[u*2]=l.tcoords[2],f.tcoords[u*2+1]=l.tcoords[3],u++,r[d[1]]+=p[1],f.points[u*3]=r[0],f.points[u*3+1]=r[1],f.points[u*3+2]=r[2],f.tcoords[u*2]=l.tcoords[4],f.tcoords[u*2+1]=l.tcoords[5],u++,r[d[0]]-=p[0],f.points[u*3]=r[0],f.points[u*3+1]=r[1],f.points[u*3+2]=r[2],f.tcoords[u*2]=l.tcoords[6],f.tcoords[u*2+1]=l.tcoords[7],u++,f.polys[g*4]=3,f.polys[g*4+1]=u-4,f.polys[g*4+2]=u-3,f.polys[g*4+3]=u-2,g++,f.polys[g*4]=3,f.polys[g*4+1]=u-4,f.polys[g*4+2]=u-2,f.polys[g*4+3]=u-1,f.ptIdx+=4,f.cellIdx+=2};let n=new Float64Array(3);t.updatePolyDataForLabels=()=>{let a=t.getTickStrings().length+e.barSegments.length,i=a*4,s=a*2,o=new Float64Array(i*3),c=new Uint16Array(s*4),f=new Float32Array(i*2),l={ptIdx:0,cellIdx:0,polys:c,points:o,tcoords:f},u=e.vertical?0:1,g=e.vertical?1:0;n[2]=-.99;let p=e.vertical?["right","middle"]:["middle","bottom"],d=[0,1],h=[0,0];e.vertical?(h[0]=-e.tickLabelPixelOffset,e.topTitle?(n[0]=e.boxPosition[0]+.5*e.boxSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],l)):(n[0]=e.barPosition[0]+e.barSize[0],n[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],l)),d=[-1,0]):(h[1]=e.tickLabelPixelOffset,n[0]=e.barPosition[0]+.5*e.barSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],l)),n[u]=e.barPosition[u]+(.5*d[u]+.5)*e.barSize[u],n[g]=e.barPosition[g]+e.barSize[g]*.5;let v=null;for(let E=0;E<e.barSegments.length;E++){let O=e.barSegments[E];O.title==="ticks"?v=O:(n[g]=e.barPosition[g]+.5*e.barSize[g]*(O.corners[2][g]+O.corners[0][g]),t.createPolyDataForOneLabel(O.title,n,p,"horizontal",h,l))}let x=e.barPosition[g]+e.barSize[g]*v.corners[0][g],T=e.barSize[g]*(v.corners[2][g]-v.corners[0][g]),m=t.getTicks(),y=t.getTickStrings(),S=t.getTickPositions();for(let E=0;E<m.length;E++){let O=S?S[E]:(m[E]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);n[g]=x+T*O,t.createPolyDataForOneLabel(y[E],n,p,"horizontal",h,l)}let C=K.newInstance({numberOfComponents:2,values:f,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(C),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{let a=e.renderable.getScalarsToColors(),i=0;e.renderable.getDrawNanAnnotation()&&a.getNanColor()&&(i+=1),e.renderable.getDrawBelowRangeSwatch()&&a.getUseBelowRangeColor?.()&&(i+=1),e.renderable.getDrawAboveRangeSwatch()&&a.getUseAboveRangeColor?.()&&(i+=1);let s=4*(1+i),o=s,c=1;a.getVectorMode()===CF.COMPONENT&&(c=a.getVectorComponent()+1);let f=new Float64Array(s*3),l=new Uint16Array(o*5),u=new Float32Array(s*c),g=0,p=0;for(let h=0;h<e.barSegments.length;h++){let v=e.barSegments[h];for(let x=0;x<4;x++){n[0]=e.barPosition[0]+v.corners[x][0]*e.barSize[0],n[1]=e.barPosition[1]+v.corners[x][1]*e.barSize[1],f[g*3]=(.5*n[0]+.5)*e.lastSize[0],f[g*3+1]=(.5*n[1]+.5)*e.lastSize[1],f[g*3+2]=n[2];for(let T=0;T<c;T++)u[g*c+T]=e.lastTickBounds[0]+v.scalars[x]*(e.lastTickBounds[1]-e.lastTickBounds[0]);g++}l[p*5]=4,l[p*5+1]=g-4,l[p*5+2]=g-3,l[p*5+3]=g-2,l[p*5+4]=g-1,p++}let d=K.newInstance({numberOfComponents:c,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(d),e.polyData.getPoints().setData(f,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(l,1),e.polyData.getPolys().modified(),e.polyData.modified()}}var OF=w.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),w.obj(t,e),w.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings","tickPositions"]),w.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),w.getArray(t,e,["boxPosition","boxSize"]),w.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},w.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=ht.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Re.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=Wt.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Re.newInstance(),e.tmMapper=ht.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=Mr.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=Wt.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],wF(t,e)},"vtkScalarBarActorHelper");function EF(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(Fv(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(kv())}}function MF(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function bv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MF(r)),e.autoLayout||(e.autoLayout=Fv(t,e)),e.generateTicks||(e.generateTicks=kv()),Wt.extend(t,e,r),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),w.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),w.get(t,e,["axisTextStyle","tickTextStyle"]),w.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),w.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),EF(t,e)}var RF=w.newInstance(bv,"vtkScalarBarActor"),pa={newInstance:RF,extend:bv,newScalarBarActorHelper:OF};function DF(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([i.usize,i.vsize],a,e._openGLRenderWindow.getRenderable())}}}var LF={};function VF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LF,r),Q.extend(t,e,r),e.scalarBarActorHelper=pa.newScalarBarActorHelper(),DF(t,e)}var FF=$(VF,"vtkOpenGLScalarBarActor");Te("vtkScalarBarActor",FF);var{vtkErrorMacro:Uv}=De;function kF(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);let a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);let i=e._openGLRenderer.getRenderable(),s=e.openGLCamera.getKeyMatrices(i),o=new Float64Array(16);if(D.invert(o,s.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){let c=i.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){let n=new Float32Array(12);for(let o=0;o<4;o++)n[o*3]=o%2*2-1,n[o*3+1]=o>1?1:-1,n[o*3+2]=1;let a=K.newInstance({numberOfComponents:3,values:n});a.setName("points");let i=new Uint16Array(8);i[0]=3,i[1]=0,i[2]=1,i[3]=3,i[4]=3,i[5]=0,i[6]=3,i[7]=2;let s=K.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",_e.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Uv("Error setting vertexMC in shader VAO."));let r=e.renderable.getTextures();r.length||Uv("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}var bF={context:null};function UF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bF,r),Q.extend(t,e,r),e.openGLTexture=Ce.newInstance(),e.tris=rt.newInstance(),e.keyMatrixTime={},ae(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ee.identity(new Float64Array(9)),mcwc:D.identity(new Float64Array(16))},ge(t,e,["context"]),Me(t,e,["activeTextures"]),kF(t,e)}var NF=$(UF);Te("vtkSkybox",NF);var{CoordinateSystem:Nv}=ar;function BF(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();let n=e.renderable.getMatrix();e.bufferShift[0]=n[3],e.bufferShift[1]=n[7],e.bufferShift[2]=n[11];let a=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Nv.WORLD&&(e.bufferShift[0]-=a[0],e.bufferShift[1]-=a[1],e.bufferShift[2]-=a[2]),D.transpose(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?D.identity(e.keyMatrices.normalMatrix):(D.copy(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,D.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),D.transpose(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),D.translate(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Nv.WORLD?D.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]):D.copy(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}var GF={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function _F(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GF,r),Q.extend(t,e,r),e.keyMatricesTime={},w.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},w.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],BF(t,e)}var WF=w.newInstance(_F);Ue("vtkActor",WF);var{CoordinateSystem:Bv}=ar;function zF(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;let n=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Bv.WORLD&&(e.bufferShift[0]-=n[0],e.bufferShift[1]-=n[1],e.bufferShift[2]-=n[2]),D.identity(e.keyMatrices.bcwc),D.identity(e.keyMatrices.normalMatrix),D.translate(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Bv.WORLD?D.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):D.copy(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}var AF={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function PF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AF,r),Q.extend(t,e,r),e.keyMatricesTime={},w.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},w.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],zF(t,e)}var HF=w.newInstance(PF);Ue("vtkActor2D",HF);function IF(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([i.usize,i.vsize],a,e.WebGPURenderWindow.getRenderable())}}}var jF={};function KF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jF,r),Q.extend(t,e,r),e.CubeAxesActorHelper=$s.newCubeAxesActorHelper(),IF(t,e)}var $F=$(KF,"vtkWebGPUCubeAxesActor");Ue("vtkCubeAxesActor",$F);var{DisplayLocation:Qf}=qf;function XF(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(Qf.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(Qf.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(_e.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(_e.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(_e.POINTS),t.getRepresentationAsString=()=>w.enumToString(_e,e.representation)}var YF={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:_e.SURFACE,displayLocation:Qf.FOREGROUND};function Gv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YF,r),w.obj(t,e),w.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),w.setGetArray(t,e,["color"],3),XF(t,e)}var qF=w.newInstance(Gv,"vtkProperty2D"),_v={newInstance:qF,extend:Gv,...qf};var{BufferUsage:nt,PrimitiveTypes:dt}=Ct,{Representation:Ys}=Gt,{ScalarMode:qs}=ht,{CoordinateSystem:ZF}=ar,{DisplayLocation:Wv}=_v,QF=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,JF=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

struct Material {
  ior: f32,
  roughness: f32,
  metallic: f32,
  base: vec3<f32>,
};

struct DirectionalLight {
  direction: vec3<f32>,
  color: vec3<f32>,
};

struct PointLight {
  position: vec3<f32>,
  color: vec3<f32>,
};

struct SpotLight {
  position: vec3<f32>,
  direction: vec3<f32>,
  cones: vec2<f32>,
  color: vec3<f32>,
};

const pi: f32 = 3.14159265359;

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;

  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, mat: Material, light: DirectionalLight) -> PBRData {
  var L: vec3<f32> = normalize(light.direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = light.color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf * incoming * angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: PointLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V);
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  var F: f32 = schlickFresnelIOR(V, N, mat.ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = light.color * (1.0 / (dist * dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: SpotLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);

  var theta: f32 = mdot(normalize(light.direction), L);
  var epsilon: f32 = light.cones.x - light.cones.y;
  var intensity: f32 = (theta - light.cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist * dist;

  var incoming: vec3<f32> = light.color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;
  var ior: f32 = mapperUBO.BaseIOR;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  // Use texture alpha for transparency
  computedColor.a = mapperUBO.Opacity * _diffuseMap.a;
  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function zv(t){return t.indexOf("edge")>=0}function ek(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=r=>{r&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==ZF.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{let n=e.WebGPUActor.getRenderable().getProperty(),a=e.UBO.getSendTime();if(t.getMTime()<=a&&n.getMTime()<=a&&e.renderable.getMTime()<=a)return;let i=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",i.bcwc),e.UBO.setArray("BCSCMatrix",i.bcsc),e.UBO.setArray("MCWCNormals",i.normalMatrix),e.is2D){let o=n.getDisplayLocation?.()??Wv.BACKGROUND;e.UBO.setValue("ZValue",o===Wv.FOREGROUND?1:0);let c=n.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[...c,1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else e.UBO.setValue("AmbientIntensity",n.getAmbient()),e.UBO.setArray("AmbientColor",[...n.getAmbientColorByReference(),1]),e.UBO.setValue("DiffuseIntensity",n.getDiffuse()),e.UBO.setArray("DiffuseColor",[...n.getDiffuseColorByReference(),1]),e.UBO.setValue("Roughness",n.getRoughness()),e.UBO.setValue("BaseIOR",n.getBaseIOR()),e.UBO.setValue("Metallic",n.getMetallic()),e.UBO.setValue("NormalStrength",n.getNormalStrength()),e.UBO.setValue("Emission",n.getEmission()),e.UBO.setValue("SpecularIntensity",n.getSpecular()),n.getSpecularColorByReference()&&e.UBO.setArray("SpecularColor",[...n.getSpecularColorByReference(),1]);let s=n.getEdgeColorByReference?.();s&&e.UBO.setArray("EdgeColor",[...s,1]),e.UBO.setValue("LineWidth",n.getLineWidth()),e.UBO.setValue("Opacity",n.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID()),e.UBO.sendIfNeeded(e.WebGPURenderWindow.getDevice())},t.haveWideLines=()=>{let r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();return r.getProperty().getLineWidth()<=1||e.primitiveType===dt.Verts?!1:e.primitiveType===dt.Triangles||e.primitiveType===dt.TriangleStrips?n===Ys.WIREFRAME:!0},t.replaceShaderPosition=(r,n,a)=>{let i=n.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),i.hasOutput("vertexVC")||i.addOutput("vec4<f32>","vertexVC");let s=i.getCode();e.useRendererMatrix?(s=J.substitute(s,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(s=J.substitute(s,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(s=J.substitute(s,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(s=J.substitute(s,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(i.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),s=J.substitute(s,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),s=J.substitute(s,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,i.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(r,n,a)=>{let i=a.getBuffer("normalMC"),s=e.WebGPUActor.getRenderable();if(i){let o=n.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",i.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",i.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",i.getArrayInformation()[0].interpolation);let c=o.getCode();c=J.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(c);let f=n.getShaderDescription("fragment");c=f.getCode(),s.getProperty().getNormalTexture()?c=J.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=J.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,f.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(r,n,a)=>{if(r.includes("sel"))return;let i=n.getShaderDescription("vertex");i.hasOutput("vertexVC")||i.addOutput("vec4<f32>","vertexVC");let s=e.WebGPURenderer.getRenderable(),o=n.getShaderDescription("fragment"),c=o.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!zv(r)&&!e.is2D&&!r.includes("sel")){let f=["  let fragPos = vec3<f32>(input.vertexVC.xyz);","  let V = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  let baseColor = _diffuseMap.rgb * diffuseColor.rgb;","  let roughness = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  let metallic = mapperUBO.Metallic * _metallicMap.r;","  let alpha = roughness * roughness;","  let k = alpha * alpha / 2.0;","  var diffuse = vec3<f32>(0.);","  var specular = vec3<f32>(0.);","  let emission = _emissionMap.rgb * mapperUBO.Emission;","","  // Material struct","  let mat = Material(ior, roughness, metallic, baseColor);","","  {","    var i = 0;","    loop {","      if (!(i < rendererUBO.LightCount)) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let pointLight = PointLight(pos, color);","           let result = calcPointLight(normal, V, fragPos, mat, pointLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","          }","         // Directional light","         case 1 {","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let dirLight = DirectionalLight(dir, color);","           let result = calcDirectionalLight(normal, V, mat, dirLight); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         // Spot Light","         case 2 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let cones = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           let spotLight = SpotLight(pos, dir, cones, color);","           let result = calcSpotLight(normal, V, fragPos, mat, spotLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  let fresnel = min(1.0, schlickFresnelIOR(V, normal, ior, k)); // Fresnel","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  let fresnelMetallic = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  let kS = min(vec3<f32>(1.0), mix(vec3<f32>(fresnel), fresnelMetallic, metallic));","  let kD = (1.0 - kS) * (1.0 - metallic);","  let PBR = mapperUBO.DiffuseIntensity * kD * diffuse + kS * specular;","  computedColor = vec4<f32>(PBR + emission, mapperUBO.Opacity);"];s.getEnvironmentTexture()?.getImageLoaded()&&f.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  let diffuseIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  let diffuseCoords = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  let VreflN = normalize(reflect(-V, normal));","  let reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  let specularCoords = vecToRectCoord(reflectionIBLCoords);","  let diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  let level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  let specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  let specularIBLContribution = specularIBL.rgb * rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution * kS, 0);","  let diffuseIBLContribution = diffuseIBL.rgb * rendererUBO.BackgroundDiffuseStrength;","  computedColor += vec4<f32>(diffuseIBLContribution * baseColor * _ambientOcclusionMap.rgb * kD, 0);"),c=J.substitute(c,"//VTK::Light::Impl",f).result,o.setCode(c)}else c=J.substitute(c,"//VTK::Light::Impl",["  let diffuse = diffuseColor.rgb;","  let specular = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(r,n,a)=>{if(zv(r)){let f=n.getShaderDescription("fragment"),l=f.getCode();l=J.substitute(l,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,f.setCode(l);return}let i=a.getBuffer("colorVI");if(!i)return;let s=n.getShaderDescription("vertex");s.addOutput("vec4<f32>","color",i.getArrayInformation()[0].interpolation);let o=s.getCode();o=J.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,s.setCode(o);let c=n.getShaderDescription("fragment");o=c.getCode(),o=J.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(r,n,a)=>{if(!a.hasAttribute("tcoord"))return;let i=n.getShaderDescription("vertex"),s=a.getBuffer("tcoord"),o=Ne.getNumberOfComponentsFromBufferFormat(s.getArrayInformation()[0].format),c=i.getCode();i.addOutput(`vec${o}<f32>`,"tcoordVS"),c=J.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,i.setCode(c);let f=n.getShaderDescription("fragment");c=f.getCode();let l=e.WebGPUActor.getRenderable(),u=l.getProperty(),g=C=>C?C.getDimensionality()===o:!1,p=[],d=u.getDiffuseTexture?.();(d?.getImageLoaded()||l.getTextures()[0]||e.colorTexture)&&(g(d)||g(l.getTextures()[0])||g(e.colorTexture))&&p.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);");let h=u.getORMTexture?.(),v=u.getRMTexture?.(),x=u.getRoughnessTexture?.(),T=u.getMetallicTexture?.(),m=u.getAmbientOcclusionTexture?.(),y=u.getEmissionTexture?.(),S=u.getNormalTexture?.();h?.getImageLoaded()?g(h)&&p.push("_ambientOcclusionMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).rrra;","_roughnessMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).bbba;"):v?.getImageLoaded()?g(v)&&p.push("_roughnessMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).bbba;"):(x?.getImageLoaded()&&g(x)&&p.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS).ggga;"),T?.getImageLoaded()&&g(T)&&p.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS).bbba;"),m?.getImageLoaded()&&g(m)&&p.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS).rrra;")),y?.getImageLoaded()&&g(y)&&p.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),S?.getImageLoaded()&&g(S)&&p.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),c=J.substitute(c,"//VTK::TCoord::Impl",p).result,f.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(r,n,a)=>{if(r.includes("sel")){let i=n.getShaderDescription("fragment"),s=i.getCode();s=J.substitute(s,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,i.setCode(s)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(r,n)=>r===Ys.POINTS||n===dt.Points?nt.Verts:n===dt.Lines?nt.Lines:r===Ys.WIREFRAME?n===dt.Triangles?nt.LinesFromTriangles:nt.LinesFromStrips:n===dt.Triangles?nt.Triangles:n===dt.TriangleStrips?nt.Strips:n===dt.TriangleEdges?nt.LinesFromTriangles:nt.LinesFromStrips,t.getHashFromUsage=r=>`pt${r}`,t.getTopologyFromUsage=r=>{switch(r){case nt.Triangles:return"triangle-list";case nt.Verts:return"point-list";case nt.Lines:default:return"line-list"}},t.buildVertexInput=()=>{let r=e.currentInput,n=e.cellArray,a=e.primitiveType,s=e.WebGPUActor.getRenderable().getProperty().getRepresentation(),o=e.WebGPURenderWindow.getDevice(),c=!1;a===dt.TriangleEdges&&(c=!0,s=Ys.WIREFRAME);let f=e.vertexInput,l=r.getPoints(),u=null;if(n?(u=o.getBufferManager().getBuffer({hash:`R${s}P${a}${n.getMTime()}`,usage:nt.Index,cells:n,numberOfPoints:l.getNumberOfPoints(),primitiveType:a,representation:s}),f.setIndexBuffer(u)):f.setIndexBuffer(null),l){let h=e.WebGPUActor.getBufferShift(e.WebGPURenderer);f.addBuffer(o.getBufferManager().getBuffer({hash:`${l.getMTime()}I${u?.getMTime?.()??0}${h.join()}float32x4`,usage:nt.PointArray,format:"float32x4",dataArray:l,indexBuffer:u,shift:h,packExtra:!0}),["vertexBC"])}else f.removeBufferIfPresent("vertexBC");let g=t.getUsage(s,a);if(e._usesCellNormals=!1,!e.is2D&&(g===nt.Triangles||g===nt.Strips)){let h=r.getPointData().getNormals(),v={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};h?(v.hash=`${h.getMTime()}I${u.getMTime()}snorm8x4`,v.dataArray=h,v.usage=nt.PointArray,f.addBuffer(o.getBufferManager().getBuffer(v),["normalMC"])):a===dt.Triangles?(e._usesCellNormals=!0,v.hash=`PFN${l.getMTime()}I${u.getMTime()}snorm8x4`,v.dataArray=l,v.cells=n,v.usage=nt.NormalsFromPoints,f.addBuffer(o.getBufferManager().getBuffer(v),["normalMC"])):f.removeBufferIfPresent("normalMC")}else f.removeBufferIfPresent("normalMC");let p=!1;if(e.renderable.getScalarVisibility()){let h=e.renderable.getColorMapColors();if(h&&!c){let v=e.renderable.getScalarMode(),x=(v===qs.USE_CELL_DATA||v===qs.USE_CELL_FIELD_DATA||v===qs.USE_FIELD_DATA||!r.getPointData().getScalars())&&v!==qs.USE_POINT_FIELD_DATA&&h;f.addBuffer(o.getBufferManager().getBuffer({usage:nt.PointArray,format:"unorm8x4",hash:`${x}${h.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:h,indexBuffer:u,cellData:x,cellOffset:0}),["colorVI"]),p=!0}}p||f.removeBufferIfPresent("colorVI");let d=null;e.renderable.getInterpolateScalarsBeforeMapping?.()&&e.renderable.getColorCoordinates()?d=e.renderable.getColorCoordinates():d=r.getPointData().getTCoords(),d&&!c?f.addBuffer(o.getBufferManager().getBufferForPointArray(d,f.getIndexBuffer()),["tcoord"]):f.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{let r=[],n=[],a=e.renderable.getColorTextureMap?.();a&&!e.colorTexture&&(e.colorTexture=Mr.newInstance({label:"polyDataColor"})),a&&(e.colorTexture.setInputData(a),n.push(["DiffuseTexture",e.colorTexture]));let i=e.WebGPUActor.getRenderable(),s=e.WebGPURenderer.getRenderable();[["DiffuseTexture",i.getProperty().getDiffuseTexture?.()],["DiffuseTexture",i.getTextures()[0]],["DiffuseTexture",e.colorTexture],["ORMTexture",i.getProperty().getORMTexture?.()],["RMTexture",i.getProperty().getRMTexture?.()],["RoughnessTexture",i.getProperty().getRoughnessTexture?.()],["MetallicTexture",i.getProperty().getMetallicTexture?.()],["NormalTexture",i.getProperty().getNormalTexture?.()],["AmbientOcclusionTexture",i.getProperty().getAmbientOcclusionTexture?.()],["EmissionTexture",i.getProperty().getEmissionTexture?.()],["EnvironmentTexture",s.getEnvironmentTexture?.()]].forEach(c=>{let[f,l]=c;l&&((l.getInputData()||l.getJsImageData()||l.getCanvas()||l.getImageBitmap())&&n.push([f,l]),l.getImage()&&l.getImageLoaded()&&n.push([f,l]))}),n.forEach(c=>{let[f,l]=c,u=e.device.getTextureManager().getTextureForVTKTexture(l,f);if(!u.getReady())return;let g=!1;for(let p=0;p<e.textures.length;++p)if(e.textures[p]===u){g=!0,r[p]=!0;break}if(!g){r[e.textures.length]=!0;let p=u.createView(f);e.textures.push(u),e.textureViews.push(p);let d=l.getInterpolate()?"linear":"nearest",h=null;l.getEdgeClamp()&&l.getRepeat()?h="mirror-repeat":l.getEdgeClamp()?h="clamp-to-edge":l.getRepeat()&&(h="repeat");let v={addressModeU:h,addressModeV:h,addressModeW:h,minFilter:d,magFilter:d};f==="EnvironmentTexture"&&(v={addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:d,magFilter:d,mipmapFilter:"linear"}),p.addSampler(e.device,v)}});for(let c=e.textures.length-1;c>=0;c--)r[c]||(e.textures.splice(c,1),e.textureViews.splice(c,1))},t.computePipelineHash=()=>{let r=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===dt.TriangleEdges||e.primitiveType===dt.TriangleStripEdges)r+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(r+="n"),e.vertexInput.hasAttribute("colorVI")&&(r+="c"),e.vertexInput.hasAttribute("tcoord")){let a=e.vertexInput.getBuffer("tcoord"),i=Ne.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);r+=`t${i}`}e.textures.length&&(r+=`tx${e.textures.length}`)}e._usesCellNormals&&(r+="cn"),e.SSBO&&(r+="ssbo");let n=t.getHashFromUsage(e.usage);r+=n,r+=e.renderEncoder.getPipelineHash(),e.pipelineHash=r},t.updateBuffers=()=>{e.primitiveType!==dt.TriangleEdges&&e.primitiveType!==dt.TriangleStripEdges&&t.updateTextures();let r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();e.usage=t.getUsage(n,e.primitiveType),t.buildVertexInput();let a=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(a.getSizeInBytes()/a.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){let i=r.getProperty();t.setNumberOfInstances(Math.ceil(i.getLineWidth()*2))}else t.setNumberOfInstances(1)}}var tk={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function Av(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tk,r),oa.extend(t,e,r),e.fragmentShaderTemplate=JF,e.vertexShaderTemplate=QF,e._tmpMat3=ee.identity(new Float64Array(9)),e._tmpMat4=D.identity(new Float64Array(16)),e.UBO=Vt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),ge(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],ek(t,e)}var rk=$(Av,"vtkWebGPUCellArrayMapper"),Zs={newInstance:rk,extend:Av};var{PrimitiveTypes:zt}=Ct;function nk(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>Zs.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();let n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{if(!r){le("No input!");return}let n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[],i=0;for(let s=zt.Points;s<=zt.TriangleStrips;s++)if(n[s].getNumberOfValues()>0){e.primitives[s]||(e.primitives[s]=t.createCellArrayMapper());let o=e.primitives[s];o.setCellArray(n[s]),o.setCurrentInput(r),o.setCellOffset(i),o.setPrimitiveType(s),o.setRenderable(e.renderable),i+=n[s].getNumberOfCells(),a.push(o)}else e.primitives[s]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility()){if(n[zt.Triangles].getNumberOfValues()>0){let s=zt.TriangleEdges;e.primitives[s]||(e.primitives[s]=t.createCellArrayMapper());let o=e.primitives[s];o.setCellArray(n[zt.Triangles]),o.setCurrentInput(r),o.setCellOffset(e.primitives[zt.Triangles].getCellOffset()),o.setPrimitiveType(s),o.setRenderable(e.renderable),a.push(o)}else e.primitives[zt.TriangleEdges]=null;if(n[zt.TriangleStrips].getNumberOfValues()>0){let s=zt.TriangleStripEdges;e.primitives[s]||(e.primitives[s]=t.createCellArrayMapper());let o=e.primitives[s];o.setCellArray(n[zt.TriangleStrips]),o.setCurrentInput(r),o.setCellOffset(e.primitives[zt.TriangleStrips].getCellOffset()),o.setPrimitiveType(s),o.setRenderable(e.renderable),a.push(o)}else e.primitives[zt.TriangleStripEdges]=null}t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}var ak={primitives:null};function ik(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ak,r),Q.extend(t,e,r),e.primitives=[],nk(t,e)}var sk=$(ik,"vtkWebGPUPolyDataMapper");Ue("vtkMapper",sk);var{PrimitiveTypes:Pv}=Ct;function ok(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>Zs.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();let n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{let n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[],i=0;for(let s=Pv.Points;s<=Pv.Triangles;s++)if(n[s].getNumberOfValues()>0){e.primitives[s]||(e.primitives[s]=t.createCellArrayMapper());let o=e.primitives[s];o.setCellArray(n[s]),o.setCurrentInput(r),o.setCellOffset(i),o.setPrimitiveType(s),o.setRenderable(e.renderable),o.setIs2D(!0),i+=n[s].getNumberOfCells(),a.push(o)}else e.primitives[s]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}function ck(t){return{primitives:[],...t}}function fk(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ck(r)),Q.extend(t,e,r),e.primitives=[],ok(t,e)}var uk=$(fk,"vtkWebGPUPolyDataMapper2D");Ue("vtkMapper2D",uk);function lk(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([i.usize,i.vsize],a,e.WebGPURenderWindow.getRenderable())}}}var gk={};function pk(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gk,r),Q.extend(t,e,r),e.scalarBarActorHelper=pa.newScalarBarActorHelper(),lk(t,e)}var hk=$(pk,"vtkWebGPUScalarBarActor");Ue("vtkScalarBarActor",hk);function dk(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(r,n)=>{e.texture=r,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;let a=Ne.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=a.sampleType},t.createFromTextureHandle=(r,n)=>{e.texture=null,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;let a=Ne.getDetailsFromTextureFormat(n.format);e.bindGroupLayoutEntry.texture.sampleType=a.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(r,n)=>{let a="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?a="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(a="u32");let i=`@binding(${r}) @group(${n}) var ${e.label}: texture_${e.options.dimension}<${a}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(i=`@binding(${r}) @group(${n}) var ${e.label}: texture_depth_${e.options.dimension};`),i},t.addSampler=(r,n)=>{let a=Kr.newInstance({label:`${e.label}Sampler`});a.create(r,n),t.setSampler(a)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}var vk={texture:null,handle:null,sampler:null,label:null};function Hv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vk,r),w.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},w.obj(e.bindGroupTime,{mtime:0}),w.get(t,e,["bindGroupTime","texture"]),w.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),dk(t,e)}var mk=w.newInstance(Hv),Qs={newInstance:mk,extend:Hv};function xk(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(r,n)=>{e.device=r,e.width=n.width,e.height=n.height,e.depth=n.depth?n.depth:1;let a=e.depth===1?"2d":"3d";e.format=n.format?n.format:"rgba8unorm",e.mipLevel=n.mipLevel?n.mipLevel:0,e.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:a,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(r,n,a)=>{e.device=r,e.handle=n,e.width=a.width,e.height=a.height,e.depth=a.depth?a.depth:1,e.format=a.format?a.format:"rgba8unorm",e.usage=a.usage?a.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=r=>{let n=[],a=u=>{e.device.getHandle().queue.copyExternalImageToTexture({source:u,flipY:r.flip},{texture:e.handle,premultipliedAlpha:!0,mipLevel:0,origin:{x:0,y:0,z:0}},[u.width,u.height,e.depth]),t.getDimensionality()!==3&&e.mipLevel>0&&Mr.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0};if(r.canvas){a(r.canvas);return}if(r.imageBitmap){r.width=r.imageBitmap.width,r.height=r.imageBitmap.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.imageBitmap);return}if(r.jsImageData){r.width=r.jsImageData.width,r.height=r.jsImageData.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.jsImageData);return}if(r.image){r.width=r.image.width,r.height=r.image.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.image);return}let i=Ne.getDetailsFromTextureFormat(e.format),s=e.width*i.stride,o=(u,g,p)=>{let d=i.elementSize===2&&i.sampleType==="float",h=u.BYTES_PER_ELEMENT,v=u.length/(g*p)*h;if(!d&&v%256===0)return[u,v];let x=v/h,T=i.elementSize,m=256*Math.floor((x*T+255)/256),y=m/T,S=w.newTypedArray(d?"Uint16Array":u.constructor.name,y*g*p),C=g*p;if(d)for(let E=0;E<C;E++){let O=E*x,U=E*y;for(let k=0;k<x;k++)S[U+k]=Tt.toHalf(u[O+k])}else if(y===x)S.set(u);else for(let E=0;E<C;E++)S.set(u.subarray(E*x,(E+1)*x),E*y);return[S,m]};r.nativeArray&&(n=r.nativeArray);let c=t.getDimensionality()===3,f=o(n,e.height,c?e.depth:1);s=f[1];let l=f[0];e.device.getHandle().queue.writeTexture({texture:e.handle,mipLevel:0,origin:{x:0,y:0,z:0}},l,{offset:0,bytesPerRow:s,rowsPerImage:e.height},{width:e.width,height:e.height,depthOrArrayLayers:c?e.depth:1}),!c&&e.mipLevel>0&&Mr.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0},t.getScale=()=>{let r=Ne.getDetailsFromTextureFormat(e.format);return r.elementSize===2&&r.sampleType==="float"?1:255},t.getNumberOfComponents=()=>Ne.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let r=0;return e.width>1&&r++,e.height>1&&r++,e.depth>1&&r++,r},t.resizeToMatch=r=>{(r.getWidth()!==e.width||r.getHeight()!==e.height||r.getDepth()!==e.depth)&&(e.width=r.getWidth(),e.height=r.getHeight(),e.depth=r.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(r!==e.width||n!==e.height||a!==e.depth)&&(e.width=r,e.height=n,e.depth=a,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n.dimension||(n.dimension=e.depth===1?"2d":"3d");let a=Qs.newInstance({label:r});return a.create(t,n),a}}var yk={device:null,handle:null,buffer:null,ready:!1,label:null};function Iv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yk,r),w.obj(t,e),w.get(t,e,["handle","ready","width","height","depth","format","usage"]),w.setGet(t,e,["device","label"]),xk(t,e)}var Tk=w.newInstance(Iv),vt={newInstance:Tk,extend:Iv};var Sk={RGB:0,HSV:1,LAB:2,DIVERGING:3},Ck={LINEAR:0,LOG10:1},Jf={ColorSpace:Sk,Scale:Ck};var{ColorSpace:At,Scale:eu}=Jf,{ScalarMappingTarget:Js}=Fn,{vtkDebugMacro:wk,vtkErrorMacro:Rr,vtkWarningMacro:Ok}=w;function jv(t,e){let r=t[0],n=t[1],a=t[2],i=Math.sqrt(r*r+n*n+a*a),s=i>.001?Math.acos(r/i):0,o=s>.001?Math.atan2(a,n):0;e[0]=i,e[1]=s,e[2]=o}function Ek(t,e){let r=t[0],n=t[1],a=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(a),e[2]=r*Math.sin(n)*Math.sin(a)}function Kv(t,e){if(t[0]>=e-.1)return t[2];let r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function Mk(t,e){let r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function $v(t,e,r,n){let a=[],i=[];Nr(e,a),Nr(r,i);let s=[],o=[];jv(a,s),jv(i,o);let c=t;if(s[1]>.05&&o[1]>.05&&Mk(s[2],o[2])>.33*Math.PI){let u=Math.max(s[0],o[0]);u=Math.max(88,u),t<.5?(o[0]=u,o[1]=0,o[2]=0,c*=2):(s[0]=u,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&o[1]>.05?s[2]=Kv(o,s[0]):o[1]<.05&&s[1]>.05&&(o[2]=Kv(s,o[0]));let f=[];f[0]=(1-c)*s[0]+c*o[0],f[1]=(1-c)*s[1]+c*o[1],f[2]=(1-c)*s[2]+c*o[2];let l=[];Ek(f,l),Ba(l,n)}function Rk(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(r,n,a,i)=>t.addRGBPointLong(r,n,a,i,.5,0),t.addRGBPointLong=function(r,n,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(s<0||s>1)return Rr("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return Rr("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);let c={x:r,r:n,g:a,b:i,midpoint:s,sharpness:o};e.nodes.push(c),t.sortAndUpdateRange();let f=0;for(;f<e.nodes.length&&e.nodes[f].x!==r;f++);return f<e.nodes.length?f:-1},t.addHSVPoint=(r,n,a,i)=>t.addHSVPointLong(r,n,a,i,.5,0),t.addHSVPointLong=function(r,n,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,c=[];return yr([n,a,i],c),t.addRGBPoint(r,c[0],c[1],c[2],s,o)},t.setNodes=r=>{if(e.nodes!==r){let n=JSON.stringify(e.nodes);e.nodes=r;let a=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==a)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{let r=JSON.stringify(e.nodes);e.nodes.sort((i,s)=>i.x-s.x);let n=JSON.stringify(e.nodes),a=t.updateRange();return!a&&r!==n?(t.modified(),!0):a},t.updateRange=()=>{let r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];let n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n=0;for(;n<e.nodes.length&&e.nodes[n].x!==r;n++);let a=n;if(n>=e.nodes.length)return-1;let i=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.movePoint=(r,n)=>{if(r!==n){t.removePoint(n);for(let a=0;a<e.nodes.length;a++)if(e.nodes[a].x===r){e.nodes[a].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(r,n,a,i,s,o,c,f)=>{t.sortAndUpdateRange();for(let l=0;l<e.nodes.length;)e.nodes[l].x>=r&&e.nodes[l].x<=s?e.nodes.splice(l,1):l++;t.addRGBPointLong(r,n,a,i,.5,0),t.addRGBPointLong(s,o,c,f,.5,0),t.modified()},t.addHSVSegment=(r,n,a,i,s,o,c,f)=>{let l=[n,a,i],u=[o,c,f],g=[],p=[];yr(l,g),yr(u,p),t.addRGBSegment(r,g[0],g[1],g[2],s,p[0],p[1],p[2])},t.mapValue=r=>{let n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=(r,n)=>{if(e.indexedLookup){let a=t.getSize(),i=t.getAnnotatedValueIndexInternal(r);if(i<0||a===0){let s=t.getNanColorByReference();n[0]=s[0],n[1]=s[1],n[2]=s[2]}else{let s=[];t.getNodeValue(i%a,s),n[0]=s[1],n[1]=s[2],n[2]=s[3]}return}t.getTable(r,r,1,n)},t.getRedValue=r=>{let n=[];return t.getColor(r,n),n[0]},t.getGreenValue=r=>{let n=[];return t.getColor(r,n),n[1]},t.getBlueValue=r=>{let n=[];return t.getColor(r,n),n[2]},t.logScaleEnabled=()=>e.scale===eu.LOG10,t.usingLogScale=()=>t.logScaleEnabled()&&e.mappingRange[0]>0,t.getTable=(r,n,a,i)=>{let s=t.usingLogScale(),o=s?Math.log10(Number(r)):Number(r),c=s?Math.log10(Number(n)):Number(n);if(pn(o)||pn(c)){for(let E=0;E<a;E++)i[E*3+0]=e.nanColor[0],i[E*3+1]=e.nanColor[1],i[E*3+2]=e.nanColor[2];return}let f=0,l=e.nodes.length,u=0,g=0,p=0;l!==0&&(u=e.nodes[l-1].r,g=e.nodes[l-1].g,p=e.nodes[l-1].b);let d=0,h=0,v=0,x=[0,0,0],T=[0,0,0],m=0,y=0,S=[],C=e.mappingRange;s&&(C=[Math.log10(e.mappingRange[0]),Math.log10(e.mappingRange[1])]);for(let E=0;E<a;E++){let O=3*E;if(a>1?d=o+E/(a-1)*(c-o):d=.5*(o+c),e.discretize){let U=C;if(d>=U[0]&&d<=U[1]){let k=e.numberOfValues,V=U[1]-U[0];if(k<=1)d=U[0]+V/2;else{let b=(d-U[0])/V,R=ba(k*b);d=U[0]+R/(k-1)*V}}}for(;f<l&&d>e.nodes[f].x;)f++,f<l&&(h=e.nodes[f-1].x,v=e.nodes[f].x,x[0]=e.nodes[f-1].r,T[0]=e.nodes[f].r,x[1]=e.nodes[f-1].g,T[1]=e.nodes[f].g,x[2]=e.nodes[f-1].b,T[2]=e.nodes[f].b,m=e.nodes[f-1].midpoint,y=e.nodes[f-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(d>C[1])i[O]=0,i[O+1]=0,i[O+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(i[O]=e.aboveRangeColor[0],i[O+1]=e.aboveRangeColor[1],i[O+2]=e.aboveRangeColor[2]):(i[O]=u,i[O+1]=g,i[O+2]=p));else if(d<C[0]||Fc(d)&&d<0)i[O]=0,i[O+1]=0,i[O+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(i[O]=e.belowRangeColor[0],i[O+1]=e.belowRangeColor[1],i[O+2]=e.belowRangeColor[2]):l>0&&(i[O]=e.nodes[0].r,i[O+1]=e.nodes[0].g,i[O+2]=e.nodes[0].b));else if(f===0&&(Math.abs(d-o)<1e-6||e.discretize))l>0?(i[O]=e.nodes[0].r,i[O+1]=e.nodes[0].g,i[O+2]=e.nodes[0].b):(i[O]=0,i[O+1]=0,i[O+2]=0);else{let U=0;if(U=(d-h)/(v-h),U<m?U=.5*U/m:U=.5+.5*(U-m)/(1-m),y>.99)if(U<.5){i[O]=x[0],i[O+1]=x[1],i[O+2]=x[2];continue}else{i[O]=T[0],i[O+1]=T[1],i[O+2]=T[2];continue}if(y<.01){if(e.colorSpace===At.RGB)i[O]=(1-U)*x[0]+U*T[0],i[O+1]=(1-U)*x[1]+U*T[1],i[O+2]=(1-U)*x[2]+U*T[2];else if(e.colorSpace===At.HSV){let G=[],F=[];ea(x,G),ea(T,F),e.hSVWrap&&(G[0]-F[0]>.5||F[0]-G[0]>.5)&&(G[0]>F[0]?G[0]-=1:F[0]-=1);let _=[];_[0]=(1-U)*G[0]+U*F[0],_[0]<0&&(_[0]+=1),_[1]=(1-U)*G[1]+U*F[1],_[2]=(1-U)*G[2]+U*F[2],yr(_,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]}else if(e.colorSpace===At.LAB){let G=[],F=[];Nr(x,G),Nr(T,F);let _=[];_[0]=(1-U)*G[0]+U*F[0],_[1]=(1-U)*G[1]+U*F[1],_[2]=(1-U)*G[2]+U*F[2],Ba(_,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]}else e.colorSpace===At.DIVERGING?($v(U,x,T,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]):Rr("ColorSpace set to invalid value.",e.colorSpace);continue}U<.5?U=.5*(U*2)**(1+10*y):U>.5&&(U=1-.5*((1-U)*2)**(1+10*y));let k=U*U,V=k*U,b=2*V-3*k+1,R=-2*V+3*k,M=V-2*k+U,N=V-k,L,B;if(e.colorSpace===At.RGB)for(let G=0;G<3;G++)L=T[G]-x[G],B=(1-y)*L,i[O+G]=b*x[G]+R*T[G]+M*B+N*B;else if(e.colorSpace===At.HSV){let G=[],F=[];ea(x,G),ea(T,F),e.hSVWrap&&(G[0]-F[0]>.5||F[0]-G[0]>.5)&&(G[0]>F[0]?G[0]-=1:F[0]-=1);let _=[];for(let W=0;W<3;W++)L=F[W]-G[W],B=(1-y)*L,_[W]=b*G[W]+R*F[W]+M*B+N*B,W===0&&_[W]<0&&(_[W]+=1);yr(_,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]}else if(e.colorSpace===At.LAB){let G=[],F=[];Nr(x,G),Nr(T,F);let _=[];for(let W=0;W<3;W++)L=F[W]-G[W],B=(1-y)*L,_[W]=b*G[W]+R*F[W]+M*B+N*B;Ba(_,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]}else e.colorSpace===At.DIVERGING?($v(U,x,T,S),i[O]=S[0],i[O+1]=S[1],i[O+2]=S[2]):Rr("ColorSpace set to invalid value.");for(let G=0;G<3;G++)i[O+G]=i[O+G]<0?0:i[O+G],i[O+G]=i[O+G]>1?1:i[O+G]}}},t.getUint8Table=function(r,n,a){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===a&&e.tableWithAlpha!==i)return e.table;if(e.nodes.length===0)return Rr("Attempting to lookup a value with no points in the function"),e.table;let s=i?4:3;(e.tableSize!==a||e.tableWithAlpha!==i)&&(e.table=new Uint8Array(a*s),e.tableSize=a,e.tableWithAlpha=i);let o=[];t.getTable(r,n,a,o);for(let c=0;c<a;c++)e.table[c*s+0]=Math.floor(o[c*3+0]*255+.5),e.table[c*s+1]=Math.floor(o[c*3+1]*255+.5),e.table[c*s+2]=Math.floor(o[c*3+2]*255+.5),i&&(e.table[c*s+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=r=>{t.removeAllPoints();let n=r.getNumberOfComponents();for(let a=0;a<r.getNumberOfTuples();a++)switch(n){case 3:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}case 6:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(r,n,a,i)=>{let s=0;t.removeAllPoints(),a>1&&(s=(n-r)/(a-1));for(let o=0;o<a;o++){let c={x:r+s*o,r:i[o*3],g:i[o*3+1],b:i[o*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(r,n)=>r<0||r>=e.nodes.length?(Rr("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1),t.setNodeValue=(r,n)=>{if(r<0||r>=e.nodes.length)return Rr("Index out of range!"),-1;let a=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],a!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;let r=e.nodes?.length??0;return Math.max(4094,r)},t.getIndexedColor=(r,n)=>{let a=t.getSize();if(a>0&&r>=0){let s=[];t.getNodeValue(r%a,s);for(let o=0;o<3;++o)n[o]=s[o+1];n[3]=1;return}let i=t.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1},t.fillFromDataPointer=(r,n)=>{if(!(r<=0||!n)){t.removeAllPoints();for(let a=0;a<r;a++)t.addRGBPoint(n[a*4],n[a*4+1],n[a*4+2],n[a*4+3])}},t.setMappingRange=(r,n)=>{let a=[r,n],i=[r,n],s=t.getRange(),o=t.logScaleEnabled();if(s[1]===a[1]&&s[0]===a[0])return;if(a[1]===a[0]){Rr("attempt to set zero width color range");return}o&&(a[0]<=0?console.warn("attempt to set log scale color range with non-positive minimum"):(i[0]=Math.log10(a[0]),i[1]=Math.log10(a[1])));let c=(i[1]-i[0])/(s[1]-s[0]),f=i[0]-s[0]*c;for(let l=0;l<e.nodes.length;++l)e.nodes[l].x=e.nodes[l].x*c+f;e.mappingRange[0]=a[0],e.mappingRange[1]=a[1],t.modified()},t.adjustRange=r=>{let n=t.getRange(),a=[];n[0]<r[0]?(t.getColor(r[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])):(t.getColor(n[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])),n[1]>r[1]?(t.getColor(r[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])):(t.getColor(n[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=r[0]&&e.nodes[i].x<=r[1]?e.nodes.splice(i,1):++i;return 1},t.estimateMinNumberOfSamples=(r,n)=>{let a=t.findMinimumXDistance();return Math.ceil((n-r)/a)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let r=Number.MAX_VALUE;for(let n=0;n<e.nodes.length-1;n++){let a=e.nodes[n+1].x-e.nodes[n].x;a<r&&(r=a)}return r},t.mapScalarsThroughTable=(r,n,a,i)=>{if(t.getSize()===0){wk("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,a,i):t.mapData(r,n,a,i)},t.mapData=(r,n,a,i)=>{if(t.getSize()===0){Ok("Transfer Function Has No Points!");return}let s=Math.floor(t.getAlpha()*255+.5),o=r.getNumberOfTuples(),c=r.getNumberOfComponents(),f=n.getData(),l=r.getData(),u=[];if(a===Js.RGBA)for(let g=0;g<o;g++){let p=l[g*c+i];t.getColor(p,u),f[g*4]=Math.floor(u[0]*255+.5),f[g*4+1]=Math.floor(u[1]*255+.5),f[g*4+2]=Math.floor(u[2]*255+.5),f[g*4+3]=s}if(a===Js.RGB)for(let g=0;g<o;g++){let p=l[g*c+i];t.getColor(p,u),f[g*3]=Math.floor(u[0]*255+.5),f[g*3+1]=Math.floor(u[1]*255+.5),f[g*3+2]=Math.floor(u[2]*255+.5)}if(a===Js.LUMINANCE)for(let g=0;g<o;g++){let p=l[g*c+i];t.getColor(p,u),f[g]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(a===Js.LUMINANCE_ALPHA)for(let g=0;g<o;g++){let p=l[g*c+i];t.getColor(p,u),f[g*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),f[g*2+1]=s}},t.applyColorMap=r=>{let n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=At[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Rr(`ColorSpace ${r.ColorSpace} not supported, using RGB instead`),e.colorSpace=At.RGB));let a=n!==JSON.stringify(e.colorSpace),i=a||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);a=a||i!==JSON.stringify(e.nanColor);let s=a||JSON.stringify(e.nodes);if(r.RGBPoints){let f=r.RGBPoints.length;e.nodes=[];let l=.5,u=0;for(let g=0;g<f;g+=4)e.nodes.push({x:r.RGBPoints[g],r:r.RGBPoints[g+1],g:r.RGBPoints[g+2],b:r.RGBPoints[g+3],midpoint:l,sharpness:u})}let o=t.sortAndUpdateRange(),c=!o&&(a||s!==JSON.stringify(e.nodes));return c&&t.modified(),o||c}}var Dk={clamping:!0,colorSpace:At.RGB,hSVWrap:!0,scale:eu.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function Xv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Dk,r),Fn.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},w.obj(e.buildTime),w.get(t,e,["buildTime","mappingRange"]),w.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:At},{type:"enum",name:"scale",enum:eu}]),w.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),w.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),Rk(t,e)}var Lk=w.newInstance(Xv,"vtkColorTransferFunction"),ri={newInstance:Lk,extend:Xv,...Jf};var{vtkDebugMacro:eo}=w;function Vk(t,e){e.classHierarchy.push("vtkCamera");let r=new Float64Array(3),n=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),i=D.identity(new Float64Array(16)),s=D.identity(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),f=new Float64Array(3),l=D.identity(new Float64Array(16)),u=D.identity(new Float64Array(16)),g=new Float64Array(3),p=new Float64Array(3);function d(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{let h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=(h,v,x)=>{h===e.position[0]&&v===e.position[1]&&x===e.position[2]||(e.position[0]=h,e.position[1]=v,e.position[2]=x,t.computeDistance(),t.modified())},t.setFocalPoint=(h,v,x)=>{h===e.focalPoint[0]&&v===e.focalPoint[1]&&x===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=v,e.focalPoint[2]=x,t.computeDistance(),t.modified())},t.setDistance=h=>{if(e.distance===h)return;e.distance=h,e.distance<1e-20&&(e.distance=1e-20,eo("Distance is set to minimum."));let v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{let h=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],x=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+v*v+x*x),e.distance<1e-20){e.distance=1e-20,eo("Distance is set to minimum.");let T=e.directionOfProjection;e.focalPoint[0]=e.position[0]+T[0]*e.distance,e.focalPoint[1]=e.position[1]+T[1]*e.distance,e.focalPoint[2]=e.position[2]+T[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=x/e.distance,d()},t.dolly=h=>{if(h<=0)return;let v=e.distance/h;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=h=>{let v=e.position,x=e.focalPoint,T=e.viewUp,m=new Float64Array([T[0],T[1],T[2],0]);D.identity(l);let y=new Float64Array([x[0]-v[0],x[1]-v[1],x[2]-v[2]]);D.rotate(l,l,Fe(h),y),lt.transformMat4(m,m,l),e.viewUp[0]=m[0],e.viewUp[1]=m[1],e.viewUp[2]=m[2],t.modified()},t.azimuth=h=>{let v=e.focalPoint;D.identity(u),D.translate(u,u,v),D.rotate(u,u,Fe(h),e.viewUp),D.translate(u,u,[-v[0],-v[1],-v[2]]),P.transformMat4(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.yaw=h=>{let v=e.position;D.identity(u),D.translate(u,u,v),D.rotate(u,u,Fe(h),e.viewUp),D.translate(u,u,[-v[0],-v[1],-v[2]]),P.transformMat4(p,e.focalPoint,u),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=h=>{let v=e.focalPoint,x=t.getViewMatrix(),T=[-x[0],-x[1],-x[2]];D.identity(u),D.translate(u,u,v),D.rotate(u,u,Fe(h),T),D.translate(u,u,[-v[0],-v[1],-v[2]]),P.transformMat4(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.pitch=h=>{let v=e.position,x=t.getViewMatrix(),T=[x[0],x[1],x[2]];D.identity(u),D.translate(u,u,v),D.rotate(u,u,Fe(h),T),D.translate(u,u,[-v[0],-v[1],-v[2]]),P.transformMat4(p,e.focalPoint,u),t.setFocalPoint(...p)},t.zoom=h=>{h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=(h,v,x)=>{let T=[h,v,x];xr(e.position,T,e.position),xr(e.focalPoint,T,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=h=>{let v=[...e.viewUp,1],x=[],T=[],m=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],lt.transformMat4(x,[...e.position,1],h),lt.transformMat4(T,[...e.focalPoint,1],h),lt.transformMat4(m,v,h),m[0]-=x[0],m[1]-=x[1],m[2]-=x[2],t.setPosition(...x.slice(0,3)),t.setFocalPoint(...T.slice(0,3)),t.setViewUp(...m.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=h=>{let v=h;v<1e-20&&(v=1e-20,eo("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=h=>{let v=h;v<1e-20&&(v=1e-20,eo("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=h=>{},t.getRoll=()=>{},t.setObliqueAngles=(h,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24),x=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],T=t.getCompositeProjectionMatrix(h,-1,1);for(let m=0;m<6;m++)lt.transformMat4(x[m],x[m],T),Op(x[m]),v[4*m+0]=x[m][0],v[4*m+1]=x[m][1],v[4*m+2]=x[m][2],v[4*m+3]=x[m][3];return v},t.getCameraLightTransformMatrix=h=>(D.copy(h,e.cameraLightTransform),h),t.computeCameraLightTransform=()=>{D.copy(i,t.getViewMatrix()),D.invert(i,i),D.fromScaling(s,[e.distance,e.distance,e.distance]),D.multiply(i,i,s),D.identity(e.cameraLightTransform),D.translate(e.cameraLightTransform,i,[0,0,-1])},t.deepCopy=h=>{},t.physicalOrientationToWorldDirection=h=>{let v=ze.fromValues(h[0],h[1],h[2],h[3]),x=ze.create(),T=ze.fromValues(0,0,1,0);return ze.conjugate(x,v),ze.multiply(T,v,T),ze.multiply(T,T,x),[T[0],T[1],T[2]]},t.getPhysicalToWorldMatrix=h=>{t.getWorldToPhysicalMatrix(h),D.invert(h,h)},t.getWorldToPhysicalMatrix=h=>{D.identity(h);let v=[3];$e(e.physicalViewNorth,e.physicalViewUp,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],D.transpose(h,h),P.set(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),D.scale(h,h,o),D.translate(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=h=>{D.invert(i,h),P.transformMat4(o,r,i),t.computeDistance();let v=e.distance;t.setPosition(o[0],o[1],o[2]),P.transformMat4(c,n,i),P.subtract(c,c,o),P.normalize(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),P.transformMat4(f,a,i),P.subtract(f,f,o),P.normalize(f,f),t.setViewUp(f[0],f[1],f[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=h=>{t.getWorldToPhysicalMatrix(i),D.multiply(i,h,i),t.computeViewParametersFromViewMatrix(i)},t.setModelTransformMatrix=h=>{e.modelTransformMatrix=h},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=h=>{e.viewMatrix=h,e.viewMatrix&&(D.copy(i,e.viewMatrix),t.computeViewParametersFromViewMatrix(i),D.transpose(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(D.multiply(i,e.viewMatrix,e.modelTransformMatrix),i):e.viewMatrix;D.lookAt(i,e.position,e.focalPoint,e.viewUp),D.transpose(i,i);let h=new Float64Array(16);return e.modelTransformMatrix?D.multiply(h,i,e.modelTransformMatrix):D.copy(h,i),h},t.setProjectionMatrix=h=>{e.projectionMatrix=h},t.getProjectionMatrix=(h,v,x)=>{let T=new Float64Array(16);if(D.identity(T),e.projectionMatrix){let S=1/e.physicalScale;return P.set(o,S,S,S),D.copy(T,e.projectionMatrix),D.scale(T,T,o),D.transpose(T,T),T}D.identity(i);let m=e.clippingRange[1]-e.clippingRange[0],y=[e.clippingRange[0]+(v+1)*m/2,e.clippingRange[0]+(x+1)*m/2];if(e.parallelProjection){let S=e.parallelScale*h,C=e.parallelScale,E=(e.windowCenter[0]-1)*S,O=(e.windowCenter[0]+1)*S,U=(e.windowCenter[1]-1)*C,k=(e.windowCenter[1]+1)*C;D.ortho(i,E,O,U,k,y[0],y[1]),D.transpose(i,i)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{let S=Math.tan(Fe(e.viewAngle)/2),C,E;e.useHorizontalViewAngle===!0?(C=e.clippingRange[0]*S,E=e.clippingRange[0]*S/h):(C=e.clippingRange[0]*S*h,E=e.clippingRange[0]*S);let O=(e.windowCenter[0]-1)*C,U=(e.windowCenter[0]+1)*C,k=(e.windowCenter[1]-1)*E,V=(e.windowCenter[1]+1)*E,b=y[0],R=y[1];i[0]=2*b/(U-O),i[5]=2*b/(V-k),i[2]=(O+U)/(U-O),i[6]=(k+V)/(V-k),i[10]=-(b+R)/(R-b),i[14]=-1,i[11]=-2*b*R/(R-b),i[15]=0}}return D.copy(T,i),T},t.getCompositeProjectionMatrix=(h,v,x)=>{let T=t.getViewMatrix(),m=t.getProjectionMatrix(h,v,x);return D.multiply(m,T,m),m},t.setDirectionOfProjection=(h,v,x)=>{if(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===x)return;e.directionOfProjection[0]=h,e.directionOfProjection[1]=v,e.directionOfProjection[2]=x;let T=e.directionOfProjection;e.focalPoint[0]=e.position[0]+T[0]*e.distance,e.focalPoint[1]=e.position[1]+T[1]*e.distance,e.focalPoint[2]=e.position[2]+T[2]*e.distance,d()},t.setDeviceAngles=(h,v,x,T)=>{let m=[3];$e(e.physicalViewNorth,e.physicalViewUp,m);let y=D.identity(new Float64Array(16));D.rotate(y,y,Fe(h),e.physicalViewUp),D.rotate(y,y,Fe(v),m),D.rotate(y,y,Fe(x),e.physicalViewNorth),D.rotate(y,y,Fe(-T),e.physicalViewUp);let S=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),C=new Float64Array(e.physicalViewNorth);P.transformMat4(S,S,y),P.transformMat4(C,C,y),t.setDirectionOfProjection(S[0],S[1],S[2]),t.setViewUp(C[0],C[1],C[2]),t.modified()},t.setOrientationWXYZ=(h,v,x,T)=>{let m=D.identity(new Float64Array(16));if(h!==0&&(v!==0||x!==0||T!==0)){let C=Fe(h),E=ze.create();ze.setAxisAngle(E,[v,x,T],C),D.fromQuat(m,E)}let y=new Float64Array(3);P.transformMat4(y,[0,0,-1],m);let S=new Float64Array(3);P.transformMat4(S,[0,1,0],m),t.setDirectionOfProjection(...y),t.setViewUp(...S),t.modified()},t.computeClippingRange=h=>{let v=null,x=null;v=e.viewPlaneNormal,x=e.position;let T=-v[0],m=-v[1],y=-v[2],S=-(T*x[0]+m*x[1]+y*x[2]),C=[T*h[0]+m*h[2]+y*h[4]+S,1e-18];for(let E=0;E<2;E++)for(let O=0;O<2;O++)for(let U=0;U<2;U++){let k=T*h[U]+m*h[2+O]+y*h[4+E]+S;C[0]=k<C[0]?k:C[0],C[1]=k>C[1]?k:C[1]}return C}}var Fk={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:D.create(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function Yv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fk,r),w.obj(t,e),w.get(t,e,["distance"]),w.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),w.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),w.setGetArray(t,e,["clippingRange","windowCenter"],2),w.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),Vk(t,e)}var kk=w.newInstance(Yv,"vtkCamera"),qv={newInstance:kk,extend:Yv};var bk=["HeadLight","CameraLight","SceneLight"];function Uk(t,e){e.classHierarchy.push("vtkLight");let r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?P.transformMat4(r,e.position,e.transformMatrix):P.set(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?P.transformMat4(r,e.focalPoint,e.transformMatrix):P.set(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(P.sub(e.direction,e.focalPoint,e.position),tt(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{let a=new Float64Array(3);P.sub(a,e.position,n),e.focalPoint=a},t.setDirectionAngle=(n,a)=>{let i=Fe(n),s=Fe(a);t.setPosition(Math.cos(i)*Math.sin(s),Math.sin(i),Math.cos(i)*Math.cos(s)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}var Nk={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function Zv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nk,r),w.obj(t,e),w.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),w.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),Uk(t,e)}var Bk=w.newInstance(Zv,"vtkLight"),Qv={newInstance:Bk,extend:Zv,LIGHT_TYPES:bk};var{vtkErrorMacro:to}=w;function Gk(t){return()=>to(`vtkViewport::${t} - NOT IMPLEMENTED`)}function _k(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{let a=e.props.filter(i=>i!==n);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(n);let i=n.getNestedProps();if(i&&i.length)for(let s=0;s<i.length;s++)r(i[s],a);return a}t.getViewPropsWithNestedProps=()=>{let n=[],a=t.getActors2D();a.sort((s,o)=>s.getLayerNumber()-o.getLayerNumber());let i=e.props.filter(s=>!a.includes(s));for(let s=0;s<i.length;s++)r(i[s],n);return n=n.concat(a),n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>to("call displayToView on your view instead"),t.viewToDisplay=()=>to("callviewtodisplay on your view instead"),t.getSize=()=>to("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,a,i)=>{let s=t.normalizedDisplayToNormalizedViewport(n,a,i);return t.normalizedViewportToProjection(s[0],s[1],s[2])},t.normalizedDisplayToNormalizedViewport=(n,a,i)=>{let s=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/s[0],(a-e.viewport[1])/s[1],i]},t.normalizedViewportToProjection=(n,a,i)=>[n*2-1,a*2-1,i*2-1],t.projectionToNormalizedDisplay=(n,a,i)=>{let s=t.projectionToNormalizedViewport(n,a,i);return t.normalizedViewportToNormalizedDisplay(s[0],s[1],s[2])},t.normalizedViewportToNormalizedDisplay=(n,a,i)=>{let s=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*s[0]+e.viewport[0],a*s[1]+e.viewport[1],i]},t.projectionToNormalizedViewport=(n,a,i)=>[(n+1)*.5,(a+1)*.5,(i+1)*.5],t.PickPropFrom=Gk("PickPropFrom")}var Wk={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function Jv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wk,r),w.obj(t,e),w.event(t,e,"event"),w.setGetArray(t,e,["viewport"],4),w.setGetArray(t,e,["background","background2"],3),_k(t,e)}var zk=w.newInstance(Jv,"vtkViewport"),e1={newInstance:zk,extend:Jv};var{vtkDebugMacro:ni,vtkErrorMacro:Zr,vtkWarningMacro:Ak}=De;function t1(t){return()=>Zr(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function Pk(t,e){e.classHierarchy.push("vtkRenderer");let r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(ni("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{let i=t.getActiveCameraAndResetIfCreated();e.lights.forEach(s=>{s.lightTypeIsSceneLight()||(s.lightTypeIsHeadLight()?(s.setPositionFrom(i.getPositionByReference()),s.setFocalPointFrom(i.getFocalPointByReference()),s.modified(i.getMTime())):s.lightTypeIsCameraLight()?s.setTransformMatrix(i.getCameraLightTransformMatrix(D.create())):Zr("light has unknown light type",s.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=t1("allocateTime"),t.updateGeometry=t1("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=i=>{ni(t.getClassName(),t,"setting Layer to ",i),e.layer!==i&&(e.layer=i,t.modified()),t.setPreserveColorBuffer(!!i)},t.setActiveCamera=i=>e.activeCamera===i?!1:(e.activeCamera=i,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:i}),!0),t.makeCamera=()=>{let i=qv.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:i}),i},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(i=>{e.actors=e.actors.concat(i.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=i=>{e.actors=e.actors.filter(s=>s!==i),t.removeViewProp(i),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(s=>{t.removeViewProp(s)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(i=>{e.volumes=e.volumes.concat(i.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=i=>{e.volumes=e.volumes.filter(s=>s!==i),t.removeViewProp(i),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(s=>{t.removeViewProp(s)}),e.volumes=[],t.modified()},t.hasLight=i=>e.lights.includes(i),t.addLight=i=>{i&&!t.hasLight(i)&&(e.lights.push(i),t.modified())},t.removeLight=i=>{e.lights=e.lights.filter(s=>s!==i),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=i=>{e.lights=i,t.modified()},t.makeLight=Qv.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(i,s,o,c)=>{let f=t.normalizedDisplayToProjection(i,s,o);return f=t.projectionToView(f[0],f[1],f[2],c),t.viewToWorld(f[0],f[1],f[2])},t.worldToNormalizedDisplay=(i,s,o,c)=>{let f=t.worldToView(i,s,o);return f=t.viewToProjection(f[0],f[1],f[2],c),t.projectionToNormalizedDisplay(f[0],f[1],f[2])},t.viewToWorld=(i,s,o)=>{if(e.activeCamera===null)return Zr("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];let c=e.activeCamera.getViewMatrix();D.invert(c,c),D.transpose(c,c);let f=new Float64Array([i,s,o]);return P.transformMat4(f,f,c),f},t.projectionToView=(i,s,o,c)=>{if(e.activeCamera===null)return Zr("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];let f=e.activeCamera.getProjectionMatrix(c,-1,1);D.invert(f,f),D.transpose(f,f);let l=new Float64Array([i,s,o]);return P.transformMat4(l,l,f),l},t.worldToView=(i,s,o)=>{if(e.activeCamera===null)return Zr("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];let c=e.activeCamera.getViewMatrix();D.transpose(c,c);let f=new Float64Array([i,s,o]);return P.transformMat4(f,f,c),f},t.viewToProjection=(i,s,o,c)=>{if(e.activeCamera===null)return Zr("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];let f=e.activeCamera.getProjectionMatrix(c,-1,1);D.transpose(f,f);let l=new Float64Array([i,s,o]);return P.transformMat4(l,l,f),l},t.computeVisiblePropBounds=()=>{e.allBounds[0]=se.INIT_BOUNDS[0],e.allBounds[1]=se.INIT_BOUNDS[1],e.allBounds[2]=se.INIT_BOUNDS[2],e.allBounds[3]=se.INIT_BOUNDS[3],e.allBounds[4]=se.INIT_BOUNDS[4],e.allBounds[5]=se.INIT_BOUNDS[5];let i=!0;t.invokeEvent(r);for(let s=0;s<e.props.length;++s){let o=e.props[s];if(o.getVisibility()&&o.getUseBounds()){let c=o.getBounds();c&&_a(c)&&(i=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return i&&(Ga(e.allBounds),ni("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){let s=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!_a(s))return ni("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Zr("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(s[0]+s[1])/2,o[1]=(s[2]+s[3])/2,o[2]=(s[4]+s[5])/2;let f=s[1]-s[0],l=s[3]-s[2],u=s[5]-s[4];f*=f,l*=l,u*=u;let g=f+l+u;g=g===0?1:g,g=Math.sqrt(g)*.5;let p=Fe(e.activeCamera.getViewAngle()),d=g,h=g/Math.sin(p*.5),v=e.activeCamera.getViewUp();return Math.abs(te(v,c))>.999&&(Ak("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+h*c[0],o[1]+h*c[1],o[2]+h*c[2]),t.resetCameraClippingRange(s),e.activeCamera.setParallelScale(d),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){let s=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!_a(s))return ni("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Zr("Trying to reset clipping range of non-existent camera"),!1;let o=e.activeCamera.computeClippingRange(s),c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{let f=Fe(e.activeCamera.getViewAngle());c=.2*Math.tan(f/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(n),!1},t.setRenderWindow=i=>{i!==e._renderWindow&&(e._vtkWindow=i,e._renderWindow=i)},t.visibleActorCount=()=>e.props.filter(i=>i.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let i=e.mtime,s=e.activeCamera?e.activeCamera.getMTime():0;s>i&&(i=s);let o=e._createdLight?e._createdLight.getMTime():0;return o>i&&(i=o),i},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}var Hk={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:hn(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function r1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,Hk,r),e1.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Me(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),ge(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),dr(t,e,["actors","volumes","lights"]),Hi(t,e,["background"],4,1),kr(t,e,["renderWindow"]),Pk(t,e)}var Ik=$(r1,"vtkRenderer"),n1={newInstance:Ik,extend:r1};var jk="WebGL",ro=Object.create(null);function ai(t,e){ro[t]=e}function Kk(){return Object.keys(ro)}function a1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ro[t]&&ro[t](e)}function $k(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a1(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{let r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{let a=n.getViewProps(),i=e._views[0].getViewNodeFor(n);a.forEach(s=>{if(s.getVisibility()){r.propCount+=1;let o=s.getMapper&&s.getMapper();if(o&&o.getPrimitiveCount){let c=i.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);let f=o.getPrimitiveCount();Object.keys(f).forEach(l=>{r[l]||(r[l]=0),r[l]+=f[l]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return w.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(r,n):void 0).filter(a=>!!a)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{let n=e.childRenderWindows.findIndex(a=>a===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}var Xk={defaultViewAPI:jk,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function i1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xk,r),w.obj(t,e),w.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),w.get(t,e,["neverRendered"]),w.getArray(t,e,["renderers","childRenderWindows"]),w.moveToProtected(t,e,["views"]),w.event(t,e,"completion"),$k(t,e)}var Yk=w.newInstance(i1,"vtkRenderWindow"),s1={newInstance:Yk,extend:i1,registerViewConstructor:ai,listViewAPIs:Kk,newAPISpecificView:a1};var no={Unknown:0,LeftController:1,RightController:2},ha={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},qk={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Zk={LeftButton:1,MiddleButton:2,RightButton:3},tu={Device:no,Input:ha,Axis:qk,MouseButton:Zk};var{Device:ao,Input:Bn}=tu,{vtkWarningMacro:io,vtkErrorMacro:so,normalizeWheel:Qk,vtkOnceErrorMacro:Jk}=w,da={ctrlKey:!1,altKey:!1,shiftKey:!1},ru={"xr-standard":[Bn.Trigger,Bn.Grip,Bn.TrackPad,Bn.Thumbstick,Bn.A,Bn.B]},nu=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function ii(t){t.cancelable&&t.preventDefault()}function oo(t){let e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:a}=r;e[n]=a}),e}function eb(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");let r={...t},n=new Set,a=new Map,i=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=h=>{so("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=h=>{e.interactorStyle!==h&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=h,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>io("empty event loop");function s(h,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(h,v))}t.getCurrentRenderer=()=>(e.currentRenderer||s(0,0),e.currentRenderer);function o(h){let v=e._view.getCanvas(),x=v.getBoundingClientRect(),T=v.width/x.width,m=v.height/x.height,y={x:T*(h.clientX-x.left),y:m*(x.height-h.clientY+x.top),z:0,movementX:T*h.movementX,movementY:m*h.movementY};return(a.size<=1||!e.currentRenderer)&&s(y.x,y.y),y}let c=e._getScreenEventPositionFor||o;function f(h){return{controlKey:h.ctrlKey,altKey:h.altKey,shiftKey:h.shiftKey}}function l(h){let v=f(h);return{key:h.key,keyCode:h.charCode,...v}}function u(h){return h.pointerType||""}let g=()=>{if(e.container===null)return;let{container:h}=e;h.addEventListener("contextmenu",ii),h.addEventListener("wheel",t.handleWheel),h.addEventListener("DOMMouseScroll",t.handleWheel),h.addEventListener("pointerenter",t.handlePointerEnter),h.addEventListener("pointerleave",t.handlePointerLeave),h.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.addEventListener("pointerup",t.handlePointerUp),h.addEventListener("pointercancel",t.handlePointerCancel),h.addEventListener("keypress",t.handleKeyPress),h.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),h.tabIndex=0,h.style.touchAction="none",h.style.userSelect="none",h.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=h=>{if(h===null)return;r.setContainer(h)&&g()};let p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,i=1;let{container:h}=e;h&&(h.removeEventListener("contextmenu",ii),h.removeEventListener("wheel",t.handleWheel),h.removeEventListener("DOMMouseScroll",t.handleWheel),h.removeEventListener("pointerenter",t.handlePointerEnter),h.removeEventListener("pointerleave",t.handlePointerLeave),h.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.removeEventListener("pointerup",t.handlePointerUp),h.removeEventListener("pointercancel",t.handlePointerCancel),h.removeEventListener("keypress",t.handleKeyPress),h.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{p(),r.setContainer(null)},t.handleKeyPress=h=>{let v=l(h);t.keyPressEvent(v)},t.handleKeyDown=h=>{let v=l(h);t.keyDownEvent(v)},t.handleKeyUp=h=>{let v=l(h);t.keyUpEvent(v)},t.handlePointerEnter=h=>{let v={...f(h),position:c(h),deviceType:u(h)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=h=>{let v={...f(h),position:c(h),deviceType:u(h)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=h=>{if(!(h.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&ii(h),h.target.hasPointerCapture(h.pointerId)&&h.target.releasePointerCapture(h.pointerId),e.container.setPointerCapture(h.pointerId),a.has(h.pointerId)&&io("[RenderWindowInteractor] duplicate pointerId detected"),a.set(h.pointerId,{pointerId:h.pointerId,position:c(h)}),h.pointerType){case"pen":case"touch":t.handleTouchStart(h);break;case"mouse":default:t.handleMouseDown(h);break}},t.handlePointerUp=h=>{if(a.has(h.pointerId))switch(e.preventDefaultOnPointerUp&&ii(h),a.delete(h.pointerId),e.container.releasePointerCapture(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerCancel=h=>{if(a.has(h.pointerId))switch(a.delete(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerMove=h=>{if(a.has(h.pointerId)){let v=a.get(h.pointerId);v.position=c(h)}switch(h.pointerType){case"pen":case"touch":t.handleTouchMove(h);break;case"mouse":default:t.handleMouseMove(h);break}},t.handleMouseDown=h=>{let v={...f(h),position:c(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:so(`Unknown mouse button pressed: ${h.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function d(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=h=>{if(h===void 0){so("undefined requester, can not start animating");return}if(n.has(h)){io("requester is already registered for animating");return}n.add(h),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=h=>{let v=Date.now()+h;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(h)){if(!v){let x=h&&h.getClassName?h.getClassName():h;io(`${x} did not request an animation`)}return}n.delete(h),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(h,v,x)=>{h.inputSources.forEach(T=>{let m=T.gripSpace==null?null:v.getPose(T.gripSpace,x),y=T.gripSpace==null?null:v.getPose(T.targetRaySpace,x),S=T.gamepad,C=T.handedness;if(S){S.index in e.lastGamepadValues||(e.lastGamepadValues[S.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let E=0;E<S.buttons.length;++E)E in e.lastGamepadValues[S.index][C].buttons||(e.lastGamepadValues[S.index][C].buttons[E]=!1),e.lastGamepadValues[S.index][C].buttons[E]!==S.buttons[E].pressed&&m!=null&&(t.button3DEvent({gamepad:S,position:m.transform.position,orientation:m.transform.orientation,targetPosition:y.transform.position,targetOrientation:y.transform.orientation,pressed:S.buttons[E].pressed,device:T.handedness==="left"?ao.LeftController:ao.RightController,input:ru[S.mapping]&&ru[S.mapping][E]?ru[S.mapping][E]:Bn.Trigger}),e.lastGamepadValues[S.index][C].buttons[E]=S.buttons[E].pressed),e.lastGamepadValues[S.index][C].buttons[E]&&m!=null&&t.move3DEvent({gamepad:S,position:m.transform.position,orientation:m.transform.orientation,targetPosition:y.transform.position,targetOrientation:y.transform.orientation,device:T.handedness==="left"?ao.LeftController:ao.RightController})}})},t.handleMouseMove=h=>{let v={...f(h),position:c(h),deviceType:u(h)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{let h=Date.now();e._animationFrameCount++,h-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(h-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=h,e._animationFrameCount=1),t.animationEvent(),d(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=h=>{ii(h);let v={...Qk(h),...f(h),position:c(h),deviceType:u(h)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?i=Math.abs(v.spinY):i=1),v.spinY/=i,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=h=>{let v={...f(h),position:c(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:so(`Unknown mouse button released: ${h.button}`);break}},t.handleTouchStart=h=>{let v=[...a.values()];if(e.recognizeGestures&&v.length>1){let x=oo(a);if(v.length===2){let T={...f(da),position:v[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(T)}t.recognizeGesture("TouchStart",x)}else if(v.length===1){let x={...f(da),position:c(h),deviceType:u(h)};t.leftButtonPressEvent(x)}},t.handleTouchMove=h=>{let v=[...a.values()];if(e.recognizeGestures&&v.length>1){let x=oo(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){let x={...f(da),position:v[0].position,deviceType:u(h)};t.mouseMoveEvent(x)}},t.handleTouchEnd=h=>{let v=[...a.values()];if(e.recognizeGestures)if(v.length===0){let x={...f(da),position:c(h),deviceType:u(h)};t.leftButtonReleaseEvent(x)}else if(v.length===1){let x=oo(a);t.recognizeGesture("TouchEnd",x);let T={...f(da),position:v[0].position,deviceType:u(h)};t.leftButtonPressEvent(T)}else{let x=oo(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){let x={...f(da),position:v[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(x)}},t.setView=h=>{e._view!==h&&(e._view=h,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;let x=e._view?.getRenderable()?.getRenderers();if(!x||x.length===0)return null;x.sort((C,E)=>C.getLayer()-E.getLayer());let T=null,m=null,y=null,S=x.length;for(;S--;){let C=x[S];if(e._view.isInViewport(h,v,C)&&C.getInteractive()){y=C;break}T===null&&C.getInteractive()&&(T=C),m===null&&e._view.isInViewport(h,v,C)&&(m=C)}return y===null&&(y=T),y===null&&(y=m),y==null&&(y=x[0]),y},t.render=()=>{!t.isAnimating()&&!e.inRender&&d()},nu.forEach(h=>{let v=h.charAt(0).toLowerCase()+h.slice(1);t[`${v}Event`]=x=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){Jk(`
          Can not forward events without a current renderer on the interactor.
        `);return}let m={type:h,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...x};t[`invoke${h}`](m)}}),t.recognizeGesture=(h,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),h==="TouchStart"){Object.keys(v).forEach(k=>{e.startingEventPositions[k]=v[k]}),e.currentGesture="Start";return}if(h==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let x=0,T=[],m=[];Object.keys(v).forEach(k=>{T[x]=v[k],m[x]=e.startingEventPositions[k],x++});let y=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y)),S=Math.sqrt((T[0].x-T[1].x)*(T[0].x-T[1].x)+(T[0].y-T[1].y)*(T[0].y-T[1].y)),C=mr(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),E=mr(Math.atan2(T[1].y-T[0].y,T[1].x-T[0].x)),O=E-C;E=E+180>=360?E-180:E+180,C=C+180>=360?C-180:C+180,Math.abs(E-C)<Math.abs(O)&&(O=E-C);let U=[];if(U[0]=(T[0].x-m[0].x+T[1].x-m[1].x)/2,U[1]=(T[0].y-m[0].y+T[1].y-m[1].y)/2,h==="TouchMove")if(e.currentGesture==="Start"){let k=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);k<15&&(k=15);let V=Math.abs(S-y),b=S*3.1415926*Math.abs(O)/360,R=Math.sqrt(U[0]*U[0]+U[1]*U[1]);if(V>k&&V>b&&V>R){e.currentGesture="Pinch";let M={scale:1,touches:v};t.startPinchEvent(M)}else if(b>k&&b>R){e.currentGesture="Rotate";let M={rotation:0,touches:v};t.startRotateEvent(M)}else if(R>k){e.currentGesture="Pan";let M={translation:[0,0],touches:v};t.startPanEvent(M)}}else{if(e.currentGesture==="Rotate"){let k={rotation:O,touches:v};t.rotateEvent(k)}if(e.currentGesture==="Pinch"){let k={scale:S/y,touches:v};t.pinchEvent(k)}if(e.currentGesture==="Pan"){let k={translation:U,touches:v};t.panEvent(k)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=h=>{e._forcedRenderer=!!h,e.currentRenderer=h},t.setContainer=h=>{p();let v=r.setContainer(h??null);return v&&g(),v},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}var tb={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function o1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tb,r),w.obj(t,e),e._animationExtendedEnd=0,w.event(t,e,"RenderEvent"),nu.forEach(n=>w.event(t,e,n)),w.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),w.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),w.moveToProtected(t,e,["view"]),eb(t,e)}var rb=w.newInstance(o1,"vtkRenderWindowInteractor"),co={newInstance:rb,extend:o1,handledEvents:nu,...tu};var{vtkErrorMacro:nb,VOID:ab}=w;function ib(t,e,r,n){return t.getRenderWindow().getViews()[0].worldToDisplay(e,r,n,t)}function sb(t,e,r,n){return t.getRenderWindow().getViews()[0].displayToWorld(e,r,n,t)}var ob={computeWorldToDisplay:ib,computeDisplayToWorld:sb};function cb(t,e){e.classHierarchy.push("vtkInteractorObserver");let r={...t};function n(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){co.handledEvents.forEach(i=>{t[`handle${i}`]&&e.subscribedEvents.push(e._interactor[`on${i}`](s=>e.processEvents?t[`handle${i}`](s):ab,e.priority))})}t.setInteractor=i=>{i!==e._interactor&&(n(),e._interactor=i,i&&e.enabled&&a(),t.modified())},t.setEnabled=i=>{i!==e.enabled&&(n(),i&&(e._interactor?a():nb(`
          The interactor must be set before subscribing to events
        `)),e.enabled=i,t.modified())},t.computeDisplayToWorld=(i,s,o,c)=>i?e._interactor.getView().displayToWorld(s,o,c,i):null,t.computeWorldToDisplay=(i,s,o,c)=>i?e._interactor.getView().worldToDisplay(s,o,c,i):null,t.setPriority=i=>{r.setPriority(i)&&e._interactor&&(n(),a())}}var fb={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function c1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fb,r),w.obj(t,e),w.event(t,e,"InteractionEvent"),w.event(t,e,"StartInteractionEvent"),w.event(t,e,"EndInteractionEvent"),w.get(t,e,["_interactor","enabled"]),w.setGet(t,e,["priority","processEvents"]),w.moveToProtected(t,e,["interactor"]),cb(t,e)}var ub=w.newInstance(c1,"vtkInteractorObserver"),f1={newInstance:ub,extend:c1,...ob};var lb={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025},si={States:lb};var{States:sr}=si,au={Rotate:sr.IS_ROTATE,Pan:sr.IS_PAN,Spin:sr.IS_SPIN,Dolly:sr.IS_DOLLY,CameraPose:sr.IS_CAMERA_POSE,WindowLevel:sr.IS_WINDOW_LEVEL,Slice:sr.IS_SLICE};function gb(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(au).forEach(r=>{w.event(t,e,`Start${r}Event`),t[`start${r}`]=()=>{e.state===sr.IS_NONE&&(e.state=au[r],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${r}Event`]({type:`Start${r}Event`}))},w.event(t,e,`End${r}Event`),t[`end${r}`]=()=>{e.state===au[r]&&(e.state=sr.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${r}Event`]({type:`End${r}Event`}),e._interactor.render())}}),e.getRenderer=r=>e.focusedRenderer||r.pokedRenderer,t.handleKeyPress=r=>{let n=e._interactor,a=null;switch(r.key){case"r":case"R":e.getRenderer(r).resetCamera(),n.render();break;case"w":case"W":a=e.getRenderer(r).getActors(),a.forEach(i=>{let s=i.getProperty();s.setRepresentationToWireframe&&s.setRepresentationToWireframe()}),n.render();break;case"s":case"S":a=e.getRenderer(r).getActors(),a.forEach(i=>{let s=i.getProperty();s.setRepresentationToSurface&&s.setRepresentationToSurface()}),n.render();break;case"v":case"V":a=e.getRenderer(r).getActors(),a.forEach(i=>{let s=i.getProperty();s.setRepresentationToPoints&&s.setRepresentationToPoints()}),n.render();break}}}var pb={state:sr.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function u1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pb,r),f1.extend(t,e,r),w.setGet(t,e,["focusedRenderer"]),gb(t,e)}var hb=w.newInstance(u1,"vtkInteractorStyle"),l1={newInstance:hb,extend:u1,...si};var{States:or}=si;function db(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=r=>{let n=r.position,a=e.getRenderer(r);switch(e.state){case or.IS_ROTATE:t.handleMouseRotate(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case or.IS_PAN:t.handleMousePan(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case or.IS_DOLLY:t.handleMouseDolly(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case or.IS_SPIN:t.handleMouseSpin(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=n},t.handleButton3D=r=>{if(r&&r.pressed&&r.device===no.RightController&&(r.input===ha.Trigger||r.input===ha.TrackPad)){t.startCameraPose();return}r&&!r.pressed&&r.device===no.RightController&&(r.input===ha.Trigger||r.input===ha.TrackPad)&&e.state===or.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=r=>{switch(e.state){case or.IS_CAMERA_POSE:t.updateCameraPose(r);break}},t.updateCameraPose=r=>{let n=e.getRenderer(r).getActiveCamera(),a=n.getPhysicalTranslation(),s=.5*.05*n.getPhysicalScale(),o=n.physicalOrientationToWorldDirection([r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w]);n.setPhysicalTranslation(a[0]+o[0]*s,a[1]+o[1]*s,a[2]+o[2]*s)},t.handleLeftButtonPress=r=>{let n=r.position;e.previousPosition=n,r.shiftKey?r.controlKey||r.altKey?t.startDolly():t.startPan():r.controlKey||r.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case or.IS_DOLLY:t.endDolly();break;case or.IS_PAN:t.endPan();break;case or.IS_SPIN:t.endSpin();break;case or.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=r=>{e.previousScale=r.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=r=>{e.previousRotation=r.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=r=>{e.previousTranslation=r.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=r=>{t.dollyByFactor(e.getRenderer(r),r.scale/e.previousScale),e.previousScale=r.scale},t.handlePan=r=>{let n=e.getRenderer(r).getActiveCamera(),a=n.getFocalPoint();a=t.computeWorldToDisplay(e.getRenderer(r),a[0],a[1],a[2]);let i=a[2],s=r.translation,o=e.previousTranslation,c=t.computeDisplayToWorld(e.getRenderer(r),a[0]+s[0]-o[0],a[1]+s[1]-o[1],i),f=t.computeDisplayToWorld(e.getRenderer(r),a[0],a[1],i),l=[];l[0]=f[0]-c[0],l[1]=f[1]-c[1],l[2]=f[2]-c[2],a=n.getFocalPoint();let u=n.getPosition();n.setFocalPoint(l[0]+a[0],l[1]+a[1],l[2]+a[2]),n.setPosition(l[0]+u[0],l[1]+u[1],l[2]+u[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(r).updateLightsGeometryToFollowCamera(),n.orthogonalizeViewUp(),e.previousTranslation=r.translation},t.handleRotate=r=>{let n=e.getRenderer(r).getActiveCamera();n.roll(r.rotation-e.previousRotation),n.orthogonalizeViewUp(),e.previousRotation=r.rotation},t.handleMouseRotate=(r,n)=>{if(!e.previousPosition)return;let a=e._interactor,i=n.x-e.previousPosition.x,s=n.y-e.previousPosition.y,o=a.getView().getViewportSize(r),c=-.1,f=-.1;o[0]&&o[1]&&(c=-20/o[1],f=-20/o[0]);let l=i*f*e.motionFactor,u=s*c*e.motionFactor,g=r.getActiveCamera();!Number.isNaN(l)&&!Number.isNaN(u)&&(g.azimuth(l),g.elevation(u),g.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange(),a.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(r,n)=>{if(!e.previousPosition)return;let a=e._interactor,i=r.getActiveCamera(),s=a.getView().getViewportCenter(r),o=mr(Math.atan2(e.previousPosition.y-s[1],e.previousPosition.x-s[0])),c=mr(Math.atan2(n.y-s[1],n.x-s[0]))-o;Number.isNaN(c)||(i.roll(c),i.orthogonalizeViewUp())},t.handleMousePan=(r,n)=>{if(!e.previousPosition)return;let a=r.getActiveCamera(),i=a.getFocalPoint();i=t.computeWorldToDisplay(r,i[0],i[1],i[2]);let s=i[2],o=t.computeDisplayToWorld(r,n.x,n.y,s),c=t.computeDisplayToWorld(r,e.previousPosition.x,e.previousPosition.y,s),f=[];f[0]=c[0]-o[0],f[1]=c[1]-o[1],f[2]=c[2]-o[2],i=a.getFocalPoint();let l=a.getPosition();a.setFocalPoint(f[0]+i[0],f[1]+i[1],f[2]+i[2]),a.setPosition(f[0]+l[0],f[1]+l[1],f[2]+l[2]),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(r,n)=>{if(!e.previousPosition)return;let a=n.y-e.previousPosition.y,s=e._interactor.getView().getViewportCenter(r),o=e.motionFactor*a/s[1];t.dollyByFactor(r,1.1**o)},t.handleMouseWheel=r=>{let n=1-r.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(r),n)},t.dollyByFactor=(r,n)=>{if(Number.isNaN(n))return;let a=r.getActiveCamera();a.getParallelProjection()?a.setParallelScale(a.getParallelScale()/n):(a.dolly(n),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()}}var vb={motionFactor:10,zoomFactor:10};function g1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vb,r),l1.extend(t,e,r),w.setGet(t,e,["motionFactor","zoomFactor"]),db(t,e)}var mb=w.newInstance(g1,"vtkInteractorStyleTrackballCamera"),p1={newInstance:mb,extend:g1};function xb(t){return t}function iu(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>iu(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function yb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search,r={},n=t?iu:xb;return new URLSearchParams(e).forEach((i,s)=>{s&&(r[s]=i?n(i):!0)}),r}var h1={toNativeType:iu,extractURLParameters:yb};function Tb(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${w.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}),e.delegates.forEach(a=>{a.traverse(r,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}))}}var Sb={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function d1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sb,r),w.obj(t,e),w.get(t,e,["currentOperation"]),w.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),w.moveToProtected(t,e,["currentParent"]),Tb(t,e)}var Cb=w.newInstance(d1,"vtkRenderPass"),at={newInstance:Cb,extend:d1};var{Representation:wb}=Gt,{vtkErrorMacro:v1}=w;function Ob(t){let e=z.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}var Eb=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function Mb(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{let r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),i=K.newInstance({numberOfComponents:3,values:r});i.setName("points");let s=K.newInstance({numberOfComponents:2,values:n});s.setName("tcoords");let o=K.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",wb.SURFACE,{points:i,tcoords:s,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{let n=r.getSize(),a=r.getContext();e.framebuffer=Ar.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Ce.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw({width:n[0],height:n[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=Ce.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw({width:n[0],height:n[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=Ce.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw({width:n[0],height:n[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),Eb,"")},t.createVBO=r=>{let n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();let a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||v1("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||v1("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,a)=>{if(e.deleted)return;let i=r.getSize(),s=r.getContext();if(e._supported=!1,n.getSelector()||!s||!r.getWebgl2()||!s.getExtension("EXT_color_buffer_half_float")&&!s.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{let c=e.framebuffer.getSize();c===null||c[0]!==i[0]||c[1]!==i[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}s.drawBuffers([s.COLOR_ATTACHMENT0]),s.clearBufferfv(s.COLOR,0,[0,0,0,0]),s.clearBufferfv(s.DEPTH,0,[1]),s.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),n.traverse(a)),s.colorMask(!0,!0,!0,!0),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1]),s.viewport(0,0,i[0],i[1]),s.scissor(0,0,i[0],i[1]),s.clearBufferfv(s.COLOR,0,[0,0,0,1]),s.clearBufferfv(s.COLOR,1,[0,0,0,0]),s.enable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFuncSeparate(s.ONE,s.ONE,s.ZERO,s.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),s.drawBuffers([s.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=ra.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.depthFunc(s.ALWAYS),s.viewport(0,0,i[0],i[1]),s.scissor(0,0,i[0],i[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.depthMask(!0),s.depthFunc(s.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();let o=n.getTiledSizeAndOrigin();s.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),s.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?Ob:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}var Rb={framebuffer:null,copyShader:null,tris:null};function m1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rb,r),at.extend(t,e,r),e.VBOBuildTime={},w.obj(e.VBOBuildTime,{mtime:0}),e.tris=rt.newInstance(),w.get(t,e,["framebuffer"]),Mb(t,e)}var Db=w.newInstance(m1,"vtkOpenGLOrderIndependentTranslucentPass"),x1={newInstance:Db,extend:m1};function Lb(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);let a=r.getRenderable().getNumberOfLayers(),i=r.getRenderable().getRenderersByReference();for(let s=0;s<a;s++)for(let o=0;o<i.length;o++){let c=i[o],f=r.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===s){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),f.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){let l=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Ar.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();let u=e.framebuffer.getSize();(u===null||u[0]!==l[0]||u[1]!==l[1])&&(e.framebuffer.create(l[0],l[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),f.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),f.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),f.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=x1.newInstance()),e.translucentPass.traverse(r,f,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),f.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),f.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}var Vb={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function y1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vb,r),at.extend(t,e,r),w.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),Lb(t,e)}var Fb=w.newInstance(y1,"vtkForwardPass"),T1={newInstance:Fb,extend:y1};var{FieldAssociations:kb}=yt;function bb(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,a,i,s)=>{},t.selectAsync=async(r,n,a,i,s)=>{let o=await t.getSourceDataAsync(r,n,a,i,s);return o?o.generateSelection(n,a,i,s):[]}}var Ub={fieldAssociation:kb.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function S1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ub,r),w.obj(t,e),w.setGet(t,e,["fieldAssociation","captureZValues"]),bb(t,e)}var Nb=w.newInstance(S1,"vtkHardwareSelector"),fo={newInstance:Nb,extend:S1};var Bb={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},Gb={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5},C1={SelectionContent:Bb,SelectionField:Gb};function _b(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}var Wb={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function w1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wb,r),w.obj(t,e),e.properties={},w.setGet(t,e,["contentType","fieldType","properties","selectionList"]),_b(t,e)}var zb=w.newInstance(w1,"vtkSelectionNode"),va={newInstance:zb,extend:w1,...C1};var{PassTypes:je}=If,{SelectionContent:Ab,SelectionField:O1}=va,{FieldAssociations:oi}=yt,{vtkErrorMacro:E1}=w,Qr=1;function M1(t){return`${t.propID} ${t.compositeID}`}function R1(t,e,r,n){if(!r)return 0;let a=(e*(n[2]-n[0]+1)+t)*4;return r[a+3]}function Dr(t,e,r,n){if(!r)return 0;let a=(e*(n[2]-n[0]+1)+t)*4,i=r[a],s=r[a+1];return(r[a+2]*256+s)*256+i}function D1(t,e){let r=e;return r<<=24,r|=t,r}function ma(t,e,r,n){let a=r<0?0:r;if(a===0){if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;let c=[e[0]-t.area[0],e[1]-t.area[1]],f=Dr(c[0],c[1],t.pixBuffer[je.ACTOR_PASS],t.area);if(f<=0||f-Qr>=t.props.length)return null;let l={};l.valid=!0,l.propID=f-Qr,l.prop=t.props[l.propID];let u=Dr(c[0],c[1],t.pixBuffer[je.COMPOSITE_INDEX_PASS],t.area);if((u<0||u>16777215)&&(u=0),l.compositeID=u-Qr,t.captureZValues){let d=(c[1]*(t.area[2]-t.area[0]+1)+c[0])*4;l.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,l.displayPosition=e}if(t.pixBuffer[je.ID_LOW24]&&R1(c[0],c[1],t.pixBuffer[je.ID_LOW24],t.area)===0)return l;let g=Dr(c[0],c[1],t.pixBuffer[je.ID_LOW24],t.area),p=Dr(c[0],c[1],t.pixBuffer[je.ID_HIGH24],t.area);return l.attributeID=D1(g,p),l}let i=[e[0],e[1]],s=[0,0],o=ma(t,e,0,n);if(o&&o.valid)return o;for(let c=1;c<a;++c){for(let f=i[1]>c?i[1]-c:0;f<=i[1]+c;++f)if(s[1]=f,i[0]>=c&&(s[0]=i[0]-c,o=ma(t,s,0,n),o&&o.valid)||(s[0]=i[0]+c,o=ma(t,s,0,n),o&&o.valid))return o;for(let f=i[0]>=c?i[0]-(c-1):0;f<=i[0]+(c-1);++f)if(s[0]=f,i[1]>=c&&(s[1]=i[1]-c,o=ma(t,s,0,n),o&&o.valid)||(s[1]=i[1]+c,o=ma(t,s,0,n),o&&o.valid))return o}return n[0]=e[0],n[1]=e[1],null}function L1(t,e,r,n,a){let i=[],s=0;return e.forEach((o,c)=>{let f=va.newInstance();switch(f.setContentType(Ab.INDICES),t){case oi.FIELD_ASSOCIATION_CELLS:f.setFieldType(O1.CELL);break;case oi.FIELD_ASSOCIATION_POINTS:f.setFieldType(O1.POINT);break;default:E1("Unknown field association")}f.getProperties().propID=o.info.propID,f.getProperties().prop=o.info.prop,f.getProperties().compositeID=o.info.compositeID,f.getProperties().attributeID=o.info.attributeID,f.getProperties().pixelCount=o.pixelCount,r&&(f.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],f.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,n)),f.setSelectionList(o.attributeIDs),i[s]=f,s++}),i}function Pb(t,e,r,n,a){let i=Math.floor(e),s=Math.floor(r),o=Math.floor(n),c=Math.floor(a),f=new Map,l=[0,0];for(let u=s;u<=c;u++)for(let g=i;g<=o;g++){let d=ma(t,[g,u],0,l);if(d&&d.valid){let h=M1(d);if(!f.has(h))f.set(h,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{let v=f.get(h);v.pixelCount++,t.captureZValues&&d.zValue<v.info.zValue&&(v.info=d),v.attributeIDs.indexOf(d.attributeID)===-1&&v.attributeIDs.push(d.attributeID)}}}return L1(t.fieldAssociation,f,t.captureZValues,t.renderer,t.openGLRenderWindow)}function Hb(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;let n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Ar.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();let a=e.framebuffer.getSize();!a||a[0]!==n[0]||a[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===oi.FIELD_ASSOCIATION_POINTS){let a=e._openGLRenderWindow.getContext(),i=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),i&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{let n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{let n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,a,i,s,o)=>{if(e._renderer=n,a===void 0){let f=e._openGLRenderWindow.getSize();t.setArea(0,0,f[0]-1,f[1]-1)}else t.setArea(a,i,s,o);if(!t.captureBuffers())return!1;let c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var f=arguments.length,l=new Array(f),u=0;u<f;u++)l[u]=arguments[u];return Pb(c,...l)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return E1("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);let n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();let a=[];for(e.currentPass=je.MIN_KNOWN_PASS;e.currentPass<=je.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===je.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(i=>{e.currentPass=i,t.processPixelBuffers()}),e.currentPass=je.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,a)=>{t.isPropHit(a)&&n.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=n=>{if(n===je.ID_HIGH24){if(e.fieldAssociation===oi.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===oi.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){let a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(a),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===je.ACTOR_PASS){if(e.captureZValues){let a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){let i=a[0].getFramebuffer();i.saveCurrentBindingsAndBuffers(),i.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),i.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let a=0;for(let i=0;i<=e.area[3]-e.area[1];i++)for(let s=0;s<=e.area[2]-e.area[0];s++){let o=Dr(s,i,n,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=n=>{e.currentPass===je.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Qr),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===je.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+Qr)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>w.enumToString(je,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,a,i)=>{let s=a<0?0:a;if(s===0){if(i[0]=n[0],i[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;let l=[n[0]-e.area[0],n[1]-e.area[1]],u=Dr(l[0],l[1],e.pixBuffer[je.ACTOR_PASS],e.area);if(u<=0||u-Qr>=e.props.length)return null;let g={};g.valid=!0,g.propID=u-Qr,g.prop=e.props[g.propID];let p=Dr(l[0],l[1],e.pixBuffer[je.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),g.compositeID=p-Qr,e.captureZValues){let v=(l[1]*(e.area[2]-e.area[0]+1)+l[0])*4;g.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,g.displayPosition=n}if(e.pixBuffer[je.ID_LOW24]&&R1(l[0],l[1],e.pixBuffer[je.ID_LOW24],e.area)===0)return g;let d=Dr(l[0],l[1],e.pixBuffer[je.ID_LOW24],e.area),h=Dr(l[0],l[1],e.pixBuffer[je.ID_HIGH24],e.area);return g.attributeID=D1(d,h),g}let o=[n[0],n[1]],c=[0,0],f=t.getPixelInformation(n,0,i);if(f&&f.valid)return f;for(let l=1;l<s;++l){for(let u=o[1]>l?o[1]-l:0;u<=o[1]+l;++u)if(c[1]=u,o[0]>=l&&(c[0]=o[0]-l,f=t.getPixelInformation(c,0,i),f&&f.valid)||(c[0]=o[0]+l,f=t.getPixelInformation(c,0,i),f&&f.valid))return f;for(let u=o[0]>=l?o[0]-(l-1):0;u<=o[0]+(l-1);++u)if(c[0]=u,o[1]>=l&&(c[1]=o[1]-l,f=t.getPixelInformation(c,0,i),f&&f.valid)||(c[1]=o[1]+l,f=t.getPixelInformation(c,0,i),f&&f.valid))return f}return i[0]=n[0],i[1]=n[1],null},t.generateSelection=(n,a,i,s)=>{let o=Math.floor(n),c=Math.floor(a),f=Math.floor(i),l=Math.floor(s),u=new Map,g=[0,0];for(let p=c;p<=l;p++)for(let d=o;d<=f;d++){let h=[d,p],v=t.getPixelInformation(h,0,g);if(v&&v.valid){let x=M1(v);if(!u.has(x))u.set(x,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{let T=u.get(x);T.pixelCount++,e.captureZValues&&v.zValue<T.info.zValue&&(T.info=v),T.attributeIDs.indexOf(v.attributeID)===-1&&T.attributeIDs.push(v.attributeID)}}}return L1(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,a)=>{e._openGLRenderWindow=n,e._renderer=a};let r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}var Ib={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function V1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ib,r),fo.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),w.setGetArray(t,e,["area"],4),w.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),w.setGetArray(t,e,["propColorValue"],3),w.moveToProtected(t,e,["renderer","openGLRenderWindow"]),w.event(t,e,"event"),Hb(t,e)}var jb=w.newInstance(V1,"vtkOpenGLHardwareSelector"),su={newInstance:jb,extend:V1,...If};var U1=Kn(b1(),1);var Kb=["lastShaderProgramBound","context","_openGLRenderWindow"];function $b(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,a)=>{let i=n;a.length>0&&(i=z.substitute(i,"VSOut","GSOut").result);let s=e._openGLRenderWindow.getWebgl2(),o=`
`,c=`#version 100
`;s?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),i=z.substitute(i,"//VTK::System::Dec",[`${c}
`,s?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let f=z.substitute(r,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(s){f=z.substitute(f,"varying","out").result,i=z.substitute(i,"varying","in").result;let u="",g=0;for(;i.includes(`gl_FragData[${g}]`);)i=z.substitute(i,`gl_FragData\\[${g}\\]`,`fragOutput${g}`).result,u+=`layout(location = ${g}) out vec4 fragOutput${g};
`,g++;i=z.substitute(i,"//VTK::Output::Dec",u).result}let l=z.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:f,FSSource:i,GSSource:l}},t.readyShaderProgramArray=(r,n,a)=>{let i=t.replaceShaderValues(r,n,a),s=t.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return t.readyShaderProgram(s)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,a)=>{let i=`${r}${n}${a}`,s=U1.default.hash(i);if(!(s in e.shaderPrograms)){let o=z.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(r),o.getFragmentShader().setSource(n),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(s),e.shaderPrograms[s]=o,o}return e.shaderPrograms[s]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}var Xb={lastShaderProgramBound:null,shaderPrograms:null,context:null};function N1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xb,r),e.shaderPrograms={},w.obj(t,e),w.setGet(t,e,Kb),w.moveToProtected(t,e,["openGLRenderWindow"]),$b(t,e)}var Yb=w.newInstance(N1,"vtkShaderCache"),B1={newInstance:Yb,extend:N1};var{vtkErrorMacro:qb}=w;function Zb(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&qb("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}var Qb={context:null,numberOfTextureUnits:0,textureUnits:0};function G1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qb,r),w.obj(t,e),e.textureUnits=[],w.get(t,e,["numberOfTextureUnits"]),w.setGet(t,e,["context"]),Zb(t,e)}var Jb=w.newInstance(G1,"vtkOpenGLTextureUnitManager"),_1={newInstance:Jb,extend:G1};function eU(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{let n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,a)=>{let i=a.getViewportByReference(),s=t.getFramebufferSize();return i[0]*s[0]<=r&&i[2]*s[0]>=r&&i[1]*s[1]<=n&&i[3]*s[1]>=n},t.getViewportSize=r=>{let n=r.getViewportByReference(),a=t.getFramebufferSize();return[(n[2]-n[0])*a[0],(n[3]-n[1])*a[1]]},t.getViewportCenter=r=>{let n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,a)=>{let i=t.getFramebufferSize();return[r/i[0],n/i[1],a]},t.normalizedDisplayToDisplay=(r,n,a)=>{let i=t.getFramebufferSize();return[r*i[0],n*i[1],a]},t.worldToView=(r,n,a,i)=>i.worldToView(r,n,a),t.viewToWorld=(r,n,a,i)=>i.viewToWorld(r,n,a),t.worldToDisplay=(r,n,a,i)=>{let s=i.worldToView(r,n,a),o=t.getViewportSize(i),c=i.viewToProjection(s[0],s[1],s[2],o[0]/o[1]),f=i.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(f[0],f[1],f[2])},t.displayToWorld=(r,n,a,i)=>{let s=t.displayToNormalizedDisplay(r,n,a),o=i.normalizedDisplayToProjection(s[0],s[1],s[2]),c=t.getViewportSize(i),f=i.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return i.viewToWorld(f[0],f[1],f[2])},t.normalizedDisplayToViewport=(r,n,a,i)=>{let s=i.getViewportByReference();s=t.normalizedDisplayToDisplay(s[0],s[1],0);let o=t.normalizedDisplayToDisplay(r,n,a);return[o[0]-s[0]-.5,o[1]-s[1]-.5,a]},t.viewportToNormalizedViewport=(r,n,a,i)=>{let s=t.getViewportSize(i);return s&&s[0]!==0&&s[1]!==0?[r/(s[0]-1),n/(s[1]-1),a]:[r,n,a]},t.normalizedViewportToViewport=(r,n,a,i)=>{let s=t.getViewportSize(i);return[r*(s[0]-1),n*(s[1]-1),a]},t.displayToLocalDisplay=(r,n,a)=>{let i=t.getFramebufferSize();return[r,i[1]-n-1,a]},t.viewportToNormalizedDisplay=(r,n,a,i)=>{let s=i.getViewportByReference();s=t.normalizedDisplayToDisplay(s[0],s[1],0);let o=r+s[0]+.5,c=n+s[1]+.5;return t.displayToNormalizedDisplay(o,c,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{w.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,a,i)=>{w.vtkErrorMacro("not implemented")},t.createSelector=()=>{w.vtkErrorMacro("not implemented")}}var tU={size:void 0,selector:void 0};function W1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tU,r),e.size||(e.size=[300,300]),w.getArray(t,e,["size"],2),w.get(t,e,["selector"]),Q.extend(t,e,r),eU(t,e)}var rU=w.newInstance(W1,"vtkRenderWindowViewNode"),uo={newInstance:rU,extend:W1};var nU="__getUnderlyingContext";function z1(){let t=new Map,e={apply(a,i,s){return t.has(s[0])?t.get(s[0]):a.apply(i,s)}};function r(a){return{apply(i,s,o){return t.set(a,o[0]),i.apply(s,o)}}}let n=Object.create(null);return n.getParameter=(a,i,s,o)=>new Proxy(o.bind(a),e),n.depthMask=(a,i,s,o)=>new Proxy(o.bind(a),r(a.DEPTH_WRITEMASK)),{get(a,i,s){if(i===nU)return()=>a;let o=Reflect.get(a,i,a);o instanceof Function&&(o=o.bind(a));let c=n[i];return c?c(a,i,s,o):o}}}var{vtkDebugMacro:A1,vtkErrorMacro:P1}=w,aU={position:"absolute",top:0,left:0,width:"100%",height:"100%"},iU=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function mt(t,e,r){let n=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);let i=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),i===t.FRAMEBUFFER_COMPLETE}var lo=0,I1=[];function sU(){lo++,I1.forEach(t=>t(lo))}function oU(){lo--,I1.forEach(t=>t(lo))}function H1(t){t.preventDefault()}function cU(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=z1()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",H1,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);let a=[0,0];function i(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(i),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(g=>{g.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&sU(),e.textureUnitManager=_1.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);let u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&P1("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){let{width:u,height:g}=e.el.getBoundingClientRect();e.containerSize=[u,g]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(u,g,p,d)=>{let h=new Uint8Array((p-u+1)*(d-g+1)*4);return e.context.readPixels(u,g,p-u+1,d-g+1,e.context.RGBA,e.context.UNSIGNED_BYTE,h),h},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},g=null,p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(g=e.canvas.getContext("webgl2",u),g&&(e.webgl2=!0,A1("using webgl2"))),g||(A1("using webgl1"),g=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(g,n())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{let u=at.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{let g=e._textureResourceIds.get(u);if(g!==void 0){e.context.activeTexture(e.context.TEXTURE0+g);return}let p=t.getTextureUnitManager().allocate();if(p<0){P1("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=u=>{let g=e._textureResourceIds.get(u);g!==void 0&&(t.getTextureUnitManager().free(g),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{let g=e._textureResourceIds.get(u);return g!==void 0?g:-1},t.getDefaultTextureByteSize=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case ce.CHAR:case ce.SIGNED_CHAR:case ce.UNSIGNED_CHAR:return 1;case g:case p:case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,g){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case ce.UNSIGNED_CHAR:switch(g){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!d&&ce.UNSIGNED_SHORT):switch(g){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!d&&ce.SHORT):switch(g){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.FLOAT:default:switch(g){case 1:return d?e.context.R16F:e.context.R32F;case 2:return d?e.context.RG16F:e.context.RG32F;case 3:return d?e.context.RGB16F:e.context.RGB32F;case 4:default:return d?e.context.RGBA16F:e.context.RGBA32F}}switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function s(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,g=document.createElement("canvas"),p=g.getContext("2d");g.width=e.canvas.width,g.height=e.canvas.height,p.drawImage(e.canvas,0,0);let d=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(T=>{T.getViewProps().forEach(y=>{if(y.getContainer){let C=y.getContainer().getElementsByTagName("canvas");for(let E=0;E<C.length;E++){let O=C[E],U=O.getBoundingClientRect(),k=U.x-d.x,V=U.y-d.y;p.drawImage(O,k,V)}}})});let x=g.toDataURL(u);g.remove(),t.invokeImageReady(x)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:g=!1,size:p=null,scale:d=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;let h=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||d!==1?p||e.size.map(v=>v*d):null},new Promise((v,x)=>{let T=t.onImageReady(m=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=h,T.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(y=>{let{restoreParamsFn:S,arg:C}=y;return S(C)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(m);else{let y=document.createElement("img");if(y.style=aU,y.src=m,e._screenshot.placeHolder=e.el.appendChild(y),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),g){let S=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(C=>{let E=C.getActiveCamera(),O=E.get("focalPoint","position","parallelScale");return{resetCameraArgs:S?{renderer:C}:void 0,resetCameraFn:S?g:C.resetCamera,restoreParamsFn:E.set,arg:JSON.parse(JSON.stringify(O))}}),e._screenshot.cameras.forEach(C=>{let{resetCameraFn:E,resetCameraArgs:O}=C;return E(O)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;let u=t.get3DContext(),g=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return o=g[1],g[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;let u=t.get3DContext(),g=u.getExtension("OES_texture_float"),p=u.getExtension("OES_texture_half_float"),d=u.getExtension("WEBGL_debug_renderer_info"),h=u.getExtension("WEBGL_draw_buffers"),v=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),x=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&u.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[g&&mt(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",g&&mt(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",g&&mt(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",g&&mt(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",g&&mt(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&mt(u,u.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&mt(u,u.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&mt(u,u.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&mt(u,u.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&mt(u,u.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[g&&mt(u,u.RGBA,u.FLOAT)?"RGBA":"",g&&mt(u,u.RGB,u.FLOAT)?"RGB":"",g&&mt(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",g&&mt(u,u.ALPHA,u.FLOAT)?"ALPHA":"",g&&mt(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",h?u.getParameter(h.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",d&&u.getParameter(d.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",d&&u.getParameter(d.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],T={};for(;x.length;){let[m,y,S]=x.pop();y&&(T[y]={label:m,value:S})}return e._glInformation=T,T},t.traverseAllPasses=()=>{if(e.renderPasses)for(let g=0;g<e.renderPasses.length;++g)e.renderPasses[g].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&s();let u=e.renderable.getChildRenderWindowsByReference();for(let g=0;g<u.length;++g)t.getViewNodeFor(u[g])?.traverseAllPasses()},t.copyParentContent=()=>{let u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(d=>!!d.getSelector?.()))return;let g=u.getCanvas(),p=e.canvas;e.context2D.drawImage(g,0,g.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{let u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){let g=[0,0];for(let p=0;p<u.length;++p){let d=t.getViewNodeFor(u[p])?.getSize();d&&(g[0]=d[0]>g[0]?d[0]:g[0],g[1]=d[1]>g[1]?d[1]:g[1])}t.setSize(...g)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){let g=e.renderable.getRenderers()[0];g.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{let u=su.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",H1),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=w.chain(()=>{e.context&&oU(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};let f=t.setSize;t.setSize=(u,g)=>{let p=f(u,g);return p&&t.invokeWindowResizeEvent({width:u,height:g}),p},t.registerGraphicsResourceUser=(u,g)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null),e._graphicsResources.get(u)?.users.add(g)},t.unregisterGraphicsResourceUser=(u,g)=>{let p=e._graphicsResources.get(u);p&&(p.users.delete(g),p.users.size||(p.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,g,p)=>{if(!u)return;let d=e._graphicsResources.get(u);d?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:g,hash:p,users:d?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(g=>{let{oglObject:p}=g;u+=p.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:g}=u;g.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{t.getViewNodeFor(u)?.releaseGraphicsResources()})};let l={...t};iU.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):l[u](...arguments)}})}var fU={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function uU(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fU,r),uo.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=su.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=Jg.newInstance(),e.shaderCache=B1.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=T1.newInstance(),w.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),w.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),w.setGetArray(t,e,["size"],2),w.event(t,e,"imageReady"),w.event(t,e,"windowResizeEvent"),cU(t,e)}var j1=w.newInstance(uU,"vtkOpenGLRenderWindow");ai("WebGL",j1);Te("vtkRenderWindow",j1);var ou=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function lU(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=r=>{e.drawCallbacks=[],e.handle=r.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let r=0;r<e.drawCallbacks.length;r++){let n=e.drawCallbacks[r],a=n.pipeline;t.setPipeline(a);for(let i=0;i<n.callbacks.length;i++)n.callbacks[i](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=r=>{if(e.boundPipeline===r)return;e.handle.setPipeline(r.getHandle());let n=r.getPipelineDescription();if(e.colorTextureViews.length!==n.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${n.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let a=0;a<e.colorTextureViews.length;a++){let i=e.colorTextureViews[a].getTexture()?.getFormat();i&&i!==n.fragment.targets[a].format&&(console.log(`mismatched attachments for attachment ${a} on pipeline ${n.fragment.targets[a].format} while encoder has ${i}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in n))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){let a=e.depthTextureView.getTexture()?.getFormat();a&&a!==n.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${n.depthStencil.format} while encoder has ${a}`),console.trace())}e.boundPipeline=r},t.replaceShaderCode=r=>{e.replaceShaderCodeFunction(r)},t.setColorTextureView=(r,n)=>{e.colorTextureViews[r]!==n&&(e.colorTextureViews[r]=n)},t.activateBindGroup=r=>{let n=e.boundPipeline.getDevice(),a=e.boundPipeline.getBindGroupLayoutCount(r.getLabel());e.handle.setBindGroup(a,r.getBindGroup(n));let i=n.getBindGroupLayoutDescription(r.getBindGroupLayout(n)),s=n.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(a));i!==s&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${i}
 versus pipeline
${s}
`),console.trace())},t.attachTextureViews=()=>{for(let r=0;r<e.colorTextureViews.length;r++)e.description.colorAttachments[r]?e.description.colorAttachments[r].view=e.colorTextureViews[r].getHandle():e.description.colorAttachments[r]={view:e.colorTextureViews[r].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(r,n)=>{for(let a=0;a<e.drawCallbacks.length;a++)if(e.drawCallbacks[a].pipeline===r){e.drawCallbacks[a].callbacks.push(n);return}e.drawCallbacks.push({pipeline:r,callbacks:[n]})};for(let r=0;r<ou.length;r++)t[ou[r]]=function(){return e.handle[ou[r]](...arguments)}}var gU={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function K1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gU,r),ae(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let i=a.getCode();i=J.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,a.setCode(i)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],Me(t,e,["boundPipeline","colorTextureViews"]),ge(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),lU(t,e)}var pU=$(K1,"vtkWebGPURenderEncoder"),Ot={newInstance:pU,extend:K1};function hU(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;let a=n.getDevice();if(e.renderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resize(n.getCanvas().width,n.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=vt.newInstance({label:"opaquePassColor"}),e.colorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});let i=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,i),e.depthFormat="depth32float",e.depthTexture=vt.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});let s=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(s)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),r.setRenderEncoder(e.renderEncoder),r.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=Ot.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}var dU={renderEncoder:null,colorTexture:null,depthTexture:null};function $1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dU,r),at.extend(t,e,r),w.get(t,e,["colorTexture","depthTexture"]),hU(t,e)}var vU=w.newInstance($1,"vtkWebGPUOpaquePass"),X1={newInstance:vU,extend:$1};var mU=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function xU(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;let a=n.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=vt.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let i=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,i),e.translucentAccumulateTexture=vt.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let s=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,s),e.fullScreenQuad=Lt.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(mU)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),r.setRenderEncoder(e.translucentRenderEncoder),r.traverse(t),t.finalPass(n,r)},t.finalPass=(r,n)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=Ot.newInstance({label:"translucentRender"});let r=e.translucentRenderEncoder.getDescription();r.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],r.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor"),a.addOutput("f32","outAccum"),a.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let i=a.getCode();i=J.substitute(i,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,a.setCode(i)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcFactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=Ot.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(r=>{let n=r.getShaderDescription("fragment");n.addOutput("vec4<f32>","outColor"),n.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let a=n.getCode();a=J.substitute(a,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,n.setCode(a)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}var yU={colorTextureView:null,depthTextureView:null};function Y1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yU,r),at.extend(t,e,r),w.setGet(t,e,["colorTextureView","depthTextureView"]),xU(t,e)}var TU=w.newInstance(Y1,"vtkWebGPUOrderIndependentTranslucentPass"),q1={newInstance:TU,extend:Y1};var SU=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,xt=new Float64Array(16),Jr=new Float64Array(16);function CU(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(a,i,s)=>{let o=i.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();c=J.substitute(c,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(c),i.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(a,i,s)=>{let o=i.getShaderDescription("fragment"),c=o.getCode(),f=[],l=[];for(let g=0;g<e.volumes.length;g++)e.volumes[g].getRenderable().getMapper().getBlendMode()===St.COMPOSITE_BLEND?(f.push(`    sampleColor = processVolume(volTexture${g}, ${g}, ${e.rowStarts[g]}, rayPosSC, tfunRows);`),f.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(l.push(`  sampleColor = traverseVals[${g}];`),l.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));c=J.substitute(c,"//VTK::Volume::CompositeCalls",f).result,c=J.substitute(c,"//VTK::Volume::TraverseCalls",l).result,c=J.substitute(c,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let u=!1;for(let g=0;g<e.volumes.length;g++){let p=e.volumes[g].getRenderable().getMapper().getBlendMode();p===St.COMPOSITE_BLEND?u=!0:p===St.MAXIMUM_INTENSITY_BLEND?c=J.substitute(c,"//VTK::Volume::Loop",[`    traverseMax(volTexture${g}, ${g}, ${g}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${g}];`,"//VTK::Volume::Loop"]).result:p===St.MINIMUM_INTENSITY_BLEND?c=J.substitute(c,"//VTK::Volume::Loop",[`    traverseMin(volTexture${g}, ${g}, ${g}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${g}];`,"//VTK::Volume::Loop"]).result:p===St.AVERAGE_INTENSITY_BLEND?c=J.substitute(c,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${g}, ${g}, ${g}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${g}];`,"//VTK::Volume::Loop"]).result:p===St.ADDITIVE_INTENSITY_BLEND&&(c=J.substitute(c,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${g}, ${g}, ${g}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${g}];`,"//VTK::Volume::Loop"]).result)}u&&(c=J.substitute(c,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(c)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=a=>{let i=t.getMTime();for(let u=0;u<e.volumes.length;u++){let g=e.volumes[u].getRenderable(),p=g.getMapper().getInputData();i=Math.max(i,g.getMTime(),p.getMTime())}if(i<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let u=0;u<e.volumes.length;u++){e.rowStarts.push(e.numRows);let p=e.volumes[u].getRenderable(),d=p.getMapper(),h=p.getProperty(),v=d.getInputData(),T=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),y=h.getIndependentComponents()?T:1;e.numRows+=y}let s=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength),c=0,f=new Float32Array(e.rowLength*3),l=e.rowLength;for(let u=0;u<e.volumes.length;u++){let p=e.volumes[u].getRenderable(),d=p.getMapper(),h=p.getProperty(),v=d.getInputData(),T=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),y=h.getIndependentComponents()?T:1;for(let S=0;S<y;++S){let C=h.getRGBTransferFunction(S),E=C.getRange();C.getTable(E[0],E[1],l,f,1);let O=c*l*4;for(let b=0;b<l;++b){s[O+b*4]=255*f[b*3],s[O+b*4+1]=255*f[b*3+1],s[O+b*4+2]=255*f[b*3+2],s[O+b*4+3]=255;for(let R=0;R<4;R++)s[O+(l+b)*4+R]=s[O+b*4+R]}let U=h.getScalarOpacity(S),k=e.sampleDist/h.getScalarOpacityUnitDistance(S),V=U.getRange();U.getTable(V[0],V[1],l,f,1),O=c*l;for(let b=0;b<l;++b)o[O+b]=1-(1-f[b])**k,o[O+b+l]=o[O+b];c+=2}}{let u={nativeArray:s,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},p=a.getTextureManager().getTexture(u).createView("tfunTexture");e.textureViews[2]=p}{let u={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},p=a.getTextureManager().getTexture(u).createView("ofunTexture");e.textureViews[3]=p}e.lutBuildTime.modified()},t.updateSSBO=a=>{let i=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let C=0;C<e.volumes.length;C++){let E=e.volumes[C].getRenderable(),O=E.getMapper(),U=O.getInputData();i=Math.max(i,E.getMTime(),U.getMTime(),O.getMTime())}if(i<e.SSBO.getSendTime())return;let s=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);let o=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*16),f=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4),u=new Float64Array(e.volumes.length*4),g=new Float64Array(e.volumes.length*4);for(let C=0;C<e.volumes.length;C++){let O=e.volumes[C].getRenderable(),k=O.getMapper().getInputData();D.identity(xt),D.translate(xt,xt,s);let V=O.getMatrix();D.transpose(Jr,V),D.invert(Jr,Jr),D.multiply(xt,Jr,xt);let b=k.getWorldToIndex();D.multiply(xt,b,xt);let R=k.getDimensions();D.identity(Jr),D.scale(Jr,Jr,[1/R[0],1/R[1],1/R[2]]),D.multiply(xt,Jr,xt);for(let B=0;B<16;B++)o[C*16+B]=xt[B];D.invert(xt,xt);for(let B=0;B<4;B++)c[C*16+B*4]=xt[B*4],c[C*16+B*4+1]=xt[B*4+1],c[C*16+B*4+2]=xt[B*4+2],c[C*16+B*4+3]=0;f[C*4]=1/R[0],f[C*4+1]=1/R[1],f[C*4+2]=1/R[2],f[C*4+3]=1,l[C*4]=O.getProperty().getShade()?1:0;let M=k.getSpacing();u[C*4]=M[0],u[C*4+1]=M[1],u[C*4+2]=M[2],u[C*4+3]=1;let N=e.textureViews[C+4].getTexture().getScale(),L=O.getProperty().getIpScalarRange();g[C*4]=L[0]/N,g[C*4+1]=L[1]/N,g[C*4+2]=O.getProperty().getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",c),e.SSBO.setAllInstancesFromArray("shade",l),e.SSBO.setAllInstancesFromArray("tstep",f),e.SSBO.setAllInstancesFromArray("spacing",u),e.SSBO.setAllInstancesFromArray("ipScalarRange",g),e.SSBO.send(a),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);let p=new Float64Array(e.numRows),d=new Float64Array(e.numRows),h=new Float64Array(e.numRows),v=new Float64Array(e.numRows),x=new Float64Array(e.numRows),T=new Float64Array(e.numRows),m=new Float64Array(e.numRows),y=new Float64Array(e.numRows),S=0;for(let C=0;C<e.volumes.length;C++){let O=e.volumes[C].getRenderable(),U=O.getMapper(),k=O.getProperty(),V=U.getInputData(),R=(V.getPointData()&&V.getPointData().getScalars()).getNumberOfComponents(),M=k.getIndependentComponents(),N=e.textureViews[C+4].getTexture().getFormat(),L=Ne.getDetailsFromTextureFormat(N),B=L.elementSize===2&&L.sampleType==="float",G={scale:[255],offset:[0]};B&&(G.scale[0]=1);for(let F=0;F<R;F++){let _=M?F:0,W=G.scale[F],I=k.getScalarOpacity(_).getRange(),ve=W/(I[1]-I[0]),me=(G.offset[F]-I[0])/(I[1]-I[0]);v[S]=me,h[S]=ve;let he=k.getRGBTransferFunction(_).getRange();if(d[S]=(G.offset[F]-he[0])/(he[1]-he[0]),p[S]=W/(he[1]-he[0]),k.getUseGradientOpacity(_)){let Oe=k.getGradientOpacityMinimumOpacity(_),re=k.getGradientOpacityMaximumOpacity(_);x[S]=Oe,T[S]=re;let ne=[k.getGradientOpacityMinimumValue(_),k.getGradientOpacityMaximumValue(_)];y[S]=W*(re-Oe)/(ne[1]-ne[0]),m[S]=-ne[0]*(re-Oe)/(ne[1]-ne[0])+Oe}else x[S]=1,T[S]=1,y[S]=0,m[S]=1;S++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",p),e.componentSSBO.setAllInstancesFromArray("cShift",d),e.componentSSBO.setAllInstancesFromArray("oScale",h),e.componentSSBO.setAllInstancesFromArray("oShift",v),e.componentSSBO.setAllInstancesFromArray("goScale",y),e.componentSSBO.setAllInstancesFromArray("goShift",m),e.componentSSBO.setAllInstancesFromArray("gomin",x),e.componentSSBO.setAllInstancesFromArray("gomax",T),e.componentSSBO.send(a)};let r=t.updateBuffers;t.updateBuffers=()=>{r();let a=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let i=0;i<e.volumes.length;i++){let c=e.volumes[i].getRenderable().getMapper().getSampleDistance();c<a&&(a=c)}e.sampleDist!==a&&(e.sampleDist=a,e.UBO.setValue("SampleDistance",a),e.UBO.sendIfNeeded(e.device));for(let i=0;i<e.volumes.length;i++){let f=e.volumes[i].getRenderable().getMapper().getInputData(),l=e.device.getTextureManager().getTextureForImageData(f);if(!e.textureViews[i+4]||e.textureViews[i+4].getTexture()!==l){let u=l.createView(`volTexture${i}`);e.textureViews[i+4]=u}}if(e.volumes.length<e.lastVolumeLength)for(let i=e.volumes.length;i<e.lastVolumeLength;i++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=Kr.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let a=0;a<e.volumes.length;a++){let i=e.volumes[a].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${i}`}},t.setVolumes=a=>{if(!e.volumes||e.volumes.length!==a.length){e.volumes=[...a],t.modified();return}for(let i=0;i<a.length;i++)if(a[i]!==e.volumes[i]){e.volumes=[...a],t.modified();return}};let n=t.getBindables;t.getBindables=()=>{let a=n();return a.push(e.componentSSBO),a.push(e.clampSampler),a}}var wU={volumes:null,rowLength:1024,lastVolumeLength:0};function Z1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wU,r),Lt.extend(t,e,r),e.fragmentShaderTemplate=SU,e.UBO=Vt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=Ka.newInstance({label:"volumeSSBO"}),e.componentSSBO=Ka.newInstance({label:"componentSSBO"}),e.lutBuildTime={},w.obj(e.lutBuildTime,{mtime:0}),CU(t,e)}var OU=w.newInstance(Z1,"vtkWebGPUVolumePassFSQ"),Q1={newInstance:OU,extend:Z1};var{Representation:EU}=Gt,{BufferUsage:J1,PrimitiveTypes:MU}=Ct,cu=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],RU=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,DU=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function LU(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=r=>{e._clearEncoder||t.createClearEncoder(r),e._mergeEncoder||t.createMergeEncoder(r),e._copyEncoder||t.createCopyEncoder(r),e._depthRangeEncoder||t.createDepthRangeEncoder(r),e.fullScreenQuad||(e.fullScreenQuad=Q1.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=Lt.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(r.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(DU),e._copyUBO=Vt.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n,t.initialize(n),t.computeTiming(n),t.renderDepthBounds(r,n),e._firstGroup=!0;let a=n.getDevice(),i=a.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>i){let s=r.getRenderable().getActiveCamera().getPosition(),o=[];for(let u=0;u<e.volumes.length;u++){let g=e.volumes[u].getRenderable().getBounds(),p=[.5*(g[1]+g[0]),.5*(g[3]+g[2]),.5*(g[5]+g[4])];o[u]=Ze(p,s)}let c=[...Array(e.volumes.length).keys()];c.sort((u,g)=>o[g]-o[u]);let f=[],l=c.length%i;for(let u=0;u<c.length;u++)f.push(e.volumes[c[u]]),f.length>=l&&(t.rayCastPass(n,r,f),f=[],l=i,e._firstGroup=!1)}else t.rayCastPass(n,r,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(r),e._useSmallViewport){let s=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/s,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(a),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=w.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=r=>{let n=r.getRenderable().getInteractor();if(e._lastScale==null){let a=e.volumes[0].getRenderable().getMapper();e._lastScale=a.getInitialInteractionScale()||1}e._useSmallViewport=!1,n.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=n.onAnimationFrameRateUpdate(()=>{let a=e.volumes[0].getRenderable().getMapper();if(a.getAutoAdjustSampleDistances()){let i=n.getRecentAnimationFrameRate(),s=e._lastScale*n.getDesiredUpdateRate()/i;e._lastScale=s,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=a.getImageSampleDistance()*a.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(r,n,a)=>{let i=e._firstGroup?e._clearEncoder:e._mergeEncoder;i.attachTextureViews(),i.begin(r.getCommandEncoder());let s=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){let c=r.getCanvas(),f=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(f*c.width),e._smallViewportHeight=Math.ceil(f*c.height),s=e._smallViewportWidth,o=e._smallViewportHeight}i.getHandle().setViewport(0,0,s,o,0,1),i.getHandle().setScissorRect(0,0,s,o),e.fullScreenQuad.setWebGPURenderer(n),e.fullScreenQuad.setVolumes(a),e.fullScreenQuad.prepareAndDraw(i),i.end()},t.renderDepthBounds=(r,n)=>{t.updateDepthPolyData(r);let a=e._boundsPoly,i=a.getPoints(),s=a.getPolys(),o={hash:`vp${s.getMTime()}`,usage:J1.Index,cells:s,numberOfPoints:i.getNumberOfPoints(),primitiveType:MU.Triangles,representation:EU.SURFACE},c=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(c),o={usage:J1.PointArray,format:"float32x4",hash:`vp${i.getMTime()}${s.getMTime()}`,dataArray:i,indexBuffer:c,packExtra:!0};let f=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(f,["vertexBC"]),e._mapper.setNumberOfVertices(f.getSizeInBytes()/f.getStrideInBytes()),t.drawDepthRange(r,n)},t.updateDepthPolyData=r=>{let n=!1;for(let l=0;l<e.volumes.length;l++){let u=e.volumes[l].getMTime();(!e._lastMTimes[l]||u!==e._lastMTimes[l])&&(n=!0,e._lastMTimes[l]=u)}let a=r.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||a!==e._lastMTimes[e.volumes.length])&&(n=!0,e._lastMTimes[e.volumes.length]=a),!n)return;let i=r.getStabilizedCenterByReference(),s=e.volumes.length*8,o=new Float64Array(s*3),c=e.volumes.length*12,f=new Uint16Array(c*4);for(let l=0;l<e.volumes.length;l++){e.volumes[l].getBoundingCubePoints(o,l*24);let u=l*12*4,g=l*8;for(let p=0;p<12;p++)f[u++]=3,f[u++]=g+cu[p][0],f[u++]=g+cu[p][1],f[u++]=g+cu[p][2]}for(let l=0;l<o.length;l+=3)o[l]-=i[0],o[l+1]-=i[1],o[l+2]-=i[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(f,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(r,n)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),r.setRenderEncoder(e._depthRangeEncoder),r.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(r),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),r.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=r=>{let n=r.getDevice();e._depthRangeEncoder=Ot.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(s=>{let o=s.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let c=o.getCode();c=J.substitute(c,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(c)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcFactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcFactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=vt.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let a=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,a),e._depthRangeTexture2=vt.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let i=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,i),e._mapper.setDevice(r.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=r=>{e._colorTexture=vt.newInstance({label:"volumePassColor"}),e._colorTexture.create(r.getDevice(),{width:r.getCanvas().width,height:r.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=Ot.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=r=>{e._copyEncoder=Ot.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=r=>{e._mergeEncoder=Ot.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let i=a.getCode();i=J.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,a.setCode(i)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=r=>{if(!e.volumes||e.volumes.length!==r.length){e.volumes=[...r],t.modified();return}for(let n=0;n<r.length;n++)if(r[n]!==e.volumes[n]){e.volumes=[...r],t.modified();return}}}var VU={colorTextureView:null,depthTextureView:null,volumes:null};function em(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VU,r),at.extend(t,e,r),e._mapper=oa.newInstance(),e._mapper.setFragmentShaderTemplate(RU),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(n,a,i)=>{a.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=Re.newInstance(),e._lastMTimes=[],w.setGet(t,e,["colorTextureView","depthTextureView"]),LU(t,e)}var FU=w.newInstance(em,"vtkWebGPUVolumePass"),tm={newInstance:FU,extend:em};var kU=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function bU(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t),e.opaquePass||(e.opaquePass=X1.newInstance());let a=r.getRenderable().getNumberOfLayers(),i=r.getChildren();for(let s=0;s<a;s++)for(let o=0;o<i.length;o++){let c=i[o],f=r.getRenderable().getRenderers()[o];f.getDraw()&&f.getLayer()===s&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),c.traverse(t),t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaquePass.traverse(c,r),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=q1.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(c,r)),e.volumes.length>0&&(e.volumePass||(e.volumePass=tm.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(c,r)),t.finalPass(r,c))}},t.finalPass=(r,n)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(r),e._finalBlitOutputTextureView.createFromTextureHandle(r.getCurrentTexture(),{depth:1,format:r.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=r=>{e._finalBlitEncoder=Ot.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:r.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=Kr.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=Lt.newInstance(),e._fullScreenQuad.setDevice(r.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(kU),e._finalBlitOutputTextureView=Qs.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=r=>{e.volumes.push(r)}}var UU={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function rm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UU,r),at.extend(t,e,r),w.setGet(t,e,["opaquePass","translucentPass","volumePass"]),bU(t,e)}var NU=w.newInstance(rm,"vtkForwardPass"),nm={newInstance:NU,extend:rm};var{VtkDataTypes:Gn}=K;function BU(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function r(a){if(a.imageData){a.dataArray=a.imageData.getPointData().getScalars(),a.time=a.dataArray.getMTime(),a.nativeArray=a.dataArray.getData();let i=a.imageData.getDimensions();switch(a.width=i[0],a.height=i[1],a.depth=i[2],a.dataArray.getNumberOfComponents()){case 1:a.format="r";break;case 2:a.format="rg";break;case 3:case 4:default:a.format="rgba";break}switch(a.dataArray.getDataType()){case Gn.UNSIGNED_CHAR:a.format+="8unorm";break;case Gn.FLOAT:case Gn.UNSIGNED_INT:case Gn.INT:case Gn.DOUBLE:case Gn.UNSIGNED_SHORT:case Gn.SHORT:default:a.format+="16float";break}}a.image&&(a.width=a.image.width,a.height=a.image.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.jsImageData&&(a.width=a.jsImageData.width,a.height=a.jsImageData.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.nativeArray=a.jsImageData.data,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.imageBitmap&&(a.width=a.imageBitmap.width,a.height=a.imageBitmap.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.canvas&&(a.width=a.canvas.width,a.height=a.canvas.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT)}function n(a){let i=vt.newInstance({label:a.label});return i.create(e.device,{width:a.width,height:a.height,depth:a.depth,format:a.format,usage:a.usage,mipLevel:a.mipLevel}),(a.nativeArray||a.image||a.canvas||a.imageBitmap)&&i.writeImageData(a),i}t.getTexture=a=>a.hash?e.device.getCachedObject(a.hash,n,a):n(a),t.getTextureForImageData=a=>{let i={time:a.getMTime()};return i.imageData=a,r(i),i.hash=i.time+i.format+i.mipLevel,e.device.getTextureManager().getTexture(i)},t.getTextureForVTKTexture=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s={time:a.getMTime(),label:i};return a.getInputData()?s.imageData=a.getInputData():a.getImage()?s.image=a.getImage():a.getJsImageData()?s.jsImageData=a.getJsImageData():a.getImageBitmap()?s.imageBitmap=a.getImageBitmap():a.getCanvas()&&(s.canvas=a.getCanvas()),r(s),s.mipLevel=a.getMipLevel(),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)}}var GU={handle:null,device:null};function am(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GU,r),w.obj(t,e),w.setGet(t,e,["device"]),BU(t,e)}var _U=w.newInstance(am),im={newInstance:_U,extend:am};var fu=class extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{let r=super.get(e);r&&r.deref&&r.deref()===void 0&&super.delete(e)})}getValue(e){let r=super.get(e);if(r){let n=r.deref();if(n!==void 0)return n;super.delete(e)}}setValue(e,r){let n;return r&&typeof r=="object"&&(n=new WeakRef(r),this.registry.register(r,e),super.set(e,n)),n}};function WU(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=r=>{e.handle=r},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=r=>{e.handle.queue.submit([r.finish()])},t.getShaderModule=r=>e.shaderCache.getShaderModule(r),t.getBindGroupLayout=r=>{if(!r.entries)return null;for(let i=0;i<r.entries.length;i++){let s=r.entries[i];s.binding=s.binding||0,s.visibility=s.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}let n=JSON.stringify(r);for(let i=0;i<e.bindGroupLayouts.length;i++)if(e.bindGroupLayouts[i].sval===n)return e.bindGroupLayouts[i].layout;let a=e.handle.createBindGroupLayout(r);return e.bindGroupLayouts.push({sval:n,layout:a}),a},t.getBindGroupLayoutDescription=r=>{for(let n=0;n<e.bindGroupLayouts.length;n++)if(e.bindGroupLayouts[n].layout===r)return e.bindGroupLayouts[n].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=r=>r in e.pipelines?e.pipelines[r]:null,t.createPipeline=(r,n)=>{n.initialize(t,r),e.pipelines[r]=n},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=r=>e.objectCache.getValue(r),t.getCachedObject=function(r,n){if(!r)return vtkErrorMacro("attempt to cache an object without a hash"),null;let a=e.objectCache.getValue(r);if(a)return a;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];let c=n(...s);return e.objectCache.setValue(r,c),c}}var zU={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function sm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zU,r),ae(t,e),ge(t,e,["handle"]),Me(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new fu,e.shaderCache=J.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=Ct.newInstance(),e.bufferManager.setDevice(t),e.textureManager=im.newInstance(),e.textureManager.setDevice(t),e.pipelines={},WU(t,e)}var AU=$(sm,"vtkWebGPUDevice"),om={newInstance:AU,extend:sm};function PU(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),r.traverse(t);let a=r.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=vt.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});let i=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,i),e.depthTexture=vt.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});let s=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(s)}e.selectionRenderEncoder.attachTextureViews(),n.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),n.traverse(t),t.setCurrentOperation("opaquePass"),n.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=Ot.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<u32>","outColor");let i=a.getCode();i=J.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,a.setCode(i)});let r=e.selectionRenderEncoder.getDescription();r.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}var HU={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function cm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HU,r),at.extend(t,e,r),w.get(t,e,["colorTexture","depthTexture"]),PU(t,e)}var IU=w.newInstance(cm,"vtkWebGPUHardwareSelectionPass"),fm={newInstance:IU,extend:cm};var{SelectionContent:jU,SelectionField:um}=va,{FieldAssociations:lm}=yt,{vtkErrorMacro:pm}=w;function KU(t){return`${t.propID} ${t.compositeID}`}function gm(t,e,r,n){let a=((r.height-e-1)*r.colorBufferWidth+t)*4+n;return r.colorValues[a]}function xa(t,e,r,n){let a=r<0?0:r;if(a===0){if(n[0]=e[0],n[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;let c=gm(e[0],e[1],t,0);if(c<=0)return null;let f={};f.propID=c;let l=gm(e[0],e[1],t,1);if((l<0||l>16777215)&&(l=0),f.compositeID=l,t.captureZValues){let u=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];f.zValue=t.depthValues[u],f.zValue=t.webGPURenderer.convertToOpenGLDepth(f.zValue),f.displayPosition=e}return f}let i=[e[0],e[1]],s=[0,0],o=xa(t,e,0,n);if(o)return o;for(let c=1;c<a;++c){for(let f=i[1]>c?i[1]-c:0;f<=i[1]+c;++f)if(s[1]=f,i[0]>=c&&(s[0]=i[0]-c,o=xa(t,s,0,n),o)||(s[0]=i[0]+c,o=xa(t,s,0,n),o))return o;for(let f=i[0]>=c?i[0]-(c-1):0;f<=i[0]+(c-1);++f)if(s[0]=f,i[1]>=c&&(s[1]=i[1]-c,o=xa(t,s,0,n),o)||(s[1]=i[1]+c,o=xa(t,s,0,n),o))return o}return n[0]=e[0],n[1]=e[1],null}function $U(t,e,r){let n=[],a=0;return e.forEach((i,s)=>{let o=va.newInstance();switch(o.setContentType(jU.INDICES),t){case lm.FIELD_ASSOCIATION_CELLS:o.setFieldType(um.CELL);break;case lm.FIELD_ASSOCIATION_POINTS:o.setFieldType(um.POINT);break;default:pm("Unknown field association")}o.getProperties().propID=i.info.propID;let c=r.webGPURenderer.getPropFromID(i.info.propID);o.getProperties().prop=c.getRenderable(),o.getProperties().compositeID=i.info.compositeID,o.getProperties().pixelCount=i.pixelCount,r.captureZValues&&(o.getProperties().displayPosition=[i.info.displayPosition[0],i.info.displayPosition[1],i.info.zValue],o.getProperties().worldPosition=r.webGPURenderWindow.displayToWorld(i.info.displayPosition[0],i.info.displayPosition[1],i.info.zValue,r.renderer)),o.setSelectionList(i.attributeIDs),n[a]=o,a++}),n}function XU(t,e,r,n,a){let i=Math.floor(e),s=Math.floor(r),o=Math.floor(n),c=Math.floor(a),f=new Map,l=[0,0];for(let u=s;u<=c;u++)for(let g=i;g<=o;g++){let d=xa(t,[g,u],0,l);if(d){let h=KU(d);if(!f.has(h))f.set(h,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{let v=f.get(h);v.pixelCount++,t.captureZValues&&d.zValue<v.info.zValue&&(v.info=d),v.attributeIDs.indexOf(d.attributeID)===-1&&v.attributeIDs.push(d.attributeID)}}}return $U(t.fieldAssociation,f,t)}function YU(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async r=>{if(!r||!e._WebGPURenderWindow)return pm("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(p=>{e._WebGPURenderWindow.onInitialized(p)}));let n=e._WebGPURenderWindow.getViewNodeFor(r);if(!n)return!1;let a=n.getSuppressClear();n.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,n),n.setSuppressClear(a);let i=e._WebGPURenderWindow.getDevice(),s=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),c={area:[0,0,s.getWidth()-1,s.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:r,webGPURenderer:n,webGPURenderWindow:e._WebGPURenderWindow,width:s.getWidth(),height:s.getHeight()};c.colorBufferWidth=16*Math.floor((c.width+15)/16),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*4*4;let f=er.newInstance({label:"hardwareSelectColorBuffer"});f.setDevice(i),f.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);let l=e._WebGPURenderWindow.getCommandEncoder();l.copyTextureToBuffer({texture:s.getHandle()},{buffer:f.getHandle(),bytesPerRow:16*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1});let u;e.captureZValues&&(c.zbufferBufferWidth=64*Math.floor((c.width+63)/64),u=er.newInstance({label:"hardwareSelectDepthBuffer"}),u.setDevice(i),c.zbufferSizeInBytes=c.height*c.zbufferBufferWidth*4,u.create(c.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),l.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:u.getHandle(),bytesPerRow:4*c.zbufferBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1})),i.submitCommandEncoder(l);let g=f.mapAsync(GPUMapMode.READ);if(e.captureZValues){let p=u.mapAsync(GPUMapMode.READ);await Promise.all([g,p]),c.depthValues=new Float32Array(u.getMappedRange().slice()),u.unmap()}else await g;return c.colorValues=new Uint32Array(f.getMappedRange().slice()),f.unmap(),c.generateSelection=(p,d,h,v)=>XU(c,p,d,h,v),c}}var qU={};function hm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qU,r),fo.extend(t,e,r),e._selectionPass=fm.newInstance(),w.setGet(t,e,["_WebGPURenderWindow"]),w.moveToProtected(t,e,["WebGPURenderWindow"]),YU(t,e)}var ZU=w.newInstance(hm,"vtkWebGPUHardwareSelector"),uu={newInstance:ZU,extend:hm};var{vtkErrorMacro:dm}=w,QU={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function JU(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;let r=[0,0];function n(){e.renderable&&(e.size[0]!==r[0]||e.size[1]!==r[1])&&(r[0]=e.size[0],r[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(n),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=s=>{if(s){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){dm("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=s=>{e.el&&e.el!==s&&(e.canvas.parentNode!==e.el&&dm("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==s&&(e.el=s,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){let{width:s,height:o}=e.el.getBoundingClientRect();e.containerSize=[s,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=om.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{let s=at.newInstance();s.setCurrentOperation("Release"),s.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=s=>{e.bgImage.src=s.src},t.setUseBackgroundImage=s=>{e.useBackgroundImage=s,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function a(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,o=document.createElement("canvas"),c=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;let f=await t.getPixelsAsync(),l=new ImageData(f.colorValues,f.width,f.height);c.putImageData(l,0,0);let u=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(h=>{h.getViewProps().forEach(x=>{if(x.getContainer){let m=x.getContainer().getElementsByTagName("canvas");for(let y=0;y<m.length;y++){let S=m[y],C=S.getBoundingClientRect(),E=C.x-u.x,O=C.y-u.y;c.drawImage(S,E,O)}}})});let d=o.toDataURL(s);o.remove(),t.invokeImageReady(d)}t.captureNextImage=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:c=null,scale:f=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=s;let l=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:c||f!==1?c||e.size.map(u=>u*f):null},new Promise((u,g)=>{let p=t.onImageReady(d=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=l,p.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(h=>{let{restoreParamsFn:v,arg:x}=h;return v(x)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),u(d);else{let h=document.createElement("img");if(h.style=QU,h.src=d,e._screenshot.placeHolder=e.el.appendChild(h),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){let v=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(x=>{let T=x.getActiveCamera(),m=T.get("focalPoint","position","parallelScale");return{resetCameraArgs:v?{renderer:x}:void 0,resetCameraFn:v?o:x.resetCamera,restoreParamsFn:T.set,arg:JSON.parse(JSON.stringify(m))}}),e._screenshot.cameras.forEach(x=>{let{resetCameraFn:T,resetCameraArgs:m}=x;return T(m)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let s=0;s<e.renderPasses.length;++s)e.renderPasses[s].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{a()}))}else{t.initialize();let s=t.onInitialized(()=>{s.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=s=>{if(e.viewStream===s)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=s,e.viewStream){let o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(c=>t.setBackgroundImage(c.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=s=>{for(let o=0;o<e.children.length;o++){let c=e.children[o].getPropFromID(s);if(c!==null)return c}return null},t.getPixelsAsync=async()=>{let s=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),c={width:o.getWidth(),height:o.getHeight()};c.colorBufferWidth=32*Math.floor((c.width+31)/32),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*8;let f=er.newInstance();f.setDevice(s),f.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);let l=e.device.createCommandEncoder();l.copyTextureToBuffer({texture:o.getHandle()},{buffer:f.getHandle(),bytesPerRow:8*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1}),s.submitCommandEncoder(l),await f.mapAsync(GPUMapMode.READ),c.colorValues=new Uint16Array(f.getMappedRange().slice()),f.unmap();let g=new Uint8ClampedArray(c.height*c.width*4);for(let p=0;p<c.height;p++)for(let d=0;d<c.width;d++){let h=(p*c.width+d)*4,v=(p*c.colorBufferWidth+d)*4;g[h]=255*Tt.fromHalf(c.colorValues[v]),g[h+1]=255*Tt.fromHalf(c.colorValues[v+1]),g[h+2]=255*Tt.fromHalf(c.colorValues[v+2]),g[h+3]=255*Tt.fromHalf(c.colorValues[v+3])}return c.colorValues=g,c},t.createSelector=()=>{let s=uu.newInstance();return s.setWebGPURenderWindow(t),s};let i=t.setSize;t.setSize=(s,o)=>{let c=i(s,o);return c&&t.invokeWindowResizeEvent({width:s,height:o}),c},t.delete=w.chain(t.delete,t.setViewStream)}var e3={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function t3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,e3,r),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",uo.extend(t,e,r),e.myFactory=jh.newInstance(),e.renderPasses[0]=nm.newInstance(),e.selector||(e.selector=uu.newInstance(),e.selector.setWebGPURenderWindow(t)),w.event(t,e,"imageReady"),w.event(t,e,"initialized"),w.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),w.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),w.setGetArray(t,e,["size"],2),w.event(t,e,"windowResizeEvent"),JU(t,e)}var vm=w.newInstance(t3,"vtkWebGPURenderWindow");ai("WebGPU",vm);Ue("vtkRenderWindow",vm);var r3=h1.extractURLParameters(),n3={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},a3={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function mm(t,e){Object.keys(e).forEach(r=>{t.style[r]=e[r]})}function i3(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");let r=document.querySelector("body");e.rootContainer||(e.rootContainer=r),e.container||(e.container=document.createElement("div"),mm(e.container,e.containerStyle||n3),e.rootContainer.appendChild(e.container)),e.rootContainer===r&&(document.documentElement.style.height="100%",r.style.height="100%",r.style.padding="0",r.style.margin="0"),e.renderWindow=s1.newInstance(),e.renderer=n1.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(r3.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=co.newInstance(),e.interactor.setInteractorStyle(p1.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{let a=e.controlContainer;a&&a.parentNode.removeChild(a)},t.setControllerVisibility=a=>{e.controllerVisibility=a,e.controlContainer&&(a?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function n(a){String.fromCharCode(a.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=a=>{e.controlContainer=document.createElement("div"),mm(e.controlContainer,e.controlPanelStyle||a3),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=a,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",n)},t.setBackground(...e.background),t.addRepresentation=a=>{a.getActors().forEach(i=>{e.renderer.addActor(i)})},t.removeRepresentation=a=>{a.getActors().forEach(i=>e.renderer.removeActor(i))},t.delete=w.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{e.rootContainer?.removeEventListener("keypress",n),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{let a=e.container.getBoundingClientRect(),i=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(a.width*i),Math.floor(a.height*i)),e.resizeCallback&&e.resizeCallback(a),e.renderWindow.render()},t.setResizeCallback=a=>{e.resizeCallback=a,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}var s3={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function xm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,s3,r),w.obj(t,e),w.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),i3(t,e)}var o3=w.newInstance(xm),ym={newInstance:o3,extend:xm};var{vtkErrorMacro:go}=w;function c3(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let r,n=0,a=0;e.nodes.length>0&&(n=e.nodes[0].y);for(let i=1;i<e.nodes.length;i++){if(r=e.nodes[i].y,r!==n)if(r>n)switch(a){case 0:case 1:a=1;break;case 2:default:a=3;break}else switch(a){case 0:case 2:a=2;break;case 1:default:a=3;break}if(n=r,a===3)break}switch(a){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{let r=e.nodes.length;if(e.function=null,r>0){e.function=[];for(let n=0;n<r;n++)e.function[2*n]=e.nodes[n].x,e.function[2*n+1]=e.nodes[n].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let r=1,n=0,a=0;for(;a<e.nodes.length;a++)if(e.nodes[a].y!==0){r=0;break}return r?n=Number.MAX_VALUE:a>0?n=e.nodes[a-1].x:e.clamping?n=-Number.MAX_VALUE:n=e.nodes[0].x,n},t.getNodeValue=(r,n)=>{let a=e.nodes.length;return r<0||r>=a?(go("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].y,n[2]=e.nodes[r].midpoint,n[3]=e.nodes[r].sharpness,1)},t.setNodeValue=(r,n)=>{let a=e.nodes.length;if(r<0||r>=a)return go("Index out of range!"),-1;let i=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].y=n[1],e.nodes[r].midpoint=n[2],e.nodes[r].sharpness=n[3],i!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(r,n)=>t.addPointLong(r,n,.5,0),t.addPointLong=(r,n,a,i)=>{if(a<0||a>1)return go("Midpoint outside range [0.0, 1.0]"),-1;if(i<0||i>1)return go("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);let s={x:r,y:n,midpoint:a,sharpness:i};e.nodes.push(s),t.sortAndUpdateRange();let o;for(o=0;o<e.nodes.length&&e.nodes[o].x!==r;o++);return o<e.nodes.length?o:-1},t.setNodes=r=>{e.nodes!==r&&(e.nodes=r,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((n,a)=>n.x-a.x),t.updateRange()||t.modified()},t.updateRange=()=>{let r=e.range.slice(),n=e.nodes.length;return n?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[n-1].x):(e.range[0]=0,e.range[1]=0),r[0]===e.range[0]&&r[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n;for(n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);if(n>=e.nodes.length)return-1;let a=n,i=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(r,n,a,i)=>{t.sortAndUpdateRange();for(let s=0;s<e.nodes.length;)e.nodes[s].x>=r&&e.nodes[s].x<=a?e.nodes.splice(s,1):s++;t.addPoint(r,n,.5,0),t.addPoint(a,i,.5,0)},t.getValue=r=>{let n=[];return t.getTable(r,r,1,n),n[0]},t.adjustRange=r=>{if(r.length<2)return 0;let n=t.getRange();n[0]<r[0]?t.addPoint(r[0],t.getValue(r[0])):t.addPoint(r[0],t.getValue(n[0])),n[1]>r[1]?t.addPoint(r[1],t.getValue(r[1])):t.addPoint(r[1],t.getValue(n[1])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=r[0]&&e.nodes[a].x<=r[1]?e.nodes.splice(a,1):++a;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(r,n)=>{let a=t.findMinimumXDistance();return Math.ceil((n-r)/a)},t.findMinimumXDistance=()=>{let r=e.nodes.length;if(r<2)return-1;let n=e.nodes[1].x-e.nodes[0].x;for(let a=0;a<r-1;a++){let i=e.nodes[a+1].x-e.nodes[a].x;i<n&&(n=i)}return n},t.getTable=function(r,n,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o,c=0,f=e.nodes.length,l=0;f!==0&&(l=e.nodes[f-1].y);let u=0,g=0,p=0,d=0,h=0,v=0,x=0;for(o=0;o<a;o++){let T=s*o;for(a>1?u=r+o/(a-1)*(n-r):u=.5*(r+n);c<f&&u>e.nodes[c].x;)c++,c<f&&(g=e.nodes[c-1].x,p=e.nodes[c].x,d=e.nodes[c-1].y,h=e.nodes[c].y,v=e.nodes[c-1].midpoint,x=e.nodes[c-1].sharpness,v<1e-5&&(v=1e-5),v>.99999&&(v=.99999));if(c>=f)i[T]=e.clamping?l:0;else if(c===0)i[T]=e.clamping?e.nodes[0].y:0;else{let m=(u-g)/(p-g);if(m<v?m=.5*m/v:m=.5+.5*(m-v)/(1-v),x>.99)if(m<.5){i[T]=d;continue}else{i[T]=h;continue}if(x<.01){i[T]=(1-m)*d+m*h;continue}m<.5?m=.5*(m*2)**(1+10*x):m>.5&&(m=1-.5*((1-m)*2)**(1+10*x));let y=m*m,S=y*m,C=2*S-3*y+1,E=-2*S+3*y,O=S-2*y+m,U=S-y,k=h-d,V=(1-x)*k;i[T]=C*d+E*h+O*V+U*V;let b=d<h?d:h,R=d>h?d:h;i[T]=i[T]<b?b:i[T],i[T]=i[T]>R?R:i[T]}}}}var f3={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function Tm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,f3,r),w.obj(t,e),e.nodes=[],w.setGet(t,e,["allowDuplicateScalars","clamping"]),w.setArray(t,e,["range"],2),w.getArray(t,e,["range"]),c3(t,e)}var u3=w.newInstance(Tm,"vtkPiecewiseFunction"),_n={newInstance:u3,extend:Tm};var{InterpolationType:ci,OpacityMode:l3,FilterMode:fi,ColorMixPreset:g3}=uf,{vtkErrorMacro:lu}=w,po=4;function p3(t,e){e.classHierarchy.push("vtkVolumeProperty");let r={...t};t.getMTime=()=>{let i=e.mtime,s;for(let o=0;o<po;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(s=e.componentData[o].grayTransferFunction.getMTime(),i=i>s?i:s):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(s=e.componentData[o].rGBTransferFunction.getMTime(),i=i>s?i:s),e.componentData[o].scalarOpacity&&(s=e.componentData[o].scalarOpacity.getMTime(),i=i>s?i:s),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(s=e.componentData[o].gradientOpacity.getMTime(),i=i>s?i:s));return i},t.getColorChannels=i=>i<0||i>3?(lu("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].grayTransferFunction!==s&&(e.componentData[i].grayTransferFunction=s,o=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=_n.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].rGBTransferFunction!==s&&(e.componentData[i].rGBTransferFunction=s,o=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=ri.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==s?(e.componentData[i].scalarOpacity=s,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=_n.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=po)return lu("Invalid index"),!1;let o=Math.min(1,Math.max(0,s));return e.componentData[i].componentWeight!==o?(e.componentData[i].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=po?(lu("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(ci.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(ci.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(ci.FAST_LINEAR),t.getInterpolationTypeAsString=()=>w.enumToString(ci,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{let s=w.capitalize(i);t[`set${s}`]=(o,c)=>e.componentData[o][`${i}`]!==c?(e.componentData[o][`${i}`]=c,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{let s=w.capitalize(i);t[`get${s}`]=o=>e.componentData[o][`${i}`]}),t.setAverageIPScalarRange=(i,s)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(i,s)},t.getFilterModeAsString=()=>w.enumToString(fi,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(fi.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(fi.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(fi.RAW)},t.setGlobalIlluminationReach=i=>r.setGlobalIlluminationReach(vr(i,0,1)),t.setVolumetricScatteringBlending=i=>r.setVolumetricScatteringBlending(vr(i,0,1)),t.setAnisotropy=i=>r.setAnisotropy(vr(i,-.99,.99)),t.setLAOKernelSize=i=>r.setLAOKernelSize(ba(vr(i,1,32))),t.setLAOKernelRadius=i=>r.setLAOKernelRadius(i>=1?i:1)}var h3=t=>({colorMixPreset:g3.DEFAULT,independentComponents:!0,interpolationType:ci.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,ipScalarRange:[-1e6,1e6],filterMode:fi.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7,updatedExtents:[],...t});function Sm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,h3(r)),w.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<po;++n)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:l3.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}w.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius","updatedExtents"]),w.setGetArray(t,e,["ipScalarRange"],2),w.setGetArray(t,e,["labelOutlineThickness"]),p3(t,e)}var d3=w.newInstance(Sm,"vtkVolumeProperty"),Cm={newInstance:d3,extend:Sm,...uf};function v3(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>[t],t.makeProperty=Cm.newInstance,t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r}}var m3={mapper:null};function wm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m3,r),_s.extend(t,e,r),e.boundsMTime={},w.obj(e.boundsMTime),w.setGet(t,e,["mapper"]),v3(t,e)}var x3=w.newInstance(wm,"vtkVolume"),Om={newInstance:x3,extend:wm};var{BlendMode:en}=_h;function y3(t,e,r,n,a){let i=null;return a?(i=a,i.removeAllPoints()):i=_n.newInstance(),i.addPointLong(-1024,0,1,1),i.addPoint(t,e),i.addPoint(r,n),i}var T3=["getAnisotropy","getComputeNormalFromOpacity","getFilterMode","getFilterModeAsString","getGlobalIlluminationReach","getIpScalarRange","getIpScalarRangeByReference","getLAOKernelRadius","getLAOKernelSize","getLocalAmbientOcclusion","getPreferSizeOverAccuracy","getVolumetricScatteringBlending","setAnisotropy","setAverageIPScalarRange","setComputeNormalFromOpacity","setFilterMode","setFilterModeToNormalized","setFilterModeToOff","setFilterModeToRaw","setGlobalIlluminationReach","setIpScalarRange","setIpScalarRangeFrom","setLAOKernelRadius","setLAOKernelSize","setLocalAmbientOcclusion","setPreferSizeOverAccuracy","setVolumetricScatteringBlending"],S3={createRadonTransferFunction:y3};function C3(t,e){e.classHierarchy.push("vtkVolumeMapper");let r={...t};t.getBounds=()=>(e.static||t.update(),e.bounds=[...t.getInputData().getBounds()],e.bounds),t.setBlendModeToComposite=()=>{t.setBlendMode(en.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(en.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(en.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(en.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(en.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(en.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>w.enumToString(en,e.blendMode),t.setVolumeShadowSamplingDistFactor=n=>r.setVolumeShadowSamplingDistFactor(n>=1?n:1),T3.forEach(n=>{let a=()=>{throw new Error(`The method "volumeMapper.${n}()" doesn't exist anymore. It is a rendering property that has been moved to the volume property. Replace your code with:
volumeActor.getProperty().${n}()
`)};t[n]=a})}var w3=t=>({bounds:[...se.INIT_BOUNDS],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:en.COMPOSITE_BLEND,volumeShadowSamplingDistFactor:5,colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024,...t});function Em(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,w3(r)),Ws.extend(t,e,r),w.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","volumeShadowSamplingDistFactor","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),w.event(t,e,"lightingActivated"),C3(t,e)}var O3=w.newInstance(Em,"vtkVolumeMapper"),Mm={newInstance:O3,extend:Em,...S3};function E3(t,e){e.classHierarchy.push("vtkPolyDataNormals"),t.vtkPolyDataNormalsExecute=(r,n,a)=>{if(!a)return null;let i=new Float32Array(a.length),s=new Float32Array(3*r),o=0,c=0,f=n.length,l=[0,0,0],u=[0,0,0];for(let g=0;g<f;g+=c+1)if(c=n[g],!(c<3)){for(let p=1;p<=3;++p)l[p-1]=3*n[g+p];if(_r.computeNormal(a.slice(l[0],l[0]+3),a.slice(l[1],l[1]+3),a.slice(l[2],l[2]+3),u),s[o++]=u[0],s[o++]=u[1],s[o++]=u[2],e.computePointNormals)for(let p=1;p<=c;++p){let d=3*n[g+p];i[d]+=u[0],i[++d]+=u[1],i[++d]+=u[2]}}if(e.computePointNormals){let g=[0,0,0];for(let p=0;p<a.length;)g[0]=i[p],g[1]=i[p+1],g[2]=i[p+2],Xe.normalize(g),i[p++]=g[0],i[p++]=g[1],i[p++]=g[2]}return[s,i]},t.requestData=(r,n)=>{if(!t.getNumberOfInputPorts())return;let i=r[0];if(!i)return;let s=n[0]?.initialize()||Re.newInstance();s.setPoints(i.getPoints()),s.setVerts(i.getVerts()),s.setLines(i.getLines()),s.setPolys(i.getPolys()),s.setStrips(i.getStrips()),s.getPointData().passData(i.getPointData()),s.getCellData().passData(i.getCellData()),s.getFieldData().passData(i.getFieldData());let[o,c]=t.vtkPolyDataNormalsExecute(i.getNumberOfPolys(),i.getPolys().getData(),i.getPoints().getData());if(e.computePointNormals){let f=K.newInstance({numberOfComponents:3,name:"Normals",values:c});s.getPointData().setNormals(f)}if(e.computeCellNormals){let f=K.newInstance({numberOfComponents:3,name:"Normals",values:o});s.getCellData().setNormals(f)}n[0]=s}}function M3(t){return{computeCellNormals:!1,computePointNormals:!0,...t}}function Rm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M3(r)),w.obj(t,e),w.algo(t,e,1,1),w.setGet(t,e,["computeCellNormals","computePointNormals"]),E3(t,e)}var R3=w.newInstance(Rm,"vtkPolyDataNormals"),Dm={newInstance:R3,extend:Rm};function Lm(t){return new TextDecoder("latin1").decode(t)}function D3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=Lm(t),a=e.exec(n);if(!a)return{text:n};let i=a.index+a[0].length,s=n.substring(0,i),o=null,c=r?r.exec(n):null;if(c){let f=n.substr(c.index);o={text:s+f,binaryBuffer:t.slice(i,c.index)}}else o={text:s,binaryBuffer:t.slice(i)};return o}var gu={arrayBufferToString:Lm,extractBinary:D3};var pu={};function hu(t){return!!pu[t]}function L3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return pu[t](e)}function du(t,e){pu[t]=e}var Vm={get:L3,has:hu,registerType:du};function Fm(){let t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,r[0]===3569595041?"LittleEndian":r[0]===2712847316?"BigEndian":null}var V3=Fm();function F3(t,e){if(e<2)return;let r=new Int8Array(t),n=r.length,a=[];for(let i=0;i<n;i+=e){for(let s=0;s<e;s++)a.push(r[i+s]);for(let s=0;s<e;s++)r[i+s]=a.pop()}}var ho={ENDIANNESS:V3,getEndianness:Fm,swapBytes:F3};var{vtkErrorMacro:km,vtkDebugMacro:k3}=w,vu=()=>(km("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."))),ya=0;function vo(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new XMLHttpRequest;return n.open(t,e,!0),r.headers&&Object.entries(r.headers).forEach(a=>{let[i,s]=a;return n.setRequestHeader(i,s)}),r.progressCallback&&n.addEventListener("progress",r.progressCallback),n}function b3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{let a=vo("GET",t,e);a.onreadystatechange=i=>{a.readyState===4&&(a.status===200||a.status===0?r(a.response):n({xhr:a,e:i}))},a.responseType="arraybuffer",a.send()})}function U3(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return n&&n.compression?vu():r.ref&&!r.ref.pending?new Promise((a,i)=>{let s=[e,r.ref.basepath,r.ref.id].join("/"),o=vo("GET",s,n);o.onreadystatechange=c=>{o.readyState===1&&(r.ref.pending=!0,++ya===1&&t?.invokeBusy&&t.invokeBusy(!0)),o.readyState===4&&(r.ref.pending=!1,o.status===200||o.status===0?(r.buffer=o.response,r.ref.encode==="JSON"?r.values=JSON.parse(r.buffer):(ho.ENDIANNESS!==r.ref.encode&&ho.ENDIANNESS&&(k3(`Swap bytes of ${r.name}`),ho.swapBytes(r.buffer,dc[r.dataType])),r.values=w.newTypedArray(r.dataType,r.buffer)),r.values.length!==r.size&&km(`Error in FetchArray: ${r.name}, does not have the proper array size. Got ${r.values.length}, instead of ${r.size}`),delete r.ref,--ya===0&&t?.invokeBusy&&t.invokeBusy(!1),t?.modified&&t.modified(),a(r)):i({xhr:o,e:c}))},o.responseType=r.dataType!=="string"?"arraybuffer":"text",o.send()}):Promise.resolve(r)}function N3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?vu():new Promise((n,a)=>{let i=vo("GET",e,r);i.onreadystatechange=s=>{i.readyState===1&&++ya===1&&t?.invokeBusy&&t.invokeBusy(!0),i.readyState===4&&(--ya===0&&t?.invokeBusy&&t.invokeBusy(!1),i.status===200||i.status===0?n(JSON.parse(i.responseText)):a({xhr:i,e:s}))},i.responseType="text",i.send()})}function B3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?vu():new Promise((n,a)=>{let i=vo("GET",e,r);i.onreadystatechange=s=>{i.readyState===1&&++ya===1&&t?.invokeBusy&&t.invokeBusy(!0),i.readyState===4&&(--ya===0&&t?.invokeBusy&&t.invokeBusy(!1),i.status===200||i.status===0?n(i.responseText):a({xhr:i,e:s}))},i.responseType="text",i.send()})}function G3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((n,a)=>{let i=new Image;r.crossOrigin&&(i.crossOrigin=r.crossOrigin),i.onload=()=>n(i),i.onerror=a,i.src=e})}var _3={fetchArray:U3,fetchJSON:N3,fetchText:B3,fetchBinary:b3,fetchImage:G3};hu("http")||du("http",t=>_3);var{vtkErrorMacro:mu}=w;function W3(t){let r=t.split(" ").filter(a=>a.indexOf("=")>-1),n={};for(let a=0;a<r.length;++a){let s=r[a].split("=");s.length===2&&(n[s[0]]=s[1])}return n}function bm(t,e){for(let r=0;r<t.length;r++)e.push(t[r])}function z3(t,e,r,n,a){let i=t[e];if(i===void 0)return-1;if(i.indexOf("endfacet")!==-1||i.indexOf("facet")===-1)return e+1;let s=0,o=2,c=r.length/3,f=i.split(/[ \t]+/).filter(l=>l).slice(-3).map(Number);for(bm(f,a);t[e+o].indexOf("vertex")!==-1;){let u=t[e+o].split(/[ \t]+/).filter(g=>g).slice(-3).map(Number);bm(u,r),s++,o++}n.push(s);for(let l=0;l<s;l++)n.push(c+l);for(;t[e+o]&&t[e+o].indexOf("endfacet")!==-1;)o++;return e+o+2}function A3(t,e){e.classHierarchy.push("vtkSTLReader"),e.dataAccessHelper||(e.dataAccessHelper=Vm.get("http"));function r(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.compression!==void 0?i.compression:e.compression,o=i.progressCallback!==void 0?i.progressCallback:e.progressCallback;return i.binary?e.dataAccessHelper.fetchBinary(a,{compression:s,progressCallback:o}):e.dataAccessHelper.fetchText(t,a,{compression:s,progressCallback:o})}function n(a){let i=e.output[0],s=i.getPoints().getData(),o=i.getPolys().getData();if(!s||!o){console.warn("No valid polydata.");return}let c=new Map,f=new Map,l=0,u=!1;for(let g=0;g<s.length;g+=3){let p=(s[g]*10**a).toFixed(0),d=(s[g+1]*10**a).toFixed(0),h=(s[g+2]*10**a).toFixed(0),v=`${p},${d},${h}`;c.get(v)!==void 0?(f.set(g/3,c.get(v)),u=!0):(f.set(g/3,l),c.set(v,l),l++)}if(u){let g=new Float32Array(c.size*3),p=Array.from(c.keys());for(let h=0;h<p.length;h++){let v=p[h],x=c.get(v)*3,T=v.split(",").map(m=>+m*10**-a);g[x]=T[0],g[x+1]=T[1],g[x+2]=T[2]}let d=new Int32Array(o.length);for(let h=0;h<o.length;h+=4)d[h]=3,d[h+1]=f.get(o[h+1]),d[h+2]=f.get(o[h+2]),d[h+3]=f.get(o[h+3]);i.getPoints().setData(g),i.getPolys().setData(d),i.modified()}}t.setUrl=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=a;let s=a.split("/");return s.pop(),e.baseURL=s.join("/"),t.loadData(i)},t.loadData=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r(e.url,a);return i.then(t.parse),i},t.parse=a=>{typeof a=="string"?t.parseAsText(a):t.parseAsArrayBuffer(a)},t.parseAsArrayBuffer=a=>{if(!a)return;if(a!==e.parseData)t.modified();else return;e.parseData=a;let i=!1;if(i=84+new DataView(a,0,84).getUint32(80,!0)*50===a.byteLength,!i){t.parseAsText(gu.arrayBufferToString(a));return}let c=a.slice(0,80),f=gu.arrayBufferToString(c),l=W3(f),u=new DataView(a,84),g=(a.byteLength-84)/50,p=new Float32Array(g*9),d=new Float32Array(g*3),h=new Uint32Array(g*4),v=new Uint16Array(g),x=0;for(let y=0;y<g;y++){let S=y*50;d[y*3+0]=u.getFloat32(S+0,!0),d[y*3+1]=u.getFloat32(S+4,!0),d[y*3+2]=u.getFloat32(S+8,!0),p[y*9+0]=u.getFloat32(S+12,!0),p[y*9+1]=u.getFloat32(S+16,!0),p[y*9+2]=u.getFloat32(S+20,!0),p[y*9+3]=u.getFloat32(S+24,!0),p[y*9+4]=u.getFloat32(S+28,!0),p[y*9+5]=u.getFloat32(S+32,!0),p[y*9+6]=u.getFloat32(S+36,!0),p[y*9+7]=u.getFloat32(S+40,!0),p[y*9+8]=u.getFloat32(S+44,!0),h[x++]=3,h[x++]=y*3+0,h[x++]=y*3+1,h[x++]=y*3+2,v[y]=u.getUint16(S+48,!0)}let T="SPACE";if(T in l&&l[T]!=="LPS"){let y=l[T],S=new Float32Array(16);switch(S[15]=1,y[0]){case"L":S[0]=1;break;case"R":S[0]=-1;break;default:mu(`Can not convert STL file from ${y} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(y[1]){case"P":S[5]=1;break;case"A":S[5]=-1;break;default:mu(`Can not convert STL file from ${y} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(y[2]){case"S":S[10]=1;break;case"I":S[10]=-1;break;default:mu(`Can not convert STL file from ${y} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}xn.buildFromDegree().setMatrix(S).apply(p).apply(d)}let m=Re.newInstance();m.getPoints().setData(p,3),m.getPolys().setData(h),m.getCellData().setScalars(K.newInstance({name:"Attribute",values:v})),m.getCellData().setNormals(K.newInstance({name:"Normals",values:d,numberOfComponents:3})),e.output[0]=m,e.removeDuplicateVertices>=0&&n(e.removeDuplicateVertices)},t.parseAsText=a=>{if(!a)return;if(a!==e.parseData)t.modified();else return;e.parseData=a;let i=a.split(`
`),s=1,o=[],c=[],f=[];for(;s!==-1;)s=z3(i,s,o,c,f);let l=Re.newInstance();l.getPoints().setData(Float32Array.from(o),3),l.getPolys().setData(Uint32Array.from(c)),l.getCellData().setNormals(K.newInstance({name:"Normals",values:Float32Array.from(f),numberOfComponents:3})),e.output[0]=l,e.removeDuplicateVertices>=0&&n(e.removeDuplicateVertices)},t.requestData=(a,i)=>{t.parse(e.parseData)}}var P3={removeDuplicateVertices:-1};function Um(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P3,r),w.obj(t,e),w.get(t,e,["url","baseURL"]),w.setGet(t,e,["dataAccessHelper","removeDuplicateVertices"]),w.algo(t,e,0,1),A3(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}var H3=w.newInstance(Um,"vtkSTLReader"),Nm={extend:Um,newInstance:H3};function I3(t,e,r,n){let a=t[e*3],i=t[e*3+1],s=t[r*3],o=t[r*3+1],c=t[n*3],f=t[n*3+1];return[[a,i],[s,o],[c,f]]}function j3(t,e,r,n,a){let i=t[e*3],s=t[e*3+1],o=t[e*3+2],c=t[r*3],f=t[r*3+1],l=t[r*3+2],u=t[n*3],g=t[n*3+1],p=t[n*3+2],d=t[a*3],h=t[a*3+1],v=t[a*3+2];return Math.abs(s-f)<Math.abs(i-c)?[[i,1-o],[c,1-l],[u,1-p],[d,1-v]]:[[s,1-o],[f,1-l],[g,1-p],[h,1-v]]}function xu(){let t=[],e=[0,0];return{curves:t,currentPoint:e,holes:[],moveTo(n,a){e[0]=n,e[1]=a},lineTo(n,a){let i=[...e],s=[n,a];t.push({curveType:"LineCurve",start:i,end:s,getPointAt(o){return[i[0]+o*(s[0]-i[0]),i[1]+o*(s[1]-i[1])]},getPoints(o){let c=[];for(let f=0;f<=o;f++)c.push(this.getPointAt(f/o));return c}}),e[0]=n,e[1]=a},quadraticCurveTo(n,a,i,s){let o=[...e],c=[i,s],f=[n,a];t.push({curveType:"QuadraticBezierCurve",cp:f,start:o,end:c,getPointAt(l){let u=1-l;return[u*u*o[0]+2*u*l*f[0]+l*l*c[0],u*u*o[1]+2*u*l*f[1]+l*l*c[1]]},getPoints(l){let u=[];for(let g=0;g<=l;g++)u.push(this.getPointAt(g/l));return u}}),e[0]=i,e[1]=s},bezierCurveTo(n,a,i,s,o,c){let f=[...e],l=[o,c],u=[n,a],g=[i,s];t.push({curveType:"BezierCurve",cp1:u,cp2:g,start:f,end:l,getPointAt(p){let d=1-p;return[d*d*d*f[0]+3*d*d*p*u[0]+3*d*p*p*g[0]+p*p*p*l[0],d*d*d*f[1]+3*d*d*p*u[1]+3*d*p*p*g[1]+p*p*p*l[1]]},getPoints(p){let d=[];for(let h=0;h<=p;h++)d.push(this.getPointAt(h/p));return d}}),e[0]=o,e[1]=c},getPoints(n){let a,i=[];for(let s=0;s<t.length;s++){let o=t[s],c=n;o.curveType==="EllipseCurve"?c=n*2:o.curveType==="LineCurve"&&(c=1);let f=o.getPoints(c);for(let l=0;l<f.length;l++){let u=f[l];a&&Ua(a,u)||(i.push(u),a=u)}}return i},extractPoints(n){let a=this.getPoints(n),i=this.holes.map(s=>s.getPoints(n));return{shape:a,holes:i}},isPointInside(n,a){let i=n[0],s=n[1],o=!1;for(let c=0,f=a.length-1;c<a.length;f=c++){let l=a[c][0],u=a[c][1],g=a[f][0],p=a[f][1];u>s!=p>s&&i<(g-l)*(s-u)/(p-u)+l&&(o=!o)}return o},isIntersect(n){let a=this.getPoints(1,t,!1),i=n.getPoints(1);return this.isPointInside(i[0],a)}}}function _m(t,e,r){let n=[1/0,1/0,e>0?0:e],a=[-1/0,-1/0,e<0?0:e];for(let i=0;i<t.length;i++){let o=t[i].extractPoints(r);for(let c=0;c<o.shape.length;c++){let f=o.shape[c];f[0]<n[0]&&(n[0]=f[0]),f[1]<n[1]&&(n[1]=f[1]),f[0]>a[0]&&(a[0]=f[0]),f[1]>a[1]&&(a[1]=f[1])}}return{min:n,max:a}}function Bm(t){let e=t.length,r=Ua(t[e-1],t[0]);e>2&&r&&t.pop()}function Wm(t){let e=0,r=t.length;for(let n=r-1,a=0;a<r;n=a++)e+=t[n][0]*t[a][1]-t[a][0]*t[n][1];return e*.5<0}function yu(t,e,r){let n=t[0]-e[0],a=t[1]-e[1],i=r[0]-t[0],s=r[1]-t[1],o=n*s-a*i,c,f,l;if(Math.abs(o)>Number.EPSILON){let u=Math.hypot(n,a),g=Math.hypot(i,s),p=e[0]-a/u,d=e[1]+n/u,h=r[0]-s/g,v=r[1]+i/g,x=((h-p)*s-(v-d)*i)/(n*s-a*i);c=p+n*x-t[0],f=d+a*x-t[1];let T=c*c+f*f;if(T<=2)return[c,f];l=Math.sqrt(T/2)}else n>0&&i>0||n<0&&i<0||Math.sign(a)===Math.sign(s)?(c=-a,f=n,l=Math.hypot(n,a)):(c=n,f=a,l=Math.sqrt((n*n+a*a)/2));return[c/l,f/l]}function zm(t,e,r){let n=[],a=[],i=[];Bm(e);for(let c=0;c<e.length;c++)a.push(e[c][0],e[c][1]);let s=e.length;r.forEach(Bm);for(let c=0;c<r.length;c++){i.push(s);let f=r[c];s+=f.length;for(let l=0;l<f.length;l++)a.push(f[l][0],f[l][1])}let o=t(a,i);for(let c=0;c<o.length;c+=3)n.push(o.slice(c,c+3));return n}function Wn(t,e,r){let n=[t[0],t[1]];return n[0]+=e[0]*r,n[1]+=e[1]*r,n}function mo(t,e,r,n,a,i,s,o){[e,n,r].forEach(u=>{a.push(t[u*3],t[u*3+1],t[u*3+2])});let f=a.length/3;if(I3(a,f-3,f-2,f-1).forEach(u=>{i.push(u[0],u[1])}),s&&o)for(let u=0;u<3;++u)s.push(o[0]*255,o[1]*255,o[2]*255)}function K3(t,e,r,n,a,i,s,o,c){[e,a,r,r,a,n].forEach(g=>i.push(t[g*3],t[g*3+1],t[g*3+2]));let l=i.length/3,u=j3(i,l-6,l-3,l-2,l-1);if(s.push(u[0][0],u[0][1]),s.push(u[1][0],u[1][1]),s.push(u[3][0],u[3][1]),s.push(u[1][0],u[1][1]),s.push(u[2][0],u[2][1]),s.push(u[3][0],u[3][1]),o&&c)for(let g=0;g<6;++g)o.push(c[0]*255,c[1]*255,c[2]*255)}function Am(t,e,r,n,a,i,s,o,c,f){if(a){let l=0,u=r*l;e.forEach(g=>{let[p,d,h]=g;mo(t,h+u,d+u,p+u,s,o,c,f)}),l=n+i*2,u=r*l,e.forEach(g=>{let[p,d,h]=g;mo(t,p+u,d+u,h+u,s,o,c,f)})}else{e.forEach(u=>{let[g,p,d]=u;mo(t,d,p,g,s,o,c,f)});let l=r*n;e.forEach(u=>{let[g,p,d]=u;mo(t,g+l,p+l,d+l,s,o,c,f)})}}function Gm(t,e,r,n,a,i,s,o,c,f){let l=a+i*2;for(let u=0;u<e.length;u++){let g=u,p=u===0?e.length-1:u-1;for(let d=0;d<l;d++){let h=n*d,v=n*(d+1),x=r+g+h,T=r+p+h,m=r+p+v,y=r+g+v;K3(t,x,T,m,y,s,o,c,f)}}}function Pm(t,e,r,n,a,i,s,o,c,f){let l=0;Gm(t,e,l,n,a,i,s,o,c,f),l+=e.length;for(let u=0;u<r.length;u++){let g=r[u];Gm(t,g,l,n,a,i,s,o,c,f),l+=g.length}}var{vtkErrorMacro:Hm,vtkWarningMacro:$3}=w;function X3(t,e){e.classHierarchy.push("vtkVectorText");function r(i,s,o){let c=e.curveSegments,f=e.steps,l=e.depth,u=e.bevelEnabled,g=e.bevelThickness,p=g-.1,d=e.bevelOffset,h=e.bevelSegments;u||(h=0,g=0,p=0,d=0);let v=i.extractPoints(c),x=v.shape,T=v.holes;if(x.forEach(b=>{b[0]+=s[0],b[1]+=s[1]}),T.forEach(b=>{b.forEach(R=>{R[0]+=s[0],R[1]+=s[1]})}),x.length<3){$3("Not enough points to create a shape");return}let m=zm(e.earcut,x,T),y=x;x=[...x,...T.flat()];let S=x.length,C=[];for(let b=0,R=y.length-1,M=b+1;b<y.length;b++,R++,M++)R===y.length&&(R=0),M===y.length&&(M=0),C[b]=yu(y[b],y[R],y[M]);let E=[],O,U=[...C];for(let b=0,R=T.length;b<R;b++){let M=T[b];O=[];for(let N=0,L=M.length-1,B=N+1;N<M.length;N++,L++,B++)L===M.length&&(L=0),B===M.length&&(B=0),O[N]=yu(M[N],M[L],M[B]);E.push(O),U=[...U,...O]}let k=[];for(let b=0;b<h;b++){let R=b/h,M=g*Math.cos(R*Math.PI/2),N=p*Math.sin(R*Math.PI/2)+d;for(let L=0;L<y.length;L++){let B=Wn(y[L],C[L],N);k.push(B[0],B[1],-M+s[2])}for(let L=0,B=T.length;L<B;L++){let G=T[L];O=E[L];for(let F=0;F<G.length;F++){let _=Wn(G[F],O[F],N);k.push(_[0],_[1],-M+s[2])}}}let V=p+d;for(let b=0;b<S;b++){let R=u?Wn(x[b],U[b],V):x[b];k.push(R[0],R[1],0+s[2])}for(let b=1;b<=f;b++)for(let R=0;R<S;R++){let M=u?Wn(x[R],U[R],V):x[R];k.push(M[0],M[1],l/f*b+s[2])}for(let b=h-1;b>=0;b--){let R=b/h,M=g*Math.cos(R*Math.PI/2),N=p*Math.sin(R*Math.PI/2)+d;for(let L=0,B=y.length;L<B;L++){let G=Wn(y[L],C[L],N);k.push(G[0],G[1],l+M+s[2])}for(let L=0,B=T.length;L<B;L++){let G=T[L];O=E[L];for(let F=0,_=G.length;F<_;F++){let W=Wn(G[F],O[F],N);k.push(W[0],W[1],l+M+s[2])}}}Am(k,m,S,f,u,h,e.verticesArray,e.uvArray,e.colorArray,o),Pm(k,y,T,S,f,h,e.verticesArray,e.uvArray,e.colorArray,o)}function n(){if(e.shapes=[],!e.font||!e.text)return;let i=e.font.getPath(e.text,0,0,e.fontSize);if(!i||!i.commands||!i.commands.length)return;let s,o=xu(),c=i.commands;for(let f=0;f<c.length;f++){let l=c[f];switch(o=o||xu(),l.type){case"M":o.moveTo(l.x,-l.y),s=l;break;case"L":o.lineTo(l.x,-l.y);break;case"C":o.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y);break;case"Q":o.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"Z":if(o.lineTo(s.x,-s.y),Wm(o.getPoints(1)))e.shapes.push(o);else for(let u=0;u<e.shapes.length;u++){let g=e.shapes[u];if(g.isIntersect(o)){g.holes.push(o);break}}o=null;break;default:console.warn(`Unknown path command: ${l.type}`);break}}o&&e.shapes.push(o)}function a(i){e.verticesArray=[],e.uvArray=[],e.colorArray=[];let s=Qt.newInstance(),o=i.getPointData(),c=_m(e.shapes,e.depth,e.curveSegments),f=[0,0,0];Be(c.min,c.max,f);let l=0;e.shapes.forEach(h=>{let v=null;e.perLetterFaceColors&&(v=e.perLetterFaceColors(l)||[1,1,1]),r(h,f,v),l++});let u=e.verticesArray.length/3,g=[];for(let h=0;h<u;h+=3)g.push(h,h+2,h+1);let p=g.length;s.resize(p+p/3);for(let h=0;h<g.length;h+=3)s.insertNextCell([g[h],g[h+1],g[h+2]]);i.setPolys(s),i.getPoints().setData(Float32Array.from(e.verticesArray),3);let d=K.newInstance({numberOfComponents:2,values:Float32Array.from(e.uvArray),name:"TEXCOORD_0"});if(o.addArray(d),o.setActiveTCoords(d.getName()),e.colorArray&&e.colorArray.length){let h=K.newInstance({numberOfComponents:3,values:Uint8Array.from(e.colorArray),name:"Colors"});o.addArray(h),o.setActiveScalars(h.getName())}return i}t.requestData=(i,s)=>{if(!e.font){Hm("Font object not set, make sure the TTF file is parsed using opentype.js.");return}if(!e.text){Hm("Text not set. Cannot generate vector text.");return}n();let o=s[0]?.initialize()||Re.newInstance();a(o),s[0]=o}}var Y3={shapes:[],verticesArray:[],uvArray:[],font:null,earcut:null,fontSize:10,depth:1,steps:1,bevelEnabled:!1,curveSegments:12,bevelThickness:.2,bevelSize:.1,bevelOffset:0,bevelSegments:1,text:null,perLetterFaceColors:null};function Im(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y3,r),w.obj(t,e),w.algo(t,e,0,1),w.setGet(t,e,["fontSize","text","depth","steps","bevelEnabled","curveSegments","bevelThickness","bevelSize","bevelOffset","bevelSegments","perLetterFaceColors"]),w.set(t,e,["font"]),X3(t,e)}var q3=w.newInstance(Im,"vtkVectorText"),jm={newInstance:q3,extend:Im};var Z3=class extends String{constructor(t,e,r){let n=new Uint32Array(t,e,r),a=Array.from(n),i=String.fromCodePoint(...a);super(i)}},Q3=new TextDecoder("latin1");function J3(t){let e=new DataView(t);if(String.fromCharCode(e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3),e.getUint8(4),e.getUint8(5))!=="\x93NUMPY")throw new Error("Not an .npy file");let n=e.getUint8(6),a=e.getUint8(7),i;return n<=1?(i=e.getUint16(8,!0),{headerOffset:10,headerLen:i,version:[n,a]}):(i=Number(e.getUint32(8,!0)),{headerOffset:12,headerLen:i,version:[n,a]})}function eN(t){let e=/'descr'\s*:\s*'([^']+)'/.exec(t)?.[1],r=/'fortran_order'\s*:\s*(True|False)/.exec(t)?.[1]==="True",a=(/'shape'\s*:\s*\(([^)]*)\)/.exec(t)?.[1]??"").split(",").map(i=>i.trim()).filter(Boolean).map(i=>Number(i));return a.length===1&&t.includes("(n,)"),{dtype:e,fortranOrder:r,shape:a}}function tN(t,e,r,n){let a=t.startsWith("<")||t.startsWith("|"),i=t.substring(t.length-2);if(i[0]==="U"){let s=parseInt(i.substring(1)),o=String(new Z3(e,r)),c=[];for(let f=0;f<o.length;f+=s)c.push(o.substring(f,f+s).replace(/\0/g,""));return c}switch(i){case"b1":if(a){let s=new Uint8Array(e,r),o=new Array(s.length);for(let c=0;c<s.length;c++)o[c]=s[c]!==0;return o}else return new Uint8Array(e,r);case"i1":return new Int8Array(e,r);case"u1":return new Uint8Array(e,r);case"i2":return new Int16Array(e,r);case"u2":return new Uint16Array(e,r);case"i4":return new Int32Array(e,r);case"u4":return new Uint32Array(e,r);case"i8":return new BigInt64Array(e,r);case"u8":return new BigUint64Array(e,r);case"f4":return new Float32Array(e,r);case"f8":return new Float64Array(e,r);case"f2":{if(n.convertFloat16!==!1){let s=new Uint16Array(e,r),o=new Float32Array(s.length);for(let c=0;c<s.length;c++)o[c]=Km(s[c]);return o}return new Uint16Array(e,r)}default:throw new Error(`Unsupported dtype: ${t}`)}}function Km(t){let e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r===31?n?NaN:e?-1/0:1/0:(e?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}async function rN(t,e={}){let r;typeof t=="string"?r=await(await fetch(t)).arrayBuffer():t instanceof ArrayBuffer?r=t:t instanceof Blob?r=await t.arrayBuffer():r=t.buffer;let{headerOffset:n,headerLen:a}=J3(r),i=new Uint8Array(r,n,a),s=Q3.decode(i).trim(),{dtype:o,fortranOrder:c,shape:f}=eN(s);if(!o||!f)throw new Error("Malformed .npy header");let l=n+a;return{data:tN(o,r,l,e),shape:f,dtype:o.slice(1),fortranOrder:c}}function nN(t){if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return"u1";if(t instanceof Int8Array)return"i1";if(t instanceof Uint16Array)return"u2";if(t instanceof Int16Array)return"i2";if(t instanceof Uint32Array)return"u4";if(t instanceof Int32Array)return"i4";if(t instanceof Float32Array)return"f4";if(t instanceof BigUint64Array)return"u8";if(t instanceof BigInt64Array)return"i8";if(t instanceof Float64Array)return"f8";let e=typeof t=="object"?t?.constructor?.name:typeof t;throw new TypeError(`Unsupported dtype for ${e}`)}function aN(t,e){if(!Array.isArray(e))throw new TypeError("Expected an array");if(t.startsWith("U")){let r=parseInt(t.substring(1)),n=new ArrayBuffer(e.length*r*4),a=new Uint32Array(n);for(let i=0;i<e.length;i++){let s=e[i];for(let o=0;o<r;o++){let c=o<s.length?s.codePointAt(o)??0:0;a[i*r+o]=c}}return new Uint8Array(n)}switch(t){case"b1":return new Uint8Array(e);case"i1":return new Int8Array(e);case"u1":return new Uint8Array(e);case"i2":return new Int16Array(e);case"u2":return new Uint16Array(e);case"i4":return new Int32Array(e);case"u4":return new Uint32Array(e);case"i8":return new BigInt64Array(e);case"u8":return new BigUint64Array(e);case"f4":return new Float32Array(e);case"f8":return new Float64Array(e);default:throw new Error(`Unsupported dtype: ${t}`)}}function iN(t){let e=t[0].length;for(let r=1;r<t.length;r++){let n=t[r];typeof n=="string"&&n.length>e&&(e=n.length)}return`U${Math.max(1,e)}`}function sN(t){let e=!0,r=!0,n=0;for(let a of t){Number.isInteger(a)||(e=!1),a<0&&(r=!1);let i=Math.abs(a);i>n&&(n=i)}return e?r?n<=255?"u1":n<=65535?"u2":n<=4294967295?"u4":"u8":n<=127?"i1":n<=32767?"i2":n<=2147483647?"i4":"i8":n<=340282347e30?"f4":"f8"}function $m(t){if(t.length===0)return"f8";let e=t[0];if(typeof e=="number")return sN(t);if(typeof e=="string")return iN(t);if(Array.isArray(e))return $m(e);if(typeof e=="boolean")return"b1";throw new TypeError("Array elements must be numbers, strings or booleans")}function oN(){return new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}function cN(t,e){let a=`${t=="u1"||t=="i1"?"|":oN()?"<":">"}${t}`,i=e.map(s=>`${s}`).join(",");return e.length===1&&(i+=","),`{'descr':'${a}','fortran_order':False,'shape':(${i})}`}function fN(t,e){let r=t instanceof Array?$m(t):nN(t);t=t instanceof Array?aN(r,t):t;let n=cN(r,e??[t.length]),a=10+n.length,i=8-(a+1)%8;n=n+" ".repeat(i)+`
`,a+=i+1;let s=new ArrayBuffer(a+t.byteLength),o=new DataView(s);o.setUint32(0,2471384397,!1),o.setUint32(4,1348010240,!1),o.setUint16(8,n.length,!0);let c=new TextEncoder,f=new Uint8Array(s,10,n.length);return c.encodeInto(n,f),new Uint8Array(s,10+n.length).set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s}var Xm=class{constructor(t={}){this.opts=t}async load(t){return rN(t,this.opts)}static float16ToFloat32(t){return Km(t)}dump(t,e){return fN(t,e)}};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,a=n(r,r,r)&&n}catch{}return a})(),e=function(r){if(this==null)throw TypeError();var n=String(this),a=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=a)){var s=n.charCodeAt(i),o;return s>=55296&&s<=56319&&a>i+1&&(o=n.charCodeAt(i+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var Wu=0,Ux=-3;function gi(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function uN(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new gi,this.dtree=new gi}var Nx=new gi,Bx=new gi,zu=new Uint8Array(30),Au=new Uint16Array(30),Gx=new Uint8Array(30),_x=new Uint16Array(30),lN=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ym=new gi,cr=new Uint8Array(320);function Wx(t,e,r,n){var a,i;for(a=0;a<r;++a)t[a]=0;for(a=0;a<30-r;++a)t[a+r]=a/r|0;for(i=n,a=0;a<30;++a)e[a]=i,i+=1<<t[a]}function gN(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var qm=new Uint16Array(16);function Su(t,e,r,n){var a,i;for(a=0;a<16;++a)t.table[a]=0;for(a=0;a<n;++a)t.table[e[r+a]]++;for(t.table[0]=0,i=0,a=0;a<16;++a)qm[a]=i,i+=t.table[a];for(a=0;a<n;++a)e[r+a]&&(t.trans[qm[e[r+a]]++]=a)}function pN(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=t.tag&1;return t.tag>>>=1,e}function fr(t,e,r){if(!e)return r;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,n+r}function Vu(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var r=0,n=0,a=0,i=t.tag;do n=2*n+(i&1),i>>>=1,++a,r+=e.table[a],n-=e.table[a];while(n>=0);return t.tag=i,t.bitcount-=a,e.trans[r+n]}function hN(t,e,r){var n,a,i,s,o,c;for(n=fr(t,5,257),a=fr(t,5,1),i=fr(t,4,4),s=0;s<19;++s)cr[s]=0;for(s=0;s<i;++s){var f=fr(t,3,0);cr[lN[s]]=f}for(Su(Ym,cr,0,19),o=0;o<n+a;){var l=Vu(t,Ym);switch(l){case 16:var u=cr[o-1];for(c=fr(t,2,3);c;--c)cr[o++]=u;break;case 17:for(c=fr(t,3,3);c;--c)cr[o++]=0;break;case 18:for(c=fr(t,7,11);c;--c)cr[o++]=0;break;default:cr[o++]=l;break}}Su(e,cr,0,n),Su(r,cr,n,a)}function Zm(t,e,r){for(;;){var n=Vu(t,e);if(n===256)return Wu;if(n<256)t.dest[t.destLen++]=n;else{var a,i,s,o;for(n-=257,a=fr(t,zu[n],Au[n]),i=Vu(t,r),s=t.destLen-fr(t,Gx[i],_x[i]),o=s;o<s+a;++o)t.dest[t.destLen++]=t.dest[o]}}}function dN(t){for(var e,r,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if(e=t.source[t.sourceIndex+1],e=256*e+t.source[t.sourceIndex],r=t.source[t.sourceIndex+3],r=256*r+t.source[t.sourceIndex+2],e!==(~r&65535))return Ux;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,Wu}function vN(t,e){var r=new uN(t,e),n,a,i;do{switch(n=pN(r),a=fr(r,2,0),a){case 0:i=dN(r);break;case 1:i=Zm(r,Nx,Bx);break;case 2:hN(r,r.ltree,r.dtree),i=Zm(r,r.ltree,r.dtree);break;default:i=Ux}if(i!==Wu)throw new Error("Data error")}while(!n);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}gN(Nx,Bx);Wx(zu,Au,4,3);Wx(Gx,_x,2,1);zu[28]=0;Au[28]=258;var mN=vN;function Ta(t,e,r,n,a){return Math.pow(1-a,3)*t+3*Math.pow(1-a,2)*a*e+3*(1-a)*Math.pow(a,2)*r+Math.pow(a,3)*n}function cn(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}cn.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};cn.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};cn.prototype.addX=function(t){this.addPoint(t,null)};cn.prototype.addY=function(t){this.addPoint(null,t)};cn.prototype.addBezier=function(t,e,r,n,a,i,s,o){var c=[t,e],f=[r,n],l=[a,i],u=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var g=0;g<=1;g++){var p=6*c[g]-12*f[g]+6*l[g],d=-3*c[g]+9*f[g]-9*l[g]+3*u[g],h=3*f[g]-3*c[g];if(d===0){if(p===0)continue;var v=-h/p;0<v&&v<1&&(g===0&&this.addX(Ta(c[g],f[g],l[g],u[g],v)),g===1&&this.addY(Ta(c[g],f[g],l[g],u[g],v)));continue}var x=Math.pow(p,2)-4*h*d;if(!(x<0)){var T=(-p+Math.sqrt(x))/(2*d);0<T&&T<1&&(g===0&&this.addX(Ta(c[g],f[g],l[g],u[g],T)),g===1&&this.addY(Ta(c[g],f[g],l[g],u[g],T)));var m=(-p-Math.sqrt(x))/(2*d);0<m&&m<1&&(g===0&&this.addX(Ta(c[g],f[g],l[g],u[g],m)),g===1&&this.addY(Ta(c[g],f[g],l[g],u[g],m)))}}};cn.prototype.addQuad=function(t,e,r,n,a,i){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),c=s+1/3*(a-t),f=o+1/3*(i-e);this.addBezier(t,e,s,o,c,f,a,i)};function Je(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Je.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};Je.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};Je.prototype.curveTo=Je.prototype.bezierCurveTo=function(t,e,r,n,a,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:a,y:i})};Je.prototype.quadTo=Je.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};Je.prototype.close=Je.prototype.closePath=function(){this.commands.push({type:"Z"})};Je.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof cn){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};Je.prototype.getBoundingBox=function(){for(var t=new cn,e=0,r=0,n=0,a=0,i=0;i<this.commands.length;i++){var s=this.commands[i];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=a=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,a=s.y;break;case"Q":t.addQuad(n,a,s.x1,s.y1,s.x,s.y),n=s.x,a=s.y;break;case"C":t.addBezier(n,a,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,a=s.y;break;case"Z":n=e,a=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};Je.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};Je.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",c=0;c<arguments.length;c+=1){var f=s[c];f>=0&&c>0&&(o+=" "),o+=e(f)}return o}for(var n="",a=0;a<this.commands.length;a+=1){var i=this.commands[a];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};Je.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Je.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function zx(t){throw new Error(t)}function Qm(t,e){t||zx(e)}var oe={fail:zx,argument:Qm,assert:Qm},Jm=32768,ex=2147483648,Ca={},j={},fe={};function Yt(t){return function(){return t}}j.BYTE=function(t){return oe.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};fe.BYTE=Yt(1);j.CHAR=function(t){return[t.charCodeAt(0)]};fe.CHAR=Yt(1);j.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};fe.CHARARRAY=function(t){return typeof t>"u"?0:t.length};j.USHORT=function(t){return[t>>8&255,t&255]};fe.USHORT=Yt(2);j.SHORT=function(t){return t>=Jm&&(t=-(2*Jm-t)),[t>>8&255,t&255]};fe.SHORT=Yt(2);j.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};fe.UINT24=Yt(3);j.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};fe.ULONG=Yt(4);j.LONG=function(t){return t>=ex&&(t=-(2*ex-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};fe.LONG=Yt(4);j.FIXED=j.ULONG;fe.FIXED=fe.ULONG;j.FWORD=j.SHORT;fe.FWORD=fe.SHORT;j.UFWORD=j.USHORT;fe.UFWORD=fe.USHORT;j.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};fe.LONGDATETIME=Yt(8);j.TAG=function(t){return oe.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};fe.TAG=Yt(4);j.Card8=j.BYTE;fe.Card8=fe.BYTE;j.Card16=j.USHORT;fe.Card16=fe.USHORT;j.OffSize=j.BYTE;fe.OffSize=fe.BYTE;j.SID=j.USHORT;fe.SID=fe.USHORT;j.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?j.NUMBER16(t):j.NUMBER32(t)};fe.NUMBER=function(t){return j.NUMBER(t).length};j.NUMBER16=function(t){return[28,t>>8&255,t&255]};fe.NUMBER16=Yt(3);j.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};fe.NUMBER32=Yt(5);j.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var a="",i=0,s=e.length;i<s;i+=1){var o=e[i];o==="e"?a+=e[++i]==="-"?"c":"b":o==="."?a+="a":o==="-"?a+="e":a+=o}a+=a.length&1?"f":"ff";for(var c=[30],f=0,l=a.length;f<l;f+=2)c.push(parseInt(a.substr(f,2),16));return c};fe.REAL=function(t){return j.REAL(t).length};j.NAME=j.CHARARRAY;fe.NAME=fe.CHARARRAY;j.STRING=j.CHARARRAY;fe.STRING=fe.CHARARRAY;Ca.UTF8=function(t,e,r){for(var n=[],a=r,i=0;i<a;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Ca.UTF16=function(t,e,r){for(var n=[],a=r/2,i=0;i<a;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};j.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};fe.UTF16=function(t){return t.length*2};var Fu={"x-mac-croatian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u03A9\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uF8FF\xA9\u2044\u20AC\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E","x-mac-gaelic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u1E02\xB1\u2264\u2265\u1E03\u010A\u010B\u1E0A\u1E0B\u1E1E\u1E1F\u0120\u0121\u1E40\xE6\xF8\u1E41\u1E56\u1E57\u027C\u0192\u017F\u1E60\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\u1E61\u1E9B\xFF\u0178\u1E6A\u20AC\u2039\u203A\u0176\u0177\u1E6B\xB7\u1EF2\u1EF3\u204A\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u2663\xD2\xDA\xDB\xD9\u0131\xDD\xFD\u0174\u0175\u1E84\u1E85\u1E80\u1E81\u1E82\u1E83","x-mac-greek":"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\u20AC\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\xB7\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\xAD","x-mac-icelandic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140A\u140B\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144E\u144F\u1450\u1451\u1455\u1456\u1466\u146D\u146E\u146F\u1470\u1472\u1473\u1483\u148B\u148C\u148D\u148E\u1490\u1491\xB0\u14A1\u14A5\u14A6\u2022\xB6\u14A7\xAE\xA9\u2122\u14A8\u14AA\u14AB\u14BB\u14C2\u14C3\u14C4\u14C5\u14C7\u14C8\u14D0\u14EF\u14F0\u14F1\u14F2\u14F4\u14F5\u1505\u14D5\u14D6\u14D7\u14D8\u14DA\u14DB\u14EA\u1528\u1529\u152A\u152B\u152D\u2026\xA0\u152E\u153E\u1555\u1556\u1557\u2013\u2014\u201C\u201D\u2018\u2019\u1558\u1559\u155A\u155D\u1546\u1547\u1548\u1549\u154B\u154C\u1550\u157F\u1580\u1581\u1582\u1583\u1584\u1585\u158F\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15A0\u15A1\u15A2\u15A3\u15A4\u15A5\u15A6\u157C\u0141\u0142","x-mac-ce":"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7",macintosh:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-romanian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u0218\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\u0103\u0219\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\u021A\u021B\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-turkish":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\uF8A0\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"};Ca.MACSTRING=function(t,e,r,n){var a=Fu[n];if(a!==void 0){for(var i="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?i+=String.fromCharCode(o):i+=a[o&127]}return i}};var xo=typeof WeakMap=="function"&&new WeakMap,yo,xN=function(t){if(!yo){yo={};for(var e in Fu)yo[e]=new String(e)}var r=yo[t];if(r!==void 0){if(xo){var n=xo.get(r);if(n!==void 0)return n}var a=Fu[t];if(a!==void 0){for(var i={},s=0;s<a.length;s++)i[a.charCodeAt(s)]=s+128;return xo&&xo.set(r,i),i}}};j.MACSTRING=function(t,e){var r=xN(e);if(r!==void 0){for(var n=[],a=0;a<t.length;a++){var i=t.charCodeAt(a);if(i>=128&&(i=r[i],i===void 0))return;n[a]=i}return n}};fe.MACSTRING=function(t,e){var r=j.MACSTRING(t,e);return r!==void 0?r.length:0};function ku(t){return t>=-128&&t<=127}function yN(t,e,r){for(var n=0,a=t.length;e<a&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function TN(t,e,r){for(var n=0,a=t.length,i=e;i<a&&n<64;){var s=t[i];if(!ku(s)||s===0&&i+1<a&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var o=e;o<i;++o)r.push(t[o]+256&255);return i}function SN(t,e,r){for(var n=0,a=t.length,i=e;i<a&&n<64;){var s=t[i];if(s===0||ku(s)&&i+1<a&&ku(t[i+1]))break;++i,++n}r.push(64|n-1);for(var o=e;o<i;++o){var c=t[o];r.push(c+65536>>8&255,c+256&255)}return i}j.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=yN(t,e,r):n>=-128&&n<=127?e=TN(t,e,r):e=SN(t,e,r)}return r};j.INDEX=function(t){for(var e=1,r=[e],n=[],a=0;a<t.length;a+=1){var i=j.OBJECT(t[a]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,j.BYTE,j.USHORT,j.UINT24,j.ULONG][o],f=0;f<r.length;f+=1){var l=c(r[f]);Array.prototype.push.apply(s,l)}return Array.prototype.concat(j.Card16(t.length),j.OffSize(o),s,n)};fe.INDEX=function(t){return j.INDEX(t).length};j.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,a=0;a<n;a+=1){var i=parseInt(r[a],0),s=t[i];e=e.concat(j.OPERAND(s.value,s.type)),e=e.concat(j.OPERATOR(i))}return e};fe.DICT=function(t){return j.DICT(t).length};j.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};j.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)oe.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(j.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(j.NUMBER(t));else if(e==="offset")r=r.concat(j.NUMBER32(t));else if(e==="number")r=r.concat(j.NUMBER(t));else if(e==="real")r=r.concat(j.REAL(t));else throw new Error("Unknown operand type "+e);return r};j.OP=j.BYTE;fe.OP=fe.BYTE;var To=typeof WeakMap=="function"&&new WeakMap;j.CHARSTRING=function(t){if(To){var e=To.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,a=0;a<n;a+=1){var i=t[a];r=r.concat(j[i.type](i.value))}return To&&To.set(t,r),r};fe.CHARSTRING=function(t){return j.CHARSTRING(t).length};j.OBJECT=function(t){var e=j[t.type];return oe.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};fe.OBJECT=function(t){var e=fe[t.type];return oe.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};j.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],a=[],i=0;i<r;i+=1){var s=t.fields[i],o=j[s.type];oe.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var c=t[s.name];c===void 0&&(c=s.value);var f=o(c);s.type==="TABLE"?(a.push(e.length),e=e.concat([0,0]),n.push(f)):e=e.concat(f)}for(var l=0;l<n.length;l+=1){var u=a[l],g=e.length;oe.argument(g<65536,"Table "+t.tableName+" too big."),e[u]=g>>8,e[u+1]=g&255,e=e.concat(n[l])}return e};fe.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var a=t.fields[n],i=fe[a.type];oe.argument(i!==void 0,"No sizeOf function for field type "+a.type+" ("+a.name+")");var s=t[a.name];s===void 0&&(s=a.value),e+=i(s),a.type==="TABLE"&&(e+=2)}return e};j.RECORD=j.TABLE;fe.RECORD=fe.TABLE;j.LITERAL=function(t){return t};fe.LITERAL=function(t){return t.length};function it(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var a=e[n];this[a.name]=a.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),s=0;s<i.length;s+=1){var o=i[s],c=r[o];this[o]!==void 0&&(this[o]=c)}}it.prototype.encode=function(){return j.TABLE(this)};it.prototype.sizeOf=function(){return fe.TABLE(this)};function pi(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var a=0;a<e.length;a++)n[a+1]={name:t+a,type:"USHORT",value:e[a]};return n}function bu(t,e,r){var n=e.length,a=new Array(n+1);a[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)a[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return a}function hi(t,e,r){var n=e.length,a=[];a[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)a=a.concat(r(e[i],i));return a}function Eo(t){t.format===1?it.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(pi("glyph",t.glyphs))):t.format===2?it.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(hi("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):oe.assert(!1,"Coverage format must be 1 or 2.")}Eo.prototype=Object.create(it.prototype);Eo.prototype.constructor=Eo;function Mo(t){it.call(this,"scriptListTable",hi("scriptRecord",t,function(e,r){var n=e.script,a=n.defaultLangSys;return oe.assert(!!a,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new it("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new it("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(pi("featureIndex",a.featureIndexes)))}].concat(hi("langSys",n.langSysRecords,function(i,s){var o=i.langSys;return[{name:"langSysTag"+s,type:"TAG",value:i.tag},{name:"langSys"+s,type:"TABLE",value:new it("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(pi("featureIndex",o.featureIndexes)))}]})))}]}))}Mo.prototype=Object.create(it.prototype);Mo.prototype.constructor=Mo;function Ro(t){it.call(this,"featureListTable",hi("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new it("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(pi("lookupListIndex",n.lookupListIndexes)))}]}))}Ro.prototype=Object.create(it.prototype);Ro.prototype.constructor=Ro;function Do(t,e){it.call(this,"lookupListTable",bu("lookup",t,function(r){var n=e[r.lookupType];return oe.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new it("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(bu("subtable",r.subtables,n)))}))}Do.prototype=Object.create(it.prototype);Do.prototype.constructor=Do;var X={Table:it,Record:it,Coverage:Eo,ScriptList:Mo,FeatureList:Ro,LookupList:Do,ushortList:pi,tableList:bu,recordList:hi};function tx(t,e){return t.getUint8(e)}function Lo(t,e){return t.getUint16(e,!1)}function CN(t,e){return t.getInt16(e,!1)}function Pu(t,e){return t.getUint32(e,!1)}function Ax(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function wN(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function ON(t,e,r){for(var n=0,a=0;a<r;a+=1)n<<=8,n+=t.getUint8(e+a);return n}function EN(t,e,r){for(var n=[],a=e;a<r;a+=1)n.push(t.getUint8(a));return n}function MN(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var RN={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function A(t,e){this.data=t,this.offset=e,this.relativeOffset=0}A.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};A.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};A.prototype.parseCard8=A.prototype.parseByte;A.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};A.prototype.parseCard16=A.prototype.parseUShort;A.prototype.parseSID=A.prototype.parseUShort;A.prototype.parseOffset16=A.prototype.parseUShort;A.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};A.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};A.prototype.parseULong=function(){var t=Pu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};A.prototype.parseOffset32=A.prototype.parseULong;A.prototype.parseFixed=function(){var t=Ax(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};A.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var a=0;a<t;a++)n+=String.fromCharCode(e.getUint8(r+a));return n};A.prototype.parseTag=function(){return this.parseString(4)};A.prototype.parseLongDateTime=function(){var t=Pu(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};A.prototype.parseVersion=function(t){var e=Lo(this.data,this.offset+this.relativeOffset),r=Lo(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};A.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=RN[t]*e};A.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};A.prototype.parseOffset16List=A.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};A.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};A.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,a=0;a<t;a++)e[a]=r.getUint8(n++);return this.relativeOffset+=t,e};A.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};A.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};A.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),a=0;a<t;a++){for(var i={},s=0;s<n.length;s++){var o=n[s],c=e[o];i[o]=c.call(this)}r[a]=i}return r};A.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),a=0;a<t;a++){for(var i={},s=0;s<n.length;s++){var o=n[s],c=e[o];i[o]=c.call(this)}r[a]=i}return r};A.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var a=e[n],i=t[a];r[a]=i.call(this)}return r};A.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};A.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};A.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new A(this.data,this.offset+e).parseStruct(t)};A.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new A(this.data,this.offset+e).parseStruct(t)};A.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,a=new Array(r),i=0;i<r;i++){var s=e[i];if(s===0){a[i]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),c=new Array(o.length),f=0;f<o.length;f++)this.relativeOffset=s+o[f],c[f]=t.call(this);a[i]=c}else a[i]=this.parseUShortList()}return this.relativeOffset=n,a};A.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),a=0;a<r;a++)n[a]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};A.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:A.uShort,end:A.uShort,classId:A.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};A.list=function(t,e){return function(){return this.parseList(t,e)}};A.list32=function(t,e){return function(){return this.parseList32(t,e)}};A.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};A.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};A.pointer=function(t){return function(){return this.parsePointer(t)}};A.pointer32=function(t){return function(){return this.parsePointer32(t)}};A.tag=A.prototype.parseTag;A.byte=A.prototype.parseByte;A.uShort=A.offset16=A.prototype.parseUShort;A.uShortList=A.prototype.parseUShortList;A.uLong=A.offset32=A.prototype.parseULong;A.uLongList=A.prototype.parseULongList;A.struct=A.prototype.parseStruct;A.coverage=A.prototype.parseCoverage;A.classDef=A.prototype.parseClassDef;var rx={reserved:A.uShort,reqFeatureIndex:A.uShort,featureIndexes:A.uShortList};A.prototype.parseScriptList=function(){return this.parsePointer(A.recordList({tag:A.tag,script:A.pointer({defaultLangSys:A.pointer(rx),langSysRecords:A.recordList({tag:A.tag,langSys:A.pointer(rx)})})}))||[]};A.prototype.parseFeatureList=function(){return this.parsePointer(A.recordList({tag:A.tag,feature:A.pointer({featureParams:A.offset16,lookupListIndexes:A.uShortList})}))||[]};A.prototype.parseLookupList=function(t){return this.parsePointer(A.list(A.pointer(function(){var e=this.parseUShort();oe.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(A.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};A.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();oe.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:A.offset32,featureTableSubstitutionOffset:A.offset32});return r})||[]};var q={getByte:tx,getCard8:tx,getUShort:Lo,getCard16:Lo,getShort:CN,getULong:Pu,getFixed:Ax,getTag:wN,getOffset:ON,getBytes:EN,bytesToString:MN,Parser:A};function DN(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var a=e.parseULong(),i=e.parseULong(),s=e.parseULong(),o=a;o<=i;o+=1)t.glyphIndexMap[o]=s,s++}function LN(t,e,r,n,a){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new q.Parser(r,n+a+14),o=new q.Parser(r,n+a+16+i*2),c=new q.Parser(r,n+a+16+i*4),f=new q.Parser(r,n+a+16+i*6),l=n+a+16+i*8,u=0;u<i-1;u+=1)for(var g=void 0,p=s.parseUShort(),d=o.parseUShort(),h=c.parseShort(),v=f.parseUShort(),x=d;x<=p;x+=1)v!==0?(l=f.offset+f.relativeOffset-2,l+=v,l+=(x-d)*2,g=q.getUShort(r,l),g!==0&&(g=g+h&65535)):g=x+h&65535,t.glyphIndexMap[x]=g}function VN(t,e){var r={};r.version=q.getUShort(t,e),oe.argument(r.version===0,"cmap table version should be 0."),r.numTables=q.getUShort(t,e+2);for(var n=-1,a=r.numTables-1;a>=0;a-=1){var i=q.getUShort(t,e+4+a*8),s=q.getUShort(t,e+4+a*8+2);if(i===3&&(s===0||s===1||s===10)||i===0&&(s===0||s===1||s===2||s===3||s===4)){n=q.getULong(t,e+4+a*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new q.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)DN(r,o);else if(r.format===4)LN(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function FN(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function kN(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function bN(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var a=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(a=a.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),a=a.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new X.Table("cmap",a);for(i.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)FN(i,s.unicodes[o],r);i.segments=i.segments.sort(function(T,m){return T.start-m.start})}kN(i);var c=i.segments.length,f=0,l=[],u=[],g=[],p=[],d=[],h=[];for(r=0;r<c;r+=1){var v=i.segments[r];v.end<=65535&&v.start<=65535?(l=l.concat({name:"end_"+r,type:"USHORT",value:v.end}),u=u.concat({name:"start_"+r,type:"USHORT",value:v.start}),g=g.concat({name:"idDelta_"+r,type:"SHORT",value:v.delta}),p=p.concat({name:"idRangeOffset_"+r,type:"USHORT",value:v.offset}),v.glyphId!==void 0&&(d=d.concat({name:"glyph_"+r,type:"USHORT",value:v.glyphId}))):f+=1,!e&&v.glyphIndex!==void 0&&(h=h.concat({name:"cmap12Start_"+r,type:"ULONG",value:v.start}),h=h.concat({name:"cmap12End_"+r,type:"ULONG",value:v.end}),h=h.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:v.glyphIndex}))}if(i.segCountX2=(c-f)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-f)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(l),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(u),i.fields=i.fields.concat(g),i.fields=i.fields.concat(p),i.fields=i.fields.concat(d),i.cmap4Length=14+l.length*2+2+u.length*2+g.length*2+p.length*2+d.length*2,!e){var x=16+h.length*4;i.cmap12Offset=20+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:x},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:h.length/3}]),i.fields=i.fields.concat(h)}return i}var Px={parse:VN,make:bN},wo=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],UN=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],NN=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],An=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Hx(t){this.font=t}Hx.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var a=r.get(n),i=0;i<a.unicodes.length;i+=1)if(a.unicodes[i]===e)return n}return null};function Ix(t){this.cmap=t}Ix.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0};function Vo(t,e){this.encoding=t,this.charset=e}Vo.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Hu(t){switch(t.version){case 1:this.names=An.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<An.length?this.names[e]=An[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-An.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var r=0;r<t.numberOfGlyphs;r++)this.names[r]=An[r+t.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}Hu.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)};Hu.prototype.glyphIndexToName=function(t){return this.names[t]};function BN(t){for(var e,r=t.tables.cmap.glyphIndexMap,n=Object.keys(r),a=0;a<n.length;a+=1){var i=n[a],s=r[i];e=t.glyphs.get(s),e.addUnicode(parseInt(i))}for(var o=0;o<t.glyphs.length;o+=1)e=t.glyphs.get(o),t.cffEncoding?t.isCIDFont?e.name="gid"+o:e.name=t.cffEncoding.charset[o]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(o))}function GN(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,r=Object.keys(e),n=0;n<r.length;n+=1){var a=r[n],i=e[a];t._IndexToUnicodeMap[i]===void 0?t._IndexToUnicodeMap[i]={unicodes:[parseInt(a)]}:t._IndexToUnicodeMap[i].unicodes.push(parseInt(a))}}function _N(t,e){e.lowMemory?GN(t):BN(t)}function WN(t,e,r,n,a){t.beginPath(),t.moveTo(e,r),t.lineTo(n,a),t.stroke()}var zn={line:WN};function zN(t,e){var r=e||new Je;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Pt(t){this.bindConstructorValues(t)}Pt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",zN(this,t.path))};Pt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};Pt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Pt.prototype.getPath=function(t,e,r,n,a){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,s;n||(n={});var o=n.xScale,c=n.yScale;if(n.hinting&&a&&a.hinting&&(s=this.path&&a.hinting.exec(this,r)),s)i=a.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=c=1;else{i=this.path.commands;var f=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=f),c===void 0&&(c=f)}for(var l=new Je,u=0;u<i.length;u+=1){var g=i[u];g.type==="M"?l.moveTo(t+g.x*o,e+-g.y*c):g.type==="L"?l.lineTo(t+g.x*o,e+-g.y*c):g.type==="Q"?l.quadraticCurveTo(t+g.x1*o,e+-g.y1*c,t+g.x*o,e+-g.y*c):g.type==="C"?l.curveTo(t+g.x1*o,e+-g.y1*c,t+g.x2*o,e+-g.y2*c,t+g.x*o,e+-g.y*c):g.type==="Z"&&l.closePath()}return l};Pt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return oe.argument(e.length===0,"There are still points left in the current contour."),t};Pt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var a=t[n];a.type!=="Z"&&(e.push(a.x),r.push(a.y)),(a.type==="Q"||a.type==="C")&&(e.push(a.x1),r.push(a.y1)),a.type==="C"&&(e.push(a.x2),r.push(a.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};Pt.prototype.draw=function(t,e,r,n,a){this.getPath(e,r,n,a).draw(t)};Pt.prototype.drawPoints=function(t,e,r,n){function a(u,g,p,d){t.beginPath();for(var h=0;h<u.length;h+=1)t.moveTo(g+u[h].x*d,p+u[h].y*d),t.arc(g+u[h].x*d,p+u[h].y*d,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,s=[],o=[],c=this.path,f=0;f<c.commands.length;f+=1){var l=c.commands[f];l.x!==void 0&&s.push({x:l.x,y:-l.y}),l.x1!==void 0&&o.push({x:l.x1,y:-l.y1}),l.x2!==void 0&&o.push({x:l.x2,y:-l.y2})}t.fillStyle="blue",a(s,e,r,i),t.fillStyle="red",a(o,e,r,i)};Pt.prototype.drawMetrics=function(t,e,r,n){var a;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,a=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",zn.line(t,e,-1e4,e,1e4),zn.line(t,-1e4,r,1e4,r);var i=this.xMin||0,s=this.yMin||0,o=this.xMax||0,c=this.yMax||0,f=this.advanceWidth||0;t.strokeStyle="blue",zn.line(t,e+i*a,-1e4,e+i*a,1e4),zn.line(t,e+o*a,-1e4,e+o*a,1e4),zn.line(t,-1e4,r+-s*a,1e4,r+-s*a),zn.line(t,-1e4,r+-c*a,1e4,r+-c*a),t.strokeStyle="green",zn.line(t,e+f*a,-1e4,e+f*a,1e4)};function So(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Iu(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Iu.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Iu.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function AN(t,e){return new Pt({index:e,font:t})}function PN(t,e,r,n,a,i){return function(){var s=new Pt({index:e,font:t});return s.path=function(){r(s,n,a);var o=i(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},So(s,"xMin","_xMin"),So(s,"xMax","_xMax"),So(s,"yMin","_yMin"),So(s,"yMax","_yMax"),s}}function HN(t,e,r,n){return function(){var a=new Pt({index:e,font:t});return a.path=function(){var i=r(t,a,n);return i.unitsPerEm=t.unitsPerEm,i},a}}var lr={GlyphSet:Iu,glyphLoader:AN,ttfGlyphLoader:PN,cffGlyphLoader:HN};function jx(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!jx(t[r],e[r]))return!1;return!0}else return!1}function Uu(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function nn(t,e,r){var n=[],a=[],i=q.getCard16(t,e),s,o;if(i!==0){var c=q.getByte(t,e+2);s=e+(i+1)*c+2;for(var f=e+3,l=0;l<i+1;l+=1)n.push(q.getOffset(t,f,c)),f+=c;o=s+n[i]}else o=e+2;for(var u=0;u<n.length-1;u+=1){var g=q.getBytes(t,s+n[u],s+n[u+1]);r&&(g=r(g)),a.push(g)}return{objects:a,startOffset:e,endOffset:o}}function IN(t,e){var r=[],n=q.getCard16(t,e),a,i;if(n!==0){var s=q.getByte(t,e+2);a=e+(n+1)*s+2;for(var o=e+3,c=0;c<n+1;c+=1)r.push(q.getOffset(t,o,s)),o+=s;i=a+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function jN(t,e,r,n,a){var i=q.getCard16(r,n),s=0;if(i!==0){var o=q.getByte(r,n+2);s=n+(i+1)*o+2}var c=q.getBytes(r,s+e[t],s+e[t+1]);return a&&(c=a(c)),c}function KN(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var a=t.parseByte(),i=a>>4,s=a&15;if(i===r||(e+=n[i],s===r))break;e+=n[s]}return parseFloat(e)}function $N(t,e){var r,n,a,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),a=t.parseByte(),i=t.parseByte(),r<<24|n<<16|a<<8|i;if(e===30)return KN(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function XN(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],a=t[r][1],i=void 0;if(a.length===1?i=a[0]:i=a,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Kx(t,e,r){e=e!==void 0?e:0;var n=new q.Parser(t,e),a=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),a.push([s,i]),i=[]):i.push($N(n,s))}return XN(a)}function li(t,e){return e<=390?e=wo[e]:e=t[e-391],e}function $x(t,e,r){for(var n={},a,i=0;i<e.length;i+=1){var s=e[i];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var c=0;c<s.type.length;c++)a=t[s.op]!==void 0?t[s.op][c]:void 0,a===void 0&&(a=s.value!==void 0&&s.value[c]!==void 0?s.value[c]:null),s.type[c]==="SID"&&(a=li(r,a)),o[c]=a;n[s.name]=o}else a=t[s.op],a===void 0&&(a=s.value!==void 0?s.value:null),s.type==="SID"&&(a=li(r,a)),n[s.name]=a}return n}function YN(t,e){var r={};return r.formatMajor=q.getCard8(t,e),r.formatMinor=q.getCard8(t,e+1),r.size=q.getCard8(t,e+2),r.offsetSize=q.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Xx=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Yx=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function qN(t,e){var r=Kx(t,0,t.byteLength);return $x(r,Xx,e)}function qx(t,e,r,n){var a=Kx(t,e,r);return $x(a,Yx,n)}function nx(t,e,r,n){for(var a=[],i=0;i<r.length;i+=1){var s=new DataView(new Uint8Array(r[i]).buffer),o=qN(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var c=o.private[0],f=o.private[1];if(c!==0&&f!==0){var l=qx(t,f+e,c,n);if(o._defaultWidthX=l.defaultWidthX,o._nominalWidthX=l.nominalWidthX,l.subrs!==0){var u=f+l.subrs,g=nn(t,u+e);o._subrs=g.objects,o._subrsBias=Uu(o._subrs)}o._privateDict=l}a.push(o)}return a}function ZN(t,e,r,n){var a,i,s=new q.Parser(t,e);r-=1;var o=[".notdef"],c=s.parseCard8();if(c===0)for(var f=0;f<r;f+=1)a=s.parseSID(),o.push(li(n,a));else if(c===1)for(;o.length<=r;){a=s.parseSID(),i=s.parseCard8();for(var l=0;l<=i;l+=1)o.push(li(n,a)),a+=1}else if(c===2)for(;o.length<=r;){a=s.parseSID(),i=s.parseCard16();for(var u=0;u<=i;u+=1)o.push(li(n,a)),a+=1}else throw new Error("Unknown charset format "+c);return o}function QN(t,e,r){var n,a={},i=new q.Parser(t,e),s=i.parseCard8();if(s===0)for(var o=i.parseCard8(),c=0;c<o;c+=1)n=i.parseCard8(),a[n]=c;else if(s===1){var f=i.parseCard8();n=1;for(var l=0;l<f;l+=1)for(var u=i.parseCard8(),g=i.parseCard8(),p=u;p<=u+g;p+=1)a[p]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new Vo(a,r)}function ax(t,e,r){var n,a,i,s,o=new Je,c=[],f=0,l=!1,u=!1,g=0,p=0,d,h,v,x;if(t.isCIDFont){var T=t.tables.cff.topDict._fdSelect[e.index],m=t.tables.cff.topDict._fdArray[T];d=m._subrs,h=m._subrsBias,v=m._defaultWidthX,x=m._nominalWidthX}else d=t.tables.cff.topDict._subrs,h=t.tables.cff.topDict._subrsBias,v=t.tables.cff.topDict._defaultWidthX,x=t.tables.cff.topDict._nominalWidthX;var y=v;function S(O,U){u&&o.closePath(),o.moveTo(O,U),u=!0}function C(){var O;O=c.length%2!==0,O&&!l&&(y=c.shift()+x),f+=c.length>>1,c.length=0,l=!0}function E(O){for(var U,k,V,b,R,M,N,L,B,G,F,_,W=0;W<O.length;){var H=O[W];switch(W+=1,H){case 1:C();break;case 3:C();break;case 4:c.length>1&&!l&&(y=c.shift()+x,l=!0),p+=c.pop(),S(g,p);break;case 5:for(;c.length>0;)g+=c.shift(),p+=c.shift(),o.lineTo(g,p);break;case 6:for(;c.length>0&&(g+=c.shift(),o.lineTo(g,p),c.length!==0);)p+=c.shift(),o.lineTo(g,p);break;case 7:for(;c.length>0&&(p+=c.shift(),o.lineTo(g,p),c.length!==0);)g+=c.shift(),o.lineTo(g,p);break;case 8:for(;c.length>0;)n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s+c.shift(),o.curveTo(n,a,i,s,g,p);break;case 10:R=c.pop()+h,M=d[R],M&&E(M);break;case 11:return;case 12:switch(H=O[W],W+=1,H){case 35:n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),N=i+c.shift(),L=s+c.shift(),B=N+c.shift(),G=L+c.shift(),F=B+c.shift(),_=G+c.shift(),g=F+c.shift(),p=_+c.shift(),c.shift(),o.curveTo(n,a,i,s,N,L),o.curveTo(B,G,F,_,g,p);break;case 34:n=g+c.shift(),a=p,i=n+c.shift(),s=a+c.shift(),N=i+c.shift(),L=s,B=N+c.shift(),G=s,F=B+c.shift(),_=p,g=F+c.shift(),o.curveTo(n,a,i,s,N,L),o.curveTo(B,G,F,_,g,p);break;case 36:n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),N=i+c.shift(),L=s,B=N+c.shift(),G=s,F=B+c.shift(),_=G+c.shift(),g=F+c.shift(),o.curveTo(n,a,i,s,N,L),o.curveTo(B,G,F,_,g,p);break;case 37:n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),N=i+c.shift(),L=s+c.shift(),B=N+c.shift(),G=L+c.shift(),F=B+c.shift(),_=G+c.shift(),Math.abs(F-g)>Math.abs(_-p)?g=F+c.shift():p=_+c.shift(),o.curveTo(n,a,i,s,N,L),o.curveTo(B,G,F,_,g,p);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+H),c.length=0}break;case 14:c.length>0&&!l&&(y=c.shift()+x,l=!0),u&&(o.closePath(),u=!1);break;case 18:C();break;case 19:case 20:C(),W+=f+7>>3;break;case 21:c.length>2&&!l&&(y=c.shift()+x,l=!0),p+=c.pop(),g+=c.pop(),S(g,p);break;case 22:c.length>1&&!l&&(y=c.shift()+x,l=!0),g+=c.pop(),S(g,p);break;case 23:C();break;case 24:for(;c.length>2;)n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s+c.shift(),o.curveTo(n,a,i,s,g,p);g+=c.shift(),p+=c.shift(),o.lineTo(g,p);break;case 25:for(;c.length>6;)g+=c.shift(),p+=c.shift(),o.lineTo(g,p);n=g+c.shift(),a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s+c.shift(),o.curveTo(n,a,i,s,g,p);break;case 26:for(c.length%2&&(g+=c.shift());c.length>0;)n=g,a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i,p=s+c.shift(),o.curveTo(n,a,i,s,g,p);break;case 27:for(c.length%2&&(p+=c.shift());c.length>0;)n=g+c.shift(),a=p,i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s,o.curveTo(n,a,i,s,g,p);break;case 28:U=O[W],k=O[W+1],c.push((U<<24|k<<16)>>16),W+=2;break;case 29:R=c.pop()+t.gsubrsBias,M=t.gsubrs[R],M&&E(M);break;case 30:for(;c.length>0&&(n=g,a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s+(c.length===1?c.shift():0),o.curveTo(n,a,i,s,g,p),c.length!==0);)n=g+c.shift(),a=p,i=n+c.shift(),s=a+c.shift(),p=s+c.shift(),g=i+(c.length===1?c.shift():0),o.curveTo(n,a,i,s,g,p);break;case 31:for(;c.length>0&&(n=g+c.shift(),a=p,i=n+c.shift(),s=a+c.shift(),p=s+c.shift(),g=i+(c.length===1?c.shift():0),o.curveTo(n,a,i,s,g,p),c.length!==0);)n=g,a=p+c.shift(),i=n+c.shift(),s=a+c.shift(),g=i+c.shift(),p=s+(c.length===1?c.shift():0),o.curveTo(n,a,i,s,g,p);break;default:H<32?console.log("Glyph "+e.index+": unknown operator "+H):H<247?c.push(H-139):H<251?(U=O[W],W+=1,c.push((H-247)*256+U+108)):H<255?(U=O[W],W+=1,c.push(-(H-251)*256-U-108)):(U=O[W],k=O[W+1],V=O[W+2],b=O[W+3],W+=4,c.push((U<<24|k<<16|V<<8|b)/65536))}}}return E(r),e.advanceWidth=y,o}function JN(t,e,r,n){var a=[],i,s=new q.Parser(t,e),o=s.parseCard8();if(o===0)for(var c=0;c<r;c++){if(i=s.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");a.push(i)}else if(o===3){var f=s.parseCard16(),l=s.parseCard16();if(l!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+l);for(var u,g=0;g<f;g++){if(i=s.parseCard8(),u=s.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(u>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+u);for(;l<u;l++)a.push(i);l=u}if(u!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+u)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return a}function eB(t,e,r,n){r.tables.cff={};var a=YN(t,e),i=nn(t,a.endOffset,q.bytesToString),s=nn(t,i.endOffset),o=nn(t,s.endOffset,q.bytesToString),c=nn(t,o.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Uu(r.gsubrs);var f=nx(t,e,s.objects,o.objects);if(f.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+f.length);var l=f[0];if(r.tables.cff.topDict=l,l._privateDict&&(r.defaultWidthX=l._privateDict.defaultWidthX,r.nominalWidthX=l._privateDict.nominalWidthX),l.ros[0]!==void 0&&l.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var u=l.fdArray,g=l.fdSelect;if(u===0||g===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");u+=e;var p=nn(t,u),d=nx(t,e,p.objects,o.objects);l._fdArray=d,g+=e,l._fdSelect=JN(t,g,r.numGlyphs,d.length)}var h=e+l.private[1],v=qx(t,h,l.private[0],o.objects);if(r.defaultWidthX=v.defaultWidthX,r.nominalWidthX=v.nominalWidthX,v.subrs!==0){var x=h+v.subrs,T=nn(t,x);r.subrs=T.objects,r.subrsBias=Uu(r.subrs)}else r.subrs=[],r.subrsBias=0;var m;n.lowMemory?(m=IN(t,e+l.charStrings),r.nGlyphs=m.offsets.length):(m=nn(t,e+l.charStrings),r.nGlyphs=m.objects.length);var y=ZN(t,e+l.charset,r.nGlyphs,o.objects);if(l.encoding===0?r.cffEncoding=new Vo(UN,y):l.encoding===1?r.cffEncoding=new Vo(NN,y):r.cffEncoding=QN(t,e+l.encoding,y),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new lr.GlyphSet(r),n.lowMemory)r._push=function(E){var O=jN(E,m.offsets,t,e+l.charStrings);r.glyphs.push(E,lr.cffGlyphLoader(r,E,ax,O))};else for(var S=0;S<r.nGlyphs;S+=1){var C=m.objects[S];r.glyphs.push(S,lr.cffGlyphLoader(r,S,ax,C))}}function Zx(t,e){var r,n=wo.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+wo.length:(r=wo.length+e.length,e.push(t)),r}function tB(){return new X.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function rB(t){var e=new X.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Qx(t,e,r){for(var n={},a=0;a<t.length;a+=1){var i=t[a],s=e[i.name];s!==void 0&&!jx(s,i.value)&&(i.type==="SID"&&(s=Zx(s,r)),n[i.op]={name:i.name,type:i.type,value:s})}return n}function ix(t,e){var r=new X.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Qx(Xx,t,e),r}function sx(t){var e=new X.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function nB(t){var e=new X.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function aB(){return new X.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function iB(t,e){for(var r=new X.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var a=t[n],i=Zx(a,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function sB(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,a=0,i=0;i<r.commands.length;i+=1){var s=void 0,o=void 0,c=r.commands[i];if(c.type==="Q"){var f=.3333333333333333,l=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(f*n+l*c.x1),y1:Math.round(f*a+l*c.y1),x2:Math.round(f*c.x+l*c.x1),y2:Math.round(f*c.y+l*c.y1)}}if(c.type==="M")s=Math.round(c.x-n),o=Math.round(c.y-a),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),a=Math.round(c.y);else if(c.type==="L")s=Math.round(c.x-n),o=Math.round(c.y-a),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),a=Math.round(c.y);else if(c.type==="C"){var u=Math.round(c.x1-n),g=Math.round(c.y1-a),p=Math.round(c.x2-c.x1),d=Math.round(c.y2-c.y1);s=Math.round(c.x-c.x2),o=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:u}),e.push({name:"dy1",type:"NUMBER",value:g}),e.push({name:"dx2",type:"NUMBER",value:p}),e.push({name:"dy2",type:"NUMBER",value:d}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),a=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function oB(t){for(var e=new X.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),a=sB(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:a})}return e}function cB(t,e){var r=new X.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Qx(Yx,t,e),r}function fB(t,e){for(var r=new X.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,a={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},s=[],o,c=1;c<t.length;c+=1)o=t.get(c),s.push(o.name);var f=[];r.header=tB(),r.nameIndex=rB([e.postScriptName]);var l=ix(a,f);r.topDictIndex=sx(l),r.globalSubrIndex=aB(),r.charsets=iB(s,f),r.charStringsIndex=oB(t),r.privateDict=cB(i,f),r.stringIndex=nB(f);var u=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return a.charset=u,a.encoding=0,a.charStrings=a.charset+r.charsets.sizeOf(),a.private[1]=a.charStrings+r.charStringsIndex.sizeOf(),l=ix(a,f),r.topDictIndex=sx(l),r}var Jx={parse:eB,make:fB};function uB(t,e){var r={},n=new q.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),oe.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function lB(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new X.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var ey={parse:uB,make:lB};function gB(t,e){var r={},n=new q.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function pB(t){return new X.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var ty={parse:gB,make:pB};function hB(t,e,r,n,a){for(var i,s,o=new q.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=o.parseUShort(),s=o.parseShort());var f=a.get(c);f.advanceWidth=i,f.leftSideBearing=s}}function dB(t,e,r,n,a){t._hmtxTableData={};for(var i,s,o=new q.Parser(e,r),c=0;c<a;c+=1)c<n&&(i=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:s}}function vB(t,e,r,n,a,i,s){s.lowMemory?dB(t,e,r,n,a):hB(e,r,n,a,i)}function mB(t){for(var e=new X.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),a=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:a}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var ry={parse:vB,make:mB};function xB(t){for(var e=new X.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,a=0;a<t.length;++a){var i=r.indexOf(t[a]);i<0&&(i=r.length,r+=t[a]),e.fields.push({name:"offset "+a,type:"USHORT",value:n+i}),e.fields.push({name:"length "+a,type:"USHORT",value:t[a].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function yB(t,e){var r=new q.Parser(t,e),n=r.parseULong();oe.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var a=r.parseULong(),i=[],s=0;s<a;s++){for(var o="",c=e+r.parseUShort(),f=r.parseUShort(),l=c;l<c+f;++l)o+=String.fromCharCode(t.getInt8(l));i.push(o)}return i}var ny={make:xB,parse:yB};function TB(t,e){var r={},n=new q.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function SB(t){return new X.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var ay={parse:TB,make:SB},iy=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],sy={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},CB={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},oy={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function wB(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return sy[e];case 3:return oy[e]}}var Nu="utf-16",OB={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},EB={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function cy(t,e,r){switch(t){case 0:return Nu;case 1:return EB[r]||OB[e];case 3:if(e===1||e===10)return Nu;break}}function MB(t,e,r){for(var n={},a=new q.Parser(t,e),i=a.parseUShort(),s=a.parseUShort(),o=a.offset+a.parseUShort(),c=0;c<s;c++){var f=a.parseUShort(),l=a.parseUShort(),u=a.parseUShort(),g=a.parseUShort(),p=iy[g]||g,d=a.parseUShort(),h=a.parseUShort(),v=wB(f,u,r),x=cy(f,l,u);if(x!==void 0&&v!==void 0){var T=void 0;if(x===Nu?T=Ca.UTF16(t,o+h,d):T=Ca.MACSTRING(t,o+h,d,x),T){var m=n[p];m===void 0&&(m=n[p]={}),m[v]=T}}}var y=0;return i===1&&(y=a.parseUShort()),n}function Cu(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function ox(t,e,r,n,a,i){return new X.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:a},{name:"offset",type:"USHORT",value:i}])}function RB(t,e){var r=t.length,n=e.length-r+1;e:for(var a=0;a<n;a++)for(;a<n;a++){for(var i=0;i<r;i++)if(e[a+i]!==t[i])continue e;return a}return-1}function cx(t,e){var r=RB(t,e);if(r<0){r=e.length;for(var n=0,a=t.length;n<a;++n)e.push(t[n])}return r}function DB(t,e){var r,n=[],a={},i=Cu(iy);for(var s in t){var o=i[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');a[r]=t[s],n.push(r)}for(var c=Cu(sy),f=Cu(oy),l=[],u=[],g=0;g<n.length;g++){r=n[g];var p=a[r];for(var d in p){var h=p[d],v=1,x=c[d],T=CB[x],m=cy(v,T,x),y=j.MACSTRING(h,m);y===void 0&&(v=0,x=e.indexOf(d),x<0&&(x=e.length,e.push(d)),T=4,y=j.UTF16(h));var S=cx(y,u);l.push(ox(v,T,x,r,y.length,S));var C=f[d];if(C!==void 0){var E=j.UTF16(h),O=cx(E,u);l.push(ox(3,1,C,r,E.length,O))}}}l.sort(function(V,b){return V.platformID-b.platformID||V.encodingID-b.encodingID||V.languageID-b.languageID||V.nameID-b.nameID});for(var U=new X.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:l.length},{name:"stringOffset",type:"USHORT",value:6+l.length*12}]),k=0;k<l.length;k++)U.fields.push({name:"record_"+k,type:"RECORD",value:l[k]});return U.fields.push({name:"strings",type:"LITERAL",value:u}),U}var fy={parse:MB,make:DB},Bu=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function LB(t){for(var e=0;e<Bu.length;e+=1){var r=Bu[e];if(t>=r.begin&&t<r.end)return e}return-1}function VB(t,e){var r={},n=new q.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var a=0;a<10;a++)r.panose[a]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function FB(t){return new X.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var Gu={parse:VB,make:FB,unicodeRanges:Bu,getUnicodeRange:LB};function kB(t,e){var r={},n=new q.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=An.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var a=0;a<r.numberOfGlyphs;a++)r.glyphNameIndex[a]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=An.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function bB(){return new X.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var uy={parse:kB,make:bB},Kt=new Array(9);Kt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),substitute:this.parseOffset16List()};oe.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Kt[2]=function(){var e=this.parseUShort();return oe.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),sequences:this.parseListOfLists()}};Kt[3]=function(){var e=this.parseUShort();return oe.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),alternateSets:this.parseListOfLists()}};Kt[4]=function(){var e=this.parseUShort();return oe.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Sa={sequenceIndex:A.uShort,lookupListIndex:A.uShort};Kt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(A.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(s,Sa)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(A.coverage),classDef:this.parsePointer(A.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(s,Sa)}})};if(r===3){var n=this.parseUShort(),a=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,A.pointer(A.coverage)),lookupRecords:this.parseRecordList(a,Sa)}}oe.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Kt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Sa)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),backtrackClassDef:this.parsePointer(A.classDef),inputClassDef:this.parsePointer(A.classDef),lookaheadClassDef:this.parsePointer(A.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Sa)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(A.pointer(A.coverage)),inputCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),lookupRecords:this.parseRecordList(Sa)};oe.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Kt[7]=function(){var e=this.parseUShort();oe.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new A(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Kt[r].call(n)}};Kt[8]=function(){var e=this.parseUShort();return oe.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),backtrackCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),substitutes:this.parseUShortList()}};function UB(t,e){e=e||0;var r=new A(t,e),n=r.parseVersion(1);return oe.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Kt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Kt),variations:r.parseFeatureVariationsList()}}var wa=new Array(9);wa[1]=function(e){return e.substFormat===1?new X.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new X.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)}].concat(X.ushortList("substitute",e.substitute)))};wa[2]=function(e){return oe.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new X.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)}].concat(X.tableList("seqSet",e.sequences,function(r){return new X.Table("sequenceSetTable",X.ushortList("sequence",r))})))};wa[3]=function(e){return oe.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new X.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)}].concat(X.tableList("altSet",e.alternateSets,function(r){return new X.Table("alternateSetTable",X.ushortList("alternate",r))})))};wa[4]=function(e){return oe.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new X.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)}].concat(X.tableList("ligSet",e.ligatureSets,function(r){return new X.Table("ligatureSetTable",X.tableList("ligature",r,function(n){return new X.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(X.ushortList("component",n.components,n.components.length+1)))}))})))};wa[6]=function(e){if(e.substFormat===1){var r=new X.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new X.Coverage(e.coverage)}].concat(X.tableList("chainRuleSet",e.chainRuleSets,function(i){return new X.Table("chainRuleSetTable",X.tableList("chainRule",i,function(s){var o=X.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(X.ushortList("inputGlyph",s.input,s.input.length+1)).concat(X.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(X.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(c,f){o=o.concat({name:"sequenceIndex"+f,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+f,type:"USHORT",value:c.lookupListIndex})}),new X.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)oe.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new X.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new X.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new X.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:i.lookupListIndex})});var a=new X.Table("chainContextTable",n);return a}oe.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function NB(t){return new X.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new X.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new X.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new X.LookupList(t.lookups,wa)}])}var ly={parse:UB,make:NB};function BB(t,e){var r=new q.Parser(t,e),n=r.parseULong();oe.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var a=r.parseULong(),i={},s=0;s<a;s++){var o=r.parseTag(),c=r.parseULong(),f=r.parseULong(),l=Ca.UTF8(t,e+c,f);i[o]=l}return i}function GB(t){var e=Object.keys(t).length,r="",n=16+e*12,a=new X.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var s=r.length;r+=t[i],a.fields.push({name:"tag "+i,type:"TAG",value:i}),a.fields.push({name:"offset "+i,type:"ULONG",value:n+s}),a.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return a.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),a}var gy={parse:BB,make:GB};function fx(t){return Math.log(t)/Math.log(2)|0}function ju(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function ux(t,e,r,n){return new X.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function py(t){var e=new X.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,fx(e.numTables));e.searchRange=16*r,e.entrySelector=fx(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],a=[],i=e.sizeOf()+ux().sizeOf()*e.numTables;i%4!==0;)i+=1,a.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];oe.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var c=o.sizeOf(),f=ux(o.tableName,ju(o.encode()),i,c);for(n.push({name:f.tag+" Table Record",type:"RECORD",value:f}),a.push({name:o.tableName+" table",type:"RECORD",value:o}),i+=c,oe.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,a.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(l,u){return l.value.tag>u.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(a),e}function lx(t,e,r){for(var n=0;n<e.length;n+=1){var a=t.charToGlyphIndex(e[n]);if(a>0){var i=t.glyphs.get(a);return i.getMetrics()}}return r}function _B(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function WB(t){for(var e=[],r=[],n=[],a=[],i=[],s=[],o=[],c,f=0,l=0,u=0,g=0,p=0,d=0;d<t.glyphs.length;d+=1){var h=t.glyphs.get(d),v=h.unicode|0;if(isNaN(h.advanceWidth))throw new Error("Glyph "+h.name+" ("+d+"): advanceWidth is not a number.");(c>v||c===void 0)&&v>0&&(c=v),f<v&&(f=v);var x=Gu.getUnicodeRange(v);if(x<32)l|=1<<x;else if(x<64)u|=1<<x-32;else if(x<96)g|=1<<x-64;else if(x<123)p|=1<<x-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(h.name!==".notdef"){var T=h.getMetrics();e.push(T.xMin),r.push(T.yMin),n.push(T.xMax),a.push(T.yMax),s.push(T.leftSideBearing),o.push(T.rightSideBearing),i.push(h.advanceWidth)}}var m={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:_B(i),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};m.ascender=t.ascender,m.descender=t.descender;var y=ey.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:m.xMin,yMin:m.yMin,xMax:m.xMax,yMax:m.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),S=ty.make({ascender:m.ascender,descender:m.descender,advanceWidthMax:m.advanceWidthMax,minLeftSideBearing:m.minLeftSideBearing,minRightSideBearing:m.minRightSideBearing,xMaxExtent:m.maxLeftSideBearing+(m.xMax-m.xMin),numberOfHMetrics:t.glyphs.length}),C=ay.make(t.glyphs.length),E=Gu.make(Object.assign({xAvgCharWidth:Math.round(m.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:f,ulUnicodeRange1:l,ulUnicodeRange2:u,ulUnicodeRange3:g,ulUnicodeRange4:p,sTypoAscender:m.ascender,sTypoDescender:m.descender,sTypoLineGap:0,usWinAscent:m.yMax,usWinDescent:Math.abs(m.yMin),ulCodePageRange1:1,sxHeight:lx(t,"xyvw",{yMax:Math.round(m.ascender/2)}).yMax,sCapHeight:lx(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",m).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),O=ry.make(t.glyphs),U=Px.make(t.glyphs),k=t.getEnglishName("fontFamily"),V=t.getEnglishName("fontSubfamily"),b=k+" "+V,R=t.getEnglishName("postScriptName");R||(R=k.replace(/\s/g,"")+"-"+V);var M={};for(var N in t.names)M[N]=t.names[N];M.uniqueID||(M.uniqueID={en:t.getEnglishName("manufacturer")+":"+b}),M.postScriptName||(M.postScriptName={en:R}),M.preferredFamily||(M.preferredFamily=t.names.fontFamily),M.preferredSubfamily||(M.preferredSubfamily=t.names.fontSubfamily);var L=[],B=fy.make(M,L),G=L.length>0?ny.make(L):void 0,F=uy.make(),_=Jx.make(t.glyphs,{version:t.getEnglishName("version"),fullName:b,familyName:k,weightName:V,postScriptName:R,unitsPerEm:t.unitsPerEm,fontBBox:[0,m.yMin,m.ascender,m.advanceWidthMax]}),W=t.metas&&Object.keys(t.metas).length>0?gy.make(t.metas):void 0,H=[y,S,C,E,B,U,F,_,O];G&&H.push(G),t.tables.gsub&&H.push(ly.make(t.tables.gsub)),W&&H.push(W);for(var I=py(H),ve=I.encode(),me=ju(ve),ie=I.fields,he=!1,we=0;we<ie.length;we+=1)if(ie[we].name==="head table"){ie[we].value.checkSumAdjustment=2981146554-me,he=!0;break}if(!he)throw new Error("Could not find head table with checkSum to adjust.");return I}var zB={make:py,fontToTable:WB,computeCheckSum:ju};function wu(t,e){for(var r=0,n=t.length-1;r<=n;){var a=r+n>>>1,i=t[a].tag;if(i===e)return a;i<e?r=a+1:n=a-1}return-r-1}function gx(t,e){for(var r=0,n=t.length-1;r<=n;){var a=r+n>>>1,i=t[a];if(i===e)return a;i<e?r=a+1:n=a-1}return-r-1}function px(t,e){for(var r,n=0,a=t.length-1;n<=a;){var i=n+a>>>1;r=t[i];var s=r.start;if(s===e)return r;s<e?n=i+1:a=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function vi(t,e){this.font=t,this.tableName=e}vi.prototype={searchTag:wu,binSearch:gx,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,a=wu(r.scripts,t);if(a>=0)return n[a].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-a,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var a=wu(n.langSysRecords,e);if(a>=0)return n.langSysRecords[a].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-a,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var a=this.getLangSysTable(t,e,n);if(a){for(var i,s=a.featureIndexes,o=this.font.tables[this.tableName].features,c=0;c<s.length;c++)if(i=o[s[c]],i.tag===r)return i.feature;if(n){var f=o.length;return oe.assert(f===0||r>=o[f-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(i),s.push(f),i.feature}}},getLookupTables:function(t,e,r,n,a){var i=this.getFeatureTable(t,e,r,a),s=[];if(i){for(var o,c=i.lookupListIndexes,f=this.font.tables[this.tableName].lookups,l=0;l<c.length;l++)o=f[c[l]],o.lookupType===n&&s.push(o);if(s.length===0&&a){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=f.length;return f.push(o),c.push(u),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=px(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=gx(t.glyphs,e);return r>=0?r:-1;case 2:var n=px(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var a=r[n],i=a.start,s=a.end,o=i;o<=s;o++)e.push(o);return e}};function mi(t){vi.call(this,t,"gpos")}mi.prototype=vi.prototype;mi.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};mi.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var a=t[n].subtables,i=0;i<a.length;i++){var s=a[i],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var c=s.pairSets[o],f=0;f<c.length;f++){var l=c[f];if(l.secondGlyph===r)return l.value1&&l.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(s.classDef1,e),g=this.getGlyphClass(s.classDef2,r),p=s.classRecords[u][g];return p.value1&&p.value1.xAdvance||0}}return 0};mi.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function bt(t){vi.call(this,t,"gsub")}function AB(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Ku(t,e,r){for(var n=t.subtables,a=0;a<n.length;a++){var i=n[a];if(i.substFormat===e)return i}if(r)return n.push(r),r}bt.prototype=vi.prototype;bt.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};bt.prototype.getSingle=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,1),i=0;i<a.length;i++)for(var s=a[i].subtables,o=0;o<s.length;o++){var c=s[o],f=this.expandCoverage(c.coverage),l=void 0;if(c.substFormat===1){var u=c.deltaGlyphId;for(l=0;l<f.length;l++){var g=f[l];n.push({sub:g,by:g+u})}}else{var p=c.substitute;for(l=0;l<f.length;l++)n.push({sub:f[l],by:p[l]})}}return n};bt.prototype.getMultiple=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,2),i=0;i<a.length;i++)for(var s=a[i].subtables,o=0;o<s.length;o++){var c=s[o],f=this.expandCoverage(c.coverage),l=void 0;for(l=0;l<f.length;l++){var u=f[l],g=c.sequences[l];n.push({sub:u,by:g})}}return n};bt.prototype.getAlternates=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,3),i=0;i<a.length;i++)for(var s=a[i].subtables,o=0;o<s.length;o++)for(var c=s[o],f=this.expandCoverage(c.coverage),l=c.alternateSets,u=0;u<f.length;u++)n.push({sub:f[u],by:l[u]});return n};bt.prototype.getLigatures=function(t,e,r){for(var n=[],a=this.getLookupTables(e,r,t,4),i=0;i<a.length;i++)for(var s=a[i].subtables,o=0;o<s.length;o++)for(var c=s[o],f=this.expandCoverage(c.coverage),l=c.ligatureSets,u=0;u<f.length;u++)for(var g=f[u],p=l[u],d=0;d<p.length;d++){var h=p[d];n.push({sub:[g].concat(h.components),by:h.ligGlyph})}return n};bt.prototype.addSingle=function(t,e,r,n){var a=this.getLookupTables(r,n,t,1,!0)[0],i=Ku(a,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});oe.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var s=e.sub,o=this.binSearch(i.coverage.glyphs,s);o<0&&(o=-1-o,i.coverage.glyphs.splice(o,0,s),i.substitute.splice(o,0,0)),i.substitute[o]=e.by};bt.prototype.addMultiple=function(t,e,r,n){oe.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var a=this.getLookupTables(r,n,t,2,!0)[0],i=Ku(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});oe.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var s=e.sub,o=this.binSearch(i.coverage.glyphs,s);o<0&&(o=-1-o,i.coverage.glyphs.splice(o,0,s),i.sequences.splice(o,0,0)),i.sequences[o]=e.by};bt.prototype.addAlternate=function(t,e,r,n){var a=this.getLookupTables(r,n,t,3,!0)[0],i=Ku(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});oe.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var s=e.sub,o=this.binSearch(i.coverage.glyphs,s);o<0&&(o=-1-o,i.coverage.glyphs.splice(o,0,s),i.alternateSets.splice(o,0,0)),i.alternateSets[o]=e.by};bt.prototype.addLigature=function(t,e,r,n){var a=this.getLookupTables(r,n,t,4,!0)[0],i=a.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},a.subtables[0]=i),oe.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var s=e.sub[0],o=e.sub.slice(1),c={ligGlyph:e.by,components:o},f=this.binSearch(i.coverage.glyphs,s);if(f>=0){for(var l=i.ligatureSets[f],u=0;u<l.length;u++)if(AB(l[u].components,o))return;l.push(c)}else f=-1-f,i.coverage.glyphs.splice(f,0,s),i.ligatureSets.splice(f,0,[c])};bt.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};bt.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function PB(){return typeof window<"u"}function HB(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;++n)r[n]=t[n];return e}function IB(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function ui(t,e){if(!t)throw e}function hx(t,e,r,n,a){var i;return(e&n)>0?(i=t.parseByte(),(e&a)===0&&(i=-i),i=r+i):(e&a)>0?i=r:i=r+t.parseShort(),i}function hy(t,e,r){var n=new q.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var a,i;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var f=s[s.length-1]+1;a=[];for(var l=0;l<f;l+=1)if(i=n.parseByte(),a.push(i),(i&8)>0)for(var u=n.parseByte(),g=0;g<u;g+=1)a.push(i),l+=1;if(oe.argument(a.length===f,"Bad flags."),s.length>0){var p=[],d;if(f>0){for(var h=0;h<f;h+=1)i=a[h],d={},d.onCurve=!!(i&1),d.lastPointOfContour=s.indexOf(h)>=0,p.push(d);for(var v=0,x=0;x<f;x+=1)i=a[x],d=p[x],d.x=hx(n,i,v,2,16),v=d.x;for(var T=0,m=0;m<f;m+=1)i=a[m],d=p[m],d.y=hx(n,i,T,4,32),T=d.y}t.points=p}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var y=!0;y;){a=n.parseUShort();var S={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(a&1)>0?(a&2)>0?(S.dx=n.parseShort(),S.dy=n.parseShort()):S.matchedPoints=[n.parseUShort(),n.parseUShort()]:(a&2)>0?(S.dx=n.parseChar(),S.dy=n.parseChar()):S.matchedPoints=[n.parseByte(),n.parseByte()],(a&8)>0?S.xScale=S.yScale=n.parseF2Dot14():(a&64)>0?(S.xScale=n.parseF2Dot14(),S.yScale=n.parseF2Dot14()):(a&128)>0&&(S.xScale=n.parseF2Dot14(),S.scale01=n.parseF2Dot14(),S.scale10=n.parseF2Dot14(),S.yScale=n.parseF2Dot14()),t.components.push(S),y=!!(a&32)}if(a&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var C=0;C<t.instructionLength;C+=1)t.instructions.push(n.parseByte())}}}function Ou(t,e){for(var r=[],n=0;n<t.length;n+=1){var a=t[n],i={x:e.xScale*a.x+e.scale01*a.y+e.dx,y:e.scale10*a.x+e.yScale*a.y+e.dy,onCurve:a.onCurve,lastPointOfContour:a.lastPointOfContour};r.push(i)}return r}function jB(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var a=t[n];r.push(a),a.lastPointOfContour&&(e.push(r),r=[])}return oe.argument(r.length===0,"There are still points left in the current contour."),e}function dy(t){var e=new Je;if(!t)return e;for(var r=jB(t),n=0;n<r.length;++n){var a=r[n],i=null,s=a[a.length-1],o=a[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(c.x,c.y)}for(var f=0;f<a.length;++f)if(i=s,s=o,o=a[(f+1)%a.length],s.onCurve)e.lineTo(s.x,s.y);else{var l=i,u=o;i.onCurve||(l={x:(s.x+i.x)*.5,y:(s.y+i.y)*.5}),o.onCurve||(u={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,u.x,u.y)}e.closePath()}return e}function vy(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],a=t.get(n.glyphIndex);if(a.getPath(),a.points){var i=void 0;if(n.matchedPoints===void 0)i=Ou(a.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>a.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=a.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=Ou([o],c)[0],c.dx=s.x-o.x,c.dy=s.y-o.y,i=Ou(a.points,c)}e.points=e.points.concat(i)}}return dy(e.points)}function KB(t,e,r,n){for(var a=new lr.GlyphSet(n),i=0;i<r.length-1;i+=1){var s=r[i],o=r[i+1];s!==o?a.push(i,lr.ttfGlyphLoader(n,i,hy,t,e+s,vy)):a.push(i,lr.glyphLoader(n,i))}return a}function $B(t,e,r,n){var a=new lr.GlyphSet(n);return n._push=function(i){var s=r[i],o=r[i+1];s!==o?a.push(i,lr.ttfGlyphLoader(n,i,hy,t,e+s,vy)):a.push(i,lr.glyphLoader(n,i))},a}function XB(t,e,r,n,a){return a.lowMemory?$B(t,e,r,n):KB(t,e,r,n)}var my={getPath:dy,parse:XB},xy,Hn,yy,_u;function Ty(t){this.font=t,this.getCommands=function(e){return my.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function YB(t){return t}function Sy(t){return Math.sign(t)*Math.round(Math.abs(t))}function qB(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function ZB(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function QB(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function JB(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Cy=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,a=1;return t<0&&(t=-t,a=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*a:t*a},ur={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var a,i,s,o,c,f,l;if(!n||n===this){if(a=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,f=r.x-r.xo,s=Math.abs(a),o=Math.abs(i),l=s+o,l===0){t.x=t.xo+(c+f)/2;return}t.x=t.xo+(c*o+f*s)/l;return}if(a=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),f=n.distance(r,r,!1,!0),s=Math.abs(a),o=Math.abs(i),l=s+o,l===0){ur.setRelative(t,t,(c+f)/2,n,!0);return}ur.setRelative(t,t,(c*o+f*s)/l,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,a){if(!n||n===this){t.x=(a?e.xo:e.x)+r;return}var i=a?e.xo:e.x,s=a?e.yo:e.y,o=i+r*n.x,c=s+r*n.y;t.x=o+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Lr={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var a,i,s,o,c,f,l;if(!n||n===this){if(a=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,f=r.y-r.yo,s=Math.abs(a),o=Math.abs(i),l=s+o,l===0){t.y=t.yo+(c+f)/2;return}t.y=t.yo+(c*o+f*s)/l;return}if(a=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),f=n.distance(r,r,!1,!0),s=Math.abs(a),o=Math.abs(i),l=s+o,l===0){Lr.setRelative(t,t,(c+f)/2,n,!0);return}Lr.setRelative(t,t,(c*o+f*s)/l,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,a){if(!n||n===this){t.y=(a?e.yo:e.y)+r;return}var i=a?e.xo:e.x,s=a?e.yo:e.y,o=i+r*n.x,c=s+r*n.y;t.y=c+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(ur);Object.freeze(Lr);function xi(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}xi.prototype.distance=function(t,e,r,n){return this.x*ur.distance(t,e,r,n)+this.y*Lr.distance(t,e,r,n)};xi.prototype.interpolate=function(t,e,r,n){var a,i,s,o,c,f,l;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),a=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(s),f=Math.abs(o),l=c+f,l===0){this.setRelative(t,t,(a+i)/2,n,!0);return}this.setRelative(t,t,(a*f+i*c)/l,n,!0)};xi.prototype.setRelative=function(t,e,r,n,a){n=n||this;var i=a?e.xo:e.x,s=a?e.yo:e.y,o=i+r*n.x,c=s+r*n.y,f=n.normalSlope,l=this.slope,u=t.x,g=t.y;t.x=(l*u-f*o+c-g)/(l-f),t.y=l*(t.x-u)+g};xi.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function yi(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?ur:t===0&&e===1?Lr:new xi(t,e)}function Vr(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Vr.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Vr.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var di=Object.freeze(new Vr(0,0)),eG={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function an(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=ur,this.round=Sy}}Ty.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var a=this._fpgmState;if(!a){an.prototype=eG,a=this._fpgmState=new an("fpgm",r.tables.fpgm),a.funcs=[],a.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),a.step=-1);try{Hn(a)}catch(f){console.log("Hinting error in FPGM:"+f),this._errorState=3;return}}an.prototype=a,n=this._prepState=new an("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var s=n.cvt=new Array(i.length),o=e/r.unitsPerEm,c=0;c<i.length;c++)s[c]=i[c]*o;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{Hn(n)}catch(f){this._errorState<2&&console.log("Hinting error in PREP:"+f),this._errorState=2}}if(!(this._errorState>1))try{return yy(t,n)}catch(f){this._errorState<1&&(console.log("Hinting error:"+f),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};yy=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,a=t.components,i,s,o;if(an.prototype=e,!a)o=new an("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),_u(t,o,r,n),s=o.gZone;else{var c=e.font;s=[],i=[];for(var f=0;f<a.length;f++){var l=a[f],u=c.glyphs.get(l.glyphIndex);o=new an("glyf",u.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+f+"---"),o.step=-1),_u(u,o,r,n);for(var g=Math.round(l.dx*r),p=Math.round(l.dy*n),d=o.gZone,h=o.contours,v=0;v<d.length;v++){var x=d[v];x.xTouched=x.yTouched=!1,x.xo=x.x=x.x+g,x.yo=x.y=x.y+p}var T=s.length;s.push.apply(s,d);for(var m=0;m<h.length;m++)i.push(h[m]+T)}t.instructions&&!o.inhibitGridFit&&(o=new an("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=i,s.push(new Vr(0,0),new Vr(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),Hn(o),s.length-=2)}return s};_u=function(t,e,r,n){for(var a=t.points||[],i=a.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],c,f=0;f<i;f++)c=a[f],s[f]=new Vr(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var l,u,g=0;g<i;g++)c=s[g],l||(l=c,o.push(g)),c.lastPointOfContour?(c.nextPointOnContour=l,l.prevPointOnContour=c,l=void 0):(u=s[g+1],c.nextPointOnContour=u,u.prevPointOnContour=c);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var p=0;p<i;p++)console.log(p,s[p].x,s[p].y)}if(s.push(new Vr(0,0),new Vr(Math.round(t.advanceWidth*r),0)),Hn(e),s.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var d=0;d<i;d++)console.log(d,s[d].x,s[d].y)}}};Hn=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=xy[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Fo(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new Vr(0,0)}function wy(t,e){var r=t.prog,n=t.ip,a=1,i;do if(i=r[++n],i===88)a++;else if(i===89)a--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&a===1&&i===27)break;while(a>0);t.ip=n}function dx(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function vx(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function mx(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function xx(t,e){var r=e.stack,n=r.pop(),a=r.pop(),i=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log("SPVTL["+t+"]",n,a);var o,c;t?(o=i.y-s.y,c=s.x-i.x):(o=s.x-i.x,c=s.y-i.y),e.pv=e.dpv=yi(o,c)}function yx(t,e){var r=e.stack,n=r.pop(),a=r.pop(),i=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log("SFVTL["+t+"]",n,a);var o,c;t?(o=i.y-s.y,c=s.x-i.x):(o=s.x-i.x,c=s.y-i.y),e.fv=yi(o,c)}function tG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=yi(n,r)}function rG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=yi(n,r)}function nG(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function aG(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function iG(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function sG(t){var e=t.stack,r=e.pop(),n=e.pop(),a=e.pop(),i=e.pop(),s=e.pop(),o=t.z0,c=t.z1,f=o[r],l=o[n],u=c[a],g=c[i],p=t.z2[s];exports.DEBUG&&console.log("ISECT[], ",r,n,a,i,s);var d=f.x,h=f.y,v=l.x,x=l.y,T=u.x,m=u.y,y=g.x,S=g.y,C=(d-v)*(m-S)-(h-x)*(T-y),E=d*x-h*v,O=T*S-m*y;p.x=(E*(T-y)-O*(d-v))/C,p.y=(E*(m-S)-O*(h-x))/C}function oG(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function cG(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function fG(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function uG(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Fo(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function lG(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Fo(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function gG(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Fo(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function pG(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Fo(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function hG(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function dG(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=Sy}function vG(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=ZB}function mG(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function xG(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),wy(t,!1)}function yG(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function TG(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function SG(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function Eu(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function CG(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function wG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function OG(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function EG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var a=t.ip,i=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)Hn(t),exports.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=a,t.prog=i}function MG(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],Hn(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function RG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function DG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function LG(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,a=e.pop(),i=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",a);r[++n]!==45;);t.ip=n,t.funcs[a]=r.slice(i+1,n)}function Tx(t,e){var r=e.stack.pop(),n=e.z0[r],a=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=i.distance(n,di);t&&(s=e.round(s)),a.setRelative(n,di,s,i),a.touch(n),e.rp0=e.rp1=r}function Sx(t,e){var r=e.z2,n=r.length-2,a,i,s;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)a=r[o],!t.touched(a)&&(i=a.prevTouched(t),i!==a&&(s=a.nextTouched(t),i===s&&t.setRelative(a,a,t.distance(i,i,!1,!0),t,!0),t.interpolate(a,i,s,t)))}function Cx(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],i=e.fv,s=e.pv,o=e.loop,c=e.z2;o--;){var f=r.pop(),l=c[f],u=s.distance(a,a,!1,!0);i.setRelative(l,l,u,s),i.touch(l),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",f)}e.loop=1}function wx(t,e){var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],i=e.fv,s=e.pv,o=r.pop(),c=e.z2[e.contours[o]],f=c;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var l=s.distance(a,a,!1,!0);do f!==a&&i.setRelative(f,f,l,s),f=f.nextPointOnContour;while(f!==c)}function Ox(t,e){var r=e.stack,n=t?e.rp1:e.rp2,a=(t?e.z0:e.z1)[n],i=e.fv,s=e.pv,o=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var c;switch(o){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var f,l=s.distance(a,a,!1,!0),u=c.length-2,g=0;g<u;g++)f=c[g],i.setRelative(f,f,l,s)}function VG(t){for(var e=t.stack,r=t.loop,n=t.fv,a=e.pop()/64,i=t.z2;r--;){var s=e.pop(),o=i[s];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,a),n.setRelative(o,o,a),n.touch(o)}t.loop=1}function FG(t){for(var e=t.stack,r=t.rp1,n=t.rp2,a=t.loop,i=t.z0[r],s=t.z1[n],o=t.fv,c=t.dpv,f=t.z2;a--;){var l=e.pop(),u=f[l];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-a)+": ":"")+"IP[]",l,r,"<->",n),o.interpolate(u,i,s,c),o.touch(u)}t.loop=1}function Ex(t,e){var r=e.stack,n=r.pop()/64,a=r.pop(),i=e.z1[a],s=e.z0[e.rp0],o=e.fv,c=e.pv;o.setRelative(i,s,n,c),o.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,a),e.rp1=e.rp0,e.rp2=a,t&&(e.rp0=a)}function kG(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],a=t.loop,i=t.fv,s=t.pv,o=t.z1;a--;){var c=e.pop(),f=o[c];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-a)+": ":"")+"ALIGNRP[]",c),i.setRelative(f,n,0,s),i.touch(f)}t.loop=1}function bG(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=qB}function Mx(t,e){var r=e.stack,n=r.pop(),a=r.pop(),i=e.z0[a],s=e.fv,o=e.pv,c=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",a);var f=o.distance(i,di);t&&(Math.abs(f-c)<e.cvCutIn&&(f=c),f=e.round(f)),s.setRelative(i,di,f,o),e.zp0===0&&(i.xo=i.x,i.yo=i.y),s.touch(i),e.rp0=e.rp1=a}function UG(t){var e=t.prog,r=t.ip,n=t.stack,a=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",a);for(var i=0;i<a;i++)n.push(e[++r]);t.ip=r}function NG(t){var e=t.ip,r=t.prog,n=t.stack,a=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",a);for(var i=0;i<a;i++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function BG(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),a=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,a),r[a]=n}function GG(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var a=r&&r[n]||0;e.push(a)}function _G(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function WG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function Rx(t,e){var r=e.stack,n=r.pop(),a=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(a,di,t,!1)*64)}function Dx(t,e){var r=e.stack,n=r.pop(),a=r.pop(),i=e.z1[n],s=e.z0[a],o=e.dpv.distance(s,i,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,a,"->",o),e.stack.push(Math.round(o*64))}function zG(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function AG(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function PG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function HG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function IG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function jG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function KG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function $G(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function XG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function YG(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function qG(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(wy(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function ZG(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function QG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function JG(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function e4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function Mu(t,e){var r=e.stack,n=r.pop(),a=e.fv,i=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,c=e.deltaShift,f=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var l=0;l<n;l++){var u=r.pop(),g=r.pop(),p=o+((g&240)>>4);if(p===s){var d=(g&15)-8;d>=0&&d++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",u,"by",d*c);var h=f[u];a.setRelative(h,h,d*c,i)}}}function t4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function r4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function n4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function a4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function i4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function s4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function o4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function c4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function f4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function u4(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Co(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function l4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function Ru(t,e){var r=e.stack,n=r.pop(),a=e.ppem,i=e.deltaBase+(t-1)*16,s=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var c=r.pop(),f=r.pop(),l=i+((f&240)>>4);if(l===a){var u=(f&15)-8;u>=0&&u++;var g=u*s;exports.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",g),e.cvt[c]+=g}}}function g4(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Cy;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function p4(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Cy;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function h4(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=YB}function d4(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=QB}function v4(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=JB}function m4(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Lx(t,e){var r=e.stack,n=r.pop(),a=r.pop(),i=e.z2[n],s=e.z1[a];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,a);var o,c;t?(o=i.y-s.y,c=s.x-i.x):(o=s.x-i.x,c=s.y-i.y),e.dpv=yi(o,c)}function x4(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function y4(t){var e=t.stack,r=e.pop(),n=e.pop(),a=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(a)}function T4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function S4(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function C4(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function w4(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function tn(t,e){var r=e.stack,n=e.prog,a=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++a]);e.ip=a}function rn(t,e){var r=e.ip,n=e.prog,a=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),a.push(s)}e.ip=r}function Y(t,e,r,n,a,i){var s=i.stack,o=t&&s.pop(),c=s.pop(),f=i.rp0,l=i.z0[f],u=i.z1[c],g=i.minDis,p=i.fv,d=i.dpv,h,v,x,T;v=h=d.distance(u,l,!0,!0),x=v>=0?1:-1,v=Math.abs(v),t&&(T=i.cvt[o],n&&Math.abs(v-T)<i.cvCutIn&&(v=T)),r&&v<g&&(v=g),n&&(v=i.round(v)),p.setRelative(u,l,x*v,d),p.touch(u),exports.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(a===0?"Gr":a===1?"Bl":a===2?"Wh":"")+"]",t?o+"("+i.cvt[o]+","+T+")":"",c,"(d =",h,"->",x*v,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}xy=[dx.bind(void 0,Lr),dx.bind(void 0,ur),vx.bind(void 0,Lr),vx.bind(void 0,ur),mx.bind(void 0,Lr),mx.bind(void 0,ur),xx.bind(void 0,0),xx.bind(void 0,1),yx.bind(void 0,0),yx.bind(void 0,1),tG,rG,nG,aG,iG,sG,oG,cG,fG,uG,lG,gG,pG,hG,dG,vG,mG,xG,yG,TG,void 0,void 0,SG,Eu,CG,wG,OG,RG,DG,void 0,void 0,void 0,EG,MG,LG,void 0,Tx.bind(void 0,0),Tx.bind(void 0,1),Sx.bind(void 0,Lr),Sx.bind(void 0,ur),Cx.bind(void 0,0),Cx.bind(void 0,1),wx.bind(void 0,0),wx.bind(void 0,1),Ox.bind(void 0,0),Ox.bind(void 0,1),VG,FG,Ex.bind(void 0,0),Ex.bind(void 0,1),kG,bG,Mx.bind(void 0,0),Mx.bind(void 0,1),UG,NG,BG,GG,_G,WG,Rx.bind(void 0,0),Rx.bind(void 0,1),void 0,Dx.bind(void 0,0),Dx.bind(void 0,1),zG,void 0,AG,void 0,void 0,PG,HG,IG,jG,KG,$G,XG,YG,qG,ZG,QG,JG,e4,Mu.bind(void 0,1),t4,r4,n4,a4,i4,s4,o4,c4,f4,u4,Co.bind(void 0,0),Co.bind(void 0,1),Co.bind(void 0,2),Co.bind(void 0,3),void 0,void 0,void 0,void 0,l4,Mu.bind(void 0,2),Mu.bind(void 0,3),Ru.bind(void 0,1),Ru.bind(void 0,2),Ru.bind(void 0,3),g4,p4,void 0,void 0,h4,void 0,d4,v4,Eu,Eu,void 0,void 0,void 0,void 0,void 0,m4,Lx.bind(void 0,0),Lx.bind(void 0,1),x4,void 0,y4,T4,S4,C4,w4,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,tn.bind(void 0,1),tn.bind(void 0,2),tn.bind(void 0,3),tn.bind(void 0,4),tn.bind(void 0,5),tn.bind(void 0,6),tn.bind(void 0,7),tn.bind(void 0,8),rn.bind(void 0,1),rn.bind(void 0,2),rn.bind(void 0,3),rn.bind(void 0,4),rn.bind(void 0,5),rn.bind(void 0,6),rn.bind(void 0,7),rn.bind(void 0,8),Y.bind(void 0,0,0,0,0,0),Y.bind(void 0,0,0,0,0,1),Y.bind(void 0,0,0,0,0,2),Y.bind(void 0,0,0,0,0,3),Y.bind(void 0,0,0,0,1,0),Y.bind(void 0,0,0,0,1,1),Y.bind(void 0,0,0,0,1,2),Y.bind(void 0,0,0,0,1,3),Y.bind(void 0,0,0,1,0,0),Y.bind(void 0,0,0,1,0,1),Y.bind(void 0,0,0,1,0,2),Y.bind(void 0,0,0,1,0,3),Y.bind(void 0,0,0,1,1,0),Y.bind(void 0,0,0,1,1,1),Y.bind(void 0,0,0,1,1,2),Y.bind(void 0,0,0,1,1,3),Y.bind(void 0,0,1,0,0,0),Y.bind(void 0,0,1,0,0,1),Y.bind(void 0,0,1,0,0,2),Y.bind(void 0,0,1,0,0,3),Y.bind(void 0,0,1,0,1,0),Y.bind(void 0,0,1,0,1,1),Y.bind(void 0,0,1,0,1,2),Y.bind(void 0,0,1,0,1,3),Y.bind(void 0,0,1,1,0,0),Y.bind(void 0,0,1,1,0,1),Y.bind(void 0,0,1,1,0,2),Y.bind(void 0,0,1,1,0,3),Y.bind(void 0,0,1,1,1,0),Y.bind(void 0,0,1,1,1,1),Y.bind(void 0,0,1,1,1,2),Y.bind(void 0,0,1,1,1,3),Y.bind(void 0,1,0,0,0,0),Y.bind(void 0,1,0,0,0,1),Y.bind(void 0,1,0,0,0,2),Y.bind(void 0,1,0,0,0,3),Y.bind(void 0,1,0,0,1,0),Y.bind(void 0,1,0,0,1,1),Y.bind(void 0,1,0,0,1,2),Y.bind(void 0,1,0,0,1,3),Y.bind(void 0,1,0,1,0,0),Y.bind(void 0,1,0,1,0,1),Y.bind(void 0,1,0,1,0,2),Y.bind(void 0,1,0,1,0,3),Y.bind(void 0,1,0,1,1,0),Y.bind(void 0,1,0,1,1,1),Y.bind(void 0,1,0,1,1,2),Y.bind(void 0,1,0,1,1,3),Y.bind(void 0,1,1,0,0,0),Y.bind(void 0,1,1,0,0,1),Y.bind(void 0,1,1,0,0,2),Y.bind(void 0,1,1,0,0,3),Y.bind(void 0,1,1,0,1,0),Y.bind(void 0,1,1,0,1,1),Y.bind(void 0,1,1,0,1,2),Y.bind(void 0,1,1,0,1,3),Y.bind(void 0,1,1,1,0,0),Y.bind(void 0,1,1,1,0,1),Y.bind(void 0,1,1,1,0,2),Y.bind(void 0,1,1,1,0,3),Y.bind(void 0,1,1,1,1,0),Y.bind(void 0,1,1,1,1,1),Y.bind(void 0,1,1,1,1,2),Y.bind(void 0,1,1,1,1,3)];function Oa(t){this.char=t,this.state={},this.activeState=null}function $u(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function O4(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function $t(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function ko(t){this.eventId=t,this.subscribers=[]}function E4(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(a){Object.defineProperty(e.events,a,{value:new ko(a)})}),t&&r.forEach(function(a){var i=t[a];typeof i=="function"&&e.events[a].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(a){e.events[a].subscribe(e.updateContextsRanges)})}function He(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],E4.call(this,t)}Oa.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};Oa.prototype.getState=function(t){return this.state[t]||null};He.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};He.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),a=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(a))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(a)};this.dispatch("composeRUD",[n.filter(function(i){return!a(i)})])};He.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var a=r.every(function(s){return s instanceof Oa});if(!isNaN(t)&&this.inboundIndex(t)&&a){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};He.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Oa){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};He.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};He.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};He.prototype.insertToken=function(t,e,r){var n=t.every(function(a){return a instanceof Oa});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};He.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,a){var i=[n,a],s=e===null||e.apply(this,i)===!0,o=[n,a];if(s){var c=r.apply(this,o);n.setState(t,c)}}),this.registeredModifiers.push(t)};ko.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};ko.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};$t.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};$t.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};He.prototype.rangeToText=function(t){if(t instanceof $u)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};He.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};He.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};He.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};He.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof ko&&n.subscribers.forEach(function(a){a.apply(r,e||[])})};He.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new O4(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};He.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};He.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};He.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};He.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new $t(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};He.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new $u(r,t,e),a=this.getContext(e).ranges;return n.rangeId=e+"."+a.length,a.push(n),this.getContext(e).openRange=null,n};He.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var a=n.contextName,i=e.getContext(a).openRange;if(!i&&n.checkStart(t)&&(i=new $u(r,null,a),e.getContext(a).openRange=i,e.dispatch("contextStart",[a,r])),i&&n.checkEnd(t)){var s=r-i.startIndex+1,o=e.setEndOffset(s,a);e.dispatch("contextEnd",[a,o])}})};He.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],a=new $t(e,r);this.dispatch("next",[a]),this.runContextCheck(a);var i=new Oa(n);this.tokens.push(i),this.dispatch("newToken",[i,a])}return this.dispatch("end",[this.tokens]),this.tokens};function sn(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Oy(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function on(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Oo(t){return/[A-z]/.test(t)}function M4(t){return/\s/.test(t)}function Ut(t){this.font=t,this.features={}}function Pn(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Ti(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var a=r[n];if(t>=a.start&&t<=a.end){var i=t-a.start;return a.index+i}}break;default:return-1}return-1}function R4(t,e){var r=Ti(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function D4(t,e){var r=Ti(t,e.coverage);return r===-1?null:e.substitute[r]}function Du(t,e){for(var r=[],n=0;n<t.length;n++){var a=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var s=Ti(i,a);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function L4(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Du(e.inputCoverage,t);if(n===-1)return[];var a=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(a);i.length&&on(i[0].char);)i.shift();var s=new $t(i,0),o=Du(e.lookaheadCoverage,s),c=[].concat(t.backtrack);for(c.reverse();c.length&&on(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var f=new $t(c,0),l=Du(e.backtrackCoverage,f),u=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&l.length===e.backtrackCoverage.length,g=[];if(u)for(var p=0;p<e.lookupRecords.length;p++)for(var d=e.lookupRecords[p],h=d.lookupListIndex,v=this.getLookupByIndex(h),x=0;x<v.subtables.length;x++){var T=v.subtables[x],m=this.getLookupMethod(v,T),y=this.getSubstitutionType(v,T);if(y==="12")for(var S=0;S<n.length;S++){var C=t.get(S),E=m(C);E&&g.push(E)}}return g}function V4(t,e){var r=t.current,n=Ti(r,e.coverage);if(n===-1)return null;for(var a,i=e.ligatureSets[n],s=0;s<i.length;s++){a=i[s];for(var o=0;o<a.components.length;o++){var c=t.lookahead[o],f=a.components[o];if(c!==f)break;if(o===a.components.length-1)return a}}return null}function F4(t,e){var r=Ti(t,e.coverage);return r===-1?null:e.sequences[r]}Ut.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};Ut.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var a=r[n];if(a.tag===t&&a.script.defaultLangSys)return a.script.defaultLangSys.featureIndexes;var i=a.langSysRecords;if(i)for(var s=0;s<i.length;s++){var o=i[s];if(o.tag===t){var c=o.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};Ut.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var a=t[n].tag,i=t[n].feature;r[a]=i}this.features[e].tags=r};Ut.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(a){return n.features[a]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};Ut.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};Ut.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(a){return R4.apply(r,[a,e])};case"12":return function(a){return D4.apply(r,[a,e])};case"63":return function(a){return L4.apply(r,[a,e])};case"41":return function(a){return V4.apply(r,[a,e])};case"21":return function(a){return F4.apply(r,[a,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};Ut.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var a=this.getFeatureLookups(n),i=[].concat(e.context),s=0;s<a.length;s++)for(var o=a[s],c=this.getLookupSubtables(o),f=0;f<c.length;f++){var l=c[f],u=this.getSubstitutionType(o,l),g=this.getLookupMethod(o,l),p=void 0;switch(u){case"11":p=g(e.current),p&&i.splice(r,1,new Pn({id:11,tag:t.tag,substitution:p}));break;case"12":p=g(e.current),p&&i.splice(r,1,new Pn({id:12,tag:t.tag,substitution:p}));break;case"63":p=g(e),Array.isArray(p)&&p.length&&i.splice(r,1,new Pn({id:63,tag:t.tag,substitution:p}));break;case"41":p=g(e),p&&i.splice(r,1,new Pn({id:41,tag:t.tag,substitution:p}));break;case"21":p=g(e.current),p&&i.splice(r,1,new Pn({id:21,tag:t.tag,substitution:p}));break}e=new $t(i,r),!(Array.isArray(p)&&!p.length)&&(p=null)}return i.length?i:null};Ut.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};Ut.prototype.getLookupSubtables=function(t){return t.subtables||null};Ut.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};Ut.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};Ut.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function k4(t){var e=t.current,r=t.get(-1);return r===null&&sn(e)||!sn(r)&&sn(e)}function b4(t){var e=t.get(1);return e===null||!sn(e)}var U4={startCheck:k4,endCheck:b4};function N4(t){var e=t.current,r=t.get(-1);return(sn(e)||on(e))&&!sn(r)}function B4(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!sn(e)&&!on(e)):var r=M4(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(a){return sn(a)||on(a)}),!n)return!0}break;default:return!1}}var G4={startCheck:N4,endCheck:B4};function _4(t,e,r){e[r].setState(t.tag,t.substitution)}function W4(t,e,r){e[r].setState(t.tag,t.substitution)}function z4(t,e,r){t.substitution.forEach(function(n,a){var i=e[r+a];i.setState(t.tag,n)})}function A4(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var a=t.substitution.components.length,i=0;i<a;i++)n=e[r+i+1],n.setState("deleted",!0)}var Vx={11:_4,12:W4,63:z4,41:A4};function Xu(t,e,r){t instanceof Pn&&Vx[t.id]&&Vx[t.id](t,e,r)}function P4(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],a=Oy(n),i=on(n);if(!a&&!i)return!0;if(a)return!1}return!1}function H4(t){if(Oy(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=on(r);if(!n)return!0}return!1}function I4(t){var e=this,r="arab",n=this.featuresTags[r],a=this.tokenizer.getRangeTokens(t);if(a.length!==1){var i=new $t(a.map(function(o){return o.getState("glyphIndex")}),0),s=new $t(a.map(function(o){return o.char}),0);a.forEach(function(o,c){if(!on(o.char)){i.setCurrentIndex(c),s.setCurrentIndex(c);var f=0;P4(s)&&(f|=1),H4(s)&&(f|=2);var l;switch(f){case 1:l="fina";break;case 2:l="init";break;case 3:l="medi";break}if(n.indexOf(l)!==-1){var u=e.query.lookupFeature({tag:l,script:r,contextParams:i});if(u instanceof Error)return console.info(u.message);u.forEach(function(g,p){g instanceof Pn&&(Xu(g,a,p),i.context[p]=g.substitution)})}}})}}function Fx(t,e){var r=t.map(function(n){return n.activeState.value});return new $t(r,e||0)}function j4(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),a=Fx(n);a.context.forEach(function(i,s){a.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:a});o.length&&(o.forEach(function(c){return Xu(c,n,s)}),a=Fx(n))})}function K4(t){var e=t.current,r=t.get(-1);return r===null&&Oo(e)||!Oo(r)&&Oo(e)}function $4(t){var e=t.get(1);return e===null||!Oo(e)}var X4={startCheck:K4,endCheck:$4};function kx(t,e){var r=t.map(function(n){return n.activeState.value});return new $t(r,e||0)}function Y4(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),a=kx(n);a.context.forEach(function(i,s){a.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:a});o.length&&(o.forEach(function(c){return Xu(c,n,s)}),a=kx(n))})}function qt(t){this.baseDir=t||"ltr",this.tokenizer=new He,this.featuresTags={}}qt.prototype.setText=function(t){this.text=t};qt.prototype.contextChecks={latinWordCheck:X4,arabicWordCheck:U4,arabicSentenceCheck:G4};function Lu(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function q4(){return Lu.call(this,"latinWord"),Lu.call(this,"arabicWord"),Lu.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Z4(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}qt.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(a){return r.query.supports({script:t,tag:a})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};qt.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Ut(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};qt.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Yu(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Q4(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Yu.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){I4.call(t,n)})}}function J4(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Yu.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(a){j4.call(t,a)})}}}function e_(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Yu.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(a){Y4.call(t,a)})}}}qt.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};qt.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Q4.call(this),J4.call(this)),this.checkContextReady("latinWord")&&e_.call(this),this.checkContextReady("arabicSentence")&&Z4.call(this)};qt.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),q4.call(this),this.applyFeaturesToContexts())};qt.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};qt.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var a=n.activeState.value;e.push(Array.isArray(a)?a[0]:a)}}return e};function ke(t){t=t||{},t.tables=t.tables||{},t.empty||(ui(t.familyName,"When creating a new Font object, familyName is required."),ui(t.styleName,"When creating a new Font object, styleName is required."),ui(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),ui(t.ascender,"When creating a new Font object, ascender is required."),ui(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new lr.GlyphSet(this,t.glyphs||[]),this.encoding=new Hx(this),this.position=new mi(this),this.substitution=new bt(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Ty(this)}})}ke.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};ke.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};ke.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};ke.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};ke.prototype.stringToGlyphs=function(t,e){var r=this,n=new qt,a=function(u){return r.charToGlyphIndex(u.char)};n.registerModifier("glyphIndex",null,a);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var s=n.getTextGlyphs(t),o=s.length,c=new Array(o),f=this.glyphs.get(0),l=0;l<o;l+=1)c[l]=this.glyphs.get(s[l])||f;return c};ke.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};ke.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};ke.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};ke.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};ke.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};ke.prototype.forEachGlyph=function(t,e,r,n,a,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,a=Object.assign({},this.defaultRenderOptions,a);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,a),c;if(a.kerning){var f=a.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(f,a.language)}for(var l=0;l<o.length;l+=1){var u=o[l];if(i.call(this,u,e,r,n,a),u.advanceWidth&&(e+=u.advanceWidth*s),a.kerning&&l<o.length-1){var g=c?this.position.getKerningValue(c,u.index,o[l+1].index):this.getKerningValue(u,o[l+1]);e+=g*s}a.letterSpacing?e+=a.letterSpacing*n:a.tracking&&(e+=a.tracking/1e3*n)}return e};ke.prototype.getPath=function(t,e,r,n,a){var i=new Je;return this.forEachGlyph(t,e,r,n,a,function(s,o,c,f){var l=s.getPath(o,c,f,a,this);i.extend(l)}),i};ke.prototype.getPaths=function(t,e,r,n,a){var i=[];return this.forEachGlyph(t,e,r,n,a,function(s,o,c,f){var l=s.getPath(o,c,f,a,this);i.push(l)}),i};ke.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};ke.prototype.draw=function(t,e,r,n,a,i){this.getPath(e,r,n,a,i).draw(t)};ke.prototype.drawPoints=function(t,e,r,n,a,i){this.forEachGlyph(e,r,n,a,i,function(s,o,c,f){s.drawPoints(t,o,c,f)})};ke.prototype.drawMetrics=function(t,e,r,n,a,i){this.forEachGlyph(e,r,n,a,i,function(s,o,c,f){s.drawMetrics(t,o,c,f)})};ke.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};ke.prototype.validate=function(){var t=this;function e(n,a){}function r(n){var a=t.getEnglishName(n);a&&a.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};ke.prototype.toTables=function(){return zB.fontToTable(this)};ke.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};ke.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0;a<e.length;a++)n[a]=e[a];return r};ke.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(PB())if(window.URL=window.URL||window.webkitURL,window.URL){var a=new DataView(n),i=new Blob([a],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(i),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=Tu(),f=IB(n);c.writeFileSync(t,f)}};ke.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};ke.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};ke.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function Ey(t,e){var r=JSON.stringify(t),n=256;for(var a in e){var i=parseInt(a);if(!(!i||i<256)){if(JSON.stringify(e[a])===r)return i;n<=i&&(n=i+1)}}return e[n]=t,n}function t_(t,e,r){var n=Ey(e.name,r);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:n}]}function r_(t,e,r){var n={},a=new q.Parser(t,e);return n.tag=a.parseTag(),n.minValue=a.parseFixed(),n.defaultValue=a.parseFixed(),n.maxValue=a.parseFixed(),a.skip("uShort",1),n.name=r[a.parseUShort()]||{},n}function n_(t,e,r,n){for(var a=Ey(e.name,n),i=[{name:"nameID_"+t,type:"USHORT",value:a},{name:"flags_"+t,type:"USHORT",value:0}],s=0;s<r.length;++s){var o=r[s].tag;i.push({name:"axis_"+t+" "+o,type:"FIXED",value:e.coordinates[o]<<16})}return i}function a_(t,e,r,n){var a={},i=new q.Parser(t,e);a.name=n[i.parseUShort()]||{},i.skip("uShort",1),a.coordinates={};for(var s=0;s<r.length;++s)a.coordinates[r[s].tag]=i.parseFixed();return a}function i_(t,e){var r=new X.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+t.axes.length*4}]);r.offsetToData=r.sizeOf();for(var n=0;n<t.axes.length;n++)r.fields=r.fields.concat(t_(n,t.axes[n],e));for(var a=0;a<t.instances.length;a++)r.fields=r.fields.concat(n_(a,t.instances[a],t.axes,e));return r}function s_(t,e,r){var n=new q.Parser(t,e),a=n.parseULong();oe.argument(a===65536,"Unsupported fvar table version.");var i=n.parseOffset16();n.skip("uShort",1);for(var s=n.parseUShort(),o=n.parseUShort(),c=n.parseUShort(),f=n.parseUShort(),l=[],u=0;u<s;u++)l.push(r_(t,e+i+u*o,r));for(var g=[],p=e+i+s*o,d=0;d<c;d++)g.push(a_(t,p+d*f,l,r));return{axes:l,instances:g}}var o_={make:i_,parse:s_},c_=function(){return{coverage:this.parsePointer(A.coverage),attachPoints:this.parseList(A.pointer(A.uShortList))}},f_=function(){var t=this.parseUShort();if(oe.argument(t===1||t===2||t===3,"Unsupported CaretValue table version."),t===1)return{coordinate:this.parseShort()};if(t===2)return{pointindex:this.parseShort()};if(t===3)return{coordinate:this.parseShort()}},u_=function(){return this.parseList(A.pointer(f_))},l_=function(){return{coverage:this.parsePointer(A.coverage),ligGlyphs:this.parseList(A.pointer(u_))}},g_=function(){return this.parseUShort(),this.parseList(A.pointer(A.coverage))};function p_(t,e){e=e||0;var r=new A(t,e),n=r.parseVersion(1);oe.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var a={version:n,classDef:r.parsePointer(A.classDef),attachList:r.parsePointer(c_),ligCaretList:r.parsePointer(l_),markAttachClassDef:r.parsePointer(A.classDef)};return n>=1.2&&(a.markGlyphSets=r.parsePointer(g_)),a}var h_={parse:p_},Xt=new Array(10);Xt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(A.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(A.coverage),values:this.parseValueRecordList()};oe.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Xt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();oe.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(A.coverage),a=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:a,valueFormat2:i,pairSets:this.parseList(A.pointer(A.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(a),value2:this.parseValueRecord(i)}})))};if(r===2){var s=this.parsePointer(A.classDef),o=this.parsePointer(A.classDef),c=this.parseUShort(),f=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:a,valueFormat2:i,classDef1:s,classDef2:o,class1Count:c,class2Count:f,classRecords:this.parseList(c,A.list(f,function(){return{value1:this.parseValueRecord(a),value2:this.parseValueRecord(i)}}))}}};Xt[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Xt[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Xt[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Xt[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Xt[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Xt[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Xt[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function d_(t,e){e=e||0;var r=new A(t,e),n=r.parseVersion(1);return oe.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Xt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Xt),variations:r.parseFeatureVariationsList()}}var v_=new Array(10);function m_(t){return new X.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new X.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new X.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new X.LookupList(t.lookups,v_)}])}var x_={parse:d_,make:m_};function y_(t){var e={};t.skip("uShort");var r=t.parseUShort();oe.argument(r===0,"Unsupported kern sub-table version."),t.skip("uShort",2);var n=t.parseUShort();t.skip("uShort",3);for(var a=0;a<n;a+=1){var i=t.parseUShort(),s=t.parseUShort(),o=t.parseShort();e[i+","+s]=o}return e}function T_(t){var e={};t.skip("uShort");var r=t.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var n=t.parseUShort(),a=n&255;if(t.skip("uShort"),a===0){var i=t.parseUShort();t.skip("uShort",3);for(var s=0;s<i;s+=1){var o=t.parseUShort(),c=t.parseUShort(),f=t.parseShort();e[o+","+c]=f}}return e}function S_(t,e){var r=new q.Parser(t,e),n=r.parseUShort();if(n===0)return y_(r);if(n===1)return T_(r);throw new Error("Unsupported kern table version ("+n+").")}var C_={parse:S_};function w_(t,e,r,n){for(var a=new q.Parser(t,e),i=n?a.parseUShort:a.parseULong,s=[],o=0;o<r+1;o+=1){var c=i.call(a);n&&(c*=2),s.push(c)}return s}var O_={parse:w_};function E_(t,e){var r=Tu();r.readFile(t,function(n,a){if(n)return e(n.message);e(null,HB(a))})}function M_(t,e){var r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function bx(t,e){for(var r=[],n=12,a=0;a<e;a+=1){var i=q.getTag(t,n),s=q.getULong(t,n+4),o=q.getULong(t,n+8),c=q.getULong(t,n+12);r.push({tag:i,checksum:s,offset:o,length:c,compression:!1}),n+=16}return r}function R_(t,e){for(var r=[],n=44,a=0;a<e;a+=1){var i=q.getTag(t,n),s=q.getULong(t,n+4),o=q.getULong(t,n+8),c=q.getULong(t,n+12),f=void 0;o<c?f="WOFF":f=!1,r.push({tag:i,offset:s,compression:f,compressedLength:o,length:c}),n+=20}return r}function Ke(t,e){if(e.compression==="WOFF"){var r=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(mN(r,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var a=new DataView(n.buffer,0);return{data:a,offset:0}}else return{data:t,offset:e.offset}}function D_(t,e){e=e??{};var r,n,a=new ke({empty:!0}),i=new DataView(t,0),s,o=[],c=q.getTag(i,0);if(c==="\0\0\0"||c==="true"||c==="typ1")a.outlinesFormat="truetype",s=q.getUShort(i,4),o=bx(i,s);else if(c==="OTTO")a.outlinesFormat="cff",s=q.getUShort(i,4),o=bx(i,s);else if(c==="wOFF"){var f=q.getTag(i,4);if(f==="\0\0\0")a.outlinesFormat="truetype";else if(f==="OTTO")a.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+c);s=q.getUShort(i,12),o=R_(i,s)}else throw new Error("Unsupported OpenType signature "+c);for(var l,u,g,p,d,h,v,x,T,m,y,S,C=0;C<s;C+=1){var E=o[C],O=void 0;switch(E.tag){case"cmap":O=Ke(i,E),a.tables.cmap=Px.parse(O.data,O.offset),a.encoding=new Ix(a.tables.cmap);break;case"cvt ":O=Ke(i,E),S=new q.Parser(O.data,O.offset),a.tables.cvt=S.parseShortList(E.length/2);break;case"fvar":u=E;break;case"fpgm":O=Ke(i,E),S=new q.Parser(O.data,O.offset),a.tables.fpgm=S.parseByteList(E.length);break;case"head":O=Ke(i,E),a.tables.head=ey.parse(O.data,O.offset),a.unitsPerEm=a.tables.head.unitsPerEm,r=a.tables.head.indexToLocFormat;break;case"hhea":O=Ke(i,E),a.tables.hhea=ty.parse(O.data,O.offset),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":v=E;break;case"ltag":O=Ke(i,E),n=ny.parse(O.data,O.offset);break;case"maxp":O=Ke(i,E),a.tables.maxp=ay.parse(O.data,O.offset),a.numGlyphs=a.tables.maxp.numGlyphs;break;case"name":m=E;break;case"OS/2":O=Ke(i,E),a.tables.os2=Gu.parse(O.data,O.offset);break;case"post":O=Ke(i,E),a.tables.post=uy.parse(O.data,O.offset),a.glyphNames=new Hu(a.tables.post);break;case"prep":O=Ke(i,E),S=new q.Parser(O.data,O.offset),a.tables.prep=S.parseByteList(E.length);break;case"glyf":g=E;break;case"loca":T=E;break;case"CFF ":l=E;break;case"kern":x=E;break;case"GDEF":p=E;break;case"GPOS":d=E;break;case"GSUB":h=E;break;case"meta":y=E;break}}var U=Ke(i,m);if(a.tables.name=fy.parse(U.data,U.offset,n),a.names=a.tables.name,g&&T){var k=r===0,V=Ke(i,T),b=O_.parse(V.data,V.offset,a.numGlyphs,k),R=Ke(i,g);a.glyphs=my.parse(R.data,R.offset,b,a,e)}else if(l){var M=Ke(i,l);Jx.parse(M.data,M.offset,a,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var N=Ke(i,v);if(ry.parse(a,N.data,N.offset,a.numberOfHMetrics,a.numGlyphs,a.glyphs,e),_N(a,e),x){var L=Ke(i,x);a.kerningPairs=C_.parse(L.data,L.offset)}else a.kerningPairs={};if(p){var B=Ke(i,p);a.tables.gdef=h_.parse(B.data,B.offset)}if(d){var G=Ke(i,d);a.tables.gpos=x_.parse(G.data,G.offset),a.position.init()}if(h){var F=Ke(i,h);a.tables.gsub=ly.parse(F.data,F.offset)}if(u){var _=Ke(i,u);a.tables.fvar=o_.parse(_.data,_.offset,a.names)}if(y){var W=Ke(i,y);a.tables.meta=gy.parse(W.data,W.offset),a.metas=a.tables.meta}return a}function My(t,e,r){r=r??{};var n=typeof window>"u",a=n&&!r.isUrl?E_:M_;return new Promise(function(i,s){a(t,function(o,c){if(o){if(e)return e(o);s(o)}var f;try{f=D_(c,r)}catch(l){if(e)return e(l,null);s(l)}if(e)return e(null,f);i(f)})})}function Qu(t,e,r=2){let n=e&&e.length,a=n?e[0]*r:t.length,i=Dy(t,0,a,r,!0),s=[];if(!i||i.next===i.prev)return s;let o,c,f;if(n&&(i=U_(t,e,i,r)),t.length>80*r){o=t[0],c=t[1];let l=o,u=c;for(let g=r;g<a;g+=r){let p=t[g],d=t[g+1];p<o&&(o=p),d<c&&(c=d),p>l&&(l=p),d>u&&(u=d)}f=Math.max(l-o,u-c),f=f!==0?32767/f:0}return Ci(i,s,r,o,c,f,0),s}function Dy(t,e,r,n,a){let i;if(a===j_(t,e,r,n)>0)for(let s=e;s<r;s+=n)i=Ry(s/n|0,t[s],t[s+1],i);else for(let s=r-n;s>=e;s-=n)i=Ry(s/n|0,t[s],t[s+1],i);return i&&Ea(i,i.next)&&(Oi(i),i=i.next),i}function In(t,e){if(!t)return t;e||(e=t);let r=t,n;do if(n=!1,!r.steiner&&(Ea(r,r.next)||Ae(r.prev,r,r.next)===0)){if(Oi(r),r=e=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==e);return e}function Ci(t,e,r,n,a,i,s){if(!t)return;!s&&i&&W_(t,n,a,i);let o=t;for(;t.prev!==t.next;){let c=t.prev,f=t.next;if(i?F_(t,n,a,i):V_(t)){e.push(c.i,t.i,f.i),Oi(t),t=f.next,o=f.next;continue}if(t=f,t===o){s?s===1?(t=k_(In(t),e),Ci(t,e,r,n,a,i,2)):s===2&&b_(t,e,r,n,a,i):Ci(In(t),e,r,n,a,i,1);break}}}function V_(t){let e=t.prev,r=t,n=t.next;if(Ae(e,r,n)>=0)return!1;let a=e.x,i=r.x,s=n.x,o=e.y,c=r.y,f=n.y,l=Math.min(a,i,s),u=Math.min(o,c,f),g=Math.max(a,i,s),p=Math.max(o,c,f),d=n.next;for(;d!==e;){if(d.x>=l&&d.x<=g&&d.y>=u&&d.y<=p&&Si(a,o,i,c,s,f,d.x,d.y)&&Ae(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function F_(t,e,r,n){let a=t.prev,i=t,s=t.next;if(Ae(a,i,s)>=0)return!1;let o=a.x,c=i.x,f=s.x,l=a.y,u=i.y,g=s.y,p=Math.min(o,c,f),d=Math.min(l,u,g),h=Math.max(o,c,f),v=Math.max(l,u,g),x=qu(p,d,e,r,n),T=qu(h,v,e,r,n),m=t.prevZ,y=t.nextZ;for(;m&&m.z>=x&&y&&y.z<=T;){if(m.x>=p&&m.x<=h&&m.y>=d&&m.y<=v&&m!==a&&m!==s&&Si(o,l,c,u,f,g,m.x,m.y)&&Ae(m.prev,m,m.next)>=0||(m=m.prevZ,y.x>=p&&y.x<=h&&y.y>=d&&y.y<=v&&y!==a&&y!==s&&Si(o,l,c,u,f,g,y.x,y.y)&&Ae(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;m&&m.z>=x;){if(m.x>=p&&m.x<=h&&m.y>=d&&m.y<=v&&m!==a&&m!==s&&Si(o,l,c,u,f,g,m.x,m.y)&&Ae(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=T;){if(y.x>=p&&y.x<=h&&y.y>=d&&y.y<=v&&y!==a&&y!==s&&Si(o,l,c,u,f,g,y.x,y.y)&&Ae(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function k_(t,e){let r=t;do{let n=r.prev,a=r.next.next;!Ea(n,a)&&Vy(n,r,r.next,a)&&wi(n,a)&&wi(a,n)&&(e.push(n.i,r.i,a.i),Oi(r),Oi(r.next),r=t=a),r=r.next}while(r!==t);return In(r)}function b_(t,e,r,n,a,i){let s=t;do{let o=s.next.next;for(;o!==s.prev;){if(s.i!==o.i&&P_(s,o)){let c=Fy(s,o);s=In(s,s.next),c=In(c,c.next),Ci(s,e,r,n,a,i,0),Ci(c,e,r,n,a,i,0);return}o=o.next}s=s.next}while(s!==t)}function U_(t,e,r,n){let a=[];for(let i=0,s=e.length;i<s;i++){let o=e[i]*n,c=i<s-1?e[i+1]*n:t.length,f=Dy(t,o,c,n,!1);f===f.next&&(f.steiner=!0),a.push(A_(f))}a.sort(N_);for(let i=0;i<a.length;i++)r=B_(a[i],r);return r}function N_(t,e){let r=t.x-e.x;if(r===0&&(r=t.y-e.y,r===0)){let n=(t.next.y-t.y)/(t.next.x-t.x),a=(e.next.y-e.y)/(e.next.x-e.x);r=n-a}return r}function B_(t,e){let r=G_(t,e);if(!r)return e;let n=Fy(r,t);return In(n,n.next),In(r,r.next)}function G_(t,e){let r=e,n=t.x,a=t.y,i=-1/0,s;if(Ea(t,r))return r;do{if(Ea(t,r.next))return r.next;if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){let u=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=n&&u>i&&(i=u,s=r.x<r.next.x?r:r.next,u===n))return s}r=r.next}while(r!==e);if(!s)return null;let o=s,c=s.x,f=s.y,l=1/0;r=s;do{if(n>=r.x&&r.x>=c&&n!==r.x&&Ly(a<f?n:i,a,c,f,a<f?i:n,a,r.x,r.y)){let u=Math.abs(a-r.y)/(n-r.x);wi(r,t)&&(u<l||u===l&&(r.x>s.x||r.x===s.x&&__(s,r)))&&(s=r,l=u)}r=r.next}while(r!==o);return s}function __(t,e){return Ae(t.prev,t,e.prev)<0&&Ae(e.next,t,t.next)<0}function W_(t,e,r,n){let a=t;do a.z===0&&(a.z=qu(a.x,a.y,e,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,z_(a)}function z_(t){let e,r=1;do{let n=t,a;t=null;let i=null;for(e=0;n;){e++;let s=n,o=0;for(let f=0;f<r&&(o++,s=s.nextZ,!!s);f++);let c=r;for(;o>0||c>0&&s;)o!==0&&(c===0||!s||n.z<=s.z)?(a=n,n=n.nextZ,o--):(a=s,s=s.nextZ,c--),i?i.nextZ=a:t=a,a.prevZ=i,i=a;n=s}i.nextZ=null,r*=2}while(e>1);return t}function qu(t,e,r,n,a){return t=(t-r)*a|0,e=(e-n)*a|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function A_(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Ly(t,e,r,n,a,i,s,o){return(a-s)*(e-o)>=(t-s)*(i-o)&&(t-s)*(n-o)>=(r-s)*(e-o)&&(r-s)*(i-o)>=(a-s)*(n-o)}function Si(t,e,r,n,a,i,s,o){return!(t===s&&e===o)&&Ly(t,e,r,n,a,i,s,o)}function P_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!H_(t,e)&&(wi(t,e)&&wi(e,t)&&I_(t,e)&&(Ae(t.prev,t,e.prev)||Ae(t,e.prev,e))||Ea(t,e)&&Ae(t.prev,t,t.next)>0&&Ae(e.prev,e,e.next)>0)}function Ae(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ea(t,e){return t.x===e.x&&t.y===e.y}function Vy(t,e,r,n){let a=Uo(Ae(t,e,r)),i=Uo(Ae(t,e,n)),s=Uo(Ae(r,n,t)),o=Uo(Ae(r,n,e));return!!(a!==i&&s!==o||a===0&&bo(t,r,e)||i===0&&bo(t,n,e)||s===0&&bo(r,t,n)||o===0&&bo(r,e,n))}function bo(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Uo(t){return t>0?1:t<0?-1:0}function H_(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Vy(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function wi(t,e){return Ae(t.prev,t,t.next)<0?Ae(t,e,t.next)>=0&&Ae(t,t.prev,e)>=0:Ae(t,e,t.prev)<0||Ae(t,t.next,e)<0}function I_(t,e){let r=t,n=!1,a=(t.x+e.x)/2,i=(t.y+e.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function Fy(t,e){let r=Zu(t.i,t.x,t.y),n=Zu(e.i,e.x,e.y),a=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Ry(t,e,r,n){let a=Zu(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function Oi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zu(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function j_(t,e,r,n){let a=0;for(let i=e,s=r-n;i<r;i+=n)a+=(t[s]-t[i])*(t[i+1]+t[s+1]),s=i;return a}var ky=`<table cellpadding=1 cellspacing=1>
    <tr>
        <td class="label">Eye model</td>
        <td>
            <input id="eyeToggle" type="checkbox" checked />
        </td>
    </tr>
    <tr>
        <td class="label" id="layerLabel1">Inner limiting membrane</td>
        <td>
            <input id="layerToggle1" type="checkbox" checked />
        </td>
    </tr>
    <tr>
        <td class="label" id="layerLabel5">Inner border of the outer nuclear layer</td>
        <td>
            <input id="layerToggle5" type="checkbox" checked />
        </td>
    </tr>
    <tr>
        <td class="label" id="layerLabel7">Inner border of the ellipsoid line</td>
        <td>
            <input id="layerToggle7" type="checkbox" checked />
        </td>
    </tr>
    <tr>
        <td class="label" id="layerLabel9">Outer border of the Bruch's membrane</td>
        <td>
            <input id="layerToggle9" type="checkbox" checked />
        </td>
    </tr>
    <tr><td id="model-license">This page incorporates <a href="https://www.thingiverse.com/thing:2833672" target="_blank">eye model</a> by Quinventor<br/>available under the <a href="https://creativecommons.org/licenses/by/4.0" target="_blank">CC BY 4.0</a> license.</td>
    </tr>
</table>
`;var $_=14,X_=48,Y_=.5,q_=3;var Z_=[1,5,7,9],Ny={1:[0,0,1],5:[0,1,0],7:[1,.647,0],9:[.5,0,.5]},By=["./data/Lens_Pupil.stl","./data/Retina_Optic_Disk.stl","./data/Chloroid_Cilliary_Body_Suspensory_Ligaments.stl","./data/Iris.stl","./data/Sclera.stl"],Q_=[[0,0,0],[.88,.64,.375],[1,.502,.482],[0,0,1],[1,1,1]],J_="https://fonts.gstatic.com/s/roboto/v15/zN7GBFwfMP4uA6AR0HCoLQ.ttf";function eW(t,e){let r=zs.newInstance();r.setExtent(0,t.shape[0]-1,0,t.shape[1]-1,0,t.shape[2]-1);let n=K.newInstance({numberOfComponents:1,values:t.data});r.getPointData().setScalars(n);let a=Om.newInstance(),i=Mm.newInstance();i.setSampleDistance(.7),a.setMapper(i),i.setInputData(r),i.setBlendMode(St.MAXIMUM_INTENSITY_BLEND);let s=ri.newInstance();s.addRGBPoint(0,0,0,0),s.addRGBPoint(e,1,0,0);let o=_n.newInstance();o.addPoint(0,0),o.addPoint(e*.1,0),o.addPoint(e*.25,.5),o.addPoint(e*.3,.9),o.addPoint(e,1);let c=a.getProperty();return c.setRGBTransferFunction(0,s),c.setScalarOpacity(0,o),c.setScalarOpacityUnitDistance(0,3),c.setInterpolationTypeToLinear(),a}function by(t,e,r,n=!0){let a=n?r-1:r,i=(e-t)/a;return Array.from({length:r},(s,o)=>Math.round(t+i*o))}function tW(t){let r={};for(let n of Z_){let a=[],i=[],s=0;for(let u of[0,1])for(let g of by(0,t.shape[u]-1,$_)){let p=[];for(let h of by(0,t.shape[1-u]-1,X_)){let v=u===0?g:h,x=u===0?h:g,T=t.data[n+t.shape[2]*(x+t.shape[1]*v)];p.push(v,T,x)}a.push(...p);let d=p.length/3;for(let h=0;h<d-1;h++)i.push(2),i.push(s+h),i.push(s+h+1);s+=d}let o=Re.newInstance();o.getPoints().setData(Float32Array.from(a),3),o.getLines().setData(Uint32Array.from(i));let c=ht.newInstance();c.setInputData(o);let f=Wt.newInstance();f.setMapper(c);let l=f.getProperty();l.setColor(Ny[n]),l.setOpacity(Y_),l.setLineWidth(q_),l.setBackfaceCulling(!1),l.setFrontfaceCulling(!1),r[n]=f}return r}async function rW(t){try{let e=By[t],r=Nm.newInstance(),n=ht.newInstance(),a=Wt.newInstance(),i=Dm.newInstance();i.setInputConnection(r.getOutputPort()),n.setInputConnection(i.getOutputPort()),a.setMapper(n),n.setScalarVisibility(!1);let o=await(await fetch(e)).arrayBuffer();r.parseAsArrayBuffer(o);let c=170;return a.setScale(c,c,c),t!==0?a.setPosition(55,-100,50):a.setPosition(-348,-100,50),a.getProperty().setColor(Q_[t]),a}catch(e){console.error("Error loading STL model:",e)}}function Uy(t,e){try{let r=jm.newInstance({earcut:Qu}),n=ht.newInstance(),a=Wt.newInstance();return n.setInputConnection(r.getOutputPort()),a.setMapper(n),r.setFont(e),r.setText(t),a}catch(r){console.error("Error loading font or setting up text:",r)}}function nW(t){let e=ht.newInstance(),r=ri.newInstance();r.addRGBPoint(0,0,0,0),r.addRGBPoint(t,1,0,0),e.setColorModeToMapScalars(),e.setLookupTable(r),e.setScalarRange(0,t),e.setScalarVisibility(!0);let n=pa.newInstance();return n.setAxisLabel("Attribution"),n.setAxisTextStyle({fontColor:"black",fontSize:20,fontFamily:"arial"}),n.setScalarsToColors(r),n.setTickTextStyle({fontColor:"black",fontSize:20,fontFamily:"arial"}),n.setDrawNanAnnotation(!1),n}async function aW(){let t=ym.newInstance({background:[1,1,1]});t.addController(ky);let e=t.getRenderWindow(),r=t.getRenderer(),n=new Xm,a=await n.load("./data/attr.npy"),i=a.data.reduce((h,v)=>Math.max(h,v),-1/0),s=await n.load("./data/layers.npy"),o=eW(a,i);r.addVolume(o);let c=nW(i);r.addActor2D(c);let f=tW(s);for(let[h,v]of Object.entries(f)){r.addActor(v);let x=document.querySelector("#layerLabel"+h.toString()),T=Ny[h];x.style.color=`rgb(${Math.round(T[0]*255)}, ${Math.round(T[1]*255)}, ${Math.round(T[2]*255)})`,document.querySelector("#layerToggle"+h.toString()).addEventListener("change",y=>{let S=y.target.checked;v.setVisibility(S),e.render()})}let l=[];for(let h=0;h<By.length;h++){let v=await rW(h);l.push(v),r.addActor(v)}document.querySelector("#eyeToggle").addEventListener("change",h=>{let v=h.target.checked;l.forEach(x=>{x.setVisibility(v)}),r.resetCamera(),e.render()});let g=await My(J_),p=Uy("Temporal",g);p.setPosition(-15,30,75),p.setScale(1,1,1),p.setOrientation(0,-90,-270),p.getProperty().setColor(0,0,1),r.addActor(p);let d=Uy("Nasal",g);d.setPosition(115,30,65),d.setScale(1,1,1),d.setOrientation(0,-90,-270),d.getProperty().setColor(1,0,0),r.addActor(d),r.resetCamera(),e.render()}async function iW(){let t=document.querySelector("#loading-overlay");try{await aW()}catch(e){console.error("Failed to load the visualisation:",e),t.innerHTML="<p>Error creating visualisation. Please try refreshing.</p>"}finally{t.style.display="none"}}iW();
/*! Bundled license information:

opentype.js/dist/opentype.module.js:
  (*! https://mths.be/codepointat v0.2.0 by @mathias *)
*/
//# sourceMappingURL=bundle.js.map
